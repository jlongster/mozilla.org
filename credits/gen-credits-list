#!/usr/bin/perl -w

use Text::Unaccent;

usage() if !$ARGV[0];
my %names;

open(my $fh,'<:encoding(utf8)', $ARGV[0]);
binmode(STDOUT, ":utf8");

while (<$fh>) {
    chomp;
    my $name = $_;
    $name = trim($name);
    next if !$name;
    
    my $letter = uc(unac_string('utf-8', substr($name, 0, 1)));
    $names{$letter} = [] if !$names{$letter};
    push (@{ $names{$letter} }, $name);
}

print "\n<!-- Autogenerated list - do not edit manually. -->\n";

foreach my $letter (sort keys %names) {
    print <<END;

<h2><a name="$letter">$letter</a></h2>
<p>
END
    my @sorted_names = sort({ unac_string('utf-8', lc($a)) cmp 
                              unac_string('utf-8', lc($b))    } 
                           @{ $names{$letter} });
    my @rearranged_names = map { 
        my ($last, $first) = split(",");
        $last = trim($last);
        $first = trim($first);
        $first ? "$first $last" : $last;
    } @sorted_names;
    print join(",\n", @rearranged_names);
    
    print "\n</p>\n";
}

exit;

sub usage {
    print "Usage: gen-credits-list <list-of-names.txt>\n";
    exit;
}

sub trim {
    my $str = shift;
    $str =~ s/^\s+//; # start trim
    $str =~ s/\s+$//; # end trim
    return $str;
}
