<?xml version="1.0" encoding="ascii"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
          "DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>nss</title>
  <link rel="stylesheet" href="epydoc.css" type="text/css" />
  <script type="text/javascript" src="epydoc.js"></script>
</head>

<body bgcolor="white" text="black" link="blue" vlink="#204080"
      alink="#204080">
<!-- ==================== NAVIGATION BAR ==================== -->
<table class="navbar" border="0" width="100%" cellpadding="0"
       bgcolor="#a0c0ff" cellspacing="0">
  <tr valign="middle">
  <!-- Home link -->
      <th bgcolor="#70b0f0" class="navbar-select"
          >&nbsp;&nbsp;&nbsp;Home&nbsp;&nbsp;&nbsp;</th>

  <!-- Tree link -->
      <th>&nbsp;&nbsp;&nbsp;<a
        href="module-tree.html">Trees</a>&nbsp;&nbsp;&nbsp;</th>

  <!-- Index link -->
      <th>&nbsp;&nbsp;&nbsp;<a
        href="identifier-index.html">Indices</a>&nbsp;&nbsp;&nbsp;</th>

  <!-- Help link -->
      <th>&nbsp;&nbsp;&nbsp;<a
        href="help.html">Help</a>&nbsp;&nbsp;&nbsp;</th>

      <th class="navbar" width="100%"></th>
  </tr>
</table>
<table width="100%" cellpadding="0" cellspacing="0">
  <tr valign="top">
    <td width="100%">
      <span class="breadcrumbs">
        Package&nbsp;nss
      </span>
    </td>
    <td>
      <table cellpadding="0" cellspacing="0">
        <!-- hide/show private -->
        <tr><td align="right"><span class="options">[<a href="javascript:void(0);" class="privatelink"
    onclick="toggle_private();">hide&nbsp;private</a>]</span></td></tr>
        <tr><td align="right"><span class="options"
            >[<a href="frames.html" target="_top">frames</a
            >]&nbsp;|&nbsp;<a href="nss-module.html"
            target="_top">no&nbsp;frames</a>]</span></td></tr>
      </table>
    </td>
  </tr>
</table>
<!-- ==================== PACKAGE DESCRIPTION ==================== -->
<h1 class="epydoc">Package nss</h1><p class="nomargin-top"><span class="codelink"><a href="nss-pysrc.html">source&nbsp;code</a></span></p>
<div class="rst-section" id="rst-introduction">
<h1 class="heading">Introduction</h1>
<p>This package provides a binding for the Network Security Services
(NSS) library. Because NSS directly uses the Netscape Portable Runtime
(NSPR) the binding also provides support for NSPR. There is an
inherent conflict between NSPR and Python, please see the Issues
section for more detail.</p>
<p>General documentation on NSS can be found here:</p>
<p><a class="rst-reference external" href="http://www.mozilla.org/projects/security/pki/nss" target="_top">http://www.mozilla.org/projects/security/pki/nss</a></p>
<p>General documentation on NSPR can be found here:</p>
<p><a class="rst-reference external" href="http://developer.mozilla.org/en/docs/NSPR_API_Reference" target="_top">http://developer.mozilla.org/en/docs/NSPR_API_Reference</a></p>
<p>Please note, the documentation included with this package already
encapsultes most of the information at the above two URL's, but is
specific to the python binding of NSS/NSPR. It is suggested you refer
to the python-nss documentation.</p>
<p>Most of the names and symbols in the NSS/NSPR C API have been kept in
the nss-python binding and should be instantly familar or
recognizable. Python has different naming conventions and the
nss-python binding has adhered to the python naming convensions,
Classes are camel case, otherwise symbols are all lower case with
words seperated by underscores. The constants used by NSS/NSPR in C
API have been imported literally to add the programmer who might be
referring to the Mozilla NSS/NSPR documentation and/or header files or
who is porting an existing C application to python. Minor other
changes have been made in the interest of being &quot;Pythonic&quot;.</p>
</div>
<div class="rst-section" id="rst-deprecated-functionality">
<h1 class="heading">Deprecated Functionality</h1>
<p>Some elements of the binding have been deprecated because of lessons
learned along the way. The following emit deprecation warnings and
should not be used, they will be removed in a subsequent release.</p>
<dl class="rst-docutils">
<dt><a href="nss.io.NetworkAddress-class.html" class="link">io.NetworkAddress()</a></dt>
<dd><a href="nss.io.NetworkAddress-class.html" class="link">NetworkAddress</a> initialization from a string parameter only works
for IPv4, use <a href="nss.io.AddrInfo-class.html" class="link">AddrInfo</a> instead.</dd>
<dt><a href="nss.io.NetworkAddress-class.html#set_from_string" class="link">io.NetworkAddress.set_from_string()</a></dt>
<dd><a href="nss.io.NetworkAddress-class.html" class="link">NetworkAddress</a> initialization from a string parameter only works
for IPv4, use <a href="nss.io.AddrInfo-class.html" class="link">AddrInfo</a> instead.</dd>
<dt><a href="nss.io.NetworkAddress-class.html#hostentry" class="link">io.NetworkAddress.hostentry</a></dt>
<dd><a href="nss.io.HostEntry-class.html" class="link">HostEntry</a> objects only support IPv4, this property will be
removed, use <a href="nss.io.AddrInfo-class.html" class="link">AddrInfo</a> instead.</dd>
<dt><a href="nss.io.HostEntry-class.html#get_network_addresses" class="link">io.HostEntry.get_network_addresses()</a></dt>
<dd>Use iteration instead (e.g. for net_adder in hostentry), the port
parameter is not respected, port will be value when <a href="nss.io.HostEntry-class.html" class="link">HostEntry</a>
object was created.</dd>
<dt><a href="nss.io.HostEntry-class.html#get_network_address" class="link">io.HostEntry.get_network_address()</a></dt>
<dd>Use indexing instead (e.g. hostentry[i]), the port parameter is
not respected, port will be value when <a href="nss.io.HostEntry-class.html" class="link">HostEntry</a> object was
created.</dd>
<dt><a href="nss.ssl-module.html#nssinit" class="link">ssl.nssinit()</a></dt>
<dd>nssinit has been moved to the nss module, use <a href="nss.nss-module.html#nss_init" class="link">nss.nss_init()</a>
instead of ssl.nssinit</dd>
<dt><a href="nss.ssl-module.html#nss_init" class="link">ssl.nss_init()</a></dt>
<dd>nss_init has been moved to the nss module, use <a href="nss.nss-module.html#nss_init" class="link">nss.nss_init()</a>
instead of ssl.nssinit</dd>
<dt><a href="nss.ssl-module.html#nss_shutdown" class="link">ssl.nss_shutdown()</a></dt>
<dd>nss_shutdown() has been moved to the nss module, use
<a href="nss.nss-module.html#nss_shutdown" class="link">nss.nss_shutdown()</a> instead of ssl.nss_shutdown()</dd>
<dt><a href="nss.io.Socket-class.html" class="link">io.Socket()</a> and <a href="nss.ssl.SSLSocket-class.html" class="link">ssl.SSLSocket()</a> without explicit family parameter</dt>
<dd>Socket initialization will require the family parameter in the future.
The default family parameter of PR_AF_INET is deprecated because
when iterating through <a href="nss.io.NetworkAddress-class.html" class="link">NetworkAddress</a> objects returned by
<a href="nss.io.AddrInfo-class.html" class="link">AddrInfo</a> some address may be an IPv6 address. Suggest using the
family property of the NetworkAddress object associated with the
socket, e.g. Socket(net_addr.family)</dd>
</dl>
</div>
<div class="rst-section" id="rst-getting-started">
<h1 class="heading">Getting Started</h1>
<p>NSS stores it's certificates and private keys in a security database
unlike OpenSSL which references it's certificates and keys via file
pathnames. This means unless you already have an NSS Certificate
Database (CertDB) the first order of business will be to create
one. When a NSS application initializes itself it will need to specify
the path to the CertDB (see &quot;Things All NSS programs must do&quot;).</p>
<p>The CertDB is created and manipulated by the command line utilities
certutil and modutil. Both of these programs are part of the nss-tools
RPM. Documentation for these tools can be found here:
<a class="rst-reference external" href="http://www.mozilla.org/projects/security/pki/nss/tools" target="_top">http://www.mozilla.org/projects/security/pki/nss/tools</a></p>
<p>Here is an example of creating a CertDB and populating it. In the
example the CertDB will be created under the directory &quot;./pki&quot;, the CA
will be called &quot;myca&quot;, the database password will be &quot;myca&quot;, and the
server's hostname will be &quot;myhost.example.com&quot;.</p>
<ol class="rst-arabic">
<li><p class="rst-first">Create the database:</p>
<pre class="rst-literal-block">
certutil -N -d ./pki
</pre>
<p>This creates a new database under the directory ./pki</p>
</li>
<li><p class="rst-first">Create a root CA certificate:</p>
<pre class="rst-literal-block">
certutil -d ./pki -S -s &quot;CN=myca&quot; -n myca -x -t &quot;CTu,C,C&quot; -m 1
</pre>
<p>This creates an individual certificate and adds it to the
certificate database with a subject of &quot;CN=myca&quot;, a nickname of
&quot;myca&quot;, trust flags indicating for SSL indicating it can issue
server certificates (C), can issue client certificates (T), and the
certificate can be used for authentication and signing (u). For
email and object signing it's trusted to create server
certificates. The certificate serial number is set to 1.</p>
</li>
<li><p class="rst-first">Create a server certificate and sign it. Our example server will
use this:</p>
<pre class="rst-literal-block">
certutil -d pki -S -c myca -s &quot;CN=myhost.example.com&quot; -n myhost -t &quot;u,u,u&quot; -m 2
</pre>
<p>This creates an individual certificate issued by the CA &quot;myca&quot; and
adds it to the certificate database with a subject of
&quot;CN=myhost.example.com&quot;, a nickname of &quot;myhost&quot;. The certificate
serial number is set to 2.</p>
</li>
<li><p class="rst-first">Import public root CA's:</p>
<pre class="rst-literal-block">
modutil -add ca_certs -libfile /usr/lib/libnssckbi.so -dbdir ./pki
</pre>
<p>This is necessary to verify certificates presented by a SSL server a
NSS client might connect to. When verifying a certificate the NSS
library will &quot;walk the certificate chain&quot; back to a root CA which
must be trusted. This command imports the well known root CA's as a
PKCS #11 module.</p>
</li>
</ol>
</div>
<div class="rst-section" id="rst-things-all-nss-programs-must-do">
<h1 class="heading">Things All NSS programs must do</h1>
<ul>
<li><p class="rst-first">Import the NSS/NSPR modules:</p>
<pre class="rst-literal-block">
from nss.error import NSPRError
import nss.io as io
import nss.nss as nss
import nss.ssl as ssl
</pre>
<p>In the interest of code brevity we drop the leading &quot;nss.&quot; from the
module namespace.</p>
</li>
<li><p class="rst-first">Initialize NSS and indicate the certficate database (CertDB):</p>
<pre class="rst-literal-block">
certdir = './pki'
ssl.nssinit(certdir)
</pre>
</li>
<li><p class="rst-first">If you are implementing an SSL server call config_secure_server()
(see ssl_example.py):</p>
<pre class="rst-literal-block">
sock = ssl.SSLSocket(net_addr.family)
sock.config_secure_server(server_cert, priv_key, server_cert_kea)
</pre>
<p><strong>WARNING</strong> you must call config_secure_server() for SSL servers, if
you do not call it the most likely result will be the NSS library
will segfault (not pretty).</p>
</li>
</ul>
</div>
<div class="rst-section" id="rst-examples">
<h1 class="heading">Examples</h1>
<p>There are example programs in under &quot;examples&quot; in the documentation
directory. On Fedora/RHEL/CentOS systems this will be
/usr/share/doc/python-nss.</p>
<p>The ssl_example.py sample implements both a client and server in one
script. You tell it whether to run as a client (-C) or a server (-S)
when you invoke it. The sample shows many of the NSS/NSPR calls and
fully implements basic non-SSL client/server using NSPR, SSL
client/server using NSS, certificate validation, CertDB operations,
and client authentication using certificates.</p>
<p>To get a list of command line options:</p>
<pre class="rst-literal-block">
ssl_example.py --help
</pre>
<p>Using the above example certificate database server can be run like
this:</p>
<pre class="rst-literal-block">
ssl_example.py -S -c ./pki -n myhost
</pre>
<p>The client can be run like this:</p>
<pre class="rst-literal-block">
ssl_example.py -C -c ./pki
</pre>
</div>
<div class="rst-section" id="rst-issues">
<h1 class="heading">Issues</h1>
<ul>
<li><p class="rst-first">The current partitioning of the NSS and NSPR API's into Python
modules (i.e. the Python namespaces and their symbols) is a first
cut and may not be ideal. One should be prepared for name changes as
the binding matures.</p>
</li>
<li><p class="rst-first">NSPR vs. Python</p>
<blockquote>
<p>An original design goal of NSS was to be portable, however NSS
required access to many system level functions which can vary
widely between platforms and OS's. Therefore NSPR was written to
encapsulate system services such as IO, sockets, threads, timers,
etc. into a common API to insulate NSS from the underlying
platform.</p>
<p>In many respects Python and its collection of packages and modules
provides the same type of platform independence for applications
and libraries and provides it's own implementation of IO, sockets,
threads, timers, etc.</p>
<p>Unfortunately NSPR's and Python's run time abstractions are not
the same nor can either be configured to use a different
underlying abstraction layer.</p>
<p>Currently the NSS binding utilizes <em>only</em> the NSPR abstraction
layer. One consequence of this is it is not possible to create a
Python socket and use it as the foundation for any NSS functions
expecting a socket, or visa versa.</p>
<p>You <strong>must</strong> use the nss.io module to create and manipulate a
socket used by NSS. You cannot pass this socket to any Python
library function expecting a socket. The two are not compatible.</p>
<p>Here are some reasons for this incompatibility, perhaps in the
future we can find a solution but the immediate goal of the NSS
Python binding was to expose NSS through Python, not necessarily
to solve the larger integration issue of Python run-time and NSPR
run-time.</p>
<ul>
<li><p class="rst-first">NSPR would like to hide the underlying platform socket (in the
NSPR code this is called &quot;osfd&quot;). There are NSPR API's which
will operate on osfd's</p>
<ul>
<li><p class="rst-first">One can base a NSPR socket on an existing osfd via:</p>
<ul class="rst-simple">
<li>PR_ImportFile()</li>
<li>PR_ImportPipe()</li>
<li>PR_ImportTCPSocket()</li>
<li>PR_ImportUDPSocket()</li>
</ul>
</li>
<li><p class="rst-first">One can obtain the osfd in use by NSPR, either when the
osfd was imported or because NSPR created the osfd itself via:</p>
<ul class="rst-simple">
<li>PR_FileDesc2NativeHandle();</li>
</ul>
<p>But note this function is not meant to be public in the NSPR
API and is documented as being deprecated and carries an
explicit warning against it's use.</p>
</li>
</ul>
<p>Once NSPR gets a hold of an osfd it manipulates it in a manner
as if it were the only owner of the osfd. Other native code
(e.g. the CPython socket code) which operates on the fd may run
afoul of NSPR belief it is the only code in the system operating
on the fd. For example in CPython the non-blocking flag is
directly set on the fd and non-blocking behavior is implemented
by the OS. However, NSPR manages non-blocking behavior
internally to the NSPR library eschewing direct OS support for
non-blocking. Thus CPython and NSPR are in direct conflict over
when and how non-blocking is set on an fd. Examples of this
problem can be seen in the Python socket.makefile() operation
which takes the fd belonging to a system socket, dups it, and
calls fdopen() on the dup'ed fd to return a FILE stream (all
Python file IO is based on file objects utilizing a FILE
stream). However, the dup'ed fd does not share the same
non-blocking flag, NSPR explicitly forces the flag off, Python
wants to directly manipulate it. Dup'ed fd's share their flags
thus if Python operates on the dup'ed fd returned by NSPR it's
going to confuse NSPR. Likewise if one sets non-blocking via
NSPR then Python won't honor the flag because Python is
expecting the flag to be set on the fd, not in some other
location (e.g. internal to NSPR).</p>
</li>
<li><p class="rst-first">Python's socket implementation is a very thin layer over the
Berkely socket API. There is very little abstraction, thus
Python and Python program expect to manipulate sockets directly
via their fd's.</p>
</li>
<li><p class="rst-first">The error and exception model for Python sockets and SSL is an
almost direct one-to-one mapping of the Posix and OpenSSL
errors. But NSS uses NSPR errors, thus Python code which has
exception handlers for sockets and SSL are expecting a complete
different set of exceptions.</p>
</li>
<li><p class="rst-first">Python's SSL implementation is a very thin layer over the
OpenSSL API, there is little abstraction. Thus there is a
sizeable body of Python code which expects the OpenSSL model for
IO ready and has exception handlers based on OpenSSL.</p>
</li>
</ul>
</blockquote>
</li>
</ul>
</div>
<div class="rst-section" id="rst-faq">
<h1 class="heading">FAQ</h1>
<p>To be added</p>
</div>

<hr />
<div class="fields">      <p><strong>Version:</strong>
        0.11
      </p>
</div><!-- ==================== SUBMODULES ==================== -->
<a name="section-Submodules"></a>
<table class="summary" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr bgcolor="#70b0f0" class="table-header">
  <td colspan="2" class="table-header">
    <table border="0" cellpadding="0" cellspacing="0" width="100%">
      <tr valign="top">
        <td align="left"><span class="table-header">Submodules</span></td>
        <td align="right" valign="top"
         ><span class="options">[<a href="#section-Submodules"
         class="privatelink" onclick="toggle_private();"
         >hide private</a>]</span></td>
      </tr>
    </table>
  </td>
</tr>
  <tr><td class="summary">
  <ul class="nomargin">
    <li> <strong class="uidlink"><a href="nss.error-module.html">nss.error</a></strong>: <em class="summary">This module defines the NSPR errors and provides functions to
manipulate them.</em>    </li>
    <li> <strong class="uidlink"><a href="nss.io-module.html">nss.io</a></strong>: <em class="summary">This module implements the NSPR IO functions</em>    </li>
    <li> <strong class="uidlink"><a href="nss.nss-module.html">nss.nss</a></strong>: <em class="summary">This module implements the NSS functions</em>    </li>
    <li> <strong class="uidlink"><a href="nss.ssl-module.html">nss.ssl</a></strong>: <em class="summary">This module implements the SSL functionality in NSS</em>    </li>
  </ul></td></tr>
</table>

<br />
<!-- ==================== VARIABLES ==================== -->
<a name="section-Variables"></a>
<table class="summary" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr bgcolor="#70b0f0" class="table-header">
  <td colspan="2" class="table-header">
    <table border="0" cellpadding="0" cellspacing="0" width="100%">
      <tr valign="top">
        <td align="left"><span class="table-header">Variables</span></td>
        <td align="right" valign="top"
         ><span class="options">[<a href="#section-Variables"
         class="privatelink" onclick="toggle_private();"
         >hide private</a>]</span></td>
      </tr>
    </table>
  </td>
</tr>
<tr>
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
        <a name="__package__"></a><span class="summary-name">__package__</span> = <code title="None">None</code>
    </td>
  </tr>
</table>
<!-- ==================== NAVIGATION BAR ==================== -->
<table class="navbar" border="0" width="100%" cellpadding="0"
       bgcolor="#a0c0ff" cellspacing="0">
  <tr valign="middle">
  <!-- Home link -->
      <th bgcolor="#70b0f0" class="navbar-select"
          >&nbsp;&nbsp;&nbsp;Home&nbsp;&nbsp;&nbsp;</th>

  <!-- Tree link -->
      <th>&nbsp;&nbsp;&nbsp;<a
        href="module-tree.html">Trees</a>&nbsp;&nbsp;&nbsp;</th>

  <!-- Index link -->
      <th>&nbsp;&nbsp;&nbsp;<a
        href="identifier-index.html">Indices</a>&nbsp;&nbsp;&nbsp;</th>

  <!-- Help link -->
      <th>&nbsp;&nbsp;&nbsp;<a
        href="help.html">Help</a>&nbsp;&nbsp;&nbsp;</th>

      <th class="navbar" width="100%"></th>
  </tr>
</table>
<table border="0" cellpadding="0" cellspacing="0" width="100%%">
  <tr>
    <td align="left" class="footer">
    Generated by Epydoc 3.0.1 on Fri Apr 15 10:07:31 2011
    </td>
    <td align="right" class="footer">
      <a target="mainFrame" href="http://epydoc.sourceforge.net"
        >http://epydoc.sourceforge.net</a>
    </td>
  </tr>
</table>

<script type="text/javascript">
  <!--
  // Private objects are initially displayed (because if
  // javascript is turned off then we want them to be
  // visible); but by default, we want to hide them.  So hide
  // them unless we have a cookie that says to show them.
  checkCookie();
  // -->
</script>
</body>
</html>
