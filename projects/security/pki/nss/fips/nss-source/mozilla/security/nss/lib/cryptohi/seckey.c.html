<?php

$html_title = '/export/nss_3_11_2/mozilla/security/nss/lib/cryptohi/seckey.c';

$menu = array(
    'id' => 'default',
);

$extra_headers = '
<meta name="generator" content=
"HTML Tidy for Windows (vers 14 February 2006), see www.w3.org">
<meta http-equiv="Content-Language" content="en">
<meta http-equiv="Content-Style-Type" content="text/css">
';

require_once "{$config['file_root']}/includes/header.inc.php"

?>

  <pre>
<strong><a name="1">    1</a></strong> /* ***** BEGIN LICENSE BLOCK *****
<strong><a name="2">    2</a></strong>  * Version: MPL 1.1/GPL 2.0/LGPL 2.1
<strong><a name="3">    3</a></strong>  *
<strong><a name=
"4">    4</a></strong>  * The contents of this file are subject to the Mozilla Public License Version
<strong><a name=
"5">    5</a></strong>  * 1.1 (the "License"); you may not use this file except in compliance with
<strong><a name=
"6">    6</a></strong>  * the License. You may obtain a copy of the License at
<strong><a name="7">    7</a></strong>  * http://www.mozilla.org/MPL/
<strong><a name="8">    8</a></strong>  *
<strong><a name=
"9">    9</a></strong>  * Software distributed under the License is distributed on an "AS IS" basis,
<strong><a name=
"10">   10</a></strong>  * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License
<strong><a name=
"11">   11</a></strong>  * for the specific language governing rights and limitations under the
<strong><a name="12">   12</a></strong>  * License.
<strong><a name="13">   13</a></strong>  *
<strong><a name=
"14">   14</a></strong>  * The Original Code is the Netscape security libraries.
<strong><a name="15">   15</a></strong>  *
<strong><a name=
"16">   16</a></strong>  * The Initial Developer of the Original Code is
<strong><a name="17">   17</a></strong>  * Netscape Communications Corporation.
<strong><a name=
"18">   18</a></strong>  * Portions created by the Initial Developer are Copyright (C) 1994-2000
<strong><a name=
"19">   19</a></strong>  * the Initial Developer. All Rights Reserved.
<strong><a name="20">   20</a></strong>  *
<strong><a name="21">   21</a></strong>  * Contributor(s):
<strong><a name=
"22">   22</a></strong>  *   Dr Stephen Henson &lt;stephen.henson@gemplus.com&gt;
<strong><a name=
"23">   23</a></strong>  *   Dr Vipul Gupta &lt;vipul.gupta@sun.com&gt;, Sun Microsystems Laboratories
<strong><a name="24">   24</a></strong>  *
<strong><a name=
"25">   25</a></strong>  * Alternatively, the contents of this file may be used under the terms of
<strong><a name=
"26">   26</a></strong>  * either the GNU General Public License Version 2 or later (the "GPL"), or
<strong><a name=
"27">   27</a></strong>  * the GNU Lesser General Public License Version 2.1 or later (the "LGPL"),
<strong><a name=
"28">   28</a></strong>  * in which case the provisions of the GPL or the LGPL are applicable instead
<strong><a name=
"29">   29</a></strong>  * of those above. If you wish to allow use of your version of this file only
<strong><a name=
"30">   30</a></strong>  * under the terms of either the GPL or the LGPL, and not to allow others to
<strong><a name=
"31">   31</a></strong>  * use your version of this file under the terms of the MPL, indicate your
<strong><a name=
"32">   32</a></strong>  * decision by deleting the provisions above and replace them with the notice
<strong><a name=
"33">   33</a></strong>  * and other provisions required by the GPL or the LGPL. If you do not delete
<strong><a name=
"34">   34</a></strong>  * the provisions above, a recipient may use your version of this file under
<strong><a name=
"35">   35</a></strong>  * the terms of any one of the MPL, the GPL or the LGPL.
<strong><a name="36">   36</a></strong>  *
<strong><a name="37">   37</a></strong>  * ***** END LICENSE BLOCK ***** */
<strong><a name="38">   38</a></strong> #include "cryptohi.h"
<strong><a name="39">   39</a></strong> #include "keyhi.h"
<strong><a name="40">   40</a></strong> #include "secoid.h"
<strong><a name="41">   41</a></strong> #include "secitem.h"
<strong><a name="42">   42</a></strong> #include "secder.h"
<strong><a name="43">   43</a></strong> #include "base64.h"
<strong><a name="44">   44</a></strong> #include "secasn1.h"
<strong><a name="45">   45</a></strong> #include "cert.h"
<strong><a name="46">   46</a></strong> #include "pk11func.h"
<strong><a name="47">   47</a></strong> #include "secerr.h"
<strong><a name="48">   48</a></strong> #include "secdig.h"
<strong><a name="49">   49</a></strong> #include "prtime.h"
<strong><a name="50">   50</a></strong> #include "ec.h"
<strong><a name="51">   51</a></strong>
<strong><a name="52">   52</a></strong> const <a href=
"../util/secasn1t.h.dep.html#SEC_ASN1Template">SEC_ASN1Template</a> <a href=
"#52">CERT_SubjectPublicKeyInfoTemplate</a>[] = {
<strong><a name="53">   53</a></strong>     { <a href=
"../util/secasn1t.h.dep.html#SEC_ASN1_SEQUENCE">SEC_ASN1_SEQUENCE</a>,
<strong><a name="54">   54</a></strong>           0, <a href=
"../mozilla/dbm/include/ncompat.h.dep.html#NULL">NULL</a>, sizeof(<a href=
"../certdb/certt.h.dep.html#CERTSubjectPublicKeyInfo">CERTSubjectPublicKeyInfo</a>) },
<strong><a name="55">   55</a></strong>     { <a href=
"../util/secasn1t.h.dep.html#SEC_ASN1_INLINE">SEC_ASN1_INLINE</a>,
<strong><a name="56">   56</a></strong>           offsetof(<a href=
"../certdb/certt.h.dep.html#CERTSubjectPublicKeyInfo">CERTSubjectPublicKeyInfo</a>,algorithm),
<strong><a name="57">   57</a></strong>           <a href=
"../util/secalgid.c.dep.html#SECOID_AlgorithmIDTemplate">SECOID_AlgorithmIDTemplate</a><a href="../util/secoid.h.dep.html#SECOID_AlgorithmIDTemplate">[1]</a> },
<strong><a name="58">   58</a></strong>     { <a href=
"../util/secasn1t.h.dep.html#SEC_ASN1_BIT_STRING">SEC_ASN1_BIT_STRING</a>,
<strong><a name="59">   59</a></strong>           offsetof(<a href=
"../certdb/certt.h.dep.html#CERTSubjectPublicKeyInfo">CERTSubjectPublicKeyInfo</a>,subjectPublicKey), },
<strong><a name="60">   60</a></strong>     { 0, }
<strong><a name="61">   61</a></strong> };
<strong><a name="62">   62</a></strong>
<strong><a name="63">   63</a></strong> const <a href=
"../util/secasn1t.h.dep.html#SEC_ASN1Template">SEC_ASN1Template</a> <a href=
"#63">CERT_PublicKeyAndChallengeTemplate</a>[] =
<strong><a name="64">   64</a></strong> {
<strong><a name="65">   65</a></strong>     { <a href=
"../util/secasn1t.h.dep.html#SEC_ASN1_SEQUENCE">SEC_ASN1_SEQUENCE</a>, 0, <a href="../mozilla/dbm/include/ncompat.h.dep.html#NULL">NULL</a>, sizeof(<a href="../certdb/certt.h.dep.html#CERTPublicKeyAndChallenge">CERTPublicKeyAndChallenge</a>) },
<strong><a name="66">   66</a></strong>     { <a href=
"../util/secasn1t.h.dep.html#SEC_ASN1_ANY">SEC_ASN1_ANY</a>, offsetof(<a href=
"../certdb/certt.h.dep.html#CERTPublicKeyAndChallenge">CERTPublicKeyAndChallenge</a>,spki) },
<strong><a name="67">   67</a></strong>     { <a href=
"../util/secasn1t.h.dep.html#SEC_ASN1_IA5_STRING">SEC_ASN1_IA5_STRING</a>, offsetof(<a href="../certdb/certt.h.dep.html#CERTPublicKeyAndChallenge">CERTPublicKeyAndChallenge</a>,challenge) },
<strong><a name="68">   68</a></strong>     { 0 }
<strong><a name="69">   69</a></strong> };
<strong><a name="70">   70</a></strong>
<strong><a name="71">   71</a></strong> const <a href=
"../util/secasn1t.h.dep.html#SEC_ASN1Template">SEC_ASN1Template</a> <a href=
"#71">SECKEY_RSAPublicKeyTemplate</a>[] = {
<strong><a name="72">   72</a></strong>     { <a href=
"../util/secasn1t.h.dep.html#SEC_ASN1_SEQUENCE">SEC_ASN1_SEQUENCE</a>, 0, <a href="../mozilla/dbm/include/ncompat.h.dep.html#NULL">NULL</a>, sizeof(<a href="../cryptohi/keythi.h.dep.html#SECKEYPublicKey">SECKEYPublicKey</a>) },
<strong><a name="73">   73</a></strong>     { <a href=
"../util/secasn1t.h.dep.html#SEC_ASN1_INTEGER">SEC_ASN1_INTEGER</a>, offsetof(<a href="../cryptohi/keythi.h.dep.html#SECKEYPublicKey">SECKEYPublicKey</a>,u.rsa.modulus), },
<strong><a name="74">   74</a></strong>     { <a href=
"../util/secasn1t.h.dep.html#SEC_ASN1_INTEGER">SEC_ASN1_INTEGER</a>, offsetof(<a href="../cryptohi/keythi.h.dep.html#SECKEYPublicKey">SECKEYPublicKey</a>,u.rsa.publicExponent), },
<strong><a name="75">   75</a></strong>     { 0, }
<strong><a name="76">   76</a></strong> };
<strong><a name="77">   77</a></strong>
<strong><a name="78">   78</a></strong> const <a href=
"../util/secasn1t.h.dep.html#SEC_ASN1Template">SEC_ASN1Template</a> <a href=
"#78">SECKEY_DSAPublicKeyTemplate</a>[] = {
<strong><a name="79">   79</a></strong>     { <a href=
"../util/secasn1t.h.dep.html#SEC_ASN1_INTEGER">SEC_ASN1_INTEGER</a>, offsetof(<a href="../cryptohi/keythi.h.dep.html#SECKEYPublicKey">SECKEYPublicKey</a>,u.dsa.publicValue), },
<strong><a name="80">   80</a></strong>     { 0, }
<strong><a name="81">   81</a></strong> };
<strong><a name="82">   82</a></strong>
<strong><a name="83">   83</a></strong> const <a href=
"../util/secasn1t.h.dep.html#SEC_ASN1Template">SEC_ASN1Template</a> <a href=
"#83">SECKEY_PQGParamsTemplate</a>[] = {
<strong><a name="84">   84</a></strong>     { <a href=
"../util/secasn1t.h.dep.html#SEC_ASN1_SEQUENCE">SEC_ASN1_SEQUENCE</a>, 0, <a href="../mozilla/dbm/include/ncompat.h.dep.html#NULL">NULL</a>, sizeof(<a href="../cryptohi/keythi.h.dep.html#SECKEYPQGParams">SECKEYPQGParams</a>) },
<strong><a name="85">   85</a></strong>     { <a href=
"../util/secasn1t.h.dep.html#SEC_ASN1_INTEGER">SEC_ASN1_INTEGER</a>, offsetof(<a href="../cryptohi/keythi.h.dep.html#SECKEYPQGParams">SECKEYPQGParams</a>,prime) },
<strong><a name="86">   86</a></strong>     { <a href=
"../util/secasn1t.h.dep.html#SEC_ASN1_INTEGER">SEC_ASN1_INTEGER</a>, offsetof(<a href="../cryptohi/keythi.h.dep.html#SECKEYPQGParams">SECKEYPQGParams</a>,subPrime) },
<strong><a name="87">   87</a></strong>     { <a href=
"../util/secasn1t.h.dep.html#SEC_ASN1_INTEGER">SEC_ASN1_INTEGER</a>, offsetof(<a href="../cryptohi/keythi.h.dep.html#SECKEYPQGParams">SECKEYPQGParams</a>,<a href="../mozilla/nsprpub/lib/libc/src/base64.c.dep.html#base">base</a><a href="../mozilla/nsprpub/lib/tests/base64t.c.dep.html#base">[1]</a><a href="../mozilla/nsprpub/pr/tests/xnotify.c.dep.html#base">[2]</a><a href="../mozilla/security/nss/cmd/crlutil/crlgen_lex.c.dep.html#base">[3]</a><a href="../mozilla/security/nss/cmd/modutil/lex.Pk11Install_yy.c.dep.html#base">[4]</a><a href="../mozilla/security/nss/cmd/signtool/signtool.c.dep.html#base">[5]</a><a href="../mozilla/security/nss/cmd/signtool/signtool.h.dep.html#base">[6]</a>) },
<strong><a name="88">   88</a></strong>     { 0, }
<strong><a name="89">   89</a></strong> };
<strong><a name="90">   90</a></strong>
<strong><a name="91">   91</a></strong> const <a href=
"../util/secasn1t.h.dep.html#SEC_ASN1Template">SEC_ASN1Template</a> <a href=
"#91">SECKEY_DHPublicKeyTemplate</a>[] = {
<strong><a name="92">   92</a></strong>     { <a href=
"../util/secasn1t.h.dep.html#SEC_ASN1_INTEGER">SEC_ASN1_INTEGER</a>, offsetof(<a href="../cryptohi/keythi.h.dep.html#SECKEYPublicKey">SECKEYPublicKey</a>,u.dh.publicValue), },
<strong><a name="93">   93</a></strong>     { 0, }
<strong><a name="94">   94</a></strong> };
<strong><a name="95">   95</a></strong>
<strong><a name="96">   96</a></strong> const <a href=
"../util/secasn1t.h.dep.html#SEC_ASN1Template">SEC_ASN1Template</a> <a href=
"#96">SECKEY_DHParamKeyTemplate</a>[] = {
<strong><a name="97">   97</a></strong>     { <a href=
"../util/secasn1t.h.dep.html#SEC_ASN1_SEQUENCE">SEC_ASN1_SEQUENCE</a>,  0, <a href="../mozilla/dbm/include/ncompat.h.dep.html#NULL">NULL</a>, sizeof(<a href="../cryptohi/keythi.h.dep.html#SECKEYPublicKey">SECKEYPublicKey</a>) },
<strong><a name="98">   98</a></strong>     { <a href=
"../util/secasn1t.h.dep.html#SEC_ASN1_INTEGER">SEC_ASN1_INTEGER</a>, offsetof(<a href="../cryptohi/keythi.h.dep.html#SECKEYPublicKey">SECKEYPublicKey</a>,u.dh.prime), },
<strong><a name="99">   99</a></strong>     { <a href=
"../util/secasn1t.h.dep.html#SEC_ASN1_INTEGER">SEC_ASN1_INTEGER</a>, offsetof(<a href="../cryptohi/keythi.h.dep.html#SECKEYPublicKey">SECKEYPublicKey</a>,u.dh.<a href="../mozilla/nsprpub/lib/libc/src/base64.c.dep.html#base">base</a><a href="../mozilla/nsprpub/lib/tests/base64t.c.dep.html#base">[1]</a><a href="../mozilla/nsprpub/pr/tests/xnotify.c.dep.html#base">[2]</a><a href="../mozilla/security/nss/cmd/crlutil/crlgen_lex.c.dep.html#base">[3]</a><a href="../mozilla/security/nss/cmd/modutil/lex.Pk11Install_yy.c.dep.html#base">[4]</a><a href="../mozilla/security/nss/cmd/signtool/signtool.c.dep.html#base">[5]</a><a href="../mozilla/security/nss/cmd/signtool/signtool.h.dep.html#base">[6]</a>), },
<strong><a name=
"100">  100</a></strong>     /* XXX chrisk: this needs to be expanded for decoding of j and validationParms (RFC2459 7.3.2) */
<strong><a name="101">  101</a></strong>     { <a href=
"../util/secasn1t.h.dep.html#SEC_ASN1_SKIP_REST">SEC_ASN1_SKIP_REST</a> },
<strong><a name="102">  102</a></strong>     { 0, }
<strong><a name="103">  103</a></strong> };
<strong><a name="104">  104</a></strong>
<strong><a name="105">  105</a></strong> const <a href=
"../util/secasn1t.h.dep.html#SEC_ASN1Template">SEC_ASN1Template</a> <a href=
"#105">SECKEY_FortezzaParameterTemplate</a>[] = {
<strong><a name="106">  106</a></strong>     { <a href=
"../util/secasn1t.h.dep.html#SEC_ASN1_SEQUENCE">SEC_ASN1_SEQUENCE</a>,  0, <a href="../mozilla/dbm/include/ncompat.h.dep.html#NULL">NULL</a>, sizeof(<a href="../cryptohi/keythi.h.dep.html#SECKEYPQGParams">SECKEYPQGParams</a>) },
<strong><a name="107">  107</a></strong>     { <a href=
"../util/secasn1t.h.dep.html#SEC_ASN1_OCTET_STRING">SEC_ASN1_OCTET_STRING</a>, offsetof(<a href="../cryptohi/keythi.h.dep.html#SECKEYPQGParams">SECKEYPQGParams</a>,prime), },
<strong><a name="108">  108</a></strong>     { <a href=
"../util/secasn1t.h.dep.html#SEC_ASN1_OCTET_STRING">SEC_ASN1_OCTET_STRING</a>, offsetof(<a href="../cryptohi/keythi.h.dep.html#SECKEYPQGParams">SECKEYPQGParams</a>,subPrime), },
<strong><a name="109">  109</a></strong>     { <a href=
"../util/secasn1t.h.dep.html#SEC_ASN1_OCTET_STRING">SEC_ASN1_OCTET_STRING</a>, offsetof(<a href="../cryptohi/keythi.h.dep.html#SECKEYPQGParams">SECKEYPQGParams</a>,<a href="../mozilla/nsprpub/lib/libc/src/base64.c.dep.html#base">base</a><a href="../mozilla/nsprpub/lib/tests/base64t.c.dep.html#base">[1]</a><a href="../mozilla/nsprpub/pr/tests/xnotify.c.dep.html#base">[2]</a><a href="../mozilla/security/nss/cmd/crlutil/crlgen_lex.c.dep.html#base">[3]</a><a href="../mozilla/security/nss/cmd/modutil/lex.Pk11Install_yy.c.dep.html#base">[4]</a><a href="../mozilla/security/nss/cmd/signtool/signtool.c.dep.html#base">[5]</a><a href="../mozilla/security/nss/cmd/signtool/signtool.h.dep.html#base">[6]</a>), },
<strong><a name="110">  110</a></strong>     { 0 },
<strong><a name="111">  111</a></strong> };
<strong><a name="112">  112</a></strong>
<strong><a name="113">  113</a></strong> const <a href=
"../util/secasn1t.h.dep.html#SEC_ASN1Template">SEC_ASN1Template</a> <a href=
"#113">SECKEY_FortezzaDiffParameterTemplate</a>[] = {
<strong><a name="114">  114</a></strong>     { <a href=
"../util/secasn1t.h.dep.html#SEC_ASN1_SEQUENCE">SEC_ASN1_SEQUENCE</a>, 0, <a href="../mozilla/dbm/include/ncompat.h.dep.html#NULL">NULL</a>, sizeof(<a href="../cryptohi/keythi.h.dep.html#SECKEYDiffPQGParams">SECKEYDiffPQGParams</a>) },
<strong><a name="115">  115</a></strong>     { <a href=
"../util/secasn1t.h.dep.html#SEC_ASN1_INLINE">SEC_ASN1_INLINE</a>, offsetof(<a href="../cryptohi/keythi.h.dep.html#SECKEYDiffPQGParams">SECKEYDiffPQGParams</a>,DiffKEAParams),
<strong><a name="116">  116</a></strong>                        <a href=
"../cryptohi/seckey.c.dep.html#SECKEY_FortezzaParameterTemplate">SECKEY_FortezzaParameterTemplate</a>},
<strong><a name="117">  117</a></strong>     { <a href=
"../util/secasn1t.h.dep.html#SEC_ASN1_INLINE">SEC_ASN1_INLINE</a>, offsetof(<a href="../cryptohi/keythi.h.dep.html#SECKEYDiffPQGParams">SECKEYDiffPQGParams</a>,DiffDSAParams),
<strong><a name="118">  118</a></strong>                        <a href=
"../cryptohi/seckey.c.dep.html#SECKEY_FortezzaParameterTemplate">SECKEY_FortezzaParameterTemplate</a>},
<strong><a name="119">  119</a></strong>     { 0 },
<strong><a name="120">  120</a></strong> };
<strong><a name="121">  121</a></strong>
<strong><a name="122">  122</a></strong> const <a href=
"../util/secasn1t.h.dep.html#SEC_ASN1Template">SEC_ASN1Template</a> <a href=
"#122">SECKEY_FortezzaPreParamTemplate</a>[] = {
<strong><a name="123">  123</a></strong>     { <a href=
"../util/secasn1t.h.dep.html#SEC_ASN1_EXPLICIT">SEC_ASN1_EXPLICIT</a> | <a href="../util/secasn1t.h.dep.html#SEC_ASN1_CONSTRUCTED">SEC_ASN1_CONSTRUCTED</a> |
<strong><a name="124">  124</a></strong>       <a href=
"../util/secasn1t.h.dep.html#SEC_ASN1_CONTEXT_SPECIFIC">SEC_ASN1_CONTEXT_SPECIFIC</a> | 1, offsetof(<a href="../cryptohi/keythi.h.dep.html#SECKEYPQGDualParams">SECKEYPQGDualParams</a>,CommParams),
<strong><a name="125">  125</a></strong>                 <a href=
"../cryptohi/seckey.c.dep.html#SECKEY_FortezzaParameterTemplate">SECKEY_FortezzaParameterTemplate</a>},
<strong><a name="126">  126</a></strong>     { 0, }
<strong><a name="127">  127</a></strong> };
<strong><a name="128">  128</a></strong>
<strong><a name="129">  129</a></strong> const <a href=
"../util/secasn1t.h.dep.html#SEC_ASN1Template">SEC_ASN1Template</a> <a href=
"#129">SECKEY_FortezzaAltPreParamTemplate</a>[] = {
<strong><a name="130">  130</a></strong>     { <a href=
"../util/secasn1t.h.dep.html#SEC_ASN1_EXPLICIT">SEC_ASN1_EXPLICIT</a> | <a href="../util/secasn1t.h.dep.html#SEC_ASN1_CONSTRUCTED">SEC_ASN1_CONSTRUCTED</a> |
<strong><a name="131">  131</a></strong>       <a href=
"../util/secasn1t.h.dep.html#SEC_ASN1_CONTEXT_SPECIFIC">SEC_ASN1_CONTEXT_SPECIFIC</a> | 0, offsetof(<a href="../cryptohi/keythi.h.dep.html#SECKEYPQGDualParams">SECKEYPQGDualParams</a>,DiffParams),
<strong><a name="132">  132</a></strong>                 <a href=
"../cryptohi/seckey.c.dep.html#SECKEY_FortezzaDiffParameterTemplate">SECKEY_FortezzaDiffParameterTemplate</a>},
<strong><a name="133">  133</a></strong>     { 0, }
<strong><a name="134">  134</a></strong> };
<strong><a name="135">  135</a></strong>
<strong><a name="136">  136</a></strong> const <a href=
"../util/secasn1t.h.dep.html#SEC_ASN1Template">SEC_ASN1Template</a> <a href=
"#136">SECKEY_KEAPublicKeyTemplate</a>[] = {
<strong><a name="137">  137</a></strong>     { <a href=
"../util/secasn1t.h.dep.html#SEC_ASN1_INTEGER">SEC_ASN1_INTEGER</a>, offsetof(<a href="../cryptohi/keythi.h.dep.html#SECKEYPublicKey">SECKEYPublicKey</a>,u.kea.publicValue), },
<strong><a name="138">  138</a></strong>     { 0, }
<strong><a name="139">  139</a></strong> };
<strong><a name="140">  140</a></strong>
<strong><a name="141">  141</a></strong> const <a href=
"../util/secasn1t.h.dep.html#SEC_ASN1Template">SEC_ASN1Template</a> <a href=
"#141">SECKEY_KEAParamsTemplate</a>[] = {
<strong><a name="142">  142</a></strong>     { <a href=
"../util/secasn1t.h.dep.html#SEC_ASN1_OCTET_STRING">SEC_ASN1_OCTET_STRING</a>, offsetof(<a href="../cryptohi/keythi.h.dep.html#SECKEYPublicKey">SECKEYPublicKey</a>,u.kea.params.hash), },
<strong><a name="143">  143</a></strong>     { 0, }
<strong><a name="144">  144</a></strong> };
<strong><a name="145">  145</a></strong>
<strong><a name="146">  146</a></strong> <a href=
"../util/secasn1t.h.dep.html#SEC_ASN1_CHOOSER_IMPLEMENT">SEC_ASN1_CHOOSER_IMPLEMENT</a>(<a href="../cryptohi/keythi.h.dep.html#SECKEY_DSAPublicKeyTemplate">SECKEY_DSAPublicKeyTemplate</a><a href="../cryptohi/seckey.c.dep.html#SECKEY_DSAPublicKeyTemplate">[1]</a>)
<strong><a name="147">  147</a></strong> <a href=
"../util/secasn1t.h.dep.html#SEC_ASN1_CHOOSER_IMPLEMENT">SEC_ASN1_CHOOSER_IMPLEMENT</a>(<a href="../cryptohi/keythi.h.dep.html#SECKEY_RSAPublicKeyTemplate">SECKEY_RSAPublicKeyTemplate</a><a href="../cryptohi/seckey.c.dep.html#SECKEY_RSAPublicKeyTemplate">[1]</a>)
<strong><a name="148">  148</a></strong> <a href=
"../util/secasn1t.h.dep.html#SEC_ASN1_CHOOSER_IMPLEMENT">SEC_ASN1_CHOOSER_IMPLEMENT</a>(<a href="../certdb/certt.h.dep.html#CERT_SubjectPublicKeyInfoTemplate">CERT_SubjectPublicKeyInfoTemplate</a><a href="../cryptohi/seckey.c.dep.html#CERT_SubjectPublicKeyInfoTemplate">[1]</a>)
<strong><a name="149">  149</a></strong>
<strong><a name="150">  150</a></strong> /*
<strong><a name="151">  151</a></strong>  * See bugzilla bug 125359
<strong><a name=
"152">  152</a></strong>  * Since NSS (via PKCS#11) wants to handle big integers as unsigned ints,
<strong><a name=
"153">  153</a></strong>  * all of the templates above that en/decode into integers must be converted
<strong><a name=
"154">  154</a></strong>  * from ASN.1's signed integer type.  This is done by marking either the
<strong><a name=
"155">  155</a></strong>  * source or destination (encoding or decoding, respectively) type as
<strong><a name="156">  156</a></strong>  * siUnsignedInteger.
<strong><a name="157">  157</a></strong>  */
<strong><a name="158">  158</a></strong> static void
<strong><a name="159">  159</a></strong> <a href=
"#159">prepare_rsa_pub_key_for_asn1</a>(<a href=
"../cryptohi/keythi.h.dep.html#SECKEYPublicKey">SECKEYPublicKey</a> *pubk)
<strong><a name="160">  160</a></strong> {
<strong><a name="161">  161</a></strong>     pubk-&gt;u.rsa.modulus.<a href=
"../mozilla/security/nss/cmd/zlib/inftrees.c.dep.html#type">type</a> = siUnsignedInteger;
<strong><a name=
"162">  162</a></strong>     pubk-&gt;u.rsa.publicExponent.<a href=
"../mozilla/security/nss/cmd/zlib/inftrees.c.dep.html#type">type</a> = siUnsignedInteger;
<strong><a name="163">  163</a></strong> }
<strong><a name="164">  164</a></strong>
<strong><a name="165">  165</a></strong> static void
<strong><a name="166">  166</a></strong> <a href=
"#166">prepare_dsa_pub_key_for_asn1</a>(<a href=
"../cryptohi/keythi.h.dep.html#SECKEYPublicKey">SECKEYPublicKey</a> *pubk)
<strong><a name="167">  167</a></strong> {
<strong><a name=
"168">  168</a></strong>     pubk-&gt;u.dsa.publicValue.<a href="../mozilla/security/nss/cmd/zlib/inftrees.c.dep.html#type">type</a> = siUnsignedInteger;
<strong><a name="169">  169</a></strong> }
<strong><a name="170">  170</a></strong>
<strong><a name="171">  171</a></strong> static void
<strong><a name="172">  172</a></strong> <a href=
"#172">prepare_pqg_params_for_asn1</a>(<a href=
"../cryptohi/keythi.h.dep.html#SECKEYPQGParams">SECKEYPQGParams</a> *params)
<strong><a name="173">  173</a></strong> {
<strong><a name="174">  174</a></strong>     params-&gt;prime.<a href=
"../mozilla/security/nss/cmd/zlib/inftrees.c.dep.html#type">type</a> = siUnsignedInteger;
<strong><a name="175">  175</a></strong>     params-&gt;subPrime.<a href=
"../mozilla/security/nss/cmd/zlib/inftrees.c.dep.html#type">type</a> = siUnsignedInteger;
<strong><a name="176">  176</a></strong>     params-&gt;<a href=
"../mozilla/nsprpub/lib/libc/src/base64.c.dep.html#base">base</a><a href=
"../mozilla/nsprpub/lib/tests/base64t.c.dep.html#base">[1]</a><a href=
"../mozilla/nsprpub/pr/tests/xnotify.c.dep.html#base">[2]</a><a href=
"../mozilla/security/nss/cmd/crlutil/crlgen_lex.c.dep.html#base">[3]</a><a href="../mozilla/security/nss/cmd/modutil/lex.Pk11Install_yy.c.dep.html#base">[4]</a><a href="../mozilla/security/nss/cmd/signtool/signtool.c.dep.html#base">[5]</a><a href="../mozilla/security/nss/cmd/signtool/signtool.h.dep.html#base">[6]</a>.<a href="../mozilla/security/nss/cmd/zlib/inftrees.c.dep.html#type">type</a> = siUnsignedInteger;
<strong><a name="177">  177</a></strong> }
<strong><a name="178">  178</a></strong>
<strong><a name="179">  179</a></strong> static void
<strong><a name="180">  180</a></strong> <a href=
"#180">prepare_dh_pub_key_for_asn1</a>(<a href=
"../cryptohi/keythi.h.dep.html#SECKEYPublicKey">SECKEYPublicKey</a> *pubk)
<strong><a name="181">  181</a></strong> {
<strong><a name="182">  182</a></strong>     pubk-&gt;u.dh.prime.<a href=
"../mozilla/security/nss/cmd/zlib/inftrees.c.dep.html#type">type</a> = siUnsignedInteger;
<strong><a name="183">  183</a></strong>     pubk-&gt;u.dh.<a href=
"../mozilla/nsprpub/lib/libc/src/base64.c.dep.html#base">base</a><a href=
"../mozilla/nsprpub/lib/tests/base64t.c.dep.html#base">[1]</a><a href=
"../mozilla/nsprpub/pr/tests/xnotify.c.dep.html#base">[2]</a><a href=
"../mozilla/security/nss/cmd/crlutil/crlgen_lex.c.dep.html#base">[3]</a><a href="../mozilla/security/nss/cmd/modutil/lex.Pk11Install_yy.c.dep.html#base">[4]</a><a href="../mozilla/security/nss/cmd/signtool/signtool.c.dep.html#base">[5]</a><a href="../mozilla/security/nss/cmd/signtool/signtool.h.dep.html#base">[6]</a>.<a href="../mozilla/security/nss/cmd/zlib/inftrees.c.dep.html#type">type</a> = siUnsignedInteger;
<strong><a name="184">  184</a></strong>     pubk-&gt;u.dh.publicValue.<a href=
"../mozilla/security/nss/cmd/zlib/inftrees.c.dep.html#type">type</a> = siUnsignedInteger;
<strong><a name="185">  185</a></strong> }
<strong><a name="186">  186</a></strong>
<strong><a name="187">  187</a></strong> static void
<strong><a name="188">  188</a></strong> <a href=
"#188">prepare_kea_pub_key_for_asn1</a>(<a href=
"../cryptohi/keythi.h.dep.html#SECKEYPublicKey">SECKEYPublicKey</a> *pubk)
<strong><a name="189">  189</a></strong> {
<strong><a name=
"190">  190</a></strong>     pubk-&gt;u.kea.publicValue.<a href="../mozilla/security/nss/cmd/zlib/inftrees.c.dep.html#type">type</a> = siUnsignedInteger;
<strong><a name="191">  191</a></strong> }
<strong><a name="192">  192</a></strong>
<strong><a name=
"193">  193</a></strong> /* Create an RSA key pair is any slot able to do so.
<strong><a name=
"194">  194</a></strong> ** The created keys are "session" (temporary), not "token" (permanent),
<strong><a name=
"195">  195</a></strong> ** and they are "sensitive", which makes them costly to move to another token.
<strong><a name="196">  196</a></strong> */
<strong><a name="197">  197</a></strong> <a href=
"../cryptohi/keythi.h.dep.html#SECKEYPrivateKey">SECKEYPrivateKey</a> *
<strong><a name="198">  198</a></strong> <a href=
"#198">SECKEY_CreateRSAPrivateKey</a>(int keySizeInBits,<a href=
"../cryptohi/keythi.h.dep.html#SECKEYPublicKey">SECKEYPublicKey</a> **pubk, void *<a href="../ssl/ssl3con.c.dep.html#cx">cx</a>)
<strong><a name="199">  199</a></strong> {
<strong><a name="200">  200</a></strong>     <a href=
"../cryptohi/keythi.h.dep.html#SECKEYPrivateKey">SECKEYPrivateKey</a> *privk;
<strong><a name="201">  201</a></strong>     <a href=
"../pk11wrap/secmodt.h.dep.html#PK11RSAGenParams">PK11RSAGenParams</a> param;
<strong><a name="202">  202</a></strong>     <a href=
"../pk11wrap/secmodt.h.dep.html#PK11SlotInfo">PK11SlotInfo</a> *<a href=
"../mozilla/security/nss/tests/pkcs11/netscape/suites/security/pkcs11/pk11test.c.dep.html#slot">slot</a> = <a href="../mozilla/security/nss/tests/pkcs11/netscape/suites/security/pkcs11/pk11test.c.dep.html#slot">slot</a><a href="../pk11wrap/pk11.c.dep.html#PK11_GetBestSlot">PK11_GetBestSlot</a>(<a href="../softoken/pkcs11t.h.dep.html#CKM_RSA_PKCS_KEY_PAIR_GEN">CKM_RSA_PKCS_KEY_PAIR_GEN</a>,<a href="../ssl/ssl3con.c.dep.html#cx">cx</a>);
<strong><a name="203">  203</a></strong>     if (!<a href=
"../mozilla/security/nss/tests/pkcs11/netscape/suites/security/pkcs11/pk11test.c.dep.html#slot">slot</a>) {
<strong><a name="204">  204</a></strong>         return <a href=
"../mozilla/dbm/include/ncompat.h.dep.html#NULL">NULL</a>;
<strong><a name="205">  205</a></strong>     }
<strong><a name="206">  206</a></strong>
<strong><a name=
"207">  207</a></strong>     param.keySizeInBits = keySizeInBits;
<strong><a name="208">  208</a></strong>     param.pe = 65537L;
<strong><a name="209">  209</a></strong>
<strong><a name="210">  210</a></strong>     privk = <a href=
"../pk11wrap/pk11akey.c.dep.html#PK11_GenerateKeyPair">PK11_GenerateKeyPair</a>(<a href="../mozilla/security/nss/tests/pkcs11/netscape/suites/security/pkcs11/pk11test.c.dep.html#slot">slot</a>,<a href="../softoken/pkcs11t.h.dep.html#CKM_RSA_PKCS_KEY_PAIR_GEN">CKM_RSA_PKCS_KEY_PAIR_GEN</a>,&amp;param,pubk,
<strong><a name=
"211">  211</a></strong>                                         <a href=
"../mozilla/nsprpub/pr/include/prtypes.h.dep.html#PR_FALSE">PR_FALSE</a>, <a href="../mozilla/nsprpub/pr/include/prtypes.h.dep.html#PR_TRUE">PR_TRUE</a>, <a href="../ssl/ssl3con.c.dep.html#cx">cx</a>);
<strong><a name="212">  212</a></strong>     <a href=
"../pk11wrap/pk11slot.c.dep.html#PK11_FreeSlot">PK11_FreeSlot</a>(<a href=
"../mozilla/security/nss/tests/pkcs11/netscape/suites/security/pkcs11/pk11test.c.dep.html#slot">slot</a>);
<strong><a name="213">  213</a></strong>     return(privk);
<strong><a name="214">  214</a></strong> }
<strong><a name="215">  215</a></strong>
<strong><a name=
"216">  216</a></strong> /* Create a DH key pair in any slot able to do so,
<strong><a name=
"217">  217</a></strong> ** This is a "session" (temporary), not "token" (permanent) key.
<strong><a name=
"218">  218</a></strong> ** Because of the high probability that this key will need to be moved to
<strong><a name=
"219">  219</a></strong> ** another token, and the high cost of moving "sensitive" keys, we attempt
<strong><a name=
"220">  220</a></strong> ** to create this key pair without the "sensitive" attribute, but revert to
<strong><a name=
"221">  221</a></strong> ** creating a "sensitive" key if necessary.
<strong><a name="222">  222</a></strong> */
<strong><a name="223">  223</a></strong> <a href=
"../cryptohi/keythi.h.dep.html#SECKEYPrivateKey">SECKEYPrivateKey</a> *
<strong><a name="224">  224</a></strong> <a href=
"#224">SECKEY_CreateDHPrivateKey</a>(<a href=
"../cryptohi/keythi.h.dep.html#SECKEYDHParams">SECKEYDHParams</a> *param, <a href="../cryptohi/keythi.h.dep.html#SECKEYPublicKey">SECKEYPublicKey</a> **pubk, void *<a href="../ssl/ssl3con.c.dep.html#cx">cx</a>)
<strong><a name="225">  225</a></strong> {
<strong><a name="226">  226</a></strong>     <a href=
"../cryptohi/keythi.h.dep.html#SECKEYPrivateKey">SECKEYPrivateKey</a> *privk;
<strong><a name="227">  227</a></strong>     <a href=
"../pk11wrap/secmodt.h.dep.html#PK11SlotInfo">PK11SlotInfo</a> *<a href=
"../mozilla/security/nss/tests/pkcs11/netscape/suites/security/pkcs11/pk11test.c.dep.html#slot">slot</a> = <a href="../mozilla/security/nss/tests/pkcs11/netscape/suites/security/pkcs11/pk11test.c.dep.html#slot">slot</a><a href="../pk11wrap/pk11.c.dep.html#PK11_GetBestSlot">PK11_GetBestSlot</a>(<a href="../softoken/pkcs11t.h.dep.html#CKM_DH_PKCS_KEY_PAIR_GEN">CKM_DH_PKCS_KEY_PAIR_GEN</a>,<a href="../ssl/ssl3con.c.dep.html#cx">cx</a>);
<strong><a name="228">  228</a></strong>     if (!<a href=
"../mozilla/security/nss/tests/pkcs11/netscape/suites/security/pkcs11/pk11test.c.dep.html#slot">slot</a>) {
<strong><a name="229">  229</a></strong>         return <a href=
"../mozilla/dbm/include/ncompat.h.dep.html#NULL">NULL</a>;
<strong><a name="230">  230</a></strong>     }
<strong><a name="231">  231</a></strong>
<strong><a name="232">  232</a></strong>     privk = <a href=
"../pk11wrap/pk11akey.c.dep.html#PK11_GenerateKeyPair">PK11_GenerateKeyPair</a>(<a href="../mozilla/security/nss/tests/pkcs11/netscape/suites/security/pkcs11/pk11test.c.dep.html#slot">slot</a>, <a href="../softoken/pkcs11t.h.dep.html#CKM_DH_PKCS_KEY_PAIR_GEN">CKM_DH_PKCS_KEY_PAIR_GEN</a>, param,
<strong><a name=
"233">  233</a></strong>                                  pubk, <a href=
"../mozilla/nsprpub/pr/include/prtypes.h.dep.html#PR_FALSE">PR_FALSE</a>, <a href="../mozilla/nsprpub/pr/include/prtypes.h.dep.html#PR_FALSE">PR_FALSE</a>, <a href="../ssl/ssl3con.c.dep.html#cx">cx</a>);
<strong><a name="234">  234</a></strong>     if (!privk)
<strong><a name="235">  235</a></strong>         privk = <a href=
"../pk11wrap/pk11akey.c.dep.html#PK11_GenerateKeyPair">PK11_GenerateKeyPair</a>(<a href="../mozilla/security/nss/tests/pkcs11/netscape/suites/security/pkcs11/pk11test.c.dep.html#slot">slot</a>, <a href="../softoken/pkcs11t.h.dep.html#CKM_DH_PKCS_KEY_PAIR_GEN">CKM_DH_PKCS_KEY_PAIR_GEN</a>, param,
<strong><a name=
"236">  236</a></strong>                                      pubk, <a href=
"../mozilla/nsprpub/pr/include/prtypes.h.dep.html#PR_FALSE">PR_FALSE</a>, <a href="../mozilla/nsprpub/pr/include/prtypes.h.dep.html#PR_TRUE">PR_TRUE</a>, <a href="../ssl/ssl3con.c.dep.html#cx">cx</a>);
<strong><a name="237">  237</a></strong>
<strong><a name="238">  238</a></strong>     <a href=
"../pk11wrap/pk11slot.c.dep.html#PK11_FreeSlot">PK11_FreeSlot</a>(<a href=
"../mozilla/security/nss/tests/pkcs11/netscape/suites/security/pkcs11/pk11test.c.dep.html#slot">slot</a>);
<strong><a name="239">  239</a></strong>     return(privk);
<strong><a name="240">  240</a></strong> }
<strong><a name="241">  241</a></strong>
<strong><a name=
"242">  242</a></strong> /* Create an EC key pair in any slot able to do so,
<strong><a name=
"243">  243</a></strong> ** This is a "session" (temporary), not "token" (permanent) key.
<strong><a name=
"244">  244</a></strong> ** Because of the high probability that this key will need to be moved to
<strong><a name=
"245">  245</a></strong> ** another token, and the high cost of moving "sensitive" keys, we attempt
<strong><a name=
"246">  246</a></strong> ** to create this key pair without the "sensitive" attribute, but revert to
<strong><a name=
"247">  247</a></strong> ** creating a "sensitive" key if necessary.
<strong><a name="248">  248</a></strong> */
<strong><a name="249">  249</a></strong> <a href=
"../cryptohi/keythi.h.dep.html#SECKEYPrivateKey">SECKEYPrivateKey</a> *
<strong><a name="250">  250</a></strong> <a href=
"#250">SECKEY_CreateECPrivateKey</a>(<a href=
"../cryptohi/keythi.h.dep.html#SECKEYECParams">SECKEYECParams</a> *param, <a href="../cryptohi/keythi.h.dep.html#SECKEYPublicKey">SECKEYPublicKey</a> **pubk, void *<a href="../ssl/ssl3con.c.dep.html#cx">cx</a>)
<strong><a name="251">  251</a></strong> {
<strong><a name="252">  252</a></strong>     <a href=
"../cryptohi/keythi.h.dep.html#SECKEYPrivateKey">SECKEYPrivateKey</a> *privk;
<strong><a name="253">  253</a></strong>     <a href=
"../pk11wrap/secmodt.h.dep.html#PK11SlotInfo">PK11SlotInfo</a> *<a href=
"../mozilla/security/nss/tests/pkcs11/netscape/suites/security/pkcs11/pk11test.c.dep.html#slot">slot</a> = <a href="../mozilla/security/nss/tests/pkcs11/netscape/suites/security/pkcs11/pk11test.c.dep.html#slot">slot</a><a href="../pk11wrap/pk11.c.dep.html#PK11_GetBestSlot">PK11_GetBestSlot</a>(<a href="../softoken/pkcs11t.h.dep.html#CKM_EC_KEY_PAIR_GEN">CKM_EC_KEY_PAIR_GEN</a>,<a href="../ssl/ssl3con.c.dep.html#cx">cx</a>);
<strong><a name="254">  254</a></strong>     if (!<a href=
"../mozilla/security/nss/tests/pkcs11/netscape/suites/security/pkcs11/pk11test.c.dep.html#slot">slot</a>) {
<strong><a name="255">  255</a></strong>         return <a href=
"../mozilla/dbm/include/ncompat.h.dep.html#NULL">NULL</a>;
<strong><a name="256">  256</a></strong>     }
<strong><a name="257">  257</a></strong>
<strong><a name="258">  258</a></strong>     privk = <a href=
"../pk11wrap/pk11akey.c.dep.html#PK11_GenerateKeyPair">PK11_GenerateKeyPair</a>(<a href="../mozilla/security/nss/tests/pkcs11/netscape/suites/security/pkcs11/pk11test.c.dep.html#slot">slot</a>, <a href="../softoken/pkcs11t.h.dep.html#CKM_EC_KEY_PAIR_GEN">CKM_EC_KEY_PAIR_GEN</a>, param,
<strong><a name=
"259">  259</a></strong>                                  pubk, <a href=
"../mozilla/nsprpub/pr/include/prtypes.h.dep.html#PR_FALSE">PR_FALSE</a>, <a href="../mozilla/nsprpub/pr/include/prtypes.h.dep.html#PR_FALSE">PR_FALSE</a>, <a href="../ssl/ssl3con.c.dep.html#cx">cx</a>);
<strong><a name="260">  260</a></strong>     if (!privk)
<strong><a name="261">  261</a></strong>         privk = <a href=
"../pk11wrap/pk11akey.c.dep.html#PK11_GenerateKeyPair">PK11_GenerateKeyPair</a>(<a href="../mozilla/security/nss/tests/pkcs11/netscape/suites/security/pkcs11/pk11test.c.dep.html#slot">slot</a>, <a href="../softoken/pkcs11t.h.dep.html#CKM_EC_KEY_PAIR_GEN">CKM_EC_KEY_PAIR_GEN</a>, param,
<strong><a name=
"262">  262</a></strong>                                      pubk, <a href=
"../mozilla/nsprpub/pr/include/prtypes.h.dep.html#PR_FALSE">PR_FALSE</a>, <a href="../mozilla/nsprpub/pr/include/prtypes.h.dep.html#PR_TRUE">PR_TRUE</a>, <a href="../ssl/ssl3con.c.dep.html#cx">cx</a>);
<strong><a name="263">  263</a></strong>
<strong><a name="264">  264</a></strong>     <a href=
"../pk11wrap/pk11slot.c.dep.html#PK11_FreeSlot">PK11_FreeSlot</a>(<a href=
"../mozilla/security/nss/tests/pkcs11/netscape/suites/security/pkcs11/pk11test.c.dep.html#slot">slot</a>);
<strong><a name="265">  265</a></strong>     return(privk);
<strong><a name="266">  266</a></strong> }
<strong><a name="267">  267</a></strong>
<strong><a name="268">  268</a></strong> void
<strong><a name="269">  269</a></strong> <a href=
"#269">SECKEY_DestroyPrivateKey</a>(<a href=
"../cryptohi/keythi.h.dep.html#SECKEYPrivateKey">SECKEYPrivateKey</a> *privk)
<strong><a name="270">  270</a></strong> {
<strong><a name="271">  271</a></strong>     if (privk) {
<strong><a name="272">  272</a></strong>         if (privk-&gt;pkcs11Slot) {
<strong><a name=
"273">  273</a></strong>             if (privk-&gt;pkcs11IsTemp) {
<strong><a name="274">  274</a></strong>                     <a href=
"../pk11wrap/pk11obj.c.dep.html#PK11_DestroyObject">PK11_DestroyObject</a>(privk-&gt;pkcs11Slot,privk-&gt;pkcs11ID);
<strong><a name="275">  275</a></strong>             }
<strong><a name="276">  276</a></strong>             <a href=
"../pk11wrap/pk11slot.c.dep.html#PK11_FreeSlot">PK11_FreeSlot</a>(privk-&gt;pkcs11Slot);
<strong><a name="277">  277</a></strong>
<strong><a name="278">  278</a></strong>         }
<strong><a name="279">  279</a></strong>             if (privk-&gt;arena) {
<strong><a name="280">  280</a></strong>             <a href=
"../util/secport.c.dep.html#PORT_FreeArena">PORT_FreeArena</a>(privk-&gt;arena, <a href="../mozilla/nsprpub/pr/include/prtypes.h.dep.html#PR_TRUE">PR_TRUE</a>);
<strong><a name="281">  281</a></strong>         }
<strong><a name="282">  282</a></strong>     }
<strong><a name="283">  283</a></strong> }
<strong><a name="284">  284</a></strong>
<strong><a name="285">  285</a></strong> void
<strong><a name="286">  286</a></strong> <a href=
"#286">SECKEY_DestroyPublicKey</a>(<a href=
"../cryptohi/keythi.h.dep.html#SECKEYPublicKey">SECKEYPublicKey</a> *pubk)
<strong><a name="287">  287</a></strong> {
<strong><a name="288">  288</a></strong>     if (pubk) {
<strong><a name="289">  289</a></strong>         if (pubk-&gt;pkcs11Slot) {
<strong><a name="290">  290</a></strong>             if (!<a href=
"../pk11wrap/pk11obj.c.dep.html#PK11_IsPermObject">PK11_IsPermObject</a>(pubk-&gt;pkcs11Slot,pubk-&gt;pkcs11ID)) {
<strong><a name="291">  291</a></strong>                 <a href=
"../pk11wrap/pk11obj.c.dep.html#PK11_DestroyObject">PK11_DestroyObject</a>(pubk-&gt;pkcs11Slot,pubk-&gt;pkcs11ID);
<strong><a name="292">  292</a></strong>             }
<strong><a name="293">  293</a></strong>             <a href=
"../pk11wrap/pk11slot.c.dep.html#PK11_FreeSlot">PK11_FreeSlot</a>(pubk-&gt;pkcs11Slot);
<strong><a name="294">  294</a></strong>         }
<strong><a name="295">  295</a></strong>             if (pubk-&gt;arena) {
<strong><a name="296">  296</a></strong>             <a href=
"../util/secport.c.dep.html#PORT_FreeArena">PORT_FreeArena</a>(pubk-&gt;arena, <a href="../mozilla/nsprpub/pr/include/prtypes.h.dep.html#PR_FALSE">PR_FALSE</a>);
<strong><a name="297">  297</a></strong>         }
<strong><a name="298">  298</a></strong>     }
<strong><a name="299">  299</a></strong> }
<strong><a name="300">  300</a></strong>
<strong><a name="301">  301</a></strong> <a href=
"../util/seccomon.h.dep.html#SECStatus">SECStatus</a>
<strong><a name="302">  302</a></strong> <a href=
"#302">SECKEY_CopySubjectPublicKeyInfo</a>(<a href=
"../mozilla/nsprpub/pr/include/obsolete/protypes.h.dep.html#PRArenaPool">PRArenaPool</a> *arena,
<strong><a name="303">  303</a></strong>                              <a href=
"../certdb/certt.h.dep.html#CERTSubjectPublicKeyInfo">CERTSubjectPublicKeyInfo</a> *to,
<strong><a name="304">  304</a></strong>                              <a href=
"../certdb/certt.h.dep.html#CERTSubjectPublicKeyInfo">CERTSubjectPublicKeyInfo</a> *from)
<strong><a name="305">  305</a></strong> {
<strong><a name="306">  306</a></strong>     <a href=
"../util/seccomon.h.dep.html#SECStatus">SECStatus</a> <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a>;
<strong><a name="307">  307</a></strong>     <a href=
"../util/seccomon.h.dep.html#SECItem">SECItem</a> spk;
<strong><a name="308">  308</a></strong>
<strong><a name="309">  309</a></strong>     <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> = <a href=
"../util/secalgid.c.dep.html#SECOID_CopyAlgorithmID">SECOID_CopyAlgorithmID</a>(arena, &amp;to-&gt;algorithm, &amp;from-&gt;algorithm);
<strong><a name="310">  310</a></strong>     if (<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> == <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a>/selfse<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a><a href=
"../mozilla/security/nss/cmd/selfse.c.dep.html#SECSuccess">SECSuccess</a>) {
<strong><a name="311">  311</a></strong>         /*
<strong><a name=
"312">  312</a></strong>          * subjectPublicKey is a bit string, whose length is in bits.
<strong><a name=
"313">  313</a></strong>          * Convert the length from bits to bytes for SECITEM_CopyItem.
<strong><a name="314">  314</a></strong>          */
<strong><a name=
"315">  315</a></strong>         spk = from-&gt;subjectPublicKey;
<strong><a name="316">  316</a></strong>         <a href=
"../util/secdert.h.dep.html#DER_ConvertBitString">DER_ConvertBitString</a>(&amp;spk);
<strong><a name="317">  317</a></strong>         <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> = <a href=
"../util/secitem.c.dep.html#SECITEM_CopyItem">SECITEM_CopyItem</a>(arena, &amp;to-&gt;subjectPublicKey, &amp;spk);
<strong><a name=
"318">  318</a></strong>         /* Set the length back to bits. */
<strong><a name="319">  319</a></strong>         if (<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> == <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a>/selfse<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a><a href=
"../mozilla/security/nss/cmd/selfse.c.dep.html#SECSuccess">SECSuccess</a>) {
<strong><a name=
"320">  320</a></strong>             to-&gt;subjectPublicKey.<a href=
"../mozilla/security/nss/cmd/crlutil/crlgen_lex.c.dep.html#len">len</a><a href=
"../mozilla/security/nss/cmd/modutil/lex.Pk11Install_yy.c.dep.html#len">[1]</a><a href="../mozilla/security/nss/cmd/zlib/adler32.c.dep.html#len">[2]</a><a href="../mozilla/security/nss/cmd/zlib/crc32.c.dep.html#len">[3]</a><a href="../mozilla/security/nss/cmd/zlib/gzio.c.dep.html#len">[6]</a><a href="../mozilla/security/nss/cmd/zlib/inflate.c.dep.html#len">[9]</a><a href="../mozilla/security/nss/cmd/zlib/trees.c.dep.html#len">[10]</a><a href="../mozilla/security/nss/cmd/zlib/zutil.c.dep.html#len">[13]</a> = from-&gt;subjectPublicKey.<a href="../mozilla/security/nss/cmd/crlutil/crlgen_lex.c.dep.html#len">len</a><a href="../mozilla/security/nss/cmd/modutil/lex.Pk11Install_yy.c.dep.html#len">[1]</a><a href="../mozilla/security/nss/cmd/zlib/adler32.c.dep.html#len">[2]</a><a href="../mozilla/security/nss/cmd/zlib/crc32.c.dep.html#len">[3]</a><a href="../mozilla/security/nss/cmd/zlib/gzio.c.dep.html#len">[6]</a><a href="../mozilla/security/nss/cmd/zlib/inflate.c.dep.html#len">[9]</a><a href="../mozilla/security/nss/cmd/zlib/trees.c.dep.html#len">[10]</a><a href="../mozilla/security/nss/cmd/zlib/zutil.c.dep.html#len">[13]</a>;
<strong><a name="321">  321</a></strong>         }
<strong><a name="322">  322</a></strong>     }
<strong><a name="323">  323</a></strong>
<strong><a name="324">  324</a></strong>     return <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a>;
<strong><a name="325">  325</a></strong> }
<strong><a name="326">  326</a></strong>
<strong><a name="327">  327</a></strong> <a href=
"../util/seccomon.h.dep.html#SECStatus">SECStatus</a>
<strong><a name="328">  328</a></strong> <a href=
"#328">SECKEY_KEASetParams</a>(<a href=
"../cryptohi/keythi.h.dep.html#SECKEYKEAParams">SECKEYKEAParams</a> * params, <a href="../cryptohi/keythi.h.dep.html#SECKEYPublicKey">SECKEYPublicKey</a> * pubKey) {
<strong><a name="329">  329</a></strong>
<strong><a name=
"330">  330</a></strong>     if (pubKey-&gt;keyType == fortezzaKey) {
<strong><a name=
"331">  331</a></strong>         /* the key is a fortezza V1 public key  */
<strong><a name="332">  332</a></strong>
<strong><a name=
"333">  333</a></strong>         /* obtain hash of pubkey-&gt;u.fortezza.params.prime.data +
<strong><a name=
"334">  334</a></strong>                           pubkey-&gt;u.fortezza.params.subPrime.data +
<strong><a name=
"335">  335</a></strong>                           pubkey-&gt;u.fortezza.params.base.data  */
<strong><a name="336">  336</a></strong>
<strong><a name=
"337">  337</a></strong>         /* store hash in params-&gt;hash */
<strong><a name="338">  338</a></strong>
<strong><a name=
"339">  339</a></strong>     } else if (pubKey-&gt;keyType == keaKey) {
<strong><a name="340">  340</a></strong>
<strong><a name=
"341">  341</a></strong>         /* the key is a new fortezza KEA public key. */
<strong><a name="342">  342</a></strong>         <a href=
"../util/secitem.c.dep.html#SECITEM_CopyItem">SECITEM_CopyItem</a>(pubKey-&gt;arena, &amp;params-&gt;hash,
<strong><a name=
"343">  343</a></strong>                          &amp;pubKey-&gt;u.kea.params.hash );
<strong><a name="344">  344</a></strong>
<strong><a name="345">  345</a></strong>     } else {
<strong><a name="346">  346</a></strong>
<strong><a name=
"347">  347</a></strong>         /* the key has no KEA parameters */
<strong><a name="348">  348</a></strong>         return SECFailure;
<strong><a name="349">  349</a></strong>     }
<strong><a name="350">  350</a></strong>     return <a href=
"../mozilla/security/nss/cmd/selfserv/selfserv.c.dep.html#SECSuccess">SECSuccess</a>;
<strong><a name="351">  351</a></strong> }
<strong><a name="352">  352</a></strong>
<strong><a name="353">  353</a></strong>
<strong><a name="354">  354</a></strong> <a href=
"../util/seccomon.h.dep.html#SECStatus">SECStatus</a>
<strong><a name="355">  355</a></strong> <a href=
"#355">SECKEY_KEAParamCompare</a>(<a href=
"../certdb/certt.h.dep.html#CERTCertificate">CERTCertificate</a> *cert1,<a href="../certdb/certt.h.dep.html#CERTCertificate">CERTCertificate</a> *cert2)
<strong><a name="356">  356</a></strong> {
<strong><a name="357">  357</a></strong>
<strong><a name="358">  358</a></strong>     <a href=
"../util/seccomon.h.dep.html#SECStatus">SECStatus</a> <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a>;
<strong><a name="359">  359</a></strong>
<strong><a name="360">  360</a></strong>     <a href=
"../cryptohi/keythi.h.dep.html#SECKEYPublicKey">SECKEYPublicKey</a> *pubKey1 = 0;
<strong><a name="361">  361</a></strong>     <a href=
"../cryptohi/keythi.h.dep.html#SECKEYPublicKey">SECKEYPublicKey</a> *pubKey2 = 0;
<strong><a name="362">  362</a></strong>
<strong><a name="363">  363</a></strong>     <a href=
"../cryptohi/keythi.h.dep.html#SECKEYKEAParams">SECKEYKEAParams</a> params1;
<strong><a name="364">  364</a></strong>     <a href=
"../cryptohi/keythi.h.dep.html#SECKEYKEAParams">SECKEYKEAParams</a> params2;
<strong><a name="365">  365</a></strong>
<strong><a name="366">  366</a></strong>
<strong><a name="367">  367</a></strong>     <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> = SECFailure;
<strong><a name="368">  368</a></strong>
<strong><a name="369">  369</a></strong>     /* get cert1's public key */
<strong><a name="370">  370</a></strong>     pubKey1 = <a href=
"../cryptohi/seckey.c.dep.html#CERT_ExtractPublicKey">CERT_ExtractPublicKey</a>(cert1);
<strong><a name="371">  371</a></strong>     if ( !pubKey1 ) {
<strong><a name="372">  372</a></strong>         return(SECFailure);
<strong><a name="373">  373</a></strong>     }
<strong><a name="374">  374</a></strong>
<strong><a name="375">  375</a></strong>
<strong><a name="376">  376</a></strong>     /* get cert2's public key */
<strong><a name="377">  377</a></strong>     pubKey2 = <a href=
"../cryptohi/seckey.c.dep.html#CERT_ExtractPublicKey">CERT_ExtractPublicKey</a>(cert2);
<strong><a name="378">  378</a></strong>     if ( !pubKey2 ) {
<strong><a name="379">  379</a></strong>         return(SECFailure);
<strong><a name="380">  380</a></strong>     }
<strong><a name="381">  381</a></strong>
<strong><a name=
"382">  382</a></strong>     /* handle the case when both public keys are new
<strong><a name="383">  383</a></strong>      * fortezza KEA public keys.    */
<strong><a name="384">  384</a></strong>
<strong><a name=
"385">  385</a></strong>     if ((pubKey1-&gt;keyType == keaKey) &amp;&amp;
<strong><a name=
"386">  386</a></strong>         (pubKey2-&gt;keyType == keaKey) ) {
<strong><a name="387">  387</a></strong>
<strong><a name="388">  388</a></strong>         <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> = (<a href=
"../util/seccomon.h.dep.html#SECStatus">SECStatus</a>)<a href=
"../util/secitem.c.dep.html#SECITEM_CompareItem">SECITEM_CompareItem</a>(&amp;pubKey1-&gt;u.kea.params.hash,
<strong><a name=
"389">  389</a></strong>                                  &amp;pubKey2-&gt;u.kea.params.hash);
<strong><a name="390">  390</a></strong>         goto done;
<strong><a name="391">  391</a></strong>     }
<strong><a name="392">  392</a></strong>
<strong><a name=
"393">  393</a></strong>     /* handle the case when both public keys are old fortezza
<strong><a name="394">  394</a></strong>      * public keys.              */
<strong><a name="395">  395</a></strong>
<strong><a name=
"396">  396</a></strong>     if ((pubKey1-&gt;keyType == fortezzaKey) &amp;&amp;
<strong><a name=
"397">  397</a></strong>         (pubKey2-&gt;keyType == fortezzaKey) ) {
<strong><a name="398">  398</a></strong>
<strong><a name="399">  399</a></strong>         <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> = (<a href=
"../util/seccomon.h.dep.html#SECStatus">SECStatus</a>)<a href=
"../util/secitem.c.dep.html#SECITEM_CompareItem">SECITEM_CompareItem</a>(&amp;pubKey1-&gt;u.fortezza.keaParams.prime,
<strong><a name=
"400">  400</a></strong>                                  &amp;pubKey2-&gt;u.fortezza.keaParams.prime);
<strong><a name="401">  401</a></strong>
<strong><a name="402">  402</a></strong>         if (<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> == SECEqual) {
<strong><a name="403">  403</a></strong>             <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> = (<a href=
"../util/seccomon.h.dep.html#SECStatus">SECStatus</a>)<a href=
"../util/secitem.c.dep.html#SECITEM_CompareItem">SECITEM_CompareItem</a>(&amp;pubKey1-&gt;u.fortezza.keaParams.subPrime,
<strong><a name=
"404">  404</a></strong>                                      &amp;pubKey2-&gt;u.fortezza.keaParams.subPrime);
<strong><a name="405">  405</a></strong>         }
<strong><a name="406">  406</a></strong>
<strong><a name="407">  407</a></strong>         if (<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> == SECEqual) {
<strong><a name="408">  408</a></strong>             <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> = (<a href=
"../util/seccomon.h.dep.html#SECStatus">SECStatus</a>)<a href=
"../util/secitem.c.dep.html#SECITEM_CompareItem">SECITEM_CompareItem</a>(&amp;pubKey1-&gt;u.fortezza.keaParams.<a href="../mozilla/nsprpub/lib/libc/src/base64.c.dep.html#base">base</a><a href="../mozilla/nsprpub/lib/tests/base64t.c.dep.html#base">[1]</a><a href="../mozilla/nsprpub/pr/tests/xnotify.c.dep.html#base">[2]</a><a href="../mozilla/security/nss/cmd/crlutil/crlgen_lex.c.dep.html#base">[3]</a><a href="../mozilla/security/nss/cmd/modutil/lex.Pk11Install_yy.c.dep.html#base">[4]</a><a href="../mozilla/security/nss/cmd/signtool/signtool.c.dep.html#base">[5]</a><a href="../mozilla/security/nss/cmd/signtool/signtool.h.dep.html#base">[6]</a>,
<strong><a name=
"409">  409</a></strong>                                      &amp;pubKey2-&gt;u.fortezza.keaParams.<a href="../mozilla/nsprpub/lib/libc/src/base64.c.dep.html#base">base</a><a href="../mozilla/nsprpub/lib/tests/base64t.c.dep.html#base">[1]</a><a href="../mozilla/nsprpub/pr/tests/xnotify.c.dep.html#base">[2]</a><a href="../mozilla/security/nss/cmd/crlutil/crlgen_lex.c.dep.html#base">[3]</a><a href="../mozilla/security/nss/cmd/modutil/lex.Pk11Install_yy.c.dep.html#base">[4]</a><a href="../mozilla/security/nss/cmd/signtool/signtool.c.dep.html#base">[5]</a><a href="../mozilla/security/nss/cmd/signtool/signtool.h.dep.html#base">[6]</a>);
<strong><a name="410">  410</a></strong>         }
<strong><a name="411">  411</a></strong>
<strong><a name="412">  412</a></strong>         goto done;
<strong><a name="413">  413</a></strong>     }
<strong><a name="414">  414</a></strong>
<strong><a name="415">  415</a></strong>
<strong><a name=
"416">  416</a></strong>     /* handle the case when the public keys are a mixture of
<strong><a name=
"417">  417</a></strong>      * old and new.                          */
<strong><a name="418">  418</a></strong>
<strong><a name="419">  419</a></strong>     <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> = <a href=
"../cryptohi/seckey.c.dep.html#SECKEY_KEASetParams">SECKEY_KEASetParams</a>(&amp;params1, pubKey1);
<strong><a name="420">  420</a></strong>     if (<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> != <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a>/selfse<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a><a href=
"../mozilla/security/nss/cmd/selfse.c.dep.html#SECSuccess">SECSuccess</a>) return <a href="../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href="../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a>;
<strong><a name="421">  421</a></strong>
<strong><a name="422">  422</a></strong>     <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> = <a href=
"../cryptohi/seckey.c.dep.html#SECKEY_KEASetParams">SECKEY_KEASetParams</a>(&amp;params2, pubKey2);
<strong><a name="423">  423</a></strong>     if (<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> != <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a>/selfse<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a><a href=
"../mozilla/security/nss/cmd/selfse.c.dep.html#SECSuccess">SECSuccess</a>) return <a href="../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href="../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a>;
<strong><a name="424">  424</a></strong>
<strong><a name="425">  425</a></strong>     <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> = (<a href=
"../util/seccomon.h.dep.html#SECStatus">SECStatus</a>)<a href=
"../util/secitem.c.dep.html#SECITEM_CompareItem">SECITEM_CompareItem</a>(&amp;params1.hash, &amp;params2.hash);
<strong><a name="426">  426</a></strong>
<strong><a name="427">  427</a></strong> done:
<strong><a name="428">  428</a></strong>     <a href=
"../cryptohi/seckey.c.dep.html#SECKEY_DestroyPublicKey">SECKEY_DestroyPublicKey</a>(pubKey1);
<strong><a name="429">  429</a></strong>     <a href=
"../cryptohi/seckey.c.dep.html#SECKEY_DestroyPublicKey">SECKEY_DestroyPublicKey</a>(pubKey2);
<strong><a name="430">  430</a></strong>
<strong><a name="431">  431</a></strong>     return <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a>;   /* returns SECEqual if parameters are equal */
<strong><a name="432">  432</a></strong>
<strong><a name="433">  433</a></strong> }
<strong><a name="434">  434</a></strong>
<strong><a name="435">  435</a></strong>
<strong><a name=
"436">  436</a></strong> /* Procedure to update the pqg parameters for a cert's public key.
<strong><a name=
"437">  437</a></strong>  * pqg parameters only need to be updated for DSA and fortezza certificates.
<strong><a name=
"438">  438</a></strong>  * The procedure uses calls to itself recursively to update a certificate
<strong><a name=
"439">  439</a></strong>  * issuer's pqg parameters.  Some important rules are:
<strong><a name=
"440">  440</a></strong>  *    - Do nothing if the cert already has PQG parameters.
<strong><a name=
"441">  441</a></strong>  *    - If the cert does not have PQG parameters, obtain them from the issuer.
<strong><a name=
"442">  442</a></strong>  *    - A valid cert chain cannot have a DSA or Fortezza cert without
<strong><a name=
"443">  443</a></strong>  *      pqg parameters that has a parent that is not a DSA or Fortezza cert.
<strong><a name=
"444">  444</a></strong>  *    - pqg paramters are stored in two different formats: the standard
<strong><a name=
"445">  445</a></strong>  *      DER encoded format and the fortezza-only wrapped format.  The params
<strong><a name=
"446">  446</a></strong>  *      should be copied from issuer to subject cert without modifying the
<strong><a name=
"447">  447</a></strong>  *      formats.  The public key extraction code will deal with the different
<strong><a name=
"448">  448</a></strong>  *      formats at the time of extraction.  */
<strong><a name="449">  449</a></strong>
<strong><a name="450">  450</a></strong> static <a href=
"../util/seccomon.h.dep.html#SECStatus">SECStatus</a>
<strong><a name="451">  451</a></strong> <a href=
"#451">seckey_UpdateCertPQGChain</a>(<a href=
"../certdb/certt.h.dep.html#CERTCertificate">CERTCertificate</a> * subjectCert, int <a href="../mozilla/nsprpub/pr/tests/accept.c.dep.html#count">count</a><a href="../mozilla/nsprpub/pr/tests/attach.c.dep.html#count">[1]</a><a href="../mozilla/nsprpub/pr/tests/cvar.c.dep.html#count">[2]</a><a href="../mozilla/nsprpub/pr/tests/cvar2.c.dep.html#count">[3]</a><a href="../mozilla/nsprpub/pr/tests/perf.c.dep.html#count">[4]</a><a href="../mozilla/nsprpub/pr/tests/select2.c.dep.html#count">[5]</a><a href="../mozilla/nsprpub/pr/tests/stat.c.dep.html#count">[6]</a><a href="../mozilla/nsprpub/pr/tests/suspend.c.dep.html#count">[7]</a><a href="../mozilla/nsprpub/pr/tests/testfile.c.dep.html#count">[8]</a><a href="../mozilla/nsprpub/pr/tests/threads.c.dep.html#count">[9]</a><a href="../mozilla/nsprpub/pr/tests/time.c.dep.html#count">[10]</a>)
<strong><a name="452">  452</a></strong> {
<strong><a name="453">  453</a></strong>     <a href=
"../util/seccomon.h.dep.html#SECStatus">SECStatus</a> <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a>, <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a>Compare;
<strong><a name="454">  454</a></strong>     <a href=
"../util/secoidt.h.dep.html#SECOidData">SECOidData</a> *oid=<a href=
"../mozilla/dbm/include/ncompat.h.dep.html#NULL">NULL</a>;
<strong><a name="455">  455</a></strong>     int <a href=
"../mozilla/nsprpub/pr/tests/system.c.dep.html#tag">tag</a>;
<strong><a name="456">  456</a></strong>     <a href=
"../certdb/certt.h.dep.html#CERTSubjectPublicKeyInfo">CERTSubjectPublicKeyInfo</a> * subjectSpki=<a href="../mozilla/dbm/include/ncompat.h.dep.html#NULL">NULL</a>;
<strong><a name="457">  457</a></strong>     <a href=
"../certdb/certt.h.dep.html#CERTSubjectPublicKeyInfo">CERTSubjectPublicKeyInfo</a> * issuerSpki=<a href="../mozilla/dbm/include/ncompat.h.dep.html#NULL">NULL</a>;
<strong><a name="458">  458</a></strong>     <a href=
"../certdb/certt.h.dep.html#CERTCertificate">CERTCertificate</a> *issuerCert = <a href="../mozilla/dbm/include/ncompat.h.dep.html#NULL">NULL</a>;
<strong><a name="459">  459</a></strong>
<strong><a name="460">  460</a></strong>     <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> = <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a>/selfse<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a><a href=
"../mozilla/security/nss/cmd/selfse.c.dep.html#SECSuccess">SECSuccess</a>;
<strong><a name="461">  461</a></strong>
<strong><a name=
"462">  462</a></strong>     /* increment cert chain length counter*/
<strong><a name="463">  463</a></strong>     <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#count">count</a><a href=
"../mozilla/nsprpub/pr/tests/attach.c.dep.html#count">[1]</a><a href=
"../mozilla/nsprpub/pr/tests/cvar.c.dep.html#count">[2]</a><a href=
"../mozilla/nsprpub/pr/tests/cvar2.c.dep.html#count">[3]</a><a href=
"../mozilla/nsprpub/pr/tests/perf.c.dep.html#count">[4]</a><a href=
"../mozilla/nsprpub/pr/tests/select2.c.dep.html#count">[5]</a><a href=
"../mozilla/nsprpub/pr/tests/stat.c.dep.html#count">[6]</a><a href=
"../mozilla/nsprpub/pr/tests/suspend.c.dep.html#count">[7]</a><a href=
"../mozilla/nsprpub/pr/tests/testfile.c.dep.html#count">[8]</a><a href=
"../mozilla/nsprpub/pr/tests/threads.c.dep.html#count">[9]</a><a href=
"../mozilla/nsprpub/pr/tests/time.c.dep.html#count">[10]</a>++;
<strong><a name="464">  464</a></strong>
<strong><a name=
"465">  465</a></strong>     /* check if cert chain length exceeds the maximum length*/
<strong><a name="466">  466</a></strong>     if (<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#count">count</a><a href=
"../mozilla/nsprpub/pr/tests/attach.c.dep.html#count">[1]</a><a href=
"../mozilla/nsprpub/pr/tests/cvar.c.dep.html#count">[2]</a><a href=
"../mozilla/nsprpub/pr/tests/cvar2.c.dep.html#count">[3]</a><a href=
"../mozilla/nsprpub/pr/tests/perf.c.dep.html#count">[4]</a><a href=
"../mozilla/nsprpub/pr/tests/select2.c.dep.html#count">[5]</a><a href=
"../mozilla/nsprpub/pr/tests/stat.c.dep.html#count">[6]</a><a href=
"../mozilla/nsprpub/pr/tests/suspend.c.dep.html#count">[7]</a><a href=
"../mozilla/nsprpub/pr/tests/testfile.c.dep.html#count">[8]</a><a href=
"../mozilla/nsprpub/pr/tests/threads.c.dep.html#count">[9]</a><a href=
"../mozilla/nsprpub/pr/tests/time.c.dep.html#count">[10]</a> &gt; <a href=
"../certdb/certt.h.dep.html#CERT_MAX_CERT_CHAIN">CERT_MAX_CERT_CHAIN</a>) {
<strong><a name="467">  467</a></strong>         return SECFailure;
<strong><a name="468">  468</a></strong>     }
<strong><a name="469">  469</a></strong>
<strong><a name="470">  470</a></strong>     oid = <a href=
"../util/secoid.c.dep.html#SECOID_FindOID">SECOID_FindOID</a>(&amp;subjectCert-&gt;subjectPublicKeyInfo.algorithm.algorithm);
<strong><a name="471">  471</a></strong>     if (oid != <a href=
"../mozilla/dbm/include/ncompat.h.dep.html#NULL">NULL</a>) {
<strong><a name="472">  472</a></strong>         <a href=
"../mozilla/nsprpub/pr/tests/system.c.dep.html#tag">tag</a> = oid-&gt;<a href=
"../mozilla/security/nss/cmd/zlib/gzio.c.dep.html#offset">offset</a>;
<strong><a name="473">  473</a></strong>
<strong><a name=
"474">  474</a></strong>         /* Check if cert has a DSA or Fortezza public key. If not, return
<strong><a name=
"475">  475</a></strong>          * success since no PQG params need to be updated.  */
<strong><a name="476">  476</a></strong>
<strong><a name="477">  477</a></strong>         if ( (<a href=
"../mozilla/nsprpub/pr/tests/system.c.dep.html#tag">tag</a> != SEC_OID_MISSI_KEA_DSS_OLD) &amp;&amp;
<strong><a name="478">  478</a></strong>              (<a href=
"../mozilla/nsprpub/pr/tests/system.c.dep.html#tag">tag</a> != SEC_OID_MISSI_DSS_OLD) &amp;&amp;
<strong><a name="479">  479</a></strong>              (<a href=
"../mozilla/nsprpub/pr/tests/system.c.dep.html#tag">tag</a> != SEC_OID_MISSI_KEA_DSS) &amp;&amp;
<strong><a name="480">  480</a></strong>              (<a href=
"../mozilla/nsprpub/pr/tests/system.c.dep.html#tag">tag</a> != SEC_OID_MISSI_DSS) &amp;&amp;
<strong><a name="481">  481</a></strong>              (<a href=
"../mozilla/nsprpub/pr/tests/system.c.dep.html#tag">tag</a> != SEC_OID_ANSIX9_DSA_SIGNATURE) &amp;&amp;
<strong><a name="482">  482</a></strong>              (<a href=
"../mozilla/nsprpub/pr/tests/system.c.dep.html#tag">tag</a> != SEC_OID_ANSIX9_DSA_SIGNATURE_WITH_SHA1_DIGEST) &amp;&amp;
<strong><a name="483">  483</a></strong>              (<a href=
"../mozilla/nsprpub/pr/tests/system.c.dep.html#tag">tag</a> != SEC_OID_BOGUS_DSA_SIGNATURE_WITH_SHA1_DIGEST) &amp;&amp;
<strong><a name="484">  484</a></strong>              (<a href=
"../mozilla/nsprpub/pr/tests/system.c.dep.html#tag">tag</a> != SEC_OID_SDN702_DSA_SIGNATURE) &amp;&amp;
<strong><a name="485">  485</a></strong>              (<a href=
"../mozilla/nsprpub/pr/tests/system.c.dep.html#tag">tag</a> != SEC_OID_ANSIX962_EC_PUBLIC_KEY) ) {
<strong><a name="486">  486</a></strong>
<strong><a name="487">  487</a></strong>             return <a href=
"../mozilla/security/nss/cmd/selfserv/selfserv.c.dep.html#SECSuccess">SECSuccess</a>;
<strong><a name="488">  488</a></strong>         }
<strong><a name="489">  489</a></strong>     } else {
<strong><a name=
"490">  490</a></strong>         return SECFailure;  /* return failure if oid is NULL */
<strong><a name="491">  491</a></strong>     }
<strong><a name="492">  492</a></strong>
<strong><a name=
"493">  493</a></strong>     /* if cert has PQG parameters, return success */
<strong><a name="494">  494</a></strong>
<strong><a name=
"495">  495</a></strong>     subjectSpki=&amp;subjectCert-&gt;subjectPublicKeyInfo;
<strong><a name="496">  496</a></strong>
<strong><a name=
"497">  497</a></strong>     if (subjectSpki-&gt;algorithm.<a href=
"../softoken/pk11pars.h.dep.html#parameters">parameters</a>.<a href=
"../mozilla/security/nss/cmd/crlutil/crlgen_lex.c.dep.html#len">len</a><a href=
"../mozilla/security/nss/cmd/modutil/lex.Pk11Install_yy.c.dep.html#len">[1]</a><a href="../mozilla/security/nss/cmd/zlib/adler32.c.dep.html#len">[2]</a><a href="../mozilla/security/nss/cmd/zlib/crc32.c.dep.html#len">[3]</a><a href="../mozilla/security/nss/cmd/zlib/gzio.c.dep.html#len">[6]</a><a href="../mozilla/security/nss/cmd/zlib/inflate.c.dep.html#len">[9]</a><a href="../mozilla/security/nss/cmd/zlib/trees.c.dep.html#len">[10]</a><a href="../mozilla/security/nss/cmd/zlib/zutil.c.dep.html#len">[13]</a> != 0) {
<strong><a name="498">  498</a></strong>         return <a href=
"../mozilla/security/nss/cmd/selfserv/selfserv.c.dep.html#SECSuccess">SECSuccess</a>;
<strong><a name="499">  499</a></strong>     }
<strong><a name="500">  500</a></strong>
<strong><a name=
"501">  501</a></strong>     /* check if the cert is self-signed */
<strong><a name="502">  502</a></strong>     rvCompare = (<a href=
"../util/seccomon.h.dep.html#SECStatus">SECStatus</a>)<a href=
"../util/secitem.c.dep.html#SECITEM_CompareItem">SECITEM_CompareItem</a>(&amp;subjectCert-&gt;derSubject,
<strong><a name=
"503">  503</a></strong>                                     &amp;subjectCert-&gt;derIssuer);
<strong><a name="504">  504</a></strong>     if (rvCompare == SECEqual) {
<strong><a name=
"505">  505</a></strong>       /* fail since cert is self-signed and has no pqg params. */
<strong><a name="506">  506</a></strong>         return SECFailure;
<strong><a name="507">  507</a></strong>     }
<strong><a name="508">  508</a></strong>
<strong><a name="509">  509</a></strong>     /* get issuer cert */
<strong><a name="510">  510</a></strong>     issuerCert = <a href=
"../certhigh/certvfy.c.dep.html#CERT_FindCertIssuer">CERT_FindCertIssuer</a>(subjectCert, <a href="../mozilla/nsprpub/pr/src/md/beos/beos.c.dep.html#PR_Now">PR_Now</a><a href="../mozilla/nsprpub/pr/src/md/mac/mactime.c.dep.html#PR_Now">[1]</a><a href="../mozilla/nsprpub/pr/src/md/os2/os2misc.c.dep.html#PR_Now">[2]</a><a href="../mozilla/nsprpub/pr/src/md/unix/unix.c.dep.html#PR_Now">[3]</a><a href="../mozilla/nsprpub/pr/src/md/windows/ntmisc.c.dep.html#PR_Now">[4]</a><a href="../mozilla/nsprpub/pr/src/md/windows/w16null.c.dep.html#PR_Now">[5]</a>(), certUsageAnyCA);
<strong><a name="511">  511</a></strong>     if ( ! issuerCert ) {
<strong><a name="512">  512</a></strong>         return SECFailure;
<strong><a name="513">  513</a></strong>     }
<strong><a name="514">  514</a></strong>
<strong><a name=
"515">  515</a></strong>     /* if parent is not DSA or fortezza, return failure since
<strong><a name="516">  516</a></strong>        we don't allow this case. */
<strong><a name="517">  517</a></strong>
<strong><a name="518">  518</a></strong>     oid = <a href=
"../util/secoid.c.dep.html#SECOID_FindOID">SECOID_FindOID</a>(&amp;issuerCert-&gt;subjectPublicKeyInfo.algorithm.algorithm);
<strong><a name="519">  519</a></strong>     if (oid != <a href=
"../mozilla/dbm/include/ncompat.h.dep.html#NULL">NULL</a>) {
<strong><a name="520">  520</a></strong>         <a href=
"../mozilla/nsprpub/pr/tests/system.c.dep.html#tag">tag</a> = oid-&gt;<a href=
"../mozilla/security/nss/cmd/zlib/gzio.c.dep.html#offset">offset</a>;
<strong><a name="521">  521</a></strong>
<strong><a name=
"522">  522</a></strong>         /* Check if issuer cert has a DSA or Fortezza public key. If not,
<strong><a name="523">  523</a></strong>          * return failure.   */
<strong><a name="524">  524</a></strong>
<strong><a name="525">  525</a></strong>         if ( (<a href=
"../mozilla/nsprpub/pr/tests/system.c.dep.html#tag">tag</a> != SEC_OID_MISSI_KEA_DSS_OLD) &amp;&amp;
<strong><a name="526">  526</a></strong>              (<a href=
"../mozilla/nsprpub/pr/tests/system.c.dep.html#tag">tag</a> != SEC_OID_MISSI_DSS_OLD) &amp;&amp;
<strong><a name="527">  527</a></strong>              (<a href=
"../mozilla/nsprpub/pr/tests/system.c.dep.html#tag">tag</a> != SEC_OID_MISSI_KEA_DSS) &amp;&amp;
<strong><a name="528">  528</a></strong>              (<a href=
"../mozilla/nsprpub/pr/tests/system.c.dep.html#tag">tag</a> != SEC_OID_MISSI_DSS) &amp;&amp;
<strong><a name="529">  529</a></strong>              (<a href=
"../mozilla/nsprpub/pr/tests/system.c.dep.html#tag">tag</a> != SEC_OID_ANSIX9_DSA_SIGNATURE) &amp;&amp;
<strong><a name="530">  530</a></strong>              (<a href=
"../mozilla/nsprpub/pr/tests/system.c.dep.html#tag">tag</a> != SEC_OID_ANSIX9_DSA_SIGNATURE_WITH_SHA1_DIGEST) &amp;&amp;
<strong><a name="531">  531</a></strong>              (<a href=
"../mozilla/nsprpub/pr/tests/system.c.dep.html#tag">tag</a> != SEC_OID_BOGUS_DSA_SIGNATURE_WITH_SHA1_DIGEST) &amp;&amp;
<strong><a name="532">  532</a></strong>              (<a href=
"../mozilla/nsprpub/pr/tests/system.c.dep.html#tag">tag</a> != SEC_OID_SDN702_DSA_SIGNATURE) &amp;&amp;
<strong><a name="533">  533</a></strong>              (<a href=
"../mozilla/nsprpub/pr/tests/system.c.dep.html#tag">tag</a> != SEC_OID_ANSIX962_EC_PUBLIC_KEY) ) {
<strong><a name="534">  534</a></strong>             <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> = SECFailure;
<strong><a name="535">  535</a></strong>             goto loser;
<strong><a name="536">  536</a></strong>         }
<strong><a name="537">  537</a></strong>     } else {
<strong><a name="538">  538</a></strong>         <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> = SECFailure;  /* return failure if oid is NULL */
<strong><a name="539">  539</a></strong>         goto loser;
<strong><a name="540">  540</a></strong>     }
<strong><a name="541">  541</a></strong>
<strong><a name="542">  542</a></strong>
<strong><a name=
"543">  543</a></strong>     /* at this point the subject cert has no pqg parameters and the
<strong><a name=
"544">  544</a></strong>      * issuer cert has a DSA or fortezza public key.  Update the issuer's
<strong><a name=
"545">  545</a></strong>      * pqg parameters with a recursive call to this same function. */
<strong><a name="546">  546</a></strong>
<strong><a name="547">  547</a></strong>     <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> = <a href=
"../cryptohi/seckey.c.dep.html#seckey_UpdateCertPQGChain">seckey_UpdateCertPQGChain</a>(issuerCert, <a href="../mozilla/nsprpub/pr/tests/accept.c.dep.html#count">count</a><a href="../mozilla/nsprpub/pr/tests/attach.c.dep.html#count">[1]</a><a href="../mozilla/nsprpub/pr/tests/cvar.c.dep.html#count">[2]</a><a href="../mozilla/nsprpub/pr/tests/cvar2.c.dep.html#count">[3]</a><a href="../mozilla/nsprpub/pr/tests/perf.c.dep.html#count">[4]</a><a href="../mozilla/nsprpub/pr/tests/select2.c.dep.html#count">[5]</a><a href="../mozilla/nsprpub/pr/tests/stat.c.dep.html#count">[6]</a><a href="../mozilla/nsprpub/pr/tests/suspend.c.dep.html#count">[7]</a><a href="../mozilla/nsprpub/pr/tests/testfile.c.dep.html#count">[8]</a><a href="../mozilla/nsprpub/pr/tests/threads.c.dep.html#count">[9]</a><a href="../mozilla/nsprpub/pr/tests/time.c.dep.html#count">[10]</a>);
<strong><a name="548">  548</a></strong>     if (<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> != <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a>/selfse<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a><a href=
"../mozilla/security/nss/cmd/selfse.c.dep.html#SECSuccess">SECSuccess</a>) {
<strong><a name="549">  549</a></strong>         <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> = SECFailure;
<strong><a name="550">  550</a></strong>         goto loser;
<strong><a name="551">  551</a></strong>     }
<strong><a name="552">  552</a></strong>
<strong><a name=
"553">  553</a></strong>     /* ensure issuer has pqg parameters */
<strong><a name="554">  554</a></strong>
<strong><a name=
"555">  555</a></strong>     issuerSpki=&amp;issuerCert-&gt;subjectPublicKeyInfo;
<strong><a name=
"556">  556</a></strong>     if (issuerSpki-&gt;algorithm.<a href=
"../softoken/pk11pars.h.dep.html#parameters">parameters</a>.<a href=
"../mozilla/security/nss/cmd/crlutil/crlgen_lex.c.dep.html#len">len</a><a href=
"../mozilla/security/nss/cmd/modutil/lex.Pk11Install_yy.c.dep.html#len">[1]</a><a href="../mozilla/security/nss/cmd/zlib/adler32.c.dep.html#len">[2]</a><a href="../mozilla/security/nss/cmd/zlib/crc32.c.dep.html#len">[3]</a><a href="../mozilla/security/nss/cmd/zlib/gzio.c.dep.html#len">[6]</a><a href="../mozilla/security/nss/cmd/zlib/inflate.c.dep.html#len">[9]</a><a href="../mozilla/security/nss/cmd/zlib/trees.c.dep.html#len">[10]</a><a href="../mozilla/security/nss/cmd/zlib/zutil.c.dep.html#len">[13]</a> == 0) {
<strong><a name="557">  557</a></strong>         <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> = SECFailure;
<strong><a name="558">  558</a></strong>     }
<strong><a name="559">  559</a></strong>
<strong><a name=
"560">  560</a></strong>     /* if update was successful and pqg params present, then copy the
<strong><a name=
"561">  561</a></strong>      * parameters to the subject cert's key. */
<strong><a name="562">  562</a></strong>
<strong><a name="563">  563</a></strong>     if (<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> == <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a>/selfse<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a><a href=
"../mozilla/security/nss/cmd/selfse.c.dep.html#SECSuccess">SECSuccess</a>) {
<strong><a name="564">  564</a></strong>         <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> = <a href=
"../util/secitem.c.dep.html#SECITEM_CopyItem">SECITEM_CopyItem</a>(subjectCert-&gt;arena,
<strong><a name=
"565">  565</a></strong>                               &amp;subjectSpki-&gt;algorithm.<a href="../softoken/pk11pars.h.dep.html#parameters">parameters</a>,
<strong><a name=
"566">  566</a></strong>                                  &amp;issuerSpki-&gt;algorithm.<a href="../softoken/pk11pars.h.dep.html#parameters">parameters</a>);
<strong><a name="567">  567</a></strong>     }
<strong><a name="568">  568</a></strong>
<strong><a name="569">  569</a></strong> loser:
<strong><a name="570">  570</a></strong>     if (issuerCert) {
<strong><a name="571">  571</a></strong>         <a href=
"../certdb/stanpcertdb.c.dep.html#CERT_DestroyCertificate">CERT_DestroyCertificate</a>(issuerCert);
<strong><a name="572">  572</a></strong>     }
<strong><a name="573">  573</a></strong>     return <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a>;
<strong><a name="574">  574</a></strong>
<strong><a name="575">  575</a></strong> }
<strong><a name="576">  576</a></strong>
<strong><a name="577">  577</a></strong>
<strong><a name="578">  578</a></strong> <a href=
"../util/seccomon.h.dep.html#SECStatus">SECStatus</a>
<strong><a name="579">  579</a></strong> <a href=
"#579">SECKEY_UpdateCertPQG</a>(<a href=
"../certdb/certt.h.dep.html#CERTCertificate">CERTCertificate</a> * subjectCert)
<strong><a name="580">  580</a></strong> {
<strong><a name="581">  581</a></strong>     if (!subjectCert) {
<strong><a name="582">  582</a></strong>         <a href=
"../util/secport.c.dep.html#PORT_SetError">PORT_SetError</a>(SEC_ERROR_INVALID_ARGS);
<strong><a name="583">  583</a></strong>         return SECFailure;
<strong><a name="584">  584</a></strong>     }
<strong><a name="585">  585</a></strong>     return <a href=
"../cryptohi/seckey.c.dep.html#seckey_UpdateCertPQGChain">seckey_UpdateCertPQGChain</a>(subjectCert,0);
<strong><a name="586">  586</a></strong> }
<strong><a name="587">  587</a></strong>
<strong><a name="588">  588</a></strong>
<strong><a name=
"589">  589</a></strong> /* Decode the PQG parameters.  The params could be stored in two
<strong><a name=
"590">  590</a></strong>  * possible formats, the old fortezza-only wrapped format or
<strong><a name=
"591">  591</a></strong>  * the standard DER encoded format.   Store the decoded parameters in an
<strong><a name="592">  592</a></strong>  * old fortezza cert data structure */
<strong><a name="593">  593</a></strong>
<strong><a name="594">  594</a></strong> <a href=
"../util/seccomon.h.dep.html#SECStatus">SECStatus</a>
<strong><a name="595">  595</a></strong> <a href=
"#595">SECKEY_FortezzaDecodePQGtoOld</a>(<a href=
"../mozilla/nsprpub/pr/include/obsolete/protypes.h.dep.html#PRArenaPool">PRArenaPool</a> *arena, <a href="../cryptohi/keythi.h.dep.html#SECKEYPublicKey">SECKEYPublicKey</a> *pubk,
<strong><a name="596">  596</a></strong>                               <a href=
"../util/seccomon.h.dep.html#SECItem">SECItem</a> *params) {
<strong><a name="597">  597</a></strong>     <a href=
"../util/seccomon.h.dep.html#SECStatus">SECStatus</a> <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a>;
<strong><a name="598">  598</a></strong>     <a href=
"../cryptohi/keythi.h.dep.html#SECKEYPQGDualParams">SECKEYPQGDualParams</a> dual_params;
<strong><a name="599">  599</a></strong>     <a href=
"../util/seccomon.h.dep.html#SECItem">SECItem</a> newparams;
<strong><a name="600">  600</a></strong>
<strong><a name="601">  601</a></strong>     <a href=
"../util/secport.h.dep.html#PORT_Assert">PORT_Assert</a><a href=
"../util/utf8.c.dep.html#PORT_Assert">[1]</a>(arena);
<strong><a name="602">  602</a></strong>
<strong><a name="603">  603</a></strong>     if (params == <a href=
"../mozilla/dbm/include/ncompat.h.dep.html#NULL">NULL</a>) return SECFailure;
<strong><a name="604">  604</a></strong>
<strong><a name="605">  605</a></strong>     if (params-&gt;<a href=
"../mozilla/security/nss/tests/pkcs11/netscape/suites/security/ssl/ssls.c.dep.html#data">data</a><a href="../mozilla/security/nss/tests/pkcs11/netscape/suites/security/ssl/ssls.h.dep.html#data">[2]</a> == <a href="../mozilla/dbm/include/ncompat.h.dep.html#NULL">NULL</a>) return SECFailure;
<strong><a name="606">  606</a></strong>
<strong><a name=
"607">  607</a></strong>     /* make a copy of the data into the arena so QuickDER output is valid */
<strong><a name="608">  608</a></strong>     <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> = <a href=
"../util/secitem.c.dep.html#SECITEM_CopyItem">SECITEM_CopyItem</a>(arena, &amp;newparams, params);
<strong><a name="609">  609</a></strong>
<strong><a name=
"610">  610</a></strong>     /* Check if params use the standard format.
<strong><a name=
"611">  611</a></strong>      * The value 0xa1 will appear in the first byte of the parameter data
<strong><a name=
"612">  612</a></strong>      * if the PQG parameters are not using the standard format. This
<strong><a name=
"613">  613</a></strong>      * code should be changed to use a better method to detect non-standard
<strong><a name="614">  614</a></strong>      * parameters.    */
<strong><a name="615">  615</a></strong>
<strong><a name="616">  616</a></strong>     if ((newparams.<a href=
"../mozilla/security/nss/tests/pkcs11/netscape/suites/security/ssl/ssls.c.dep.html#data">data</a><a href="../mozilla/security/nss/tests/pkcs11/netscape/suites/security/ssl/ssls.h.dep.html#data">[2]</a>[0] != 0xa1) &amp;&amp;
<strong><a name="617">  617</a></strong>         (newparams.<a href=
"../mozilla/security/nss/tests/pkcs11/netscape/suites/security/ssl/ssls.c.dep.html#data">data</a><a href="../mozilla/security/nss/tests/pkcs11/netscape/suites/security/ssl/ssls.h.dep.html#data">[2]</a>[0] != 0xa0)) {
<strong><a name="618">  618</a></strong>
<strong><a name="619">  619</a></strong>         if (<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a>/selfse<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a><a href=
"../mozilla/security/nss/cmd/selfse.c.dep.html#SECSuccess">SECSuccess</a> == <a href="../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href="../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a>) {
<strong><a name=
"620">  620</a></strong>             /* PQG params are in the standard format */
<strong><a name="621">  621</a></strong>
<strong><a name=
"622">  622</a></strong>             /* Store DSA PQG parameters */
<strong><a name="623">  623</a></strong>             <a href=
"../cryptohi/seckey.c.dep.html#prepare_pqg_params_for_asn1">prepare_pqg_params_for_asn1</a>(&amp;pubk-&gt;u.fortezza.params);
<strong><a name="624">  624</a></strong>             <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> = <a href=
"../util/quickder.c.dep.html#SEC_QuickDERDecodeItem">SEC_QuickDERDecodeItem</a>(arena, &amp;pubk-&gt;u.fortezza.params,
<strong><a name="625">  625</a></strong>                               <a href=
"../mozilla/security/nss/cmd/certutil/keystuff.c.dep.html#SECKEY_PQGParamsTemplate">SECKEY_PQGParamsTemplate</a><a href="../cryptohi/keythi.h.dep.html#SECKEY_PQGParamsTemplate">[1]</a><a href="../cryptohi/seckey.c.dep.html#SECKEY_PQGParamsTemplate">[2]</a>,
<strong><a name=
"626">  626</a></strong>                               &amp;newparams);
<strong><a name="627">  627</a></strong>         }
<strong><a name="628">  628</a></strong>
<strong><a name="629">  629</a></strong>         if (<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a>/selfse<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a><a href=
"../mozilla/security/nss/cmd/selfse.c.dep.html#SECSuccess">SECSuccess</a> == <a href="../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href="../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a>) {
<strong><a name="630">  630</a></strong>
<strong><a name=
"631">  631</a></strong>             /* Copy the DSA PQG parameters to the KEA PQG parameters. */
<strong><a name="632">  632</a></strong>             <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> = <a href=
"../util/secitem.c.dep.html#SECITEM_CopyItem">SECITEM_CopyItem</a>(arena, &amp;pubk-&gt;u.fortezza.keaParams.prime,
<strong><a name=
"633">  633</a></strong>                                   &amp;pubk-&gt;u.fortezza.params.prime);
<strong><a name="634">  634</a></strong>         }
<strong><a name="635">  635</a></strong>         if (<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a>/selfse<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a><a href=
"../mozilla/security/nss/cmd/selfse.c.dep.html#SECSuccess">SECSuccess</a> == <a href="../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href="../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a>) {
<strong><a name="636">  636</a></strong>             <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> = <a href=
"../util/secitem.c.dep.html#SECITEM_CopyItem">SECITEM_CopyItem</a>(arena, &amp;pubk-&gt;u.fortezza.keaParams.subPrime,
<strong><a name=
"637">  637</a></strong>                                   &amp;pubk-&gt;u.fortezza.params.subPrime);
<strong><a name="638">  638</a></strong>         }
<strong><a name="639">  639</a></strong>         if (<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a>/selfse<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a><a href=
"../mozilla/security/nss/cmd/selfse.c.dep.html#SECSuccess">SECSuccess</a> == <a href="../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href="../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a>) {
<strong><a name="640">  640</a></strong>             <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> = <a href=
"../util/secitem.c.dep.html#SECITEM_CopyItem">SECITEM_CopyItem</a>(arena, &amp;pubk-&gt;u.fortezza.keaParams.<a href="../mozilla/nsprpub/lib/libc/src/base64.c.dep.html#base">base</a><a href="../mozilla/nsprpub/lib/tests/base64t.c.dep.html#base">[1]</a><a href="../mozilla/nsprpub/pr/tests/xnotify.c.dep.html#base">[2]</a><a href="../mozilla/security/nss/cmd/crlutil/crlgen_lex.c.dep.html#base">[3]</a><a href="../mozilla/security/nss/cmd/modutil/lex.Pk11Install_yy.c.dep.html#base">[4]</a><a href="../mozilla/security/nss/cmd/signtool/signtool.c.dep.html#base">[5]</a><a href="../mozilla/security/nss/cmd/signtool/signtool.h.dep.html#base">[6]</a>,
<strong><a name=
"641">  641</a></strong>                                   &amp;pubk-&gt;u.fortezza.params.<a href="../mozilla/nsprpub/lib/libc/src/base64.c.dep.html#base">base</a><a href="../mozilla/nsprpub/lib/tests/base64t.c.dep.html#base">[1]</a><a href="../mozilla/nsprpub/pr/tests/xnotify.c.dep.html#base">[2]</a><a href="../mozilla/security/nss/cmd/crlutil/crlgen_lex.c.dep.html#base">[3]</a><a href="../mozilla/security/nss/cmd/modutil/lex.Pk11Install_yy.c.dep.html#base">[4]</a><a href="../mozilla/security/nss/cmd/signtool/signtool.c.dep.html#base">[5]</a><a href="../mozilla/security/nss/cmd/signtool/signtool.h.dep.html#base">[6]</a>);
<strong><a name="642">  642</a></strong>         }
<strong><a name="643">  643</a></strong>     } else {
<strong><a name="644">  644</a></strong>
<strong><a name=
"645">  645</a></strong>         dual_params.CommParams.prime.<a href=
"../mozilla/security/nss/cmd/crlutil/crlgen_lex.c.dep.html#len">len</a><a href=
"../mozilla/security/nss/cmd/modutil/lex.Pk11Install_yy.c.dep.html#len">[1]</a><a href="../mozilla/security/nss/cmd/zlib/adler32.c.dep.html#len">[2]</a><a href="../mozilla/security/nss/cmd/zlib/crc32.c.dep.html#len">[3]</a><a href="../mozilla/security/nss/cmd/zlib/gzio.c.dep.html#len">[6]</a><a href="../mozilla/security/nss/cmd/zlib/inflate.c.dep.html#len">[9]</a><a href="../mozilla/security/nss/cmd/zlib/trees.c.dep.html#len">[10]</a><a href="../mozilla/security/nss/cmd/zlib/zutil.c.dep.html#len">[13]</a> = 0;
<strong><a name=
"646">  646</a></strong>         dual_params.CommParams.subPrime.<a href=
"../mozilla/security/nss/cmd/crlutil/crlgen_lex.c.dep.html#len">len</a><a href=
"../mozilla/security/nss/cmd/modutil/lex.Pk11Install_yy.c.dep.html#len">[1]</a><a href="../mozilla/security/nss/cmd/zlib/adler32.c.dep.html#len">[2]</a><a href="../mozilla/security/nss/cmd/zlib/crc32.c.dep.html#len">[3]</a><a href="../mozilla/security/nss/cmd/zlib/gzio.c.dep.html#len">[6]</a><a href="../mozilla/security/nss/cmd/zlib/inflate.c.dep.html#len">[9]</a><a href="../mozilla/security/nss/cmd/zlib/trees.c.dep.html#len">[10]</a><a href="../mozilla/security/nss/cmd/zlib/zutil.c.dep.html#len">[13]</a> = 0;
<strong><a name=
"647">  647</a></strong>         dual_params.CommParams.<a href="../mozilla/nsprpub/lib/libc/src/base64.c.dep.html#base">base</a><a href="../mozilla/nsprpub/lib/tests/base64t.c.dep.html#base">[1]</a><a href="../mozilla/nsprpub/pr/tests/xnotify.c.dep.html#base">[2]</a><a href="../mozilla/security/nss/cmd/crlutil/crlgen_lex.c.dep.html#base">[3]</a><a href="../mozilla/security/nss/cmd/modutil/lex.Pk11Install_yy.c.dep.html#base">[4]</a><a href="../mozilla/security/nss/cmd/signtool/signtool.c.dep.html#base">[5]</a><a href="../mozilla/security/nss/cmd/signtool/signtool.h.dep.html#base">[6]</a>.<a href="../mozilla/security/nss/cmd/crlutil/crlgen_lex.c.dep.html#len">len</a><a href="../mozilla/security/nss/cmd/modutil/lex.Pk11Install_yy.c.dep.html#len">[1]</a><a href="../mozilla/security/nss/cmd/zlib/adler32.c.dep.html#len">[2]</a><a href="../mozilla/security/nss/cmd/zlib/crc32.c.dep.html#len">[3]</a><a href="../mozilla/security/nss/cmd/zlib/gzio.c.dep.html#len">[6]</a><a href="../mozilla/security/nss/cmd/zlib/inflate.c.dep.html#len">[9]</a><a href="../mozilla/security/nss/cmd/zlib/trees.c.dep.html#len">[10]</a><a href="../mozilla/security/nss/cmd/zlib/zutil.c.dep.html#len">[13]</a> = 0;
<strong><a name=
"648">  648</a></strong>         dual_params.DiffParams.DiffDSAParams.prime.<a href="../mozilla/security/nss/cmd/crlutil/crlgen_lex.c.dep.html#len">len</a><a href="../mozilla/security/nss/cmd/modutil/lex.Pk11Install_yy.c.dep.html#len">[1]</a><a href="../mozilla/security/nss/cmd/zlib/adler32.c.dep.html#len">[2]</a><a href="../mozilla/security/nss/cmd/zlib/crc32.c.dep.html#len">[3]</a><a href="../mozilla/security/nss/cmd/zlib/gzio.c.dep.html#len">[6]</a><a href="../mozilla/security/nss/cmd/zlib/inflate.c.dep.html#len">[9]</a><a href="../mozilla/security/nss/cmd/zlib/trees.c.dep.html#len">[10]</a><a href="../mozilla/security/nss/cmd/zlib/zutil.c.dep.html#len">[13]</a> = 0;
<strong><a name=
"649">  649</a></strong>         dual_params.DiffParams.DiffDSAParams.subPrime.<a href="../mozilla/security/nss/cmd/crlutil/crlgen_lex.c.dep.html#len">len</a><a href="../mozilla/security/nss/cmd/modutil/lex.Pk11Install_yy.c.dep.html#len">[1]</a><a href="../mozilla/security/nss/cmd/zlib/adler32.c.dep.html#len">[2]</a><a href="../mozilla/security/nss/cmd/zlib/crc32.c.dep.html#len">[3]</a><a href="../mozilla/security/nss/cmd/zlib/gzio.c.dep.html#len">[6]</a><a href="../mozilla/security/nss/cmd/zlib/inflate.c.dep.html#len">[9]</a><a href="../mozilla/security/nss/cmd/zlib/trees.c.dep.html#len">[10]</a><a href="../mozilla/security/nss/cmd/zlib/zutil.c.dep.html#len">[13]</a> = 0;
<strong><a name=
"650">  650</a></strong>         dual_params.DiffParams.DiffDSAParams.<a href=
"../mozilla/nsprpub/lib/libc/src/base64.c.dep.html#base">base</a><a href=
"../mozilla/nsprpub/lib/tests/base64t.c.dep.html#base">[1]</a><a href=
"../mozilla/nsprpub/pr/tests/xnotify.c.dep.html#base">[2]</a><a href=
"../mozilla/security/nss/cmd/crlutil/crlgen_lex.c.dep.html#base">[3]</a><a href="../mozilla/security/nss/cmd/modutil/lex.Pk11Install_yy.c.dep.html#base">[4]</a><a href="../mozilla/security/nss/cmd/signtool/signtool.c.dep.html#base">[5]</a><a href="../mozilla/security/nss/cmd/signtool/signtool.h.dep.html#base">[6]</a>.<a href="../mozilla/security/nss/cmd/crlutil/crlgen_lex.c.dep.html#len">len</a><a href="../mozilla/security/nss/cmd/modutil/lex.Pk11Install_yy.c.dep.html#len">[1]</a><a href="../mozilla/security/nss/cmd/zlib/adler32.c.dep.html#len">[2]</a><a href="../mozilla/security/nss/cmd/zlib/crc32.c.dep.html#len">[3]</a><a href="../mozilla/security/nss/cmd/zlib/gzio.c.dep.html#len">[6]</a><a href="../mozilla/security/nss/cmd/zlib/inflate.c.dep.html#len">[9]</a><a href="../mozilla/security/nss/cmd/zlib/trees.c.dep.html#len">[10]</a><a href="../mozilla/security/nss/cmd/zlib/zutil.c.dep.html#len">[13]</a> = 0;
<strong><a name="651">  651</a></strong>
<strong><a name=
"652">  652</a></strong>         /* else the old fortezza-only wrapped format is used. */
<strong><a name="653">  653</a></strong>
<strong><a name="654">  654</a></strong>         if (<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a>/selfse<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a><a href=
"../mozilla/security/nss/cmd/selfse.c.dep.html#SECSuccess">SECSuccess</a> == <a href="../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href="../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a>) {
<strong><a name="655">  655</a></strong>             if (newparams.<a href=
"../mozilla/security/nss/tests/pkcs11/netscape/suites/security/ssl/ssls.c.dep.html#data">data</a><a href="../mozilla/security/nss/tests/pkcs11/netscape/suites/security/ssl/ssls.h.dep.html#data">[2]</a>[0] == 0xa1) {
<strong><a name="656">  656</a></strong>                 <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> = <a href=
"../util/quickder.c.dep.html#SEC_QuickDERDecodeItem">SEC_QuickDERDecodeItem</a>(arena, &amp;dual_params,
<strong><a name=
"657">  657</a></strong>                                     <a href=
"../cryptohi/seckey.c.dep.html#SECKEY_FortezzaPreParamTemplate">SECKEY_FortezzaPreParamTemplate</a>, &amp;newparams);
<strong><a name="658">  658</a></strong>             } else {
<strong><a name="659">  659</a></strong>                 <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> = <a href=
"../util/quickder.c.dep.html#SEC_QuickDERDecodeItem">SEC_QuickDERDecodeItem</a>(arena, &amp;dual_params,
<strong><a name=
"660">  660</a></strong>                                            <a href=
"../cryptohi/seckey.c.dep.html#SECKEY_FortezzaAltPreParamTemplate">SECKEY_FortezzaAltPreParamTemplate</a>, &amp;newparams);
<strong><a name="661">  661</a></strong>             }
<strong><a name="662">  662</a></strong>         }
<strong><a name="663">  663</a></strong>
<strong><a name=
"664">  664</a></strong>         if ( (dual_params.CommParams.prime.<a href=
"../mozilla/security/nss/cmd/crlutil/crlgen_lex.c.dep.html#len">len</a><a href=
"../mozilla/security/nss/cmd/modutil/lex.Pk11Install_yy.c.dep.html#len">[1]</a><a href="../mozilla/security/nss/cmd/zlib/adler32.c.dep.html#len">[2]</a><a href="../mozilla/security/nss/cmd/zlib/crc32.c.dep.html#len">[3]</a><a href="../mozilla/security/nss/cmd/zlib/gzio.c.dep.html#len">[6]</a><a href="../mozilla/security/nss/cmd/zlib/inflate.c.dep.html#len">[9]</a><a href="../mozilla/security/nss/cmd/zlib/trees.c.dep.html#len">[10]</a><a href="../mozilla/security/nss/cmd/zlib/zutil.c.dep.html#len">[13]</a> &gt; 0) &amp;&amp;
<strong><a name=
"665">  665</a></strong>              (dual_params.CommParams.subPrime.<a href=
"../mozilla/security/nss/cmd/crlutil/crlgen_lex.c.dep.html#len">len</a><a href=
"../mozilla/security/nss/cmd/modutil/lex.Pk11Install_yy.c.dep.html#len">[1]</a><a href="../mozilla/security/nss/cmd/zlib/adler32.c.dep.html#len">[2]</a><a href="../mozilla/security/nss/cmd/zlib/crc32.c.dep.html#len">[3]</a><a href="../mozilla/security/nss/cmd/zlib/gzio.c.dep.html#len">[6]</a><a href="../mozilla/security/nss/cmd/zlib/inflate.c.dep.html#len">[9]</a><a href="../mozilla/security/nss/cmd/zlib/trees.c.dep.html#len">[10]</a><a href="../mozilla/security/nss/cmd/zlib/zutil.c.dep.html#len">[13]</a> &gt; 0) &amp;&amp;
<strong><a name=
"666">  666</a></strong>              (dual_params.CommParams.<a href=
"../mozilla/nsprpub/lib/libc/src/base64.c.dep.html#base">base</a><a href=
"../mozilla/nsprpub/lib/tests/base64t.c.dep.html#base">[1]</a><a href=
"../mozilla/nsprpub/pr/tests/xnotify.c.dep.html#base">[2]</a><a href=
"../mozilla/security/nss/cmd/crlutil/crlgen_lex.c.dep.html#base">[3]</a><a href="../mozilla/security/nss/cmd/modutil/lex.Pk11Install_yy.c.dep.html#base">[4]</a><a href="../mozilla/security/nss/cmd/signtool/signtool.c.dep.html#base">[5]</a><a href="../mozilla/security/nss/cmd/signtool/signtool.h.dep.html#base">[6]</a>.<a href="../mozilla/security/nss/cmd/crlutil/crlgen_lex.c.dep.html#len">len</a><a href="../mozilla/security/nss/cmd/modutil/lex.Pk11Install_yy.c.dep.html#len">[1]</a><a href="../mozilla/security/nss/cmd/zlib/adler32.c.dep.html#len">[2]</a><a href="../mozilla/security/nss/cmd/zlib/crc32.c.dep.html#len">[3]</a><a href="../mozilla/security/nss/cmd/zlib/gzio.c.dep.html#len">[6]</a><a href="../mozilla/security/nss/cmd/zlib/inflate.c.dep.html#len">[9]</a><a href="../mozilla/security/nss/cmd/zlib/trees.c.dep.html#len">[10]</a><a href="../mozilla/security/nss/cmd/zlib/zutil.c.dep.html#len">[13]</a> &gt; 0) ) {
<strong><a name=
"667">  667</a></strong>             /* copy in common params */
<strong><a name="668">  668</a></strong>             if (<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a>/selfse<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a><a href=
"../mozilla/security/nss/cmd/selfse.c.dep.html#SECSuccess">SECSuccess</a> == <a href="../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href="../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a>) {
<strong><a name="669">  669</a></strong>                 <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> = <a href=
"../util/secitem.c.dep.html#SECITEM_CopyItem">SECITEM_CopyItem</a>(arena, &amp;pubk-&gt;u.fortezza.params.prime,
<strong><a name=
"670">  670</a></strong>                                       &amp;dual_params.CommParams.prime);
<strong><a name="671">  671</a></strong>             }
<strong><a name="672">  672</a></strong>             if (<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a>/selfse<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a><a href=
"../mozilla/security/nss/cmd/selfse.c.dep.html#SECSuccess">SECSuccess</a> == <a href="../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href="../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a>) {
<strong><a name="673">  673</a></strong>                 <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> = <a href=
"../util/secitem.c.dep.html#SECITEM_CopyItem">SECITEM_CopyItem</a>(arena, &amp;pubk-&gt;u.fortezza.params.subPrime,
<strong><a name=
"674">  674</a></strong>                                       &amp;dual_params.CommParams.subPrime);
<strong><a name="675">  675</a></strong>             }
<strong><a name="676">  676</a></strong>             if (<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a>/selfse<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a><a href=
"../mozilla/security/nss/cmd/selfse.c.dep.html#SECSuccess">SECSuccess</a> == <a href="../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href="../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a>) {
<strong><a name="677">  677</a></strong>                 <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> = <a href=
"../util/secitem.c.dep.html#SECITEM_CopyItem">SECITEM_CopyItem</a>(arena, &amp;pubk-&gt;u.fortezza.params.<a href="../mozilla/nsprpub/lib/libc/src/base64.c.dep.html#base">base</a><a href="../mozilla/nsprpub/lib/tests/base64t.c.dep.html#base">[1]</a><a href="../mozilla/nsprpub/pr/tests/xnotify.c.dep.html#base">[2]</a><a href="../mozilla/security/nss/cmd/crlutil/crlgen_lex.c.dep.html#base">[3]</a><a href="../mozilla/security/nss/cmd/modutil/lex.Pk11Install_yy.c.dep.html#base">[4]</a><a href="../mozilla/security/nss/cmd/signtool/signtool.c.dep.html#base">[5]</a><a href="../mozilla/security/nss/cmd/signtool/signtool.h.dep.html#base">[6]</a>,
<strong><a name=
"678">  678</a></strong>                                       &amp;dual_params.CommParams.<a href="../mozilla/nsprpub/lib/libc/src/base64.c.dep.html#base">base</a><a href="../mozilla/nsprpub/lib/tests/base64t.c.dep.html#base">[1]</a><a href="../mozilla/nsprpub/pr/tests/xnotify.c.dep.html#base">[2]</a><a href="../mozilla/security/nss/cmd/crlutil/crlgen_lex.c.dep.html#base">[3]</a><a href="../mozilla/security/nss/cmd/modutil/lex.Pk11Install_yy.c.dep.html#base">[4]</a><a href="../mozilla/security/nss/cmd/signtool/signtool.c.dep.html#base">[5]</a><a href="../mozilla/security/nss/cmd/signtool/signtool.h.dep.html#base">[6]</a>);
<strong><a name="679">  679</a></strong>             }
<strong><a name="680">  680</a></strong>
<strong><a name=
"681">  681</a></strong>             /* Copy the DSA PQG parameters to the KEA PQG parameters. */
<strong><a name="682">  682</a></strong>             if (<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a>/selfse<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a><a href=
"../mozilla/security/nss/cmd/selfse.c.dep.html#SECSuccess">SECSuccess</a> == <a href="../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href="../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a>) {
<strong><a name="683">  683</a></strong>                 <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> = <a href=
"../util/secitem.c.dep.html#SECITEM_CopyItem">SECITEM_CopyItem</a>(arena, &amp;pubk-&gt;u.fortezza.keaParams.prime,
<strong><a name=
"684">  684</a></strong>                                       &amp;pubk-&gt;u.fortezza.params.prime);
<strong><a name="685">  685</a></strong>             }
<strong><a name="686">  686</a></strong>             if (<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a>/selfse<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a><a href=
"../mozilla/security/nss/cmd/selfse.c.dep.html#SECSuccess">SECSuccess</a> == <a href="../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href="../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a>) {
<strong><a name="687">  687</a></strong>                 <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> = <a href=
"../util/secitem.c.dep.html#SECITEM_CopyItem">SECITEM_CopyItem</a>(arena, &amp;pubk-&gt;u.fortezza.keaParams.subPrime,
<strong><a name=
"688">  688</a></strong>                                       &amp;pubk-&gt;u.fortezza.params.subPrime);
<strong><a name="689">  689</a></strong>             }
<strong><a name="690">  690</a></strong>             if (<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a>/selfse<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a><a href=
"../mozilla/security/nss/cmd/selfse.c.dep.html#SECSuccess">SECSuccess</a> == <a href="../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href="../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a>) {
<strong><a name="691">  691</a></strong>                 <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> = <a href=
"../util/secitem.c.dep.html#SECITEM_CopyItem">SECITEM_CopyItem</a>(arena, &amp;pubk-&gt;u.fortezza.keaParams.<a href="../mozilla/nsprpub/lib/libc/src/base64.c.dep.html#base">base</a><a href="../mozilla/nsprpub/lib/tests/base64t.c.dep.html#base">[1]</a><a href="../mozilla/nsprpub/pr/tests/xnotify.c.dep.html#base">[2]</a><a href="../mozilla/security/nss/cmd/crlutil/crlgen_lex.c.dep.html#base">[3]</a><a href="../mozilla/security/nss/cmd/modutil/lex.Pk11Install_yy.c.dep.html#base">[4]</a><a href="../mozilla/security/nss/cmd/signtool/signtool.c.dep.html#base">[5]</a><a href="../mozilla/security/nss/cmd/signtool/signtool.h.dep.html#base">[6]</a>,
<strong><a name=
"692">  692</a></strong>                                       &amp;pubk-&gt;u.fortezza.params.<a href="../mozilla/nsprpub/lib/libc/src/base64.c.dep.html#base">base</a><a href="../mozilla/nsprpub/lib/tests/base64t.c.dep.html#base">[1]</a><a href="../mozilla/nsprpub/pr/tests/xnotify.c.dep.html#base">[2]</a><a href="../mozilla/security/nss/cmd/crlutil/crlgen_lex.c.dep.html#base">[3]</a><a href="../mozilla/security/nss/cmd/modutil/lex.Pk11Install_yy.c.dep.html#base">[4]</a><a href="../mozilla/security/nss/cmd/signtool/signtool.c.dep.html#base">[5]</a><a href="../mozilla/security/nss/cmd/signtool/signtool.h.dep.html#base">[6]</a>);
<strong><a name="693">  693</a></strong>             }
<strong><a name="694">  694</a></strong>         } else {
<strong><a name="695">  695</a></strong>
<strong><a name=
"696">  696</a></strong>             /* else copy in different params */
<strong><a name="697">  697</a></strong>
<strong><a name=
"698">  698</a></strong>             /* copy DSA PQG parameters */
<strong><a name="699">  699</a></strong>             if (<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a>/selfse<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a><a href=
"../mozilla/security/nss/cmd/selfse.c.dep.html#SECSuccess">SECSuccess</a> == <a href="../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href="../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a>) {
<strong><a name="700">  700</a></strong>                 <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> = <a href=
"../util/secitem.c.dep.html#SECITEM_CopyItem">SECITEM_CopyItem</a>(arena, &amp;pubk-&gt;u.fortezza.params.prime,
<strong><a name=
"701">  701</a></strong>                                   &amp;dual_params.DiffParams.DiffDSAParams.prime);
<strong><a name="702">  702</a></strong>             }
<strong><a name="703">  703</a></strong>             if (<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a>/selfse<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a><a href=
"../mozilla/security/nss/cmd/selfse.c.dep.html#SECSuccess">SECSuccess</a> == <a href="../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href="../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a>) {
<strong><a name="704">  704</a></strong>                 <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> = <a href=
"../util/secitem.c.dep.html#SECITEM_CopyItem">SECITEM_CopyItem</a>(arena, &amp;pubk-&gt;u.fortezza.params.subPrime,
<strong><a name=
"705">  705</a></strong>                                   &amp;dual_params.DiffParams.DiffDSAParams.subPrime);
<strong><a name="706">  706</a></strong>             }
<strong><a name="707">  707</a></strong>             if (<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a>/selfse<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a><a href=
"../mozilla/security/nss/cmd/selfse.c.dep.html#SECSuccess">SECSuccess</a> == <a href="../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href="../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a>) {
<strong><a name="708">  708</a></strong>                 <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> = <a href=
"../util/secitem.c.dep.html#SECITEM_CopyItem">SECITEM_CopyItem</a>(arena, &amp;pubk-&gt;u.fortezza.params.<a href="../mozilla/nsprpub/lib/libc/src/base64.c.dep.html#base">base</a><a href="../mozilla/nsprpub/lib/tests/base64t.c.dep.html#base">[1]</a><a href="../mozilla/nsprpub/pr/tests/xnotify.c.dep.html#base">[2]</a><a href="../mozilla/security/nss/cmd/crlutil/crlgen_lex.c.dep.html#base">[3]</a><a href="../mozilla/security/nss/cmd/modutil/lex.Pk11Install_yy.c.dep.html#base">[4]</a><a href="../mozilla/security/nss/cmd/signtool/signtool.c.dep.html#base">[5]</a><a href="../mozilla/security/nss/cmd/signtool/signtool.h.dep.html#base">[6]</a>,
<strong><a name=
"709">  709</a></strong>                                   &amp;dual_params.DiffParams.DiffDSAParams.<a href="../mozilla/nsprpub/lib/libc/src/base64.c.dep.html#base">base</a><a href="../mozilla/nsprpub/lib/tests/base64t.c.dep.html#base">[1]</a><a href="../mozilla/nsprpub/pr/tests/xnotify.c.dep.html#base">[2]</a><a href="../mozilla/security/nss/cmd/crlutil/crlgen_lex.c.dep.html#base">[3]</a><a href="../mozilla/security/nss/cmd/modutil/lex.Pk11Install_yy.c.dep.html#base">[4]</a><a href="../mozilla/security/nss/cmd/signtool/signtool.c.dep.html#base">[5]</a><a href="../mozilla/security/nss/cmd/signtool/signtool.h.dep.html#base">[6]</a>);
<strong><a name="710">  710</a></strong>             }
<strong><a name="711">  711</a></strong>
<strong><a name=
"712">  712</a></strong>             /* copy KEA PQG parameters */
<strong><a name="713">  713</a></strong>
<strong><a name="714">  714</a></strong>             if (<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a>/selfse<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a><a href=
"../mozilla/security/nss/cmd/selfse.c.dep.html#SECSuccess">SECSuccess</a> == <a href="../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href="../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a>) {
<strong><a name="715">  715</a></strong>                 <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> = <a href=
"../util/secitem.c.dep.html#SECITEM_CopyItem">SECITEM_CopyItem</a>(arena, &amp;pubk-&gt;u.fortezza.keaParams.prime,
<strong><a name=
"716">  716</a></strong>                                   &amp;dual_params.DiffParams.DiffKEAParams.prime);
<strong><a name="717">  717</a></strong>             }
<strong><a name="718">  718</a></strong>             if (<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a>/selfse<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a><a href=
"../mozilla/security/nss/cmd/selfse.c.dep.html#SECSuccess">SECSuccess</a> == <a href="../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href="../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a>) {
<strong><a name="719">  719</a></strong>                 <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> = <a href=
"../util/secitem.c.dep.html#SECITEM_CopyItem">SECITEM_CopyItem</a>(arena, &amp;pubk-&gt;u.fortezza.keaParams.subPrime,
<strong><a name=
"720">  720</a></strong>                                   &amp;dual_params.DiffParams.DiffKEAParams.subPrime);
<strong><a name="721">  721</a></strong>             }
<strong><a name="722">  722</a></strong>             if (<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a>/selfse<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a><a href=
"../mozilla/security/nss/cmd/selfse.c.dep.html#SECSuccess">SECSuccess</a> == <a href="../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href="../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a>) {
<strong><a name="723">  723</a></strong>                 <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> = <a href=
"../util/secitem.c.dep.html#SECITEM_CopyItem">SECITEM_CopyItem</a>(arena, &amp;pubk-&gt;u.fortezza.keaParams.<a href="../mozilla/nsprpub/lib/libc/src/base64.c.dep.html#base">base</a><a href="../mozilla/nsprpub/lib/tests/base64t.c.dep.html#base">[1]</a><a href="../mozilla/nsprpub/pr/tests/xnotify.c.dep.html#base">[2]</a><a href="../mozilla/security/nss/cmd/crlutil/crlgen_lex.c.dep.html#base">[3]</a><a href="../mozilla/security/nss/cmd/modutil/lex.Pk11Install_yy.c.dep.html#base">[4]</a><a href="../mozilla/security/nss/cmd/signtool/signtool.c.dep.html#base">[5]</a><a href="../mozilla/security/nss/cmd/signtool/signtool.h.dep.html#base">[6]</a>,
<strong><a name=
"724">  724</a></strong>                                   &amp;dual_params.DiffParams.DiffKEAParams.<a href="../mozilla/nsprpub/lib/libc/src/base64.c.dep.html#base">base</a><a href="../mozilla/nsprpub/lib/tests/base64t.c.dep.html#base">[1]</a><a href="../mozilla/nsprpub/pr/tests/xnotify.c.dep.html#base">[2]</a><a href="../mozilla/security/nss/cmd/crlutil/crlgen_lex.c.dep.html#base">[3]</a><a href="../mozilla/security/nss/cmd/modutil/lex.Pk11Install_yy.c.dep.html#base">[4]</a><a href="../mozilla/security/nss/cmd/signtool/signtool.c.dep.html#base">[5]</a><a href="../mozilla/security/nss/cmd/signtool/signtool.h.dep.html#base">[6]</a>);
<strong><a name="725">  725</a></strong>             }
<strong><a name="726">  726</a></strong>         }
<strong><a name="727">  727</a></strong>     }
<strong><a name="728">  728</a></strong>     return <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a>;
<strong><a name="729">  729</a></strong> }
<strong><a name="730">  730</a></strong>
<strong><a name="731">  731</a></strong>
<strong><a name=
"732">  732</a></strong> /* Decode the DSA PQG parameters. The params could be stored in two
<strong><a name=
"733">  733</a></strong>  * possible formats, the old fortezza-only wrapped format or
<strong><a name=
"734">  734</a></strong>  * the normal standard format.  Store the decoded parameters in
<strong><a name=
"735">  735</a></strong>  * a V3 certificate data structure.  */
<strong><a name="736">  736</a></strong>
<strong><a name="737">  737</a></strong> <a href=
"../util/seccomon.h.dep.html#SECStatus">SECStatus</a>
<strong><a name="738">  738</a></strong> <a href=
"#738">SECKEY_DSADecodePQG</a>(<a href=
"../mozilla/nsprpub/pr/include/obsolete/protypes.h.dep.html#PRArenaPool">PRArenaPool</a> *arena, <a href="../cryptohi/keythi.h.dep.html#SECKEYPublicKey">SECKEYPublicKey</a> *pubk, <a href="../util/seccomon.h.dep.html#SECItem">SECItem</a> *params) {
<strong><a name="739">  739</a></strong>     <a href=
"../util/seccomon.h.dep.html#SECStatus">SECStatus</a> <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a>;
<strong><a name="740">  740</a></strong>     <a href=
"../cryptohi/keythi.h.dep.html#SECKEYPQGDualParams">SECKEYPQGDualParams</a> dual_params;
<strong><a name="741">  741</a></strong>     <a href=
"../util/seccomon.h.dep.html#SECItem">SECItem</a> newparams;
<strong><a name="742">  742</a></strong>
<strong><a name="743">  743</a></strong>     if (params == <a href=
"../mozilla/dbm/include/ncompat.h.dep.html#NULL">NULL</a>) return SECFailure;
<strong><a name="744">  744</a></strong>
<strong><a name="745">  745</a></strong>     if (params-&gt;<a href=
"../mozilla/security/nss/tests/pkcs11/netscape/suites/security/ssl/ssls.c.dep.html#data">data</a><a href="../mozilla/security/nss/tests/pkcs11/netscape/suites/security/ssl/ssls.h.dep.html#data">[2]</a> == <a href="../mozilla/dbm/include/ncompat.h.dep.html#NULL">NULL</a>) return SECFailure;
<strong><a name="746">  746</a></strong>
<strong><a name="747">  747</a></strong>     <a href=
"../util/secport.h.dep.html#PORT_Assert">PORT_Assert</a><a href=
"../util/utf8.c.dep.html#PORT_Assert">[1]</a>(arena);
<strong><a name="748">  748</a></strong>
<strong><a name=
"749">  749</a></strong>     /* make a copy of the data into the arena so QuickDER output is valid */
<strong><a name="750">  750</a></strong>     <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> = <a href=
"../util/secitem.c.dep.html#SECITEM_CopyItem">SECITEM_CopyItem</a>(arena, &amp;newparams, params);
<strong><a name="751">  751</a></strong>
<strong><a name=
"752">  752</a></strong>     /* Check if params use the standard format.
<strong><a name=
"753">  753</a></strong>      * The value 0xa1 will appear in the first byte of the parameter data
<strong><a name=
"754">  754</a></strong>      * if the PQG parameters are not using the standard format.  This
<strong><a name=
"755">  755</a></strong>      * code should be changed to use a better method to detect non-standard
<strong><a name="756">  756</a></strong>      * parameters.    */
<strong><a name="757">  757</a></strong>
<strong><a name="758">  758</a></strong>     if ((newparams.<a href=
"../mozilla/security/nss/tests/pkcs11/netscape/suites/security/ssl/ssls.c.dep.html#data">data</a><a href="../mozilla/security/nss/tests/pkcs11/netscape/suites/security/ssl/ssls.h.dep.html#data">[2]</a>[0] != 0xa1) &amp;&amp;
<strong><a name="759">  759</a></strong>         (newparams.<a href=
"../mozilla/security/nss/tests/pkcs11/netscape/suites/security/ssl/ssls.c.dep.html#data">data</a><a href="../mozilla/security/nss/tests/pkcs11/netscape/suites/security/ssl/ssls.h.dep.html#data">[2]</a>[0] != 0xa0)) {
<strong><a name="760">  760</a></strong>
<strong><a name="761">  761</a></strong>         if (<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a>/selfse<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a><a href=
"../mozilla/security/nss/cmd/selfse.c.dep.html#SECSuccess">SECSuccess</a> == <a href="../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href="../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a>) {
<strong><a name=
"762">  762</a></strong>              /* PQG params are in the standard format */
<strong><a name="763">  763</a></strong>              <a href=
"../cryptohi/seckey.c.dep.html#prepare_pqg_params_for_asn1">prepare_pqg_params_for_asn1</a>(&amp;pubk-&gt;u.dsa.params);
<strong><a name="764">  764</a></strong>              <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> = <a href=
"../util/quickder.c.dep.html#SEC_QuickDERDecodeItem">SEC_QuickDERDecodeItem</a>(arena, &amp;pubk-&gt;u.dsa.params,
<strong><a name=
"765">  765</a></strong>                                  <a href=
"../mozilla/security/nss/cmd/certutil/keystuff.c.dep.html#SECKEY_PQGParamsTemplate">SECKEY_PQGParamsTemplate</a><a href="../cryptohi/keythi.h.dep.html#SECKEY_PQGParamsTemplate">[1]</a><a href="../cryptohi/seckey.c.dep.html#SECKEY_PQGParamsTemplate">[2]</a>,
<strong><a name=
"766">  766</a></strong>                                  &amp;newparams);
<strong><a name="767">  767</a></strong>         }
<strong><a name="768">  768</a></strong>     } else {
<strong><a name="769">  769</a></strong>
<strong><a name=
"770">  770</a></strong>         dual_params.CommParams.prime.<a href=
"../mozilla/security/nss/cmd/crlutil/crlgen_lex.c.dep.html#len">len</a><a href=
"../mozilla/security/nss/cmd/modutil/lex.Pk11Install_yy.c.dep.html#len">[1]</a><a href="../mozilla/security/nss/cmd/zlib/adler32.c.dep.html#len">[2]</a><a href="../mozilla/security/nss/cmd/zlib/crc32.c.dep.html#len">[3]</a><a href="../mozilla/security/nss/cmd/zlib/gzio.c.dep.html#len">[6]</a><a href="../mozilla/security/nss/cmd/zlib/inflate.c.dep.html#len">[9]</a><a href="../mozilla/security/nss/cmd/zlib/trees.c.dep.html#len">[10]</a><a href="../mozilla/security/nss/cmd/zlib/zutil.c.dep.html#len">[13]</a> = 0;
<strong><a name=
"771">  771</a></strong>         dual_params.CommParams.subPrime.<a href=
"../mozilla/security/nss/cmd/crlutil/crlgen_lex.c.dep.html#len">len</a><a href=
"../mozilla/security/nss/cmd/modutil/lex.Pk11Install_yy.c.dep.html#len">[1]</a><a href="../mozilla/security/nss/cmd/zlib/adler32.c.dep.html#len">[2]</a><a href="../mozilla/security/nss/cmd/zlib/crc32.c.dep.html#len">[3]</a><a href="../mozilla/security/nss/cmd/zlib/gzio.c.dep.html#len">[6]</a><a href="../mozilla/security/nss/cmd/zlib/inflate.c.dep.html#len">[9]</a><a href="../mozilla/security/nss/cmd/zlib/trees.c.dep.html#len">[10]</a><a href="../mozilla/security/nss/cmd/zlib/zutil.c.dep.html#len">[13]</a> = 0;
<strong><a name=
"772">  772</a></strong>         dual_params.CommParams.<a href="../mozilla/nsprpub/lib/libc/src/base64.c.dep.html#base">base</a><a href="../mozilla/nsprpub/lib/tests/base64t.c.dep.html#base">[1]</a><a href="../mozilla/nsprpub/pr/tests/xnotify.c.dep.html#base">[2]</a><a href="../mozilla/security/nss/cmd/crlutil/crlgen_lex.c.dep.html#base">[3]</a><a href="../mozilla/security/nss/cmd/modutil/lex.Pk11Install_yy.c.dep.html#base">[4]</a><a href="../mozilla/security/nss/cmd/signtool/signtool.c.dep.html#base">[5]</a><a href="../mozilla/security/nss/cmd/signtool/signtool.h.dep.html#base">[6]</a>.<a href="../mozilla/security/nss/cmd/crlutil/crlgen_lex.c.dep.html#len">len</a><a href="../mozilla/security/nss/cmd/modutil/lex.Pk11Install_yy.c.dep.html#len">[1]</a><a href="../mozilla/security/nss/cmd/zlib/adler32.c.dep.html#len">[2]</a><a href="../mozilla/security/nss/cmd/zlib/crc32.c.dep.html#len">[3]</a><a href="../mozilla/security/nss/cmd/zlib/gzio.c.dep.html#len">[6]</a><a href="../mozilla/security/nss/cmd/zlib/inflate.c.dep.html#len">[9]</a><a href="../mozilla/security/nss/cmd/zlib/trees.c.dep.html#len">[10]</a><a href="../mozilla/security/nss/cmd/zlib/zutil.c.dep.html#len">[13]</a> = 0;
<strong><a name=
"773">  773</a></strong>         dual_params.DiffParams.DiffDSAParams.prime.<a href="../mozilla/security/nss/cmd/crlutil/crlgen_lex.c.dep.html#len">len</a><a href="../mozilla/security/nss/cmd/modutil/lex.Pk11Install_yy.c.dep.html#len">[1]</a><a href="../mozilla/security/nss/cmd/zlib/adler32.c.dep.html#len">[2]</a><a href="../mozilla/security/nss/cmd/zlib/crc32.c.dep.html#len">[3]</a><a href="../mozilla/security/nss/cmd/zlib/gzio.c.dep.html#len">[6]</a><a href="../mozilla/security/nss/cmd/zlib/inflate.c.dep.html#len">[9]</a><a href="../mozilla/security/nss/cmd/zlib/trees.c.dep.html#len">[10]</a><a href="../mozilla/security/nss/cmd/zlib/zutil.c.dep.html#len">[13]</a> = 0;
<strong><a name=
"774">  774</a></strong>         dual_params.DiffParams.DiffDSAParams.subPrime.<a href="../mozilla/security/nss/cmd/crlutil/crlgen_lex.c.dep.html#len">len</a><a href="../mozilla/security/nss/cmd/modutil/lex.Pk11Install_yy.c.dep.html#len">[1]</a><a href="../mozilla/security/nss/cmd/zlib/adler32.c.dep.html#len">[2]</a><a href="../mozilla/security/nss/cmd/zlib/crc32.c.dep.html#len">[3]</a><a href="../mozilla/security/nss/cmd/zlib/gzio.c.dep.html#len">[6]</a><a href="../mozilla/security/nss/cmd/zlib/inflate.c.dep.html#len">[9]</a><a href="../mozilla/security/nss/cmd/zlib/trees.c.dep.html#len">[10]</a><a href="../mozilla/security/nss/cmd/zlib/zutil.c.dep.html#len">[13]</a> = 0;
<strong><a name=
"775">  775</a></strong>         dual_params.DiffParams.DiffDSAParams.<a href=
"../mozilla/nsprpub/lib/libc/src/base64.c.dep.html#base">base</a><a href=
"../mozilla/nsprpub/lib/tests/base64t.c.dep.html#base">[1]</a><a href=
"../mozilla/nsprpub/pr/tests/xnotify.c.dep.html#base">[2]</a><a href=
"../mozilla/security/nss/cmd/crlutil/crlgen_lex.c.dep.html#base">[3]</a><a href="../mozilla/security/nss/cmd/modutil/lex.Pk11Install_yy.c.dep.html#base">[4]</a><a href="../mozilla/security/nss/cmd/signtool/signtool.c.dep.html#base">[5]</a><a href="../mozilla/security/nss/cmd/signtool/signtool.h.dep.html#base">[6]</a>.<a href="../mozilla/security/nss/cmd/crlutil/crlgen_lex.c.dep.html#len">len</a><a href="../mozilla/security/nss/cmd/modutil/lex.Pk11Install_yy.c.dep.html#len">[1]</a><a href="../mozilla/security/nss/cmd/zlib/adler32.c.dep.html#len">[2]</a><a href="../mozilla/security/nss/cmd/zlib/crc32.c.dep.html#len">[3]</a><a href="../mozilla/security/nss/cmd/zlib/gzio.c.dep.html#len">[6]</a><a href="../mozilla/security/nss/cmd/zlib/inflate.c.dep.html#len">[9]</a><a href="../mozilla/security/nss/cmd/zlib/trees.c.dep.html#len">[10]</a><a href="../mozilla/security/nss/cmd/zlib/zutil.c.dep.html#len">[13]</a> = 0;
<strong><a name="776">  776</a></strong>
<strong><a name="777">  777</a></strong>         if (<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a>/selfse<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a><a href=
"../mozilla/security/nss/cmd/selfse.c.dep.html#SECSuccess">SECSuccess</a> == <a href="../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href="../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a>) {
<strong><a name=
"778">  778</a></strong>             /* else the old fortezza-only wrapped format is used. */
<strong><a name="779">  779</a></strong>             if (newparams.<a href=
"../mozilla/security/nss/tests/pkcs11/netscape/suites/security/ssl/ssls.c.dep.html#data">data</a><a href="../mozilla/security/nss/tests/pkcs11/netscape/suites/security/ssl/ssls.h.dep.html#data">[2]</a>[0] == 0xa1) {
<strong><a name="780">  780</a></strong>                 <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> = <a href=
"../util/quickder.c.dep.html#SEC_QuickDERDecodeItem">SEC_QuickDERDecodeItem</a>(arena, &amp;dual_params,
<strong><a name=
"781">  781</a></strong>                                     <a href=
"../cryptohi/seckey.c.dep.html#SECKEY_FortezzaPreParamTemplate">SECKEY_FortezzaPreParamTemplate</a>, &amp;newparams);
<strong><a name="782">  782</a></strong>             } else {
<strong><a name="783">  783</a></strong>                 <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> = <a href=
"../util/quickder.c.dep.html#SEC_QuickDERDecodeItem">SEC_QuickDERDecodeItem</a>(arena, &amp;dual_params,
<strong><a name=
"784">  784</a></strong>                                            <a href=
"../cryptohi/seckey.c.dep.html#SECKEY_FortezzaAltPreParamTemplate">SECKEY_FortezzaAltPreParamTemplate</a>, &amp;newparams);
<strong><a name="785">  785</a></strong>             }
<strong><a name="786">  786</a></strong>         }
<strong><a name="787">  787</a></strong>
<strong><a name=
"788">  788</a></strong>         if ( (dual_params.CommParams.prime.<a href=
"../mozilla/security/nss/cmd/crlutil/crlgen_lex.c.dep.html#len">len</a><a href=
"../mozilla/security/nss/cmd/modutil/lex.Pk11Install_yy.c.dep.html#len">[1]</a><a href="../mozilla/security/nss/cmd/zlib/adler32.c.dep.html#len">[2]</a><a href="../mozilla/security/nss/cmd/zlib/crc32.c.dep.html#len">[3]</a><a href="../mozilla/security/nss/cmd/zlib/gzio.c.dep.html#len">[6]</a><a href="../mozilla/security/nss/cmd/zlib/inflate.c.dep.html#len">[9]</a><a href="../mozilla/security/nss/cmd/zlib/trees.c.dep.html#len">[10]</a><a href="../mozilla/security/nss/cmd/zlib/zutil.c.dep.html#len">[13]</a> &gt; 0) &amp;&amp;
<strong><a name=
"789">  789</a></strong>              (dual_params.CommParams.subPrime.<a href=
"../mozilla/security/nss/cmd/crlutil/crlgen_lex.c.dep.html#len">len</a><a href=
"../mozilla/security/nss/cmd/modutil/lex.Pk11Install_yy.c.dep.html#len">[1]</a><a href="../mozilla/security/nss/cmd/zlib/adler32.c.dep.html#len">[2]</a><a href="../mozilla/security/nss/cmd/zlib/crc32.c.dep.html#len">[3]</a><a href="../mozilla/security/nss/cmd/zlib/gzio.c.dep.html#len">[6]</a><a href="../mozilla/security/nss/cmd/zlib/inflate.c.dep.html#len">[9]</a><a href="../mozilla/security/nss/cmd/zlib/trees.c.dep.html#len">[10]</a><a href="../mozilla/security/nss/cmd/zlib/zutil.c.dep.html#len">[13]</a> &gt; 0) &amp;&amp;
<strong><a name=
"790">  790</a></strong>              (dual_params.CommParams.<a href=
"../mozilla/nsprpub/lib/libc/src/base64.c.dep.html#base">base</a><a href=
"../mozilla/nsprpub/lib/tests/base64t.c.dep.html#base">[1]</a><a href=
"../mozilla/nsprpub/pr/tests/xnotify.c.dep.html#base">[2]</a><a href=
"../mozilla/security/nss/cmd/crlutil/crlgen_lex.c.dep.html#base">[3]</a><a href="../mozilla/security/nss/cmd/modutil/lex.Pk11Install_yy.c.dep.html#base">[4]</a><a href="../mozilla/security/nss/cmd/signtool/signtool.c.dep.html#base">[5]</a><a href="../mozilla/security/nss/cmd/signtool/signtool.h.dep.html#base">[6]</a>.<a href="../mozilla/security/nss/cmd/crlutil/crlgen_lex.c.dep.html#len">len</a><a href="../mozilla/security/nss/cmd/modutil/lex.Pk11Install_yy.c.dep.html#len">[1]</a><a href="../mozilla/security/nss/cmd/zlib/adler32.c.dep.html#len">[2]</a><a href="../mozilla/security/nss/cmd/zlib/crc32.c.dep.html#len">[3]</a><a href="../mozilla/security/nss/cmd/zlib/gzio.c.dep.html#len">[6]</a><a href="../mozilla/security/nss/cmd/zlib/inflate.c.dep.html#len">[9]</a><a href="../mozilla/security/nss/cmd/zlib/trees.c.dep.html#len">[10]</a><a href="../mozilla/security/nss/cmd/zlib/zutil.c.dep.html#len">[13]</a> &gt; 0) ) {
<strong><a name=
"791">  791</a></strong>             /* copy in common params */
<strong><a name="792">  792</a></strong>
<strong><a name="793">  793</a></strong>             if (<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a>/selfse<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a><a href=
"../mozilla/security/nss/cmd/selfse.c.dep.html#SECSuccess">SECSuccess</a> == <a href="../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href="../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a>) {
<strong><a name="794">  794</a></strong>                 <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> = <a href=
"../util/secitem.c.dep.html#SECITEM_CopyItem">SECITEM_CopyItem</a>(arena, &amp;pubk-&gt;u.dsa.params.prime,
<strong><a name=
"795">  795</a></strong>                                       &amp;dual_params.CommParams.prime);
<strong><a name="796">  796</a></strong>             }
<strong><a name="797">  797</a></strong>             if (<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a>/selfse<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a><a href=
"../mozilla/security/nss/cmd/selfse.c.dep.html#SECSuccess">SECSuccess</a> == <a href="../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href="../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a>) {
<strong><a name="798">  798</a></strong>                 <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> = <a href=
"../util/secitem.c.dep.html#SECITEM_CopyItem">SECITEM_CopyItem</a>(arena, &amp;pubk-&gt;u.dsa.params.subPrime,
<strong><a name=
"799">  799</a></strong>                                       &amp;dual_params.CommParams.subPrime);
<strong><a name="800">  800</a></strong>             }
<strong><a name="801">  801</a></strong>             if (<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a>/selfse<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a><a href=
"../mozilla/security/nss/cmd/selfse.c.dep.html#SECSuccess">SECSuccess</a> == <a href="../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href="../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a>) {
<strong><a name="802">  802</a></strong>                 <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> = <a href=
"../util/secitem.c.dep.html#SECITEM_CopyItem">SECITEM_CopyItem</a>(arena, &amp;pubk-&gt;u.dsa.params.<a href="../mozilla/nsprpub/lib/libc/src/base64.c.dep.html#base">base</a><a href="../mozilla/nsprpub/lib/tests/base64t.c.dep.html#base">[1]</a><a href="../mozilla/nsprpub/pr/tests/xnotify.c.dep.html#base">[2]</a><a href="../mozilla/security/nss/cmd/crlutil/crlgen_lex.c.dep.html#base">[3]</a><a href="../mozilla/security/nss/cmd/modutil/lex.Pk11Install_yy.c.dep.html#base">[4]</a><a href="../mozilla/security/nss/cmd/signtool/signtool.c.dep.html#base">[5]</a><a href="../mozilla/security/nss/cmd/signtool/signtool.h.dep.html#base">[6]</a>,
<strong><a name=
"803">  803</a></strong>                                     &amp;dual_params.CommParams.<a href="../mozilla/nsprpub/lib/libc/src/base64.c.dep.html#base">base</a><a href="../mozilla/nsprpub/lib/tests/base64t.c.dep.html#base">[1]</a><a href="../mozilla/nsprpub/pr/tests/xnotify.c.dep.html#base">[2]</a><a href="../mozilla/security/nss/cmd/crlutil/crlgen_lex.c.dep.html#base">[3]</a><a href="../mozilla/security/nss/cmd/modutil/lex.Pk11Install_yy.c.dep.html#base">[4]</a><a href="../mozilla/security/nss/cmd/signtool/signtool.c.dep.html#base">[5]</a><a href="../mozilla/security/nss/cmd/signtool/signtool.h.dep.html#base">[6]</a>);
<strong><a name="804">  804</a></strong>             }
<strong><a name="805">  805</a></strong>         } else {
<strong><a name="806">  806</a></strong>
<strong><a name=
"807">  807</a></strong>             /* else copy in different params */
<strong><a name="808">  808</a></strong>
<strong><a name=
"809">  809</a></strong>             /* copy DSA PQG parameters */
<strong><a name="810">  810</a></strong>             if (<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a>/selfse<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a><a href=
"../mozilla/security/nss/cmd/selfse.c.dep.html#SECSuccess">SECSuccess</a> == <a href="../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href="../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a>) {
<strong><a name="811">  811</a></strong>                 <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> = <a href=
"../util/secitem.c.dep.html#SECITEM_CopyItem">SECITEM_CopyItem</a>(arena, &amp;pubk-&gt;u.dsa.params.prime,
<strong><a name=
"812">  812</a></strong>                                       &amp;dual_params.DiffParams.DiffDSAParams.prime);
<strong><a name="813">  813</a></strong>             }
<strong><a name="814">  814</a></strong>             if (<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a>/selfse<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a><a href=
"../mozilla/security/nss/cmd/selfse.c.dep.html#SECSuccess">SECSuccess</a> == <a href="../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href="../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a>) {
<strong><a name="815">  815</a></strong>                 <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> = <a href=
"../util/secitem.c.dep.html#SECITEM_CopyItem">SECITEM_CopyItem</a>(arena, &amp;pubk-&gt;u.dsa.params.subPrime,
<strong><a name=
"816">  816</a></strong>                                       &amp;dual_params.DiffParams.DiffDSAParams.subPrime);
<strong><a name="817">  817</a></strong>             }
<strong><a name="818">  818</a></strong>             if (<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a>/selfse<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a><a href=
"../mozilla/security/nss/cmd/selfse.c.dep.html#SECSuccess">SECSuccess</a> == <a href="../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href="../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a>) {
<strong><a name="819">  819</a></strong>                 <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> = <a href=
"../util/secitem.c.dep.html#SECITEM_CopyItem">SECITEM_CopyItem</a>(arena, &amp;pubk-&gt;u.dsa.params.<a href="../mozilla/nsprpub/lib/libc/src/base64.c.dep.html#base">base</a><a href="../mozilla/nsprpub/lib/tests/base64t.c.dep.html#base">[1]</a><a href="../mozilla/nsprpub/pr/tests/xnotify.c.dep.html#base">[2]</a><a href="../mozilla/security/nss/cmd/crlutil/crlgen_lex.c.dep.html#base">[3]</a><a href="../mozilla/security/nss/cmd/modutil/lex.Pk11Install_yy.c.dep.html#base">[4]</a><a href="../mozilla/security/nss/cmd/signtool/signtool.c.dep.html#base">[5]</a><a href="../mozilla/security/nss/cmd/signtool/signtool.h.dep.html#base">[6]</a>,
<strong><a name=
"820">  820</a></strong>                                       &amp;dual_params.DiffParams.DiffDSAParams.<a href="../mozilla/nsprpub/lib/libc/src/base64.c.dep.html#base">base</a><a href="../mozilla/nsprpub/lib/tests/base64t.c.dep.html#base">[1]</a><a href="../mozilla/nsprpub/pr/tests/xnotify.c.dep.html#base">[2]</a><a href="../mozilla/security/nss/cmd/crlutil/crlgen_lex.c.dep.html#base">[3]</a><a href="../mozilla/security/nss/cmd/modutil/lex.Pk11Install_yy.c.dep.html#base">[4]</a><a href="../mozilla/security/nss/cmd/signtool/signtool.c.dep.html#base">[5]</a><a href="../mozilla/security/nss/cmd/signtool/signtool.h.dep.html#base">[6]</a>);
<strong><a name="821">  821</a></strong>             }
<strong><a name="822">  822</a></strong>         }
<strong><a name="823">  823</a></strong>     }
<strong><a name="824">  824</a></strong>     return <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a>;
<strong><a name="825">  825</a></strong> }
<strong><a name="826">  826</a></strong>
<strong><a name="827">  827</a></strong>
<strong><a name=
"828">  828</a></strong> /* Decodes the DER encoded fortezza public key and stores the results in a
<strong><a name=
"829">  829</a></strong>  * structure of type SECKEYPublicKey. */
<strong><a name="830">  830</a></strong>
<strong><a name="831">  831</a></strong> <a href=
"../util/seccomon.h.dep.html#SECStatus">SECStatus</a>
<strong><a name="832">  832</a></strong> <a href=
"#832">SECKEY_FortezzaDecodeCertKey</a>(<a href=
"../mozilla/nsprpub/pr/include/obsolete/protypes.h.dep.html#PRArenaPool">PRArenaPool</a> *arena, <a href="../cryptohi/keythi.h.dep.html#SECKEYPublicKey">SECKEYPublicKey</a> *pubk,
<strong><a name="833">  833</a></strong>                              <a href=
"../util/seccomon.h.dep.html#SECItem">SECItem</a> *rawkey, <a href=
"../util/seccomon.h.dep.html#SECItem">SECItem</a> *params) {
<strong><a name="834">  834</a></strong>
<strong><a name=
"835">  835</a></strong>         unsigned char *rawptr = rawkey-&gt;<a href=
"../mozilla/security/nss/tests/pkcs11/netscape/suites/security/ssl/ssls.c.dep.html#data">data</a><a href="../mozilla/security/nss/tests/pkcs11/netscape/suites/security/ssl/ssls.h.dep.html#data">[2]</a>;
<strong><a name="836">  836</a></strong>         unsigned char *<a href=
"../mozilla/nsprpub/tools/httpget.c.dep.html#end">end</a> = rawkey-&gt;<a href=
"../mozilla/security/nss/tests/pkcs11/netscape/suites/security/ssl/ssls.c.dep.html#data">data</a><a href="../mozilla/security/nss/tests/pkcs11/netscape/suites/security/ssl/ssls.h.dep.html#data">[2]</a> + rawkey-&gt;<a href="../mozilla/security/nss/cmd/crlutil/crlgen_lex.c.dep.html#len">len</a><a href="../mozilla/security/nss/cmd/modutil/lex.Pk11Install_yy.c.dep.html#len">[1]</a><a href="../mozilla/security/nss/cmd/zlib/adler32.c.dep.html#len">[2]</a><a href="../mozilla/security/nss/cmd/zlib/crc32.c.dep.html#len">[3]</a><a href="../mozilla/security/nss/cmd/zlib/gzio.c.dep.html#len">[6]</a><a href="../mozilla/security/nss/cmd/zlib/inflate.c.dep.html#len">[9]</a><a href="../mozilla/security/nss/cmd/zlib/trees.c.dep.html#len">[10]</a><a href="../mozilla/security/nss/cmd/zlib/zutil.c.dep.html#len">[13]</a>;
<strong><a name="837">  837</a></strong>         unsigned char *clearptr;
<strong><a name="838">  838</a></strong>
<strong><a name=
"839">  839</a></strong>         /* first march down and decode the raw key data */
<strong><a name="840">  840</a></strong>
<strong><a name="841">  841</a></strong>         /* version */
<strong><a name=
"842">  842</a></strong>         pubk-&gt;u.fortezza.KEAversion = *rawptr++;
<strong><a name="843">  843</a></strong>         if (*rawptr++ != 0x01) {
<strong><a name="844">  844</a></strong>                 return SECFailure;
<strong><a name="845">  845</a></strong>         }
<strong><a name="846">  846</a></strong>
<strong><a name="847">  847</a></strong>         /* KMID */
<strong><a name="848">  848</a></strong>         <a href=
"../util/secport.h.dep.html#PORT_Memcpy">PORT_Memcpy</a>(pubk-&gt;u.fortezza.KMID,rawptr,
<strong><a name=
"849">  849</a></strong>                                 sizeof(pubk-&gt;u.fortezza.KMID));
<strong><a name=
"850">  850</a></strong>         rawptr += sizeof(pubk-&gt;u.fortezza.KMID);
<strong><a name="851">  851</a></strong>
<strong><a name=
"852">  852</a></strong>         /* clearance (the string up to the first byte with the hi-bit on */
<strong><a name="853">  853</a></strong>         clearptr = rawptr;
<strong><a name="854">  854</a></strong>         while ((rawptr &lt; <a href=
"../mozilla/nsprpub/tools/httpget.c.dep.html#end">end</a>) &amp;&amp; (*rawptr++ &amp; 0x80));
<strong><a name="855">  855</a></strong>
<strong><a name="856">  856</a></strong>         if (rawptr &gt;= <a href=
"../mozilla/nsprpub/tools/httpget.c.dep.html#end">end</a>) { return SECFailure; }
<strong><a name=
"857">  857</a></strong>         pubk-&gt;u.fortezza.clearance.<a href=
"../mozilla/security/nss/cmd/crlutil/crlgen_lex.c.dep.html#len">len</a><a href=
"../mozilla/security/nss/cmd/modutil/lex.Pk11Install_yy.c.dep.html#len">[1]</a><a href="../mozilla/security/nss/cmd/zlib/adler32.c.dep.html#len">[2]</a><a href="../mozilla/security/nss/cmd/zlib/crc32.c.dep.html#len">[3]</a><a href="../mozilla/security/nss/cmd/zlib/gzio.c.dep.html#len">[6]</a><a href="../mozilla/security/nss/cmd/zlib/inflate.c.dep.html#len">[9]</a><a href="../mozilla/security/nss/cmd/zlib/trees.c.dep.html#len">[10]</a><a href="../mozilla/security/nss/cmd/zlib/zutil.c.dep.html#len">[13]</a> = rawptr - clearptr;
<strong><a name=
"858">  858</a></strong>         pubk-&gt;u.fortezza.clearance.<a href=
"../mozilla/security/nss/tests/pkcs11/netscape/suites/security/ssl/ssls.c.dep.html#data">data</a><a href="../mozilla/security/nss/tests/pkcs11/netscape/suites/security/ssl/ssls.h.dep.html#data">[2]</a> =
<strong><a name=
"859">  859</a></strong>                 (unsigned char*)<a href=
"../util/secport.c.dep.html#PORT_ArenaZAlloc">PORT_ArenaZAlloc</a>(arena,pubk-&gt;u.fortezza.clearance.<a href="../mozilla/security/nss/cmd/crlutil/crlgen_lex.c.dep.html#len">len</a><a href="../mozilla/security/nss/cmd/modutil/lex.Pk11Install_yy.c.dep.html#len">[1]</a><a href="../mozilla/security/nss/cmd/zlib/adler32.c.dep.html#len">[2]</a><a href="../mozilla/security/nss/cmd/zlib/crc32.c.dep.html#len">[3]</a><a href="../mozilla/security/nss/cmd/zlib/gzio.c.dep.html#len">[6]</a><a href="../mozilla/security/nss/cmd/zlib/inflate.c.dep.html#len">[9]</a><a href="../mozilla/security/nss/cmd/zlib/trees.c.dep.html#len">[10]</a><a href="../mozilla/security/nss/cmd/zlib/zutil.c.dep.html#len">[13]</a>);
<strong><a name=
"860">  860</a></strong>         if (pubk-&gt;u.fortezza.clearance.<a href=
"../mozilla/security/nss/tests/pkcs11/netscape/suites/security/ssl/ssls.c.dep.html#data">data</a><a href="../mozilla/security/nss/tests/pkcs11/netscape/suites/security/ssl/ssls.h.dep.html#data">[2]</a> == <a href="../mozilla/dbm/include/ncompat.h.dep.html#NULL">NULL</a>) {
<strong><a name="861">  861</a></strong>                 return SECFailure;
<strong><a name="862">  862</a></strong>         }
<strong><a name="863">  863</a></strong>         <a href=
"../util/secport.h.dep.html#PORT_Memcpy">PORT_Memcpy</a>(pubk-&gt;u.fortezza.clearance.<a href="../mozilla/security/nss/tests/pkcs11/netscape/suites/security/ssl/ssls.c.dep.html#data">data</a><a href="../mozilla/security/nss/tests/pkcs11/netscape/suites/security/ssl/ssls.h.dep.html#data">[2]</a>,clearptr,
<strong><a name=
"864">  864</a></strong>                                         pubk-&gt;u.fortezza.clearance.<a href="../mozilla/security/nss/cmd/crlutil/crlgen_lex.c.dep.html#len">len</a><a href="../mozilla/security/nss/cmd/modutil/lex.Pk11Install_yy.c.dep.html#len">[1]</a><a href="../mozilla/security/nss/cmd/zlib/adler32.c.dep.html#len">[2]</a><a href="../mozilla/security/nss/cmd/zlib/crc32.c.dep.html#len">[3]</a><a href="../mozilla/security/nss/cmd/zlib/gzio.c.dep.html#len">[6]</a><a href="../mozilla/security/nss/cmd/zlib/inflate.c.dep.html#len">[9]</a><a href="../mozilla/security/nss/cmd/zlib/trees.c.dep.html#len">[10]</a><a href="../mozilla/security/nss/cmd/zlib/zutil.c.dep.html#len">[13]</a>);
<strong><a name="865">  865</a></strong>
<strong><a name=
"866">  866</a></strong>         /* KEAPrivilege (the string up to the first byte with the hi-bit on */
<strong><a name="867">  867</a></strong>         clearptr = rawptr;
<strong><a name="868">  868</a></strong>         while ((rawptr &lt; <a href=
"../mozilla/nsprpub/tools/httpget.c.dep.html#end">end</a>) &amp;&amp; (*rawptr++ &amp; 0x80));
<strong><a name="869">  869</a></strong>         if (rawptr &gt;= <a href=
"../mozilla/nsprpub/tools/httpget.c.dep.html#end">end</a>) { return SECFailure; }
<strong><a name=
"870">  870</a></strong>         pubk-&gt;u.fortezza.KEApriviledge.<a href=
"../mozilla/security/nss/cmd/crlutil/crlgen_lex.c.dep.html#len">len</a><a href=
"../mozilla/security/nss/cmd/modutil/lex.Pk11Install_yy.c.dep.html#len">[1]</a><a href="../mozilla/security/nss/cmd/zlib/adler32.c.dep.html#len">[2]</a><a href="../mozilla/security/nss/cmd/zlib/crc32.c.dep.html#len">[3]</a><a href="../mozilla/security/nss/cmd/zlib/gzio.c.dep.html#len">[6]</a><a href="../mozilla/security/nss/cmd/zlib/inflate.c.dep.html#len">[9]</a><a href="../mozilla/security/nss/cmd/zlib/trees.c.dep.html#len">[10]</a><a href="../mozilla/security/nss/cmd/zlib/zutil.c.dep.html#len">[13]</a> = rawptr - clearptr;
<strong><a name=
"871">  871</a></strong>         pubk-&gt;u.fortezza.KEApriviledge.<a href=
"../mozilla/security/nss/tests/pkcs11/netscape/suites/security/ssl/ssls.c.dep.html#data">data</a><a href="../mozilla/security/nss/tests/pkcs11/netscape/suites/security/ssl/ssls.h.dep.html#data">[2]</a> =
<strong><a name=
"872">  872</a></strong>                 (unsigned char*)<a href=
"../util/secport.c.dep.html#PORT_ArenaZAlloc">PORT_ArenaZAlloc</a>(arena,pubk-&gt;u.fortezza.KEApriviledge.<a href="../mozilla/security/nss/cmd/crlutil/crlgen_lex.c.dep.html#len">len</a><a href="../mozilla/security/nss/cmd/modutil/lex.Pk11Install_yy.c.dep.html#len">[1]</a><a href="../mozilla/security/nss/cmd/zlib/adler32.c.dep.html#len">[2]</a><a href="../mozilla/security/nss/cmd/zlib/crc32.c.dep.html#len">[3]</a><a href="../mozilla/security/nss/cmd/zlib/gzio.c.dep.html#len">[6]</a><a href="../mozilla/security/nss/cmd/zlib/inflate.c.dep.html#len">[9]</a><a href="../mozilla/security/nss/cmd/zlib/trees.c.dep.html#len">[10]</a><a href="../mozilla/security/nss/cmd/zlib/zutil.c.dep.html#len">[13]</a>);
<strong><a name=
"873">  873</a></strong>         if (pubk-&gt;u.fortezza.KEApriviledge.<a href=
"../mozilla/security/nss/tests/pkcs11/netscape/suites/security/ssl/ssls.c.dep.html#data">data</a><a href="../mozilla/security/nss/tests/pkcs11/netscape/suites/security/ssl/ssls.h.dep.html#data">[2]</a> == <a href="../mozilla/dbm/include/ncompat.h.dep.html#NULL">NULL</a>) {
<strong><a name="874">  874</a></strong>                 return SECFailure;
<strong><a name="875">  875</a></strong>         }
<strong><a name="876">  876</a></strong>         <a href=
"../util/secport.h.dep.html#PORT_Memcpy">PORT_Memcpy</a>(pubk-&gt;u.fortezza.KEApriviledge.<a href="../mozilla/security/nss/tests/pkcs11/netscape/suites/security/ssl/ssls.c.dep.html#data">data</a><a href="../mozilla/security/nss/tests/pkcs11/netscape/suites/security/ssl/ssls.h.dep.html#data">[2]</a>,clearptr,
<strong><a name=
"877">  877</a></strong>                                 pubk-&gt;u.fortezza.KEApriviledge.<a href="../mozilla/security/nss/cmd/crlutil/crlgen_lex.c.dep.html#len">len</a><a href="../mozilla/security/nss/cmd/modutil/lex.Pk11Install_yy.c.dep.html#len">[1]</a><a href="../mozilla/security/nss/cmd/zlib/adler32.c.dep.html#len">[2]</a><a href="../mozilla/security/nss/cmd/zlib/crc32.c.dep.html#len">[3]</a><a href="../mozilla/security/nss/cmd/zlib/gzio.c.dep.html#len">[6]</a><a href="../mozilla/security/nss/cmd/zlib/inflate.c.dep.html#len">[9]</a><a href="../mozilla/security/nss/cmd/zlib/trees.c.dep.html#len">[10]</a><a href="../mozilla/security/nss/cmd/zlib/zutil.c.dep.html#len">[13]</a>);
<strong><a name="878">  878</a></strong>
<strong><a name="879">  879</a></strong>
<strong><a name=
"880">  880</a></strong>         /* now copy the key. The next to bytes are the key length, and the
<strong><a name="881">  881</a></strong>          * key follows */
<strong><a name=
"882">  882</a></strong>         pubk-&gt;u.fortezza.KEAKey.<a href=
"../mozilla/security/nss/cmd/crlutil/crlgen_lex.c.dep.html#len">len</a><a href=
"../mozilla/security/nss/cmd/modutil/lex.Pk11Install_yy.c.dep.html#len">[1]</a><a href="../mozilla/security/nss/cmd/zlib/adler32.c.dep.html#len">[2]</a><a href="../mozilla/security/nss/cmd/zlib/crc32.c.dep.html#len">[3]</a><a href="../mozilla/security/nss/cmd/zlib/gzio.c.dep.html#len">[6]</a><a href="../mozilla/security/nss/cmd/zlib/inflate.c.dep.html#len">[9]</a><a href="../mozilla/security/nss/cmd/zlib/trees.c.dep.html#len">[10]</a><a href="../mozilla/security/nss/cmd/zlib/zutil.c.dep.html#len">[13]</a> = (*rawptr &lt;&lt; 8) | rawptr[1];
<strong><a name="883">  883</a></strong>
<strong><a name="884">  884</a></strong>         rawptr += 2;
<strong><a name=
"885">  885</a></strong>         if (rawptr+pubk-&gt;u.fortezza.KEAKey.<a href=
"../mozilla/security/nss/cmd/crlutil/crlgen_lex.c.dep.html#len">len</a><a href=
"../mozilla/security/nss/cmd/modutil/lex.Pk11Install_yy.c.dep.html#len">[1]</a><a href="../mozilla/security/nss/cmd/zlib/adler32.c.dep.html#len">[2]</a><a href="../mozilla/security/nss/cmd/zlib/crc32.c.dep.html#len">[3]</a><a href="../mozilla/security/nss/cmd/zlib/gzio.c.dep.html#len">[6]</a><a href="../mozilla/security/nss/cmd/zlib/inflate.c.dep.html#len">[9]</a><a href="../mozilla/security/nss/cmd/zlib/trees.c.dep.html#len">[10]</a><a href="../mozilla/security/nss/cmd/zlib/zutil.c.dep.html#len">[13]</a> &gt; <a href="../mozilla/nsprpub/tools/httpget.c.dep.html#end">end</a>) { return SECFailure; }
<strong><a name=
"886">  886</a></strong>         pubk-&gt;u.fortezza.KEAKey.<a href=
"../mozilla/security/nss/tests/pkcs11/netscape/suites/security/ssl/ssls.c.dep.html#data">data</a><a href="../mozilla/security/nss/tests/pkcs11/netscape/suites/security/ssl/ssls.h.dep.html#data">[2]</a> =
<strong><a name=
"887">  887</a></strong>                         (unsigned char*)<a href=
"../util/secport.c.dep.html#PORT_ArenaZAlloc">PORT_ArenaZAlloc</a>(arena,pubk-&gt;u.fortezza.KEAKey.<a href="../mozilla/security/nss/cmd/crlutil/crlgen_lex.c.dep.html#len">len</a><a href="../mozilla/security/nss/cmd/modutil/lex.Pk11Install_yy.c.dep.html#len">[1]</a><a href="../mozilla/security/nss/cmd/zlib/adler32.c.dep.html#len">[2]</a><a href="../mozilla/security/nss/cmd/zlib/crc32.c.dep.html#len">[3]</a><a href="../mozilla/security/nss/cmd/zlib/gzio.c.dep.html#len">[6]</a><a href="../mozilla/security/nss/cmd/zlib/inflate.c.dep.html#len">[9]</a><a href="../mozilla/security/nss/cmd/zlib/trees.c.dep.html#len">[10]</a><a href="../mozilla/security/nss/cmd/zlib/zutil.c.dep.html#len">[13]</a>);
<strong><a name=
"888">  888</a></strong>         if (pubk-&gt;u.fortezza.KEAKey.<a href=
"../mozilla/security/nss/tests/pkcs11/netscape/suites/security/ssl/ssls.c.dep.html#data">data</a><a href="../mozilla/security/nss/tests/pkcs11/netscape/suites/security/ssl/ssls.h.dep.html#data">[2]</a> == <a href="../mozilla/dbm/include/ncompat.h.dep.html#NULL">NULL</a>) {
<strong><a name="889">  889</a></strong>                 return SECFailure;
<strong><a name="890">  890</a></strong>         }
<strong><a name="891">  891</a></strong>         <a href=
"../util/secport.h.dep.html#PORT_Memcpy">PORT_Memcpy</a>(pubk-&gt;u.fortezza.KEAKey.<a href="../mozilla/security/nss/tests/pkcs11/netscape/suites/security/ssl/ssls.c.dep.html#data">data</a><a href="../mozilla/security/nss/tests/pkcs11/netscape/suites/security/ssl/ssls.h.dep.html#data">[2]</a>,rawptr,
<strong><a name=
"892">  892</a></strong>                                         pubk-&gt;u.fortezza.KEAKey.<a href="../mozilla/security/nss/cmd/crlutil/crlgen_lex.c.dep.html#len">len</a><a href="../mozilla/security/nss/cmd/modutil/lex.Pk11Install_yy.c.dep.html#len">[1]</a><a href="../mozilla/security/nss/cmd/zlib/adler32.c.dep.html#len">[2]</a><a href="../mozilla/security/nss/cmd/zlib/crc32.c.dep.html#len">[3]</a><a href="../mozilla/security/nss/cmd/zlib/gzio.c.dep.html#len">[6]</a><a href="../mozilla/security/nss/cmd/zlib/inflate.c.dep.html#len">[9]</a><a href="../mozilla/security/nss/cmd/zlib/trees.c.dep.html#len">[10]</a><a href="../mozilla/security/nss/cmd/zlib/zutil.c.dep.html#len">[13]</a>);
<strong><a name=
"893">  893</a></strong>         rawptr += pubk-&gt;u.fortezza.KEAKey.<a href=
"../mozilla/security/nss/cmd/crlutil/crlgen_lex.c.dep.html#len">len</a><a href=
"../mozilla/security/nss/cmd/modutil/lex.Pk11Install_yy.c.dep.html#len">[1]</a><a href="../mozilla/security/nss/cmd/zlib/adler32.c.dep.html#len">[2]</a><a href="../mozilla/security/nss/cmd/zlib/crc32.c.dep.html#len">[3]</a><a href="../mozilla/security/nss/cmd/zlib/gzio.c.dep.html#len">[6]</a><a href="../mozilla/security/nss/cmd/zlib/inflate.c.dep.html#len">[9]</a><a href="../mozilla/security/nss/cmd/zlib/trees.c.dep.html#len">[10]</a><a href="../mozilla/security/nss/cmd/zlib/zutil.c.dep.html#len">[13]</a>;
<strong><a name="894">  894</a></strong>
<strong><a name="895">  895</a></strong>         /* shared key */
<strong><a name="896">  896</a></strong>         if (rawptr &gt;= <a href=
"../mozilla/nsprpub/tools/httpget.c.dep.html#end">end</a>) {
<strong><a name=
"897">  897</a></strong>             pubk-&gt;u.fortezza.DSSKey.<a href=
"../mozilla/security/nss/cmd/crlutil/crlgen_lex.c.dep.html#len">len</a><a href=
"../mozilla/security/nss/cmd/modutil/lex.Pk11Install_yy.c.dep.html#len">[1]</a><a href="../mozilla/security/nss/cmd/zlib/adler32.c.dep.html#len">[2]</a><a href="../mozilla/security/nss/cmd/zlib/crc32.c.dep.html#len">[3]</a><a href="../mozilla/security/nss/cmd/zlib/gzio.c.dep.html#len">[6]</a><a href="../mozilla/security/nss/cmd/zlib/inflate.c.dep.html#len">[9]</a><a href="../mozilla/security/nss/cmd/zlib/trees.c.dep.html#len">[10]</a><a href="../mozilla/security/nss/cmd/zlib/zutil.c.dep.html#len">[13]</a> = pubk-&gt;u.fortezza.KEAKey.<a href="../mozilla/security/nss/cmd/crlutil/crlgen_lex.c.dep.html#len">len</a><a href="../mozilla/security/nss/cmd/modutil/lex.Pk11Install_yy.c.dep.html#len">[1]</a><a href="../mozilla/security/nss/cmd/zlib/adler32.c.dep.html#len">[2]</a><a href="../mozilla/security/nss/cmd/zlib/crc32.c.dep.html#len">[3]</a><a href="../mozilla/security/nss/cmd/zlib/gzio.c.dep.html#len">[6]</a><a href="../mozilla/security/nss/cmd/zlib/inflate.c.dep.html#len">[9]</a><a href="../mozilla/security/nss/cmd/zlib/trees.c.dep.html#len">[10]</a><a href="../mozilla/security/nss/cmd/zlib/zutil.c.dep.html#len">[13]</a>;
<strong><a name=
"898">  898</a></strong>             /* this depends on the fact that we are going to get freed with an
<strong><a name=
"899">  899</a></strong>              * ArenaFree call. We cannot free DSSKey and KEAKey separately */
<strong><a name=
"900">  900</a></strong>             pubk-&gt;u.fortezza.DSSKey.<a href=
"../mozilla/security/nss/tests/pkcs11/netscape/suites/security/ssl/ssls.c.dep.html#data">data</a><a href="../mozilla/security/nss/tests/pkcs11/netscape/suites/security/ssl/ssls.h.dep.html#data">[2]</a>=
<strong><a name=
"901">  901</a></strong>                                         pubk-&gt;u.fortezza.KEAKey.<a href="../mozilla/security/nss/tests/pkcs11/netscape/suites/security/ssl/ssls.c.dep.html#data">data</a><a href="../mozilla/security/nss/tests/pkcs11/netscape/suites/security/ssl/ssls.h.dep.html#data">[2]</a>;
<strong><a name=
"902">  902</a></strong>             pubk-&gt;u.fortezza.DSSpriviledge.<a href=
"../mozilla/security/nss/cmd/crlutil/crlgen_lex.c.dep.html#len">len</a><a href=
"../mozilla/security/nss/cmd/modutil/lex.Pk11Install_yy.c.dep.html#len">[1]</a><a href="../mozilla/security/nss/cmd/zlib/adler32.c.dep.html#len">[2]</a><a href="../mozilla/security/nss/cmd/zlib/crc32.c.dep.html#len">[3]</a><a href="../mozilla/security/nss/cmd/zlib/gzio.c.dep.html#len">[6]</a><a href="../mozilla/security/nss/cmd/zlib/inflate.c.dep.html#len">[9]</a><a href="../mozilla/security/nss/cmd/zlib/trees.c.dep.html#len">[10]</a><a href="../mozilla/security/nss/cmd/zlib/zutil.c.dep.html#len">[13]</a> =
<strong><a name=
"903">  903</a></strong>                                 pubk-&gt;u.fortezza.KEApriviledge.<a href="../mozilla/security/nss/cmd/crlutil/crlgen_lex.c.dep.html#len">len</a><a href="../mozilla/security/nss/cmd/modutil/lex.Pk11Install_yy.c.dep.html#len">[1]</a><a href="../mozilla/security/nss/cmd/zlib/adler32.c.dep.html#len">[2]</a><a href="../mozilla/security/nss/cmd/zlib/crc32.c.dep.html#len">[3]</a><a href="../mozilla/security/nss/cmd/zlib/gzio.c.dep.html#len">[6]</a><a href="../mozilla/security/nss/cmd/zlib/inflate.c.dep.html#len">[9]</a><a href="../mozilla/security/nss/cmd/zlib/trees.c.dep.html#len">[10]</a><a href="../mozilla/security/nss/cmd/zlib/zutil.c.dep.html#len">[13]</a>;
<strong><a name=
"904">  904</a></strong>             pubk-&gt;u.fortezza.DSSpriviledge.<a href=
"../mozilla/security/nss/tests/pkcs11/netscape/suites/security/ssl/ssls.c.dep.html#data">data</a><a href="../mozilla/security/nss/tests/pkcs11/netscape/suites/security/ssl/ssls.h.dep.html#data">[2]</a> =
<strong><a name=
"905">  905</a></strong>                         pubk-&gt;u.fortezza.DSSpriviledge.<a href="../mozilla/security/nss/tests/pkcs11/netscape/suites/security/ssl/ssls.c.dep.html#data">data</a><a href="../mozilla/security/nss/tests/pkcs11/netscape/suites/security/ssl/ssls.h.dep.html#data">[2]</a>;
<strong><a name="906">  906</a></strong>             goto done;
<strong><a name="907">  907</a></strong>         }
<strong><a name="908">  908</a></strong>
<strong><a name="909">  909</a></strong>
<strong><a name="910">  910</a></strong>         /* DSS Version is next */
<strong><a name=
"911">  911</a></strong>         pubk-&gt;u.fortezza.DSSversion = *rawptr++;
<strong><a name="912">  912</a></strong>
<strong><a name="913">  913</a></strong>         if (*rawptr++ != 2) {
<strong><a name="914">  914</a></strong>                 return SECFailure;
<strong><a name="915">  915</a></strong>         }
<strong><a name="916">  916</a></strong>
<strong><a name=
"917">  917</a></strong>         /* DSSPrivilege (the string up to the first byte with the hi-bit on */
<strong><a name="918">  918</a></strong>         clearptr = rawptr;
<strong><a name="919">  919</a></strong>         while ((rawptr &lt; <a href=
"../mozilla/nsprpub/tools/httpget.c.dep.html#end">end</a>) &amp;&amp; (*rawptr++ &amp; 0x80));
<strong><a name="920">  920</a></strong>         if (rawptr &gt;= <a href=
"../mozilla/nsprpub/tools/httpget.c.dep.html#end">end</a>) { return SECFailure; }
<strong><a name=
"921">  921</a></strong>         pubk-&gt;u.fortezza.DSSpriviledge.<a href=
"../mozilla/security/nss/cmd/crlutil/crlgen_lex.c.dep.html#len">len</a><a href=
"../mozilla/security/nss/cmd/modutil/lex.Pk11Install_yy.c.dep.html#len">[1]</a><a href="../mozilla/security/nss/cmd/zlib/adler32.c.dep.html#len">[2]</a><a href="../mozilla/security/nss/cmd/zlib/crc32.c.dep.html#len">[3]</a><a href="../mozilla/security/nss/cmd/zlib/gzio.c.dep.html#len">[6]</a><a href="../mozilla/security/nss/cmd/zlib/inflate.c.dep.html#len">[9]</a><a href="../mozilla/security/nss/cmd/zlib/trees.c.dep.html#len">[10]</a><a href="../mozilla/security/nss/cmd/zlib/zutil.c.dep.html#len">[13]</a> = rawptr - clearptr;
<strong><a name=
"922">  922</a></strong>         pubk-&gt;u.fortezza.DSSpriviledge.<a href=
"../mozilla/security/nss/tests/pkcs11/netscape/suites/security/ssl/ssls.c.dep.html#data">data</a><a href="../mozilla/security/nss/tests/pkcs11/netscape/suites/security/ssl/ssls.h.dep.html#data">[2]</a> =
<strong><a name=
"923">  923</a></strong>                 (unsigned char*)<a href=
"../util/secport.c.dep.html#PORT_ArenaZAlloc">PORT_ArenaZAlloc</a>(arena,pubk-&gt;u.fortezza.DSSpriviledge.<a href="../mozilla/security/nss/cmd/crlutil/crlgen_lex.c.dep.html#len">len</a><a href="../mozilla/security/nss/cmd/modutil/lex.Pk11Install_yy.c.dep.html#len">[1]</a><a href="../mozilla/security/nss/cmd/zlib/adler32.c.dep.html#len">[2]</a><a href="../mozilla/security/nss/cmd/zlib/crc32.c.dep.html#len">[3]</a><a href="../mozilla/security/nss/cmd/zlib/gzio.c.dep.html#len">[6]</a><a href="../mozilla/security/nss/cmd/zlib/inflate.c.dep.html#len">[9]</a><a href="../mozilla/security/nss/cmd/zlib/trees.c.dep.html#len">[10]</a><a href="../mozilla/security/nss/cmd/zlib/zutil.c.dep.html#len">[13]</a>);
<strong><a name=
"924">  924</a></strong>         if (pubk-&gt;u.fortezza.DSSpriviledge.<a href=
"../mozilla/security/nss/tests/pkcs11/netscape/suites/security/ssl/ssls.c.dep.html#data">data</a><a href="../mozilla/security/nss/tests/pkcs11/netscape/suites/security/ssl/ssls.h.dep.html#data">[2]</a> == <a href="../mozilla/dbm/include/ncompat.h.dep.html#NULL">NULL</a>) {
<strong><a name="925">  925</a></strong>                 return SECFailure;
<strong><a name="926">  926</a></strong>         }
<strong><a name="927">  927</a></strong>         <a href=
"../util/secport.h.dep.html#PORT_Memcpy">PORT_Memcpy</a>(pubk-&gt;u.fortezza.DSSpriviledge.<a href="../mozilla/security/nss/tests/pkcs11/netscape/suites/security/ssl/ssls.c.dep.html#data">data</a><a href="../mozilla/security/nss/tests/pkcs11/netscape/suites/security/ssl/ssls.h.dep.html#data">[2]</a>,clearptr,
<strong><a name=
"928">  928</a></strong>                                 pubk-&gt;u.fortezza.DSSpriviledge.<a href="../mozilla/security/nss/cmd/crlutil/crlgen_lex.c.dep.html#len">len</a><a href="../mozilla/security/nss/cmd/modutil/lex.Pk11Install_yy.c.dep.html#len">[1]</a><a href="../mozilla/security/nss/cmd/zlib/adler32.c.dep.html#len">[2]</a><a href="../mozilla/security/nss/cmd/zlib/crc32.c.dep.html#len">[3]</a><a href="../mozilla/security/nss/cmd/zlib/gzio.c.dep.html#len">[6]</a><a href="../mozilla/security/nss/cmd/zlib/inflate.c.dep.html#len">[9]</a><a href="../mozilla/security/nss/cmd/zlib/trees.c.dep.html#len">[10]</a><a href="../mozilla/security/nss/cmd/zlib/zutil.c.dep.html#len">[13]</a>);
<strong><a name="929">  929</a></strong>
<strong><a name=
"930">  930</a></strong>         /* finally copy the DSS key. The next to bytes are the key length,
<strong><a name="931">  931</a></strong>          *  and the key follows */
<strong><a name=
"932">  932</a></strong>         pubk-&gt;u.fortezza.DSSKey.<a href=
"../mozilla/security/nss/cmd/crlutil/crlgen_lex.c.dep.html#len">len</a><a href=
"../mozilla/security/nss/cmd/modutil/lex.Pk11Install_yy.c.dep.html#len">[1]</a><a href="../mozilla/security/nss/cmd/zlib/adler32.c.dep.html#len">[2]</a><a href="../mozilla/security/nss/cmd/zlib/crc32.c.dep.html#len">[3]</a><a href="../mozilla/security/nss/cmd/zlib/gzio.c.dep.html#len">[6]</a><a href="../mozilla/security/nss/cmd/zlib/inflate.c.dep.html#len">[9]</a><a href="../mozilla/security/nss/cmd/zlib/trees.c.dep.html#len">[10]</a><a href="../mozilla/security/nss/cmd/zlib/zutil.c.dep.html#len">[13]</a> = (*rawptr &lt;&lt; 8) | rawptr[1];
<strong><a name="933">  933</a></strong>
<strong><a name="934">  934</a></strong>         rawptr += 2;
<strong><a name=
"935">  935</a></strong>         if (rawptr+pubk-&gt;u.fortezza.DSSKey.<a href=
"../mozilla/security/nss/cmd/crlutil/crlgen_lex.c.dep.html#len">len</a><a href=
"../mozilla/security/nss/cmd/modutil/lex.Pk11Install_yy.c.dep.html#len">[1]</a><a href="../mozilla/security/nss/cmd/zlib/adler32.c.dep.html#len">[2]</a><a href="../mozilla/security/nss/cmd/zlib/crc32.c.dep.html#len">[3]</a><a href="../mozilla/security/nss/cmd/zlib/gzio.c.dep.html#len">[6]</a><a href="../mozilla/security/nss/cmd/zlib/inflate.c.dep.html#len">[9]</a><a href="../mozilla/security/nss/cmd/zlib/trees.c.dep.html#len">[10]</a><a href="../mozilla/security/nss/cmd/zlib/zutil.c.dep.html#len">[13]</a> &gt; <a href="../mozilla/nsprpub/tools/httpget.c.dep.html#end">end</a>){ return SECFailure; }
<strong><a name=
"936">  936</a></strong>         pubk-&gt;u.fortezza.DSSKey.<a href=
"../mozilla/security/nss/tests/pkcs11/netscape/suites/security/ssl/ssls.c.dep.html#data">data</a><a href="../mozilla/security/nss/tests/pkcs11/netscape/suites/security/ssl/ssls.h.dep.html#data">[2]</a> =
<strong><a name=
"937">  937</a></strong>                         (unsigned char*)<a href=
"../util/secport.c.dep.html#PORT_ArenaZAlloc">PORT_ArenaZAlloc</a>(arena,pubk-&gt;u.fortezza.DSSKey.<a href="../mozilla/security/nss/cmd/crlutil/crlgen_lex.c.dep.html#len">len</a><a href="../mozilla/security/nss/cmd/modutil/lex.Pk11Install_yy.c.dep.html#len">[1]</a><a href="../mozilla/security/nss/cmd/zlib/adler32.c.dep.html#len">[2]</a><a href="../mozilla/security/nss/cmd/zlib/crc32.c.dep.html#len">[3]</a><a href="../mozilla/security/nss/cmd/zlib/gzio.c.dep.html#len">[6]</a><a href="../mozilla/security/nss/cmd/zlib/inflate.c.dep.html#len">[9]</a><a href="../mozilla/security/nss/cmd/zlib/trees.c.dep.html#len">[10]</a><a href="../mozilla/security/nss/cmd/zlib/zutil.c.dep.html#len">[13]</a>);
<strong><a name=
"938">  938</a></strong>         if (pubk-&gt;u.fortezza.DSSKey.<a href=
"../mozilla/security/nss/tests/pkcs11/netscape/suites/security/ssl/ssls.c.dep.html#data">data</a><a href="../mozilla/security/nss/tests/pkcs11/netscape/suites/security/ssl/ssls.h.dep.html#data">[2]</a> == <a href="../mozilla/dbm/include/ncompat.h.dep.html#NULL">NULL</a>) {
<strong><a name="939">  939</a></strong>                 return SECFailure;
<strong><a name="940">  940</a></strong>         }
<strong><a name="941">  941</a></strong>         <a href=
"../util/secport.h.dep.html#PORT_Memcpy">PORT_Memcpy</a>(pubk-&gt;u.fortezza.DSSKey.<a href="../mozilla/security/nss/tests/pkcs11/netscape/suites/security/ssl/ssls.c.dep.html#data">data</a><a href="../mozilla/security/nss/tests/pkcs11/netscape/suites/security/ssl/ssls.h.dep.html#data">[2]</a>,rawptr,
<strong><a name=
"942">  942</a></strong>                                         pubk-&gt;u.fortezza.DSSKey.<a href="../mozilla/security/nss/cmd/crlutil/crlgen_lex.c.dep.html#len">len</a><a href="../mozilla/security/nss/cmd/modutil/lex.Pk11Install_yy.c.dep.html#len">[1]</a><a href="../mozilla/security/nss/cmd/zlib/adler32.c.dep.html#len">[2]</a><a href="../mozilla/security/nss/cmd/zlib/crc32.c.dep.html#len">[3]</a><a href="../mozilla/security/nss/cmd/zlib/gzio.c.dep.html#len">[6]</a><a href="../mozilla/security/nss/cmd/zlib/inflate.c.dep.html#len">[9]</a><a href="../mozilla/security/nss/cmd/zlib/trees.c.dep.html#len">[10]</a><a href="../mozilla/security/nss/cmd/zlib/zutil.c.dep.html#len">[13]</a>);
<strong><a name="943">  943</a></strong>
<strong><a name=
"944">  944</a></strong>         /* ok, now we decode the parameters */
<strong><a name="945">  945</a></strong> done:
<strong><a name="946">  946</a></strong>
<strong><a name="947">  947</a></strong>         return <a href=
"../cryptohi/seckey.c.dep.html#SECKEY_FortezzaDecodePQGtoOld">SECKEY_FortezzaDecodePQGtoOld</a>(arena, pubk, params);
<strong><a name="948">  948</a></strong> }
<strong><a name="949">  949</a></strong>
<strong><a name="950">  950</a></strong>
<strong><a name=
"951">  951</a></strong> /* Function used to determine what kind of cert we are dealing with. */
<strong><a name="952">  952</a></strong> <a href=
"../cryptohi/keythi.h.dep.html#KeyType">KeyType</a>
<strong><a name="953">  953</a></strong> <a href=
"#953">CERT_GetCertKeyType</a> (<a href=
"../certdb/certt.h.dep.html#CERTSubjectPublicKeyInfo">CERTSubjectPublicKeyInfo</a> *spki) {
<strong><a name="954">  954</a></strong>     int <a href=
"../mozilla/nsprpub/pr/tests/system.c.dep.html#tag">tag</a>;
<strong><a name="955">  955</a></strong>     <a href=
"../cryptohi/keythi.h.dep.html#KeyType">KeyType</a> keyType;
<strong><a name="956">  956</a></strong>
<strong><a name="957">  957</a></strong>     <a href=
"../mozilla/nsprpub/pr/tests/system.c.dep.html#tag">tag</a> = <a href=
"../util/secalgid.c.dep.html#SECOID_GetAlgorithmTag">SECOID_GetAlgorithmTag</a>(&amp;spki-&gt;algorithm);
<strong><a name="958">  958</a></strong>     switch (<a href=
"../mozilla/nsprpub/pr/tests/system.c.dep.html#tag">tag</a>) {
<strong><a name=
"959">  959</a></strong>       case SEC_OID_X500_RSA_ENCRYPTION:
<strong><a name=
"960">  960</a></strong>       case SEC_OID_PKCS1_RSA_ENCRYPTION:
<strong><a name="961">  961</a></strong>         keyType = rsaKey;
<strong><a name="962">  962</a></strong>         break;
<strong><a name=
"963">  963</a></strong>       case SEC_OID_ANSIX9_DSA_SIGNATURE:
<strong><a name="964">  964</a></strong>         keyType = dsaKey;
<strong><a name="965">  965</a></strong>         break;
<strong><a name="966">  966</a></strong>       case SEC_OID_MISSI_KEA_DSS_OLD:
<strong><a name="967">  967</a></strong>       case SEC_OID_MISSI_KEA_DSS:
<strong><a name="968">  968</a></strong>       case SEC_OID_MISSI_DSS_OLD:
<strong><a name="969">  969</a></strong>       case SEC_OID_MISSI_DSS:
<strong><a name="970">  970</a></strong>         keyType = fortezzaKey;
<strong><a name="971">  971</a></strong>         break;
<strong><a name="972">  972</a></strong>       case <a href=
"../pk11wrap/pk11cert.c.dep.html#SEC_OID_MISSI_KEA">SEC_OID_MISSI_KEA</a>:
<strong><a name="973">  973</a></strong>       case SEC_OID_MISSI_ALT_KEA:
<strong><a name="974">  974</a></strong>         keyType = keaKey;
<strong><a name="975">  975</a></strong>         break;
<strong><a name=
"976">  976</a></strong>       case SEC_OID_X942_DIFFIE_HELMAN_KEY:
<strong><a name="977">  977</a></strong>         keyType = dhKey;
<strong><a name="978">  978</a></strong>         break;
<strong><a name=
"979">  979</a></strong>       case SEC_OID_ANSIX962_EC_PUBLIC_KEY:
<strong><a name="980">  980</a></strong>         keyType = ecKey;
<strong><a name="981">  981</a></strong>         break;
<strong><a name="982">  982</a></strong>       default:
<strong><a name="983">  983</a></strong>         keyType = nullKey;
<strong><a name="984">  984</a></strong>     }
<strong><a name="985">  985</a></strong>     return keyType;
<strong><a name="986">  986</a></strong> }
<strong><a name="987">  987</a></strong>
<strong><a name="988">  988</a></strong> static <a href=
"../cryptohi/keythi.h.dep.html#SECKEYPublicKey">SECKEYPublicKey</a> *
<strong><a name="989">  989</a></strong> <a href=
"#989">seckey_ExtractPublicKey</a>(<a href=
"../certdb/certt.h.dep.html#CERTSubjectPublicKeyInfo">CERTSubjectPublicKeyInfo</a> *spki)
<strong><a name="990">  990</a></strong> {
<strong><a name="991">  991</a></strong>     <a href=
"../cryptohi/keythi.h.dep.html#SECKEYPublicKey">SECKEYPublicKey</a> *pubk;
<strong><a name="992">  992</a></strong>     <a href=
"../util/seccomon.h.dep.html#SECItem">SECItem</a> os, newOs, newParms;
<strong><a name="993">  993</a></strong>     <a href=
"../util/seccomon.h.dep.html#SECStatus">SECStatus</a> <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a>;
<strong><a name="994">  994</a></strong>     <a href=
"../mozilla/nsprpub/pr/include/obsolete/protypes.h.dep.html#PRArenaPool">PRArenaPool</a> *arena;
<strong><a name="995">  995</a></strong>     <a href=
"../util/secoidt.h.dep.html#SECOidTag">SECOidTag</a> <a href=
"../mozilla/nsprpub/pr/tests/system.c.dep.html#tag">tag</a>;
<strong><a name="996">  996</a></strong>
<strong><a name="997">  997</a></strong>     arena = <a href=
"../util/secport.c.dep.html#PORT_NewArena">PORT_NewArena</a> (<a href=
"../util/secdert.h.dep.html#DER_DEFAULT_CHUNKSIZE">DER_DEFAULT_CHUNKSIZE</a>);
<strong><a name="998">  998</a></strong>     if (arena == <a href=
"../mozilla/dbm/include/ncompat.h.dep.html#NULL">NULL</a>)
<strong><a name="999">  999</a></strong>         return <a href=
"../mozilla/dbm/include/ncompat.h.dep.html#NULL">NULL</a>;
<strong><a name="1000"> 1000</a></strong>
<strong><a name="1001"> 1001</a></strong>     pubk = (<a href=
"../cryptohi/keythi.h.dep.html#SECKEYPublicKey">SECKEYPublicKey</a> *) <a href=
"../util/secport.c.dep.html#PORT_ArenaZAlloc">PORT_ArenaZAlloc</a>(arena, sizeof(<a href="../cryptohi/keythi.h.dep.html#SECKEYPublicKey">SECKEYPublicKey</a>));
<strong><a name="1002"> 1002</a></strong>     if (pubk == <a href=
"../mozilla/dbm/include/ncompat.h.dep.html#NULL">NULL</a>) {
<strong><a name="1003"> 1003</a></strong>         <a href=
"../util/secport.c.dep.html#PORT_FreeArena">PORT_FreeArena</a> (arena, <a href=
"../mozilla/nsprpub/pr/include/prtypes.h.dep.html#PR_FALSE">PR_FALSE</a>);
<strong><a name="1004"> 1004</a></strong>         return <a href=
"../mozilla/dbm/include/ncompat.h.dep.html#NULL">NULL</a>;
<strong><a name="1005"> 1005</a></strong>     }
<strong><a name="1006"> 1006</a></strong>
<strong><a name="1007"> 1007</a></strong>     pubk-&gt;arena = arena;
<strong><a name="1008"> 1008</a></strong>     pubk-&gt;pkcs11Slot = 0;
<strong><a name="1009"> 1009</a></strong>     pubk-&gt;pkcs11ID = <a href=
"../softoken/pkcs11t.h.dep.html#CK_INVALID_HANDLE">CK_INVALID_HANDLE</a>;
<strong><a name="1010"> 1010</a></strong>
<strong><a name="1011"> 1011</a></strong>
<strong><a name=
"1012"> 1012</a></strong>     /* Convert bit string length from bits to bytes */
<strong><a name="1013"> 1013</a></strong>     os = spki-&gt;subjectPublicKey;
<strong><a name="1014"> 1014</a></strong>     <a href=
"../util/secdert.h.dep.html#DER_ConvertBitString">DER_ConvertBitString</a> (&amp;os);
<strong><a name="1015"> 1015</a></strong>
<strong><a name="1016"> 1016</a></strong>     <a href=
"../mozilla/nsprpub/pr/tests/system.c.dep.html#tag">tag</a> = <a href=
"../util/secalgid.c.dep.html#SECOID_GetAlgorithmTag">SECOID_GetAlgorithmTag</a>(&amp;spki-&gt;algorithm);
<strong><a name="1017"> 1017</a></strong>
<strong><a name=
"1018"> 1018</a></strong>     /* copy the DER into the arena, since Quick DER returns data that points
<strong><a name=
"1019"> 1019</a></strong>        into the DER input, which may get freed by the caller */
<strong><a name="1020"> 1020</a></strong>     <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> = <a href=
"../util/secitem.c.dep.html#SECITEM_CopyItem">SECITEM_CopyItem</a>(arena, &amp;newOs, &amp;os);
<strong><a name="1021"> 1021</a></strong>     if ( <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> == <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a>/selfse<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a><a href=
"../mozilla/security/nss/cmd/selfse.c.dep.html#SECSuccess">SECSuccess</a> )
<strong><a name="1022"> 1022</a></strong>     switch ( <a href=
"../mozilla/nsprpub/pr/tests/system.c.dep.html#tag">tag</a> ) {
<strong><a name=
"1023"> 1023</a></strong>       case SEC_OID_X500_RSA_ENCRYPTION:
<strong><a name=
"1024"> 1024</a></strong>       case SEC_OID_PKCS1_RSA_ENCRYPTION:
<strong><a name="1025"> 1025</a></strong>         pubk-&gt;keyType = rsaKey;
<strong><a name="1026"> 1026</a></strong>         <a href=
"../cryptohi/seckey.c.dep.html#prepare_rsa_pub_key_for_asn1">prepare_rsa_pub_key_for_asn1</a>(pubk);
<strong><a name="1027"> 1027</a></strong>         <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> = <a href=
"../util/quickder.c.dep.html#SEC_QuickDERDecodeItem">SEC_QuickDERDecodeItem</a>(arena, pubk, <a href="../cryptohi/keythi.h.dep.html#SECKEY_RSAPublicKeyTemplate">SECKEY_RSAPublicKeyTemplate</a><a href="../cryptohi/seckey.c.dep.html#SECKEY_RSAPublicKeyTemplate">[1]</a>, &amp;newOs);
<strong><a name="1028"> 1028</a></strong>         if (<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> == <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a>/selfse<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a><a href=
"../mozilla/security/nss/cmd/selfse.c.dep.html#SECSuccess">SECSuccess</a>)
<strong><a name="1029"> 1029</a></strong>             return pubk;
<strong><a name="1030"> 1030</a></strong>         break;
<strong><a name=
"1031"> 1031</a></strong>       case SEC_OID_ANSIX9_DSA_SIGNATURE:
<strong><a name=
"1032"> 1032</a></strong>       case SEC_OID_SDN702_DSA_SIGNATURE:
<strong><a name="1033"> 1033</a></strong>         pubk-&gt;keyType = dsaKey;
<strong><a name="1034"> 1034</a></strong>         <a href=
"../cryptohi/seckey.c.dep.html#prepare_dsa_pub_key_for_asn1">prepare_dsa_pub_key_for_asn1</a>(pubk);
<strong><a name="1035"> 1035</a></strong>         <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> = <a href=
"../util/quickder.c.dep.html#SEC_QuickDERDecodeItem">SEC_QuickDERDecodeItem</a>(arena, pubk, <a href="../cryptohi/keythi.h.dep.html#SECKEY_DSAPublicKeyTemplate">SECKEY_DSAPublicKeyTemplate</a><a href="../cryptohi/seckey.c.dep.html#SECKEY_DSAPublicKeyTemplate">[1]</a>, &amp;newOs);
<strong><a name="1036"> 1036</a></strong>         if (<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> != <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a>/selfse<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a><a href=
"../mozilla/security/nss/cmd/selfse.c.dep.html#SECSuccess">SECSuccess</a>) break;
<strong><a name="1037"> 1037</a></strong>
<strong><a name="1038"> 1038</a></strong>         <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> = <a href=
"../cryptohi/seckey.c.dep.html#SECKEY_DSADecodePQG">SECKEY_DSADecodePQG</a>(arena, pubk,
<strong><a name=
"1039"> 1039</a></strong>                                  &amp;spki-&gt;algorithm.<a href="../softoken/pk11pars.h.dep.html#parameters">parameters</a>);
<strong><a name="1040"> 1040</a></strong>
<strong><a name="1041"> 1041</a></strong>         if (<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> == <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a>/selfse<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a><a href=
"../mozilla/security/nss/cmd/selfse.c.dep.html#SECSuccess">SECSuccess</a>) return pubk;
<strong><a name="1042"> 1042</a></strong>         break;
<strong><a name=
"1043"> 1043</a></strong>       case SEC_OID_X942_DIFFIE_HELMAN_KEY:
<strong><a name="1044"> 1044</a></strong>         pubk-&gt;keyType = dhKey;
<strong><a name="1045"> 1045</a></strong>         <a href=
"../cryptohi/seckey.c.dep.html#prepare_dh_pub_key_for_asn1">prepare_dh_pub_key_for_asn1</a>(pubk);
<strong><a name="1046"> 1046</a></strong>         <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> = <a href=
"../util/quickder.c.dep.html#SEC_QuickDERDecodeItem">SEC_QuickDERDecodeItem</a>(arena, pubk, <a href="../cryptohi/keythi.h.dep.html#SECKEY_DHPublicKeyTemplate">SECKEY_DHPublicKeyTemplate</a><a href="../cryptohi/seckey.c.dep.html#SECKEY_DHPublicKeyTemplate">[1]</a>, &amp;newOs);
<strong><a name="1047"> 1047</a></strong>         if (<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> != <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a>/selfse<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a><a href=
"../mozilla/security/nss/cmd/selfse.c.dep.html#SECSuccess">SECSuccess</a>) break;
<strong><a name="1048"> 1048</a></strong>
<strong><a name=
"1049"> 1049</a></strong>         /* copy the DER into the arena, since Quick DER returns data that points
<strong><a name=
"1050"> 1050</a></strong>            into the DER input, which may get freed by the caller */
<strong><a name="1051"> 1051</a></strong>         <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> = <a href=
"../util/secitem.c.dep.html#SECITEM_CopyItem">SECITEM_CopyItem</a>(arena, &amp;newParms, &amp;spki-&gt;algorithm.<a href="../softoken/pk11pars.h.dep.html#parameters">parameters</a>);
<strong><a name="1052"> 1052</a></strong>         if ( <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> != <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a>/selfse<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a><a href=
"../mozilla/security/nss/cmd/selfse.c.dep.html#SECSuccess">SECSuccess</a> )
<strong><a name="1053"> 1053</a></strong>             break;
<strong><a name="1054"> 1054</a></strong>
<strong><a name="1055"> 1055</a></strong>         <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> = <a href=
"../util/quickder.c.dep.html#SEC_QuickDERDecodeItem">SEC_QuickDERDecodeItem</a>(arena, pubk, <a href="../cryptohi/keythi.h.dep.html#SECKEY_DHParamKeyTemplate">SECKEY_DHParamKeyTemplate</a><a href="../cryptohi/seckey.c.dep.html#SECKEY_DHParamKeyTemplate">[1]</a>,
<strong><a name=
"1056"> 1056</a></strong>                                  &amp;newParms);
<strong><a name="1057"> 1057</a></strong>
<strong><a name="1058"> 1058</a></strong>         if (<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> == <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a>/selfse<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a><a href=
"../mozilla/security/nss/cmd/selfse.c.dep.html#SECSuccess">SECSuccess</a>) return pubk;
<strong><a name="1059"> 1059</a></strong>         break;
<strong><a name="1060"> 1060</a></strong>       case SEC_OID_MISSI_KEA_DSS_OLD:
<strong><a name="1061"> 1061</a></strong>       case SEC_OID_MISSI_KEA_DSS:
<strong><a name="1062"> 1062</a></strong>       case SEC_OID_MISSI_DSS_OLD:
<strong><a name="1063"> 1063</a></strong>       case SEC_OID_MISSI_DSS:
<strong><a name=
"1064"> 1064</a></strong>         pubk-&gt;keyType = fortezzaKey;
<strong><a name="1065"> 1065</a></strong>         <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> = <a href=
"../cryptohi/seckey.c.dep.html#SECKEY_FortezzaDecodeCertKey">SECKEY_FortezzaDecodeCertKey</a>(arena, pubk, &amp;newOs,
<strong><a name=
"1066"> 1066</a></strong>                                           &amp;spki-&gt;algorithm.<a href="../softoken/pk11pars.h.dep.html#parameters">parameters</a>);
<strong><a name="1067"> 1067</a></strong>         if (<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> == <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a>/selfse<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a><a href=
"../mozilla/security/nss/cmd/selfse.c.dep.html#SECSuccess">SECSuccess</a>)
<strong><a name="1068"> 1068</a></strong>             return pubk;
<strong><a name="1069"> 1069</a></strong>         break;
<strong><a name="1070"> 1070</a></strong>
<strong><a name="1071"> 1071</a></strong>       case <a href=
"../pk11wrap/pk11cert.c.dep.html#SEC_OID_MISSI_KEA">SEC_OID_MISSI_KEA</a>:
<strong><a name="1072"> 1072</a></strong>         pubk-&gt;keyType = keaKey;
<strong><a name="1073"> 1073</a></strong>
<strong><a name="1074"> 1074</a></strong>         <a href=
"../cryptohi/seckey.c.dep.html#prepare_kea_pub_key_for_asn1">prepare_kea_pub_key_for_asn1</a>(pubk);
<strong><a name="1075"> 1075</a></strong>         <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> = <a href=
"../util/quickder.c.dep.html#SEC_QuickDERDecodeItem">SEC_QuickDERDecodeItem</a>(arena, pubk,
<strong><a name=
"1076"> 1076</a></strong>                                 <a href=
"../cryptohi/seckey.c.dep.html#SECKEY_KEAPublicKeyTemplate">SECKEY_KEAPublicKeyTemplate</a>, &amp;newOs);
<strong><a name="1077"> 1077</a></strong>         if (<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> != <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a>/selfse<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a><a href=
"../mozilla/security/nss/cmd/selfse.c.dep.html#SECSuccess">SECSuccess</a>) break;
<strong><a name="1078"> 1078</a></strong>
<strong><a name=
"1079"> 1079</a></strong>         /* copy the DER into the arena, since Quick DER returns data that points
<strong><a name=
"1080"> 1080</a></strong>            into the DER input, which may get freed by the caller */
<strong><a name="1081"> 1081</a></strong>         <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> = <a href=
"../util/secitem.c.dep.html#SECITEM_CopyItem">SECITEM_CopyItem</a>(arena, &amp;newParms, &amp;spki-&gt;algorithm.<a href="../softoken/pk11pars.h.dep.html#parameters">parameters</a>);
<strong><a name="1082"> 1082</a></strong>         if ( <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> != <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a>/selfse<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a><a href=
"../mozilla/security/nss/cmd/selfse.c.dep.html#SECSuccess">SECSuccess</a> )
<strong><a name="1083"> 1083</a></strong>             break;
<strong><a name="1084"> 1084</a></strong>
<strong><a name="1085"> 1085</a></strong>         <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> = <a href=
"../util/quickder.c.dep.html#SEC_QuickDERDecodeItem">SEC_QuickDERDecodeItem</a>(arena, pubk, <a href="../cryptohi/seckey.c.dep.html#SECKEY_KEAParamsTemplate">SECKEY_KEAParamsTemplate</a>,
<strong><a name=
"1086"> 1086</a></strong>                         &amp;newParms);
<strong><a name="1087"> 1087</a></strong>
<strong><a name="1088"> 1088</a></strong>         if (<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> == <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a>/selfse<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a><a href=
"../mozilla/security/nss/cmd/selfse.c.dep.html#SECSuccess">SECSuccess</a>)
<strong><a name="1089"> 1089</a></strong>             return pubk;
<strong><a name="1090"> 1090</a></strong>
<strong><a name="1091"> 1091</a></strong>         break;
<strong><a name="1092"> 1092</a></strong>
<strong><a name="1093"> 1093</a></strong>       case SEC_OID_MISSI_ALT_KEA:
<strong><a name="1094"> 1094</a></strong>         pubk-&gt;keyType = keaKey;
<strong><a name="1095"> 1095</a></strong>
<strong><a name="1096"> 1096</a></strong>         <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> = <a href=
"../util/secitem.c.dep.html#SECITEM_CopyItem">SECITEM_CopyItem</a>(arena,&amp;pubk-&gt;u.kea.publicValue,&amp;newOs);
<strong><a name="1097"> 1097</a></strong>         if (<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> != <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a>/selfse<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a><a href=
"../mozilla/security/nss/cmd/selfse.c.dep.html#SECSuccess">SECSuccess</a>) break;
<strong><a name="1098"> 1098</a></strong>
<strong><a name=
"1099"> 1099</a></strong>         /* copy the DER into the arena, since Quick DER returns data that points
<strong><a name=
"1100"> 1100</a></strong>            into the DER input, which may get freed by the caller */
<strong><a name="1101"> 1101</a></strong>         <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> = <a href=
"../util/secitem.c.dep.html#SECITEM_CopyItem">SECITEM_CopyItem</a>(arena, &amp;newParms, &amp;spki-&gt;algorithm.<a href="../softoken/pk11pars.h.dep.html#parameters">parameters</a>);
<strong><a name="1102"> 1102</a></strong>         if ( <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> != <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a>/selfse<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a><a href=
"../mozilla/security/nss/cmd/selfse.c.dep.html#SECSuccess">SECSuccess</a> )
<strong><a name="1103"> 1103</a></strong>             break;
<strong><a name="1104"> 1104</a></strong>
<strong><a name="1105"> 1105</a></strong>         <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> = <a href=
"../util/quickder.c.dep.html#SEC_QuickDERDecodeItem">SEC_QuickDERDecodeItem</a>(arena, pubk, <a href="../cryptohi/seckey.c.dep.html#SECKEY_KEAParamsTemplate">SECKEY_KEAParamsTemplate</a>,
<strong><a name=
"1106"> 1106</a></strong>                         &amp;newParms);
<strong><a name="1107"> 1107</a></strong>
<strong><a name="1108"> 1108</a></strong>         if (<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> == <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a>/selfse<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a><a href=
"../mozilla/security/nss/cmd/selfse.c.dep.html#SECSuccess">SECSuccess</a>)
<strong><a name="1109"> 1109</a></strong>             return pubk;
<strong><a name="1110"> 1110</a></strong>
<strong><a name="1111"> 1111</a></strong>         break;
<strong><a name="1112"> 1112</a></strong>
<strong><a name=
"1113"> 1113</a></strong>       case SEC_OID_ANSIX962_EC_PUBLIC_KEY:
<strong><a name="1114"> 1114</a></strong>         pubk-&gt;keyType = ecKey;
<strong><a name="1115"> 1115</a></strong>         pubk-&gt;u.ec.<a href=
"../mozilla/security/nss/cmd/crlutil/crlgen_lex.c.dep.html#size">size</a><a href="../mozilla/security/nss/cmd/modutil/lex.Pk11Install_yy.c.dep.html#size">[4]</a><a href="../mozilla/security/nss/cmd/zlib/deflate.c.dep.html#size">[8]</a><a href="../mozilla/security/nss/cmd/zlib/zutil.c.dep.html#size">[9]</a> = 0;
<strong><a name="1116"> 1116</a></strong>
<strong><a name=
"1117"> 1117</a></strong>         /* Since PKCS#11 directly takes the DER encoding of EC params
<strong><a name=
"1118"> 1118</a></strong>          * and public value, we don't need any decoding here.
<strong><a name="1119"> 1119</a></strong>          */
<strong><a name="1120"> 1120</a></strong>         <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> = <a href=
"../util/secitem.c.dep.html#SECITEM_CopyItem">SECITEM_CopyItem</a>(arena, &amp;pubk-&gt;u.ec.DEREncodedParams,
<strong><a name=
"1121"> 1121</a></strong>             &amp;spki-&gt;algorithm.<a href=
"../softoken/pk11pars.h.dep.html#parameters">parameters</a>);
<strong><a name="1122"> 1122</a></strong>         if ( <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> != <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a>/selfse<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a><a href=
"../mozilla/security/nss/cmd/selfse.c.dep.html#SECSuccess">SECSuccess</a> )
<strong><a name="1123"> 1123</a></strong>             break;
<strong><a name="1124"> 1124</a></strong>         <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> = <a href=
"../util/secitem.c.dep.html#SECITEM_CopyItem">SECITEM_CopyItem</a>(arena, &amp;pubk-&gt;u.ec.publicValue, &amp;newOs);
<strong><a name="1125"> 1125</a></strong>         if (<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> == <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a>/selfse<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a><a href=
"../mozilla/security/nss/cmd/selfse.c.dep.html#SECSuccess">SECSuccess</a>) return pubk;
<strong><a name="1126"> 1126</a></strong>         break;
<strong><a name="1127"> 1127</a></strong>
<strong><a name="1128"> 1128</a></strong>       default:
<strong><a name="1129"> 1129</a></strong>         <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> = SECFailure;
<strong><a name="1130"> 1130</a></strong>         break;
<strong><a name="1131"> 1131</a></strong>     }
<strong><a name="1132"> 1132</a></strong>
<strong><a name="1133"> 1133</a></strong>     <a href=
"../cryptohi/seckey.c.dep.html#SECKEY_DestroyPublicKey">SECKEY_DestroyPublicKey</a> (pubk);
<strong><a name="1134"> 1134</a></strong>     return <a href=
"../mozilla/dbm/include/ncompat.h.dep.html#NULL">NULL</a>;
<strong><a name="1135"> 1135</a></strong> }
<strong><a name="1136"> 1136</a></strong>
<strong><a name="1137"> 1137</a></strong>
<strong><a name="1138"> 1138</a></strong> /* required for JSS */
<strong><a name="1139"> 1139</a></strong> <a href=
"../cryptohi/keythi.h.dep.html#SECKEYPublicKey">SECKEYPublicKey</a> *
<strong><a name="1140"> 1140</a></strong> <a href=
"#1140">SECKEY_ExtractPublicKey</a>(<a href=
"../certdb/certt.h.dep.html#CERTSubjectPublicKeyInfo">CERTSubjectPublicKeyInfo</a> *spki)
<strong><a name="1141"> 1141</a></strong> {
<strong><a name="1142"> 1142</a></strong>     return <a href=
"../cryptohi/seckey.c.dep.html#seckey_ExtractPublicKey">seckey_ExtractPublicKey</a>(spki);
<strong><a name="1143"> 1143</a></strong> }
<strong><a name="1144"> 1144</a></strong>
<strong><a name="1145"> 1145</a></strong> <a href=
"../cryptohi/keythi.h.dep.html#SECKEYPublicKey">SECKEYPublicKey</a> *
<strong><a name="1146"> 1146</a></strong> <a href=
"#1146">CERT_ExtractPublicKey</a>(<a href=
"../mozilla/security/nss/cmd/SSLsample/server.c.dep.html#cert">cert</a>db/<a href="../mozilla/security/nss/cmd/SSLsample/server.c.dep.html#cert">cert</a><a href="../t.h.dep.html#CERTCertificate">CERTCertificate</a> *<a href="../mozilla/security/nss/cmd/SSLsample/server.c.dep.html#cert">cert</a>)
<strong><a name="1147"> 1147</a></strong> {
<strong><a name="1148"> 1148</a></strong>     <a href=
"../util/seccomon.h.dep.html#SECStatus">SECStatus</a> <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a>;
<strong><a name="1149"> 1149</a></strong>
<strong><a name="1150"> 1150</a></strong>     if (!<a href=
"../mozilla/security/nss/cmd/SSLsample/server.c.dep.html#cert">cert</a>) {
<strong><a name="1151"> 1151</a></strong>         <a href=
"../util/secport.c.dep.html#PORT_SetError">PORT_SetError</a>(SEC_ERROR_INVALID_ARGS);
<strong><a name="1152"> 1152</a></strong>         return <a href=
"../mozilla/dbm/include/ncompat.h.dep.html#NULL">NULL</a>;
<strong><a name="1153"> 1153</a></strong>     }
<strong><a name="1154"> 1154</a></strong>     <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> = <a href=
"../cryptohi/seckey.c.dep.html#SECKEY_UpdateCertPQG">SECKEY_UpdateCertPQG</a>(<a href="../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href="../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a><a href="../mozilla/security/nss/cmd/SSLsample/seer.c.dep.html#cert">cert</a>);
<strong><a name="1155"> 1155</a></strong>     if (<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> != <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a>/selfse<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a><a href=
"../mozilla/security/nss/cmd/selfse.c.dep.html#SECSuccess">SECSuccess</a>) return <a href="../mozilla/dbm/include/ncompat.h.dep.html#NULL">NULL</a>;
<strong><a name="1156"> 1156</a></strong>
<strong><a name="1157"> 1157</a></strong>     return <a href=
"../cryptohi/seckey.c.dep.html#seckey_ExtractPublicKey">seckey_ExtractPublicKey</a>(&amp;<a href="../mozilla/security/nss/cmd/SSLsample/server.c.dep.html#cert">cert</a>-&gt;subjectPublicKeyInfo);
<strong><a name="1158"> 1158</a></strong> }
<strong><a name="1159"> 1159</a></strong>
<strong><a name="1160"> 1160</a></strong> /*
<strong><a name=
"1161"> 1161</a></strong>  * Get the public key for the fortezza KMID. NOTE this requires the
<strong><a name=
"1162"> 1162</a></strong>  * PQG paramters to be set. We probably should have a fortezza call that
<strong><a name=
"1163"> 1163</a></strong>  * just extracts the kmid for us directly so this function can work
<strong><a name=
"1164"> 1164</a></strong>  * without having the whole cert chain
<strong><a name="1165"> 1165</a></strong>  */
<strong><a name="1166"> 1166</a></strong> <a href=
"../cryptohi/keythi.h.dep.html#SECKEYPublicKey">SECKEYPublicKey</a> *
<strong><a name="1167"> 1167</a></strong> <a href=
"#1167">CERT_KMIDPublicKey</a>(<a href=
"../mozilla/security/nss/cmd/SSLsample/server.c.dep.html#cert">cert</a>db/<a href="../mozilla/security/nss/cmd/SSLsample/server.c.dep.html#cert">cert</a><a href="../t.h.dep.html#CERTCertificate">CERTCertificate</a> *<a href="../mozilla/security/nss/cmd/SSLsample/server.c.dep.html#cert">cert</a>)
<strong><a name="1168"> 1168</a></strong> {
<strong><a name="1169"> 1169</a></strong>     return <a href=
"../cryptohi/seckey.c.dep.html#seckey_ExtractPublicKey">seckey_ExtractPublicKey</a>(&amp;<a href="../mozilla/security/nss/cmd/SSLsample/server.c.dep.html#cert">cert</a>-&gt;subjectPublicKeyInfo);
<strong><a name="1170"> 1170</a></strong> }
<strong><a name="1171"> 1171</a></strong>
<strong><a name="1172"> 1172</a></strong> int
<strong><a name="1173"> 1173</a></strong> <a href=
"#1173">SECKEY_ECParamsToKeySize</a>(const <a href=
"../util/seccomon.h.dep.html#SECItem">SECItem</a> *encodedParams)
<strong><a name="1174"> 1174</a></strong> {
<strong><a name="1175"> 1175</a></strong>     <a href=
"../util/secoidt.h.dep.html#SECOidTag">SECOidTag</a> <a href=
"../mozilla/nsprpub/pr/tests/system.c.dep.html#tag">tag</a>;
<strong><a name="1176"> 1176</a></strong>     <a href=
"../util/seccomon.h.dep.html#SECItem">SECItem</a> oid = { siBuffer, <a href=
"../mozilla/dbm/include/ncompat.h.dep.html#NULL">NULL</a>, 0};
<strong><a name="1177"> 1177</a></strong>
<strong><a name=
"1178"> 1178</a></strong>     /* The encodedParams data contains 0x06 (SEC_ASN1_OBJECT_ID),
<strong><a name=
"1179"> 1179</a></strong>      * followed by the length of the curve oid and the curve oid.
<strong><a name="1180"> 1180</a></strong>      */
<strong><a name="1181"> 1181</a></strong>     oid.<a href=
"../mozilla/security/nss/cmd/crlutil/crlgen_lex.c.dep.html#len">len</a><a href=
"../mozilla/security/nss/cmd/modutil/lex.Pk11Install_yy.c.dep.html#len">[1]</a><a href="../mozilla/security/nss/cmd/zlib/adler32.c.dep.html#len">[2]</a><a href="../mozilla/security/nss/cmd/zlib/crc32.c.dep.html#len">[3]</a><a href="../mozilla/security/nss/cmd/zlib/gzio.c.dep.html#len">[6]</a><a href="../mozilla/security/nss/cmd/zlib/inflate.c.dep.html#len">[9]</a><a href="../mozilla/security/nss/cmd/zlib/trees.c.dep.html#len">[10]</a><a href="../mozilla/security/nss/cmd/zlib/zutil.c.dep.html#len">[13]</a> = encodedParams-&gt;<a href="../mozilla/security/nss/tests/pkcs11/netscape/suites/security/ssl/ssls.c.dep.html#data">data</a><a href="../mozilla/security/nss/tests/pkcs11/netscape/suites/security/ssl/ssls.h.dep.html#data">[2]</a>[1];
<strong><a name="1182"> 1182</a></strong>     oid.<a href=
"../mozilla/security/nss/tests/pkcs11/netscape/suites/security/ssl/ssls.c.dep.html#data">data</a><a href="../mozilla/security/nss/tests/pkcs11/netscape/suites/security/ssl/ssls.h.dep.html#data">[2]</a> = encodedParams-&gt;<a href="../mozilla/security/nss/tests/pkcs11/netscape/suites/security/ssl/ssls.c.dep.html#data">data</a><a href="../mozilla/security/nss/tests/pkcs11/netscape/suites/security/ssl/ssls.h.dep.html#data">[2]</a> + 2;
<strong><a name="1183"> 1183</a></strong>     if ((<a href=
"../mozilla/nsprpub/pr/tests/system.c.dep.html#tag">tag</a> = <a href=
"../util/secoid.c.dep.html#SECOID_FindOIDTag">SECOID_FindOIDTag</a>(&amp;oid)) == SEC_OID_UNKNOWN)
<strong><a name="1184"> 1184</a></strong>         return 0;
<strong><a name="1185"> 1185</a></strong>
<strong><a name="1186"> 1186</a></strong>     switch (<a href=
"../mozilla/nsprpub/pr/tests/system.c.dep.html#tag">tag</a>) {
<strong><a name="1187"> 1187</a></strong>     case SEC_OID_SECG_EC_SECP112R1:
<strong><a name="1188"> 1188</a></strong>     case SEC_OID_SECG_EC_SECP112R2:
<strong><a name="1189"> 1189</a></strong>         return 112;
<strong><a name="1190"> 1190</a></strong>
<strong><a name="1191"> 1191</a></strong>     case SEC_OID_SECG_EC_SECT113R1:
<strong><a name="1192"> 1192</a></strong>     case SEC_OID_SECG_EC_SECT113R2:
<strong><a name="1193"> 1193</a></strong>         return 113;
<strong><a name="1194"> 1194</a></strong>
<strong><a name="1195"> 1195</a></strong>     case SEC_OID_SECG_EC_SECP128R1:
<strong><a name="1196"> 1196</a></strong>     case SEC_OID_SECG_EC_SECP128R2:
<strong><a name="1197"> 1197</a></strong>         return 128;
<strong><a name="1198"> 1198</a></strong>
<strong><a name="1199"> 1199</a></strong>     case SEC_OID_SECG_EC_SECT131R1:
<strong><a name="1200"> 1200</a></strong>     case SEC_OID_SECG_EC_SECT131R2:
<strong><a name="1201"> 1201</a></strong>         return 131;
<strong><a name="1202"> 1202</a></strong>
<strong><a name="1203"> 1203</a></strong>     case SEC_OID_SECG_EC_SECP160K1:
<strong><a name="1204"> 1204</a></strong>     case SEC_OID_SECG_EC_SECP160R1:
<strong><a name="1205"> 1205</a></strong>     case SEC_OID_SECG_EC_SECP160R2:
<strong><a name="1206"> 1206</a></strong>         return 160;
<strong><a name="1207"> 1207</a></strong>
<strong><a name="1208"> 1208</a></strong>     case SEC_OID_SECG_EC_SECT163K1:
<strong><a name="1209"> 1209</a></strong>     case SEC_OID_SECG_EC_SECT163R1:
<strong><a name="1210"> 1210</a></strong>     case SEC_OID_SECG_EC_SECT163R2:
<strong><a name=
"1211"> 1211</a></strong>     case SEC_OID_ANSIX962_EC_C2PNB163V1:
<strong><a name=
"1212"> 1212</a></strong>     case SEC_OID_ANSIX962_EC_C2PNB163V2:
<strong><a name=
"1213"> 1213</a></strong>     case SEC_OID_ANSIX962_EC_C2PNB163V3:
<strong><a name="1214"> 1214</a></strong>         return 163;
<strong><a name="1215"> 1215</a></strong>
<strong><a name=
"1216"> 1216</a></strong>     case SEC_OID_ANSIX962_EC_C2PNB176V1:
<strong><a name="1217"> 1217</a></strong>         return 176;
<strong><a name="1218"> 1218</a></strong>
<strong><a name=
"1219"> 1219</a></strong>     case SEC_OID_ANSIX962_EC_C2TNB191V1:
<strong><a name=
"1220"> 1220</a></strong>     case SEC_OID_ANSIX962_EC_C2TNB191V2:
<strong><a name=
"1221"> 1221</a></strong>     case SEC_OID_ANSIX962_EC_C2TNB191V3:
<strong><a name=
"1222"> 1222</a></strong>     case SEC_OID_ANSIX962_EC_C2ONB191V4:
<strong><a name=
"1223"> 1223</a></strong>     case SEC_OID_ANSIX962_EC_C2ONB191V5:
<strong><a name="1224"> 1224</a></strong>         return 191;
<strong><a name="1225"> 1225</a></strong>
<strong><a name="1226"> 1226</a></strong>     case SEC_OID_SECG_EC_SECP192K1:
<strong><a name=
"1227"> 1227</a></strong>     case SEC_OID_ANSIX962_EC_PRIME192V1:
<strong><a name=
"1228"> 1228</a></strong>     case SEC_OID_ANSIX962_EC_PRIME192V2:
<strong><a name=
"1229"> 1229</a></strong>     case SEC_OID_ANSIX962_EC_PRIME192V3:
<strong><a name="1230"> 1230</a></strong>         return 192;
<strong><a name="1231"> 1231</a></strong>
<strong><a name="1232"> 1232</a></strong>     case SEC_OID_SECG_EC_SECT193R1:
<strong><a name="1233"> 1233</a></strong>     case SEC_OID_SECG_EC_SECT193R2:
<strong><a name="1234"> 1234</a></strong>         return 193;
<strong><a name="1235"> 1235</a></strong>
<strong><a name=
"1236"> 1236</a></strong>     case SEC_OID_ANSIX962_EC_C2PNB208W1:
<strong><a name="1237"> 1237</a></strong>         return 208;
<strong><a name="1238"> 1238</a></strong>
<strong><a name="1239"> 1239</a></strong>     case SEC_OID_SECG_EC_SECP224K1:
<strong><a name="1240"> 1240</a></strong>     case SEC_OID_SECG_EC_SECP224R1:
<strong><a name="1241"> 1241</a></strong>         return 224;
<strong><a name="1242"> 1242</a></strong>
<strong><a name="1243"> 1243</a></strong>     case SEC_OID_SECG_EC_SECT233K1:
<strong><a name="1244"> 1244</a></strong>     case SEC_OID_SECG_EC_SECT233R1:
<strong><a name="1245"> 1245</a></strong>         return 233;
<strong><a name="1246"> 1246</a></strong>
<strong><a name="1247"> 1247</a></strong>     case SEC_OID_SECG_EC_SECT239K1:
<strong><a name=
"1248"> 1248</a></strong>     case SEC_OID_ANSIX962_EC_C2TNB239V1:
<strong><a name=
"1249"> 1249</a></strong>     case SEC_OID_ANSIX962_EC_C2TNB239V2:
<strong><a name=
"1250"> 1250</a></strong>     case SEC_OID_ANSIX962_EC_C2TNB239V3:
<strong><a name=
"1251"> 1251</a></strong>     case SEC_OID_ANSIX962_EC_C2ONB239V4:
<strong><a name=
"1252"> 1252</a></strong>     case SEC_OID_ANSIX962_EC_C2ONB239V5:
<strong><a name=
"1253"> 1253</a></strong>     case SEC_OID_ANSIX962_EC_PRIME239V1:
<strong><a name=
"1254"> 1254</a></strong>     case SEC_OID_ANSIX962_EC_PRIME239V2:
<strong><a name=
"1255"> 1255</a></strong>     case SEC_OID_ANSIX962_EC_PRIME239V3:
<strong><a name="1256"> 1256</a></strong>         return 239;
<strong><a name="1257"> 1257</a></strong>
<strong><a name="1258"> 1258</a></strong>     case SEC_OID_SECG_EC_SECP256K1:
<strong><a name=
"1259"> 1259</a></strong>     case SEC_OID_ANSIX962_EC_PRIME256V1:
<strong><a name="1260"> 1260</a></strong>         return 256;
<strong><a name="1261"> 1261</a></strong>
<strong><a name=
"1262"> 1262</a></strong>     case SEC_OID_ANSIX962_EC_C2PNB272W1:
<strong><a name="1263"> 1263</a></strong>         return 272;
<strong><a name="1264"> 1264</a></strong>
<strong><a name="1265"> 1265</a></strong>     case SEC_OID_SECG_EC_SECT283K1:
<strong><a name="1266"> 1266</a></strong>     case SEC_OID_SECG_EC_SECT283R1:
<strong><a name="1267"> 1267</a></strong>         return 283;
<strong><a name="1268"> 1268</a></strong>
<strong><a name=
"1269"> 1269</a></strong>     case SEC_OID_ANSIX962_EC_C2PNB304W1:
<strong><a name="1270"> 1270</a></strong>         return 304;
<strong><a name="1271"> 1271</a></strong>
<strong><a name=
"1272"> 1272</a></strong>     case SEC_OID_ANSIX962_EC_C2TNB359V1:
<strong><a name="1273"> 1273</a></strong>         return 359;
<strong><a name="1274"> 1274</a></strong>
<strong><a name=
"1275"> 1275</a></strong>     case SEC_OID_ANSIX962_EC_C2PNB368W1:
<strong><a name="1276"> 1276</a></strong>         return 368;
<strong><a name="1277"> 1277</a></strong>
<strong><a name="1278"> 1278</a></strong>     case SEC_OID_SECG_EC_SECP384R1:
<strong><a name="1279"> 1279</a></strong>         return 384;
<strong><a name="1280"> 1280</a></strong>
<strong><a name="1281"> 1281</a></strong>     case SEC_OID_SECG_EC_SECT409K1:
<strong><a name="1282"> 1282</a></strong>     case SEC_OID_SECG_EC_SECT409R1:
<strong><a name="1283"> 1283</a></strong>         return 409;
<strong><a name="1284"> 1284</a></strong>
<strong><a name=
"1285"> 1285</a></strong>     case SEC_OID_ANSIX962_EC_C2TNB431R1:
<strong><a name="1286"> 1286</a></strong>         return 431;
<strong><a name="1287"> 1287</a></strong>
<strong><a name="1288"> 1288</a></strong>     case SEC_OID_SECG_EC_SECP521R1:
<strong><a name="1289"> 1289</a></strong>         return 521;
<strong><a name="1290"> 1290</a></strong>
<strong><a name="1291"> 1291</a></strong>     case SEC_OID_SECG_EC_SECT571K1:
<strong><a name="1292"> 1292</a></strong>     case SEC_OID_SECG_EC_SECT571R1:
<strong><a name="1293"> 1293</a></strong>         return 571;
<strong><a name="1294"> 1294</a></strong>
<strong><a name="1295"> 1295</a></strong>     default:
<strong><a name="1296"> 1296</a></strong>         <a href=
"../util/secport.c.dep.html#PORT_SetError">PORT_SetError</a>(SEC_ERROR_UNSUPPORTED_ELLIPTIC_CURVE);
<strong><a name="1297"> 1297</a></strong>         return 0;
<strong><a name="1298"> 1298</a></strong>     }
<strong><a name="1299"> 1299</a></strong> }
<strong><a name="1300"> 1300</a></strong>
<strong><a name="1301"> 1301</a></strong> int
<strong><a name="1302"> 1302</a></strong> <a href=
"#1302">SECKEY_ECParamsToBasePointOrderLen</a>(const <a href=
"../util/seccomon.h.dep.html#SECItem">SECItem</a> *encodedParams)
<strong><a name="1303"> 1303</a></strong> {
<strong><a name="1304"> 1304</a></strong>     <a href=
"../util/secoidt.h.dep.html#SECOidTag">SECOidTag</a> <a href=
"../mozilla/nsprpub/pr/tests/system.c.dep.html#tag">tag</a>;
<strong><a name="1305"> 1305</a></strong>     <a href=
"../util/seccomon.h.dep.html#SECItem">SECItem</a> oid = { siBuffer, <a href=
"../mozilla/dbm/include/ncompat.h.dep.html#NULL">NULL</a>, 0};
<strong><a name="1306"> 1306</a></strong>
<strong><a name=
"1307"> 1307</a></strong>     /* The encodedParams data contains 0x06 (SEC_ASN1_OBJECT_ID),
<strong><a name=
"1308"> 1308</a></strong>      * followed by the length of the curve oid and the curve oid.
<strong><a name="1309"> 1309</a></strong>      */
<strong><a name="1310"> 1310</a></strong>     oid.<a href=
"../mozilla/security/nss/cmd/crlutil/crlgen_lex.c.dep.html#len">len</a><a href=
"../mozilla/security/nss/cmd/modutil/lex.Pk11Install_yy.c.dep.html#len">[1]</a><a href="../mozilla/security/nss/cmd/zlib/adler32.c.dep.html#len">[2]</a><a href="../mozilla/security/nss/cmd/zlib/crc32.c.dep.html#len">[3]</a><a href="../mozilla/security/nss/cmd/zlib/gzio.c.dep.html#len">[6]</a><a href="../mozilla/security/nss/cmd/zlib/inflate.c.dep.html#len">[9]</a><a href="../mozilla/security/nss/cmd/zlib/trees.c.dep.html#len">[10]</a><a href="../mozilla/security/nss/cmd/zlib/zutil.c.dep.html#len">[13]</a> = encodedParams-&gt;<a href="../mozilla/security/nss/tests/pkcs11/netscape/suites/security/ssl/ssls.c.dep.html#data">data</a><a href="../mozilla/security/nss/tests/pkcs11/netscape/suites/security/ssl/ssls.h.dep.html#data">[2]</a>[1];
<strong><a name="1311"> 1311</a></strong>     oid.<a href=
"../mozilla/security/nss/tests/pkcs11/netscape/suites/security/ssl/ssls.c.dep.html#data">data</a><a href="../mozilla/security/nss/tests/pkcs11/netscape/suites/security/ssl/ssls.h.dep.html#data">[2]</a> = encodedParams-&gt;<a href="../mozilla/security/nss/tests/pkcs11/netscape/suites/security/ssl/ssls.c.dep.html#data">data</a><a href="../mozilla/security/nss/tests/pkcs11/netscape/suites/security/ssl/ssls.h.dep.html#data">[2]</a> + 2;
<strong><a name="1312"> 1312</a></strong>     if ((<a href=
"../mozilla/nsprpub/pr/tests/system.c.dep.html#tag">tag</a> = <a href=
"../util/secoid.c.dep.html#SECOID_FindOIDTag">SECOID_FindOIDTag</a>(&amp;oid)) == SEC_OID_UNKNOWN)
<strong><a name="1313"> 1313</a></strong>         return 0;
<strong><a name="1314"> 1314</a></strong>
<strong><a name="1315"> 1315</a></strong>     switch (<a href=
"../mozilla/nsprpub/pr/tests/system.c.dep.html#tag">tag</a>) {
<strong><a name="1316"> 1316</a></strong>     case SEC_OID_SECG_EC_SECP112R1:
<strong><a name="1317"> 1317</a></strong>         return 112;
<strong><a name="1318"> 1318</a></strong>     case SEC_OID_SECG_EC_SECP112R2:
<strong><a name="1319"> 1319</a></strong>         return 110;
<strong><a name="1320"> 1320</a></strong>
<strong><a name="1321"> 1321</a></strong>     case SEC_OID_SECG_EC_SECT113R1:
<strong><a name="1322"> 1322</a></strong>     case SEC_OID_SECG_EC_SECT113R2:
<strong><a name="1323"> 1323</a></strong>         return 113;
<strong><a name="1324"> 1324</a></strong>
<strong><a name="1325"> 1325</a></strong>     case SEC_OID_SECG_EC_SECP128R1:
<strong><a name="1326"> 1326</a></strong>         return 128;
<strong><a name="1327"> 1327</a></strong>     case SEC_OID_SECG_EC_SECP128R2:
<strong><a name="1328"> 1328</a></strong>         return 126;
<strong><a name="1329"> 1329</a></strong>
<strong><a name="1330"> 1330</a></strong>     case SEC_OID_SECG_EC_SECT131R1:
<strong><a name="1331"> 1331</a></strong>     case SEC_OID_SECG_EC_SECT131R2:
<strong><a name="1332"> 1332</a></strong>         return 131;
<strong><a name="1333"> 1333</a></strong>
<strong><a name="1334"> 1334</a></strong>     case SEC_OID_SECG_EC_SECP160K1:
<strong><a name="1335"> 1335</a></strong>     case SEC_OID_SECG_EC_SECP160R1:
<strong><a name="1336"> 1336</a></strong>     case SEC_OID_SECG_EC_SECP160R2:
<strong><a name="1337"> 1337</a></strong>         return 161;
<strong><a name="1338"> 1338</a></strong>
<strong><a name="1339"> 1339</a></strong>     case SEC_OID_SECG_EC_SECT163K1:
<strong><a name="1340"> 1340</a></strong>         return 163;
<strong><a name="1341"> 1341</a></strong>     case SEC_OID_SECG_EC_SECT163R1:
<strong><a name="1342"> 1342</a></strong>         return 162;
<strong><a name="1343"> 1343</a></strong>     case SEC_OID_SECG_EC_SECT163R2:
<strong><a name=
"1344"> 1344</a></strong>     case SEC_OID_ANSIX962_EC_C2PNB163V1:
<strong><a name="1345"> 1345</a></strong>         return 163;
<strong><a name=
"1346"> 1346</a></strong>     case SEC_OID_ANSIX962_EC_C2PNB163V2:
<strong><a name=
"1347"> 1347</a></strong>     case SEC_OID_ANSIX962_EC_C2PNB163V3:
<strong><a name="1348"> 1348</a></strong>         return 162;
<strong><a name="1349"> 1349</a></strong>
<strong><a name=
"1350"> 1350</a></strong>     case SEC_OID_ANSIX962_EC_C2PNB176V1:
<strong><a name="1351"> 1351</a></strong>         return 161;
<strong><a name="1352"> 1352</a></strong>
<strong><a name=
"1353"> 1353</a></strong>     case SEC_OID_ANSIX962_EC_C2TNB191V1:
<strong><a name="1354"> 1354</a></strong>         return 191;
<strong><a name=
"1355"> 1355</a></strong>     case SEC_OID_ANSIX962_EC_C2TNB191V2:
<strong><a name="1356"> 1356</a></strong>         return 190;
<strong><a name=
"1357"> 1357</a></strong>     case SEC_OID_ANSIX962_EC_C2TNB191V3:
<strong><a name="1358"> 1358</a></strong>         return 189;
<strong><a name=
"1359"> 1359</a></strong>     case SEC_OID_ANSIX962_EC_C2ONB191V4:
<strong><a name="1360"> 1360</a></strong>         return 191;
<strong><a name=
"1361"> 1361</a></strong>     case SEC_OID_ANSIX962_EC_C2ONB191V5:
<strong><a name="1362"> 1362</a></strong>         return 188;
<strong><a name="1363"> 1363</a></strong>
<strong><a name="1364"> 1364</a></strong>     case SEC_OID_SECG_EC_SECP192K1:
<strong><a name=
"1365"> 1365</a></strong>     case SEC_OID_ANSIX962_EC_PRIME192V1:
<strong><a name=
"1366"> 1366</a></strong>     case SEC_OID_ANSIX962_EC_PRIME192V2:
<strong><a name=
"1367"> 1367</a></strong>     case SEC_OID_ANSIX962_EC_PRIME192V3:
<strong><a name="1368"> 1368</a></strong>         return 192;
<strong><a name="1369"> 1369</a></strong>
<strong><a name="1370"> 1370</a></strong>     case SEC_OID_SECG_EC_SECT193R1:
<strong><a name="1371"> 1371</a></strong>     case SEC_OID_SECG_EC_SECT193R2:
<strong><a name="1372"> 1372</a></strong>         return 193;
<strong><a name="1373"> 1373</a></strong>
<strong><a name=
"1374"> 1374</a></strong>     case SEC_OID_ANSIX962_EC_C2PNB208W1:
<strong><a name="1375"> 1375</a></strong>         return 193;
<strong><a name="1376"> 1376</a></strong>
<strong><a name="1377"> 1377</a></strong>     case SEC_OID_SECG_EC_SECP224K1:
<strong><a name="1378"> 1378</a></strong>         return 225;
<strong><a name="1379"> 1379</a></strong>     case SEC_OID_SECG_EC_SECP224R1:
<strong><a name="1380"> 1380</a></strong>         return 224;
<strong><a name="1381"> 1381</a></strong>
<strong><a name="1382"> 1382</a></strong>     case SEC_OID_SECG_EC_SECT233K1:
<strong><a name="1383"> 1383</a></strong>         return 232;
<strong><a name="1384"> 1384</a></strong>     case SEC_OID_SECG_EC_SECT233R1:
<strong><a name="1385"> 1385</a></strong>         return 233;
<strong><a name="1386"> 1386</a></strong>
<strong><a name="1387"> 1387</a></strong>     case SEC_OID_SECG_EC_SECT239K1:
<strong><a name=
"1388"> 1388</a></strong>     case SEC_OID_ANSIX962_EC_C2TNB239V1:
<strong><a name="1389"> 1389</a></strong>         return 238;
<strong><a name=
"1390"> 1390</a></strong>     case SEC_OID_ANSIX962_EC_C2TNB239V2:
<strong><a name="1391"> 1391</a></strong>         return 237;
<strong><a name=
"1392"> 1392</a></strong>     case SEC_OID_ANSIX962_EC_C2TNB239V3:
<strong><a name="1393"> 1393</a></strong>         return 236;
<strong><a name=
"1394"> 1394</a></strong>     case SEC_OID_ANSIX962_EC_C2ONB239V4:
<strong><a name="1395"> 1395</a></strong>         return 238;
<strong><a name=
"1396"> 1396</a></strong>     case SEC_OID_ANSIX962_EC_C2ONB239V5:
<strong><a name="1397"> 1397</a></strong>         return 237;
<strong><a name=
"1398"> 1398</a></strong>     case SEC_OID_ANSIX962_EC_PRIME239V1:
<strong><a name=
"1399"> 1399</a></strong>     case SEC_OID_ANSIX962_EC_PRIME239V2:
<strong><a name=
"1400"> 1400</a></strong>     case SEC_OID_ANSIX962_EC_PRIME239V3:
<strong><a name="1401"> 1401</a></strong>         return 239;
<strong><a name="1402"> 1402</a></strong>
<strong><a name="1403"> 1403</a></strong>     case SEC_OID_SECG_EC_SECP256K1:
<strong><a name=
"1404"> 1404</a></strong>     case SEC_OID_ANSIX962_EC_PRIME256V1:
<strong><a name="1405"> 1405</a></strong>         return 256;
<strong><a name="1406"> 1406</a></strong>
<strong><a name=
"1407"> 1407</a></strong>     case SEC_OID_ANSIX962_EC_C2PNB272W1:
<strong><a name="1408"> 1408</a></strong>         return 257;
<strong><a name="1409"> 1409</a></strong>
<strong><a name="1410"> 1410</a></strong>     case SEC_OID_SECG_EC_SECT283K1:
<strong><a name="1411"> 1411</a></strong>         return 281;
<strong><a name="1412"> 1412</a></strong>     case SEC_OID_SECG_EC_SECT283R1:
<strong><a name="1413"> 1413</a></strong>         return 282;
<strong><a name="1414"> 1414</a></strong>
<strong><a name=
"1415"> 1415</a></strong>     case SEC_OID_ANSIX962_EC_C2PNB304W1:
<strong><a name="1416"> 1416</a></strong>         return 289;
<strong><a name="1417"> 1417</a></strong>
<strong><a name=
"1418"> 1418</a></strong>     case SEC_OID_ANSIX962_EC_C2TNB359V1:
<strong><a name="1419"> 1419</a></strong>         return 353;
<strong><a name="1420"> 1420</a></strong>
<strong><a name=
"1421"> 1421</a></strong>     case SEC_OID_ANSIX962_EC_C2PNB368W1:
<strong><a name="1422"> 1422</a></strong>         return 353;
<strong><a name="1423"> 1423</a></strong>
<strong><a name="1424"> 1424</a></strong>     case SEC_OID_SECG_EC_SECP384R1:
<strong><a name="1425"> 1425</a></strong>         return 384;
<strong><a name="1426"> 1426</a></strong>
<strong><a name="1427"> 1427</a></strong>     case SEC_OID_SECG_EC_SECT409K1:
<strong><a name="1428"> 1428</a></strong>         return 407;
<strong><a name="1429"> 1429</a></strong>     case SEC_OID_SECG_EC_SECT409R1:
<strong><a name="1430"> 1430</a></strong>         return 409;
<strong><a name="1431"> 1431</a></strong>
<strong><a name=
"1432"> 1432</a></strong>     case SEC_OID_ANSIX962_EC_C2TNB431R1:
<strong><a name="1433"> 1433</a></strong>         return 418;
<strong><a name="1434"> 1434</a></strong>
<strong><a name="1435"> 1435</a></strong>     case SEC_OID_SECG_EC_SECP521R1:
<strong><a name="1436"> 1436</a></strong>         return 521;
<strong><a name="1437"> 1437</a></strong>
<strong><a name="1438"> 1438</a></strong>     case SEC_OID_SECG_EC_SECT571K1:
<strong><a name="1439"> 1439</a></strong>     case SEC_OID_SECG_EC_SECT571R1:
<strong><a name="1440"> 1440</a></strong>         return 570;
<strong><a name="1441"> 1441</a></strong>
<strong><a name="1442"> 1442</a></strong>     default:
<strong><a name="1443"> 1443</a></strong>         <a href=
"../util/secport.c.dep.html#PORT_SetError">PORT_SetError</a>(SEC_ERROR_UNSUPPORTED_ELLIPTIC_CURVE);
<strong><a name="1444"> 1444</a></strong>         return 0;
<strong><a name="1445"> 1445</a></strong>     }
<strong><a name="1446"> 1446</a></strong> }
<strong><a name="1447"> 1447</a></strong>
<strong><a name=
"1448"> 1448</a></strong> /* returns key strength in bytes (not bits) */
<strong><a name="1449"> 1449</a></strong> unsigned
<strong><a name="1450"> 1450</a></strong> <a href=
"#1450">SECKEY_PublicKeyStrength</a>(<a href=
"../cryptohi/keythi.h.dep.html#SECKEYPublicKey">SECKEYPublicKey</a> *pubk)
<strong><a name="1451"> 1451</a></strong> {
<strong><a name="1452"> 1452</a></strong>     unsigned char b0;
<strong><a name="1453"> 1453</a></strong>
<strong><a name=
"1454"> 1454</a></strong>     /* interpret modulus length as key strength... in
<strong><a name=
"1455"> 1455</a></strong>      * fortezza that's the public key length */
<strong><a name="1456"> 1456</a></strong>
<strong><a name="1457"> 1457</a></strong>     switch (pubk-&gt;keyType) {
<strong><a name="1458"> 1458</a></strong>     case rsaKey:
<strong><a name=
"1459"> 1459</a></strong>             b0 = pubk-&gt;u.rsa.modulus.<a href=
"../mozilla/security/nss/tests/pkcs11/netscape/suites/security/ssl/ssls.c.dep.html#data">data</a><a href="../mozilla/security/nss/tests/pkcs11/netscape/suites/security/ssl/ssls.h.dep.html#data">[2]</a>[0];
<strong><a name=
"1460"> 1460</a></strong>             return b0 ? pubk-&gt;u.rsa.modulus.<a href="../mozilla/security/nss/cmd/crlutil/crlgen_lex.c.dep.html#len">len</a><a href="../mozilla/security/nss/cmd/modutil/lex.Pk11Install_yy.c.dep.html#len">[1]</a><a href="../mozilla/security/nss/cmd/zlib/adler32.c.dep.html#len">[2]</a><a href="../mozilla/security/nss/cmd/zlib/crc32.c.dep.html#len">[3]</a><a href="../mozilla/security/nss/cmd/zlib/gzio.c.dep.html#len">[6]</a><a href="../mozilla/security/nss/cmd/zlib/inflate.c.dep.html#len">[9]</a><a href="../mozilla/security/nss/cmd/zlib/trees.c.dep.html#len">[10]</a><a href="../mozilla/security/nss/cmd/zlib/zutil.c.dep.html#len">[13]</a> : pubk-&gt;u.rsa.modulus.<a href="../mozilla/security/nss/cmd/crlutil/crlgen_lex.c.dep.html#len">len</a><a href="../mozilla/security/nss/cmd/modutil/lex.Pk11Install_yy.c.dep.html#len">[1]</a><a href="../mozilla/security/nss/cmd/zlib/adler32.c.dep.html#len">[2]</a><a href="../mozilla/security/nss/cmd/zlib/crc32.c.dep.html#len">[3]</a><a href="../mozilla/security/nss/cmd/zlib/gzio.c.dep.html#len">[6]</a><a href="../mozilla/security/nss/cmd/zlib/inflate.c.dep.html#len">[9]</a><a href="../mozilla/security/nss/cmd/zlib/trees.c.dep.html#len">[10]</a><a href="../mozilla/security/nss/cmd/zlib/zutil.c.dep.html#len">[13]</a> - 1;
<strong><a name="1461"> 1461</a></strong>     case dsaKey:
<strong><a name=
"1462"> 1462</a></strong>             b0 = pubk-&gt;u.dsa.publicValue.<a href=
"../mozilla/security/nss/tests/pkcs11/netscape/suites/security/ssl/ssls.c.dep.html#data">data</a><a href="../mozilla/security/nss/tests/pkcs11/netscape/suites/security/ssl/ssls.h.dep.html#data">[2]</a>[0];
<strong><a name=
"1463"> 1463</a></strong>             return b0 ? pubk-&gt;u.dsa.publicValue.<a href="../mozilla/security/nss/cmd/crlutil/crlgen_lex.c.dep.html#len">len</a><a href="../mozilla/security/nss/cmd/modutil/lex.Pk11Install_yy.c.dep.html#len">[1]</a><a href="../mozilla/security/nss/cmd/zlib/adler32.c.dep.html#len">[2]</a><a href="../mozilla/security/nss/cmd/zlib/crc32.c.dep.html#len">[3]</a><a href="../mozilla/security/nss/cmd/zlib/gzio.c.dep.html#len">[6]</a><a href="../mozilla/security/nss/cmd/zlib/inflate.c.dep.html#len">[9]</a><a href="../mozilla/security/nss/cmd/zlib/trees.c.dep.html#len">[10]</a><a href="../mozilla/security/nss/cmd/zlib/zutil.c.dep.html#len">[13]</a> :
<strong><a name=
"1464"> 1464</a></strong>             pubk-&gt;u.dsa.publicValue.<a href=
"../mozilla/security/nss/cmd/crlutil/crlgen_lex.c.dep.html#len">len</a><a href=
"../mozilla/security/nss/cmd/modutil/lex.Pk11Install_yy.c.dep.html#len">[1]</a><a href="../mozilla/security/nss/cmd/zlib/adler32.c.dep.html#len">[2]</a><a href="../mozilla/security/nss/cmd/zlib/crc32.c.dep.html#len">[3]</a><a href="../mozilla/security/nss/cmd/zlib/gzio.c.dep.html#len">[6]</a><a href="../mozilla/security/nss/cmd/zlib/inflate.c.dep.html#len">[9]</a><a href="../mozilla/security/nss/cmd/zlib/trees.c.dep.html#len">[10]</a><a href="../mozilla/security/nss/cmd/zlib/zutil.c.dep.html#len">[13]</a> - 1;
<strong><a name="1465"> 1465</a></strong>     case dhKey:
<strong><a name=
"1466"> 1466</a></strong>             b0 = pubk-&gt;u.dh.publicValue.<a href=
"../mozilla/security/nss/tests/pkcs11/netscape/suites/security/ssl/ssls.c.dep.html#data">data</a><a href="../mozilla/security/nss/tests/pkcs11/netscape/suites/security/ssl/ssls.h.dep.html#data">[2]</a>[0];
<strong><a name=
"1467"> 1467</a></strong>             return b0 ? pubk-&gt;u.dh.publicValue.<a href="../mozilla/security/nss/cmd/crlutil/crlgen_lex.c.dep.html#len">len</a><a href="../mozilla/security/nss/cmd/modutil/lex.Pk11Install_yy.c.dep.html#len">[1]</a><a href="../mozilla/security/nss/cmd/zlib/adler32.c.dep.html#len">[2]</a><a href="../mozilla/security/nss/cmd/zlib/crc32.c.dep.html#len">[3]</a><a href="../mozilla/security/nss/cmd/zlib/gzio.c.dep.html#len">[6]</a><a href="../mozilla/security/nss/cmd/zlib/inflate.c.dep.html#len">[9]</a><a href="../mozilla/security/nss/cmd/zlib/trees.c.dep.html#len">[10]</a><a href="../mozilla/security/nss/cmd/zlib/zutil.c.dep.html#len">[13]</a> :
<strong><a name=
"1468"> 1468</a></strong>             pubk-&gt;u.dh.publicValue.<a href=
"../mozilla/security/nss/cmd/crlutil/crlgen_lex.c.dep.html#len">len</a><a href=
"../mozilla/security/nss/cmd/modutil/lex.Pk11Install_yy.c.dep.html#len">[1]</a><a href="../mozilla/security/nss/cmd/zlib/adler32.c.dep.html#len">[2]</a><a href="../mozilla/security/nss/cmd/zlib/crc32.c.dep.html#len">[3]</a><a href="../mozilla/security/nss/cmd/zlib/gzio.c.dep.html#len">[6]</a><a href="../mozilla/security/nss/cmd/zlib/inflate.c.dep.html#len">[9]</a><a href="../mozilla/security/nss/cmd/zlib/trees.c.dep.html#len">[10]</a><a href="../mozilla/security/nss/cmd/zlib/zutil.c.dep.html#len">[13]</a> - 1;
<strong><a name="1469"> 1469</a></strong>     case fortezzaKey:
<strong><a name="1470"> 1470</a></strong>         return <a href=
"../mozilla/nsprpub/pr/include/prtypes.h.dep.html#PR_MAX">PR_MAX</a>(pubk-&gt;u.fortezza.KEAKey.<a href="../mozilla/security/nss/cmd/crlutil/crlgen_lex.c.dep.html#len">len</a><a href="../mozilla/security/nss/cmd/modutil/lex.Pk11Install_yy.c.dep.html#len">[1]</a><a href="../mozilla/security/nss/cmd/zlib/adler32.c.dep.html#len">[2]</a><a href="../mozilla/security/nss/cmd/zlib/crc32.c.dep.html#len">[3]</a><a href="../mozilla/security/nss/cmd/zlib/gzio.c.dep.html#len">[6]</a><a href="../mozilla/security/nss/cmd/zlib/inflate.c.dep.html#len">[9]</a><a href="../mozilla/security/nss/cmd/zlib/trees.c.dep.html#len">[10]</a><a href="../mozilla/security/nss/cmd/zlib/zutil.c.dep.html#len">[13]</a>, pubk-&gt;u.fortezza.DSSKey.<a href="../mozilla/security/nss/cmd/crlutil/crlgen_lex.c.dep.html#len">len</a><a href="../mozilla/security/nss/cmd/modutil/lex.Pk11Install_yy.c.dep.html#len">[1]</a><a href="../mozilla/security/nss/cmd/zlib/adler32.c.dep.html#len">[2]</a><a href="../mozilla/security/nss/cmd/zlib/crc32.c.dep.html#len">[3]</a><a href="../mozilla/security/nss/cmd/zlib/gzio.c.dep.html#len">[6]</a><a href="../mozilla/security/nss/cmd/zlib/inflate.c.dep.html#len">[9]</a><a href="../mozilla/security/nss/cmd/zlib/trees.c.dep.html#len">[10]</a><a href="../mozilla/security/nss/cmd/zlib/zutil.c.dep.html#len">[13]</a>);
<strong><a name="1471"> 1471</a></strong>     case ecKey:
<strong><a name=
"1472"> 1472</a></strong>         /* Get the key size in bits and adjust */
<strong><a name="1473"> 1473</a></strong>         if (pubk-&gt;u.ec.<a href=
"../mozilla/security/nss/cmd/crlutil/crlgen_lex.c.dep.html#size">size</a><a href="../mozilla/security/nss/cmd/modutil/lex.Pk11Install_yy.c.dep.html#size">[4]</a><a href="../mozilla/security/nss/cmd/zlib/deflate.c.dep.html#size">[8]</a><a href="../mozilla/security/nss/cmd/zlib/zutil.c.dep.html#size">[9]</a> == 0) {
<strong><a name="1474"> 1474</a></strong>             pubk-&gt;u.ec.<a href=
"../mozilla/security/nss/cmd/crlutil/crlgen_lex.c.dep.html#size">size</a><a href="../mozilla/security/nss/cmd/modutil/lex.Pk11Install_yy.c.dep.html#size">[4]</a><a href="../mozilla/security/nss/cmd/zlib/deflate.c.dep.html#size">[8]</a><a href="../mozilla/security/nss/cmd/zlib/zutil.c.dep.html#size">[9]</a> =
<strong><a name="1475"> 1475</a></strong>                 <a href=
"../cryptohi/seckey.c.dep.html#SECKEY_ECParamsToKeySize">SECKEY_ECParamsToKeySize</a>(&amp;pubk-&gt;u.ec.DEREncodedParams);
<strong><a name="1476"> 1476</a></strong>         }
<strong><a name=
"1477"> 1477</a></strong>         return (pubk-&gt;u.ec.<a href="../mozilla/security/nss/cmd/crlutil/crlgen_lex.c.dep.html#size">size</a><a href="../mozilla/security/nss/cmd/modutil/lex.Pk11Install_yy.c.dep.html#size">[4]</a><a href="../mozilla/security/nss/cmd/zlib/deflate.c.dep.html#size">[8]</a><a href="../mozilla/security/nss/cmd/zlib/zutil.c.dep.html#size">[9]</a> + 7)/8;
<strong><a name="1478"> 1478</a></strong>     default:
<strong><a name="1479"> 1479</a></strong>         break;
<strong><a name="1480"> 1480</a></strong>     }
<strong><a name="1481"> 1481</a></strong>     <a href=
"../util/secport.c.dep.html#PORT_SetError">PORT_SetError</a>(SEC_ERROR_INVALID_KEY);
<strong><a name="1482"> 1482</a></strong>     return 0;
<strong><a name="1483"> 1483</a></strong> }
<strong><a name="1484"> 1484</a></strong>
<strong><a name="1485"> 1485</a></strong> /* returns key strength in bits */
<strong><a name="1486"> 1486</a></strong> unsigned
<strong><a name="1487"> 1487</a></strong> <a href=
"#1487">SECKEY_PublicKeyStrengthInBits</a>(<a href=
"../cryptohi/keythi.h.dep.html#SECKEYPublicKey">SECKEYPublicKey</a> *pubk)
<strong><a name="1488"> 1488</a></strong> {
<strong><a name="1489"> 1489</a></strong>     switch (pubk-&gt;keyType) {
<strong><a name="1490"> 1490</a></strong>     case rsaKey:
<strong><a name="1491"> 1491</a></strong>     case dsaKey:
<strong><a name="1492"> 1492</a></strong>     case dhKey:
<strong><a name="1493"> 1493</a></strong>     case fortezzaKey:
<strong><a name="1494"> 1494</a></strong>         return <a href=
"../cryptohi/seckey.c.dep.html#SECKEY_PublicKeyStrength">SECKEY_PublicKeyStrength</a>(pubk) * 8; /* 1 byte = 8 bits */
<strong><a name="1495"> 1495</a></strong>     case ecKey:
<strong><a name="1496"> 1496</a></strong>         if (pubk-&gt;u.ec.<a href=
"../mozilla/security/nss/cmd/crlutil/crlgen_lex.c.dep.html#size">size</a><a href="../mozilla/security/nss/cmd/modutil/lex.Pk11Install_yy.c.dep.html#size">[4]</a><a href="../mozilla/security/nss/cmd/zlib/deflate.c.dep.html#size">[8]</a><a href="../mozilla/security/nss/cmd/zlib/zutil.c.dep.html#size">[9]</a> == 0) {
<strong><a name="1497"> 1497</a></strong>             pubk-&gt;u.ec.<a href=
"../mozilla/security/nss/cmd/crlutil/crlgen_lex.c.dep.html#size">size</a><a href="../mozilla/security/nss/cmd/modutil/lex.Pk11Install_yy.c.dep.html#size">[4]</a><a href="../mozilla/security/nss/cmd/zlib/deflate.c.dep.html#size">[8]</a><a href="../mozilla/security/nss/cmd/zlib/zutil.c.dep.html#size">[9]</a> =
<strong><a name="1498"> 1498</a></strong>                 <a href=
"../cryptohi/seckey.c.dep.html#SECKEY_ECParamsToKeySize">SECKEY_ECParamsToKeySize</a>(&amp;pubk-&gt;u.ec.DEREncodedParams);
<strong><a name="1499"> 1499</a></strong>         }
<strong><a name="1500"> 1500</a></strong>         return pubk-&gt;u.ec.<a href=
"../mozilla/security/nss/cmd/crlutil/crlgen_lex.c.dep.html#size">size</a><a href="../mozilla/security/nss/cmd/modutil/lex.Pk11Install_yy.c.dep.html#size">[4]</a><a href="../mozilla/security/nss/cmd/zlib/deflate.c.dep.html#size">[8]</a><a href="../mozilla/security/nss/cmd/zlib/zutil.c.dep.html#size">[9]</a>;
<strong><a name="1501"> 1501</a></strong>     default:
<strong><a name="1502"> 1502</a></strong>         break;
<strong><a name="1503"> 1503</a></strong>     }
<strong><a name="1504"> 1504</a></strong>     <a href=
"../util/secport.c.dep.html#PORT_SetError">PORT_SetError</a>(SEC_ERROR_INVALID_KEY);
<strong><a name="1505"> 1505</a></strong>     return 0;
<strong><a name="1506"> 1506</a></strong> }
<strong><a name="1507"> 1507</a></strong>
<strong><a name=
"1508"> 1508</a></strong> /* returns signature length in bytes (not bits) */
<strong><a name="1509"> 1509</a></strong> unsigned
<strong><a name="1510"> 1510</a></strong> <a href=
"#1510">SECKEY_SignatureLen</a>(const <a href=
"../cryptohi/keythi.h.dep.html#SECKEYPublicKey">SECKEYPublicKey</a> *pubk)
<strong><a name="1511"> 1511</a></strong> {
<strong><a name="1512"> 1512</a></strong>     unsigned char b0;
<strong><a name="1513"> 1513</a></strong>     unsigned <a href=
"../mozilla/security/nss/cmd/crlutil/crlgen_lex.c.dep.html#size">size</a><a href="../mozilla/security/nss/cmd/modutil/lex.Pk11Install_yy.c.dep.html#size">[4]</a><a href="../mozilla/security/nss/cmd/zlib/deflate.c.dep.html#size">[8]</a><a href="../mozilla/security/nss/cmd/zlib/zutil.c.dep.html#size">[9]</a>;
<strong><a name="1514"> 1514</a></strong>
<strong><a name="1515"> 1515</a></strong>     switch (pubk-&gt;keyType) {
<strong><a name="1516"> 1516</a></strong>     case rsaKey:
<strong><a name=
"1517"> 1517</a></strong>             b0 = pubk-&gt;u.rsa.modulus.<a href=
"../mozilla/security/nss/tests/pkcs11/netscape/suites/security/ssl/ssls.c.dep.html#data">data</a><a href="../mozilla/security/nss/tests/pkcs11/netscape/suites/security/ssl/ssls.h.dep.html#data">[2]</a>[0];
<strong><a name=
"1518"> 1518</a></strong>             return b0 ? pubk-&gt;u.rsa.modulus.<a href="../mozilla/security/nss/cmd/crlutil/crlgen_lex.c.dep.html#len">len</a><a href="../mozilla/security/nss/cmd/modutil/lex.Pk11Install_yy.c.dep.html#len">[1]</a><a href="../mozilla/security/nss/cmd/zlib/adler32.c.dep.html#len">[2]</a><a href="../mozilla/security/nss/cmd/zlib/crc32.c.dep.html#len">[3]</a><a href="../mozilla/security/nss/cmd/zlib/gzio.c.dep.html#len">[6]</a><a href="../mozilla/security/nss/cmd/zlib/inflate.c.dep.html#len">[9]</a><a href="../mozilla/security/nss/cmd/zlib/trees.c.dep.html#len">[10]</a><a href="../mozilla/security/nss/cmd/zlib/zutil.c.dep.html#len">[13]</a> : pubk-&gt;u.rsa.modulus.<a href="../mozilla/security/nss/cmd/crlutil/crlgen_lex.c.dep.html#len">len</a><a href="../mozilla/security/nss/cmd/modutil/lex.Pk11Install_yy.c.dep.html#len">[1]</a><a href="../mozilla/security/nss/cmd/zlib/adler32.c.dep.html#len">[2]</a><a href="../mozilla/security/nss/cmd/zlib/crc32.c.dep.html#len">[3]</a><a href="../mozilla/security/nss/cmd/zlib/gzio.c.dep.html#len">[6]</a><a href="../mozilla/security/nss/cmd/zlib/inflate.c.dep.html#len">[9]</a><a href="../mozilla/security/nss/cmd/zlib/trees.c.dep.html#len">[10]</a><a href="../mozilla/security/nss/cmd/zlib/zutil.c.dep.html#len">[13]</a> - 1;
<strong><a name="1519"> 1519</a></strong>     case fortezzaKey:
<strong><a name="1520"> 1520</a></strong>     case dsaKey:
<strong><a name="1521"> 1521</a></strong>             return <a href=
"../freebl/blapit.h.dep.html#DSA_SIGNATURE_LEN">DSA_SIGNATURE_LEN</a>;
<strong><a name="1522"> 1522</a></strong>     case ecKey:
<strong><a name=
"1523"> 1523</a></strong>         /* Get the base point order length in bits and adjust */
<strong><a name="1524"> 1524</a></strong>         <a href=
"../mozilla/security/nss/cmd/crlutil/crlgen_lex.c.dep.html#size">size</a><a href="../mozilla/security/nss/cmd/modutil/lex.Pk11Install_yy.c.dep.html#size">[4]</a><a href="../mozilla/security/nss/cmd/zlib/deflate.c.dep.html#size">[8]</a><a href="../mozilla/security/nss/cmd/zlib/zutil.c.dep.html#size">[9]</a> =        <a href="../cryptohi/seckey.c.dep.html#SECKEY_ECParamsToBasePointOrderLen">SECKEY_ECParamsToBasePointOrderLen</a>(
<strong><a name=
"1525"> 1525</a></strong>                 &amp;pubk-&gt;u.ec.DEREncodedParams);
<strong><a name="1526"> 1526</a></strong>         return ((<a href=
"../mozilla/security/nss/cmd/crlutil/crlgen_lex.c.dep.html#size">size</a><a href="../mozilla/security/nss/cmd/modutil/lex.Pk11Install_yy.c.dep.html#size">[4]</a><a href="../mozilla/security/nss/cmd/zlib/deflate.c.dep.html#size">[8]</a><a href="../mozilla/security/nss/cmd/zlib/zutil.c.dep.html#size">[9]</a> + 7)/8) * 2;
<strong><a name="1527"> 1527</a></strong>     default:
<strong><a name="1528"> 1528</a></strong>         break;
<strong><a name="1529"> 1529</a></strong>     }
<strong><a name="1530"> 1530</a></strong>     <a href=
"../util/secport.c.dep.html#PORT_SetError">PORT_SetError</a>(SEC_ERROR_INVALID_KEY);
<strong><a name="1531"> 1531</a></strong>     return 0;
<strong><a name="1532"> 1532</a></strong> }
<strong><a name="1533"> 1533</a></strong>
<strong><a name="1534"> 1534</a></strong> <a href=
"../cryptohi/keythi.h.dep.html#SECKEYPrivateKey">SECKEYPrivateKey</a> *
<strong><a name="1535"> 1535</a></strong> <a href=
"#1535">SECKEY_CopyPrivateKey</a>(<a href=
"../cryptohi/keythi.h.dep.html#SECKEYPrivateKey">SECKEYPrivateKey</a> *privk)
<strong><a name="1536"> 1536</a></strong> {
<strong><a name="1537"> 1537</a></strong>     <a href=
"../cryptohi/keythi.h.dep.html#SECKEYPrivateKey">SECKEYPrivateKey</a> *copyk;
<strong><a name="1538"> 1538</a></strong>     <a href=
"../mozilla/nsprpub/pr/include/obsolete/protypes.h.dep.html#PRArenaPool">PRArenaPool</a> *arena;
<strong><a name="1539"> 1539</a></strong>
<strong><a name=
"1540"> 1540</a></strong>     if (!privk || !privk-&gt;pkcs11Slot) {
<strong><a name="1541"> 1541</a></strong>         <a href=
"../util/secport.c.dep.html#PORT_SetError">PORT_SetError</a>(SEC_ERROR_INVALID_ARGS);
<strong><a name="1542"> 1542</a></strong>         return <a href=
"../mozilla/dbm/include/ncompat.h.dep.html#NULL">NULL</a>;
<strong><a name="1543"> 1543</a></strong>     }
<strong><a name="1544"> 1544</a></strong>
<strong><a name="1545"> 1545</a></strong>     arena = <a href=
"../util/secport.c.dep.html#PORT_NewArena">PORT_NewArena</a>(<a href=
"../util/secdert.h.dep.html#DER_DEFAULT_CHUNKSIZE">DER_DEFAULT_CHUNKSIZE</a>);
<strong><a name="1546"> 1546</a></strong>     if (arena == <a href=
"../mozilla/dbm/include/ncompat.h.dep.html#NULL">NULL</a>) {
<strong><a name="1547"> 1547</a></strong>         return <a href=
"../mozilla/dbm/include/ncompat.h.dep.html#NULL">NULL</a>;
<strong><a name="1548"> 1548</a></strong>     }
<strong><a name="1549"> 1549</a></strong>
<strong><a name="1550"> 1550</a></strong>     copyk = (<a href=
"../cryptohi/keythi.h.dep.html#SECKEYPrivateKey">SECKEYPrivateKey</a> *) <a href="../util/secport.c.dep.html#PORT_ArenaZAlloc">PORT_ArenaZAlloc</a> (arena, sizeof (<a href="../cryptohi/keythi.h.dep.html#SECKEYPrivateKey">SECKEYPrivateKey</a>));
<strong><a name="1551"> 1551</a></strong>     if (copyk) {
<strong><a name="1552"> 1552</a></strong>         copyk-&gt;arena = arena;
<strong><a name=
"1553"> 1553</a></strong>         copyk-&gt;keyType = privk-&gt;keyType;
<strong><a name="1554"> 1554</a></strong>
<strong><a name=
"1555"> 1555</a></strong>         /* copy the PKCS #11 parameters */
<strong><a name=
"1556"> 1556</a></strong>         copyk-&gt;pkcs11Slot = <a href=
"../pk11wrap/pk11slot.c.dep.html#PK11_ReferenceSlot">PK11_ReferenceSlot</a>(privk-&gt;pkcs11Slot);
<strong><a name=
"1557"> 1557</a></strong>         /* if the key we're referencing was a temparary key we have just
<strong><a name=
"1558"> 1558</a></strong>          * created, that we want to go away when we're through, we need
<strong><a name="1559"> 1559</a></strong>          * to make a copy of it */
<strong><a name="1560"> 1560</a></strong>         if (privk-&gt;pkcs11IsTemp) {
<strong><a name="1561"> 1561</a></strong>             copyk-&gt;pkcs11ID =
<strong><a name="1562"> 1562</a></strong>                         <a href=
"../pk11wrap/pk11obj.c.dep.html#PK11_CopyKey">PK11_CopyKey</a>(privk-&gt;pkcs11Slot,privk-&gt;pkcs11ID);
<strong><a name=
"1563"> 1563</a></strong>             if (copyk-&gt;pkcs11ID == <a href=
"../softoken/pkcs11t.h.dep.html#CK_INVALID_HANDLE">CK_INVALID_HANDLE</a>) goto <a href="../mozilla/nsprpub/config/nsinstall.c.dep.html#fail">fail</a><a href="../mozilla/security/coreconf/nsinstall/pathsub.c.dep.html#fail">[1]</a>;
<strong><a name="1564"> 1564</a></strong>         } else {
<strong><a name=
"1565"> 1565</a></strong>             copyk-&gt;pkcs11ID = privk-&gt;pkcs11ID;
<strong><a name="1566"> 1566</a></strong>         }
<strong><a name=
"1567"> 1567</a></strong>         copyk-&gt;pkcs11IsTemp = privk-&gt;pkcs11IsTemp;
<strong><a name=
"1568"> 1568</a></strong>         copyk-&gt;wincx = privk-&gt;wincx;
<strong><a name=
"1569"> 1569</a></strong>         copyk-&gt;staticflags = privk-&gt;staticflags;
<strong><a name="1570"> 1570</a></strong>         return copyk;
<strong><a name="1571"> 1571</a></strong>     } else {
<strong><a name="1572"> 1572</a></strong>         <a href=
"../util/secport.c.dep.html#PORT_SetError">PORT_SetError</a> (SEC_ERROR_NO_MEMORY);
<strong><a name="1573"> 1573</a></strong>     }
<strong><a name="1574"> 1574</a></strong>
<strong><a name="1575"> 1575</a></strong> <a href=
"../mozilla/nsprpub/config/nsinstall.c.dep.html#fail">fail</a><a href=
"../mozilla/security/coreconf/nsinstall/pathsub.c.dep.html#fail">[1]</a>:
<strong><a name="1576"> 1576</a></strong>     <a href=
"../util/secport.c.dep.html#PORT_FreeArena">PORT_FreeArena</a> (arena, <a href=
"../mozilla/nsprpub/pr/include/prtypes.h.dep.html#PR_FALSE">PR_FALSE</a>);
<strong><a name="1577"> 1577</a></strong>     return <a href=
"../mozilla/dbm/include/ncompat.h.dep.html#NULL">NULL</a>;
<strong><a name="1578"> 1578</a></strong> }
<strong><a name="1579"> 1579</a></strong>
<strong><a name="1580"> 1580</a></strong> <a href=
"../cryptohi/keythi.h.dep.html#SECKEYPublicKey">SECKEYPublicKey</a> *
<strong><a name="1581"> 1581</a></strong> <a href=
"#1581">SECKEY_CopyPublicKey</a>(<a href=
"../cryptohi/keythi.h.dep.html#SECKEYPublicKey">SECKEYPublicKey</a> *pubk)
<strong><a name="1582"> 1582</a></strong> {
<strong><a name="1583"> 1583</a></strong>     <a href=
"../cryptohi/keythi.h.dep.html#SECKEYPublicKey">SECKEYPublicKey</a> *copyk;
<strong><a name="1584"> 1584</a></strong>     <a href=
"../mozilla/nsprpub/pr/include/obsolete/protypes.h.dep.html#PRArenaPool">PRArenaPool</a> *arena;
<strong><a name="1585"> 1585</a></strong>     <a href=
"../util/seccomon.h.dep.html#SECStatus">SECStatus</a> <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> = <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a>/selfse<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a><a href=
"../mozilla/security/nss/cmd/selfse.c.dep.html#SECSuccess">SECSuccess</a>;
<strong><a name="1586"> 1586</a></strong>
<strong><a name="1587"> 1587</a></strong>     arena = <a href=
"../util/secport.c.dep.html#PORT_NewArena">PORT_NewArena</a>(<a href=
"../util/secdert.h.dep.html#DER_DEFAULT_CHUNKSIZE">DER_DEFAULT_CHUNKSIZE</a>);
<strong><a name="1588"> 1588</a></strong>     if (arena == <a href=
"../mozilla/dbm/include/ncompat.h.dep.html#NULL">NULL</a>) {
<strong><a name="1589"> 1589</a></strong>         <a href=
"../util/secport.c.dep.html#PORT_SetError">PORT_SetError</a> (SEC_ERROR_NO_MEMORY);
<strong><a name="1590"> 1590</a></strong>         return <a href=
"../mozilla/dbm/include/ncompat.h.dep.html#NULL">NULL</a>;
<strong><a name="1591"> 1591</a></strong>     }
<strong><a name="1592"> 1592</a></strong>
<strong><a name="1593"> 1593</a></strong>     copyk = (<a href=
"../cryptohi/keythi.h.dep.html#SECKEYPublicKey">SECKEYPublicKey</a> *) <a href=
"../util/secport.c.dep.html#PORT_ArenaZAlloc">PORT_ArenaZAlloc</a> (arena, sizeof (<a href="../cryptohi/keythi.h.dep.html#SECKEYPublicKey">SECKEYPublicKey</a>));
<strong><a name="1594"> 1594</a></strong>     if (!copyk) {
<strong><a name="1595"> 1595</a></strong>         <a href=
"../util/secport.c.dep.html#PORT_SetError">PORT_SetError</a> (SEC_ERROR_NO_MEMORY);
<strong><a name="1596"> 1596</a></strong>         <a href=
"../util/secport.c.dep.html#PORT_FreeArena">PORT_FreeArena</a> (arena, <a href=
"../mozilla/nsprpub/pr/include/prtypes.h.dep.html#PR_FALSE">PR_FALSE</a>);
<strong><a name="1597"> 1597</a></strong>         return <a href=
"../mozilla/dbm/include/ncompat.h.dep.html#NULL">NULL</a>;
<strong><a name="1598"> 1598</a></strong>     }
<strong><a name="1599"> 1599</a></strong>
<strong><a name="1600"> 1600</a></strong>     copyk-&gt;arena = arena;
<strong><a name=
"1601"> 1601</a></strong>     copyk-&gt;keyType = pubk-&gt;keyType;
<strong><a name=
"1602"> 1602</a></strong>     if (pubk-&gt;pkcs11Slot &amp;&amp;
<strong><a name="1603"> 1603</a></strong>         <a href=
"../pk11wrap/pk11obj.c.dep.html#PK11_IsPermObject">PK11_IsPermObject</a>(pubk-&gt;pkcs11Slot,pubk-&gt;pkcs11ID)) {
<strong><a name=
"1604"> 1604</a></strong>         copyk-&gt;pkcs11Slot = <a href=
"../pk11wrap/pk11slot.c.dep.html#PK11_ReferenceSlot">PK11_ReferenceSlot</a>(pubk-&gt;pkcs11Slot);
<strong><a name=
"1605"> 1605</a></strong>         copyk-&gt;pkcs11ID = pubk-&gt;pkcs11ID;
<strong><a name="1606"> 1606</a></strong>     } else {
<strong><a name=
"1607"> 1607</a></strong>         copyk-&gt;pkcs11Slot = <a href=
"../mozilla/dbm/include/ncompat.h.dep.html#NULL">NULL</a>;        /* go get own reference */
<strong><a name="1608"> 1608</a></strong>         copyk-&gt;pkcs11ID = <a href=
"../softoken/pkcs11t.h.dep.html#CK_INVALID_HANDLE">CK_INVALID_HANDLE</a>;
<strong><a name="1609"> 1609</a></strong>     }
<strong><a name="1610"> 1610</a></strong>     switch (pubk-&gt;keyType) {
<strong><a name="1611"> 1611</a></strong>       case rsaKey:
<strong><a name="1612"> 1612</a></strong>           <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> = <a href=
"../util/secitem.c.dep.html#SECITEM_CopyItem">SECITEM_CopyItem</a>(arena, &amp;copyk-&gt;u.rsa.modulus,
<strong><a name=
"1613"> 1613</a></strong>                                 &amp;pubk-&gt;u.rsa.modulus);
<strong><a name="1614"> 1614</a></strong>           if (<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> == <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a>/selfse<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a><a href=
"../mozilla/security/nss/cmd/selfse.c.dep.html#SECSuccess">SECSuccess</a>) {
<strong><a name="1615"> 1615</a></strong>               <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> = <a href=
"../util/secitem.c.dep.html#SECITEM_CopyItem">SECITEM_CopyItem</a> (arena, &amp;copyk-&gt;u.rsa.publicExponent,
<strong><a name=
"1616"> 1616</a></strong>                                      &amp;pubk-&gt;u.rsa.publicExponent);
<strong><a name="1617"> 1617</a></strong>               if (<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> == <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a>/selfse<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a><a href=
"../mozilla/security/nss/cmd/selfse.c.dep.html#SECSuccess">SECSuccess</a>)
<strong><a name="1618"> 1618</a></strong>                   return copyk;
<strong><a name="1619"> 1619</a></strong>           }
<strong><a name="1620"> 1620</a></strong>           break;
<strong><a name="1621"> 1621</a></strong>       case dsaKey:
<strong><a name="1622"> 1622</a></strong>           <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> = <a href=
"../util/secitem.c.dep.html#SECITEM_CopyItem">SECITEM_CopyItem</a>(arena, &amp;copyk-&gt;u.dsa.publicValue,
<strong><a name=
"1623"> 1623</a></strong>                                 &amp;pubk-&gt;u.dsa.publicValue);
<strong><a name="1624"> 1624</a></strong>           if (<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> != <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a>/selfse<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a><a href=
"../mozilla/security/nss/cmd/selfse.c.dep.html#SECSuccess">SECSuccess</a>) break;
<strong><a name="1625"> 1625</a></strong>           <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> = <a href=
"../util/secitem.c.dep.html#SECITEM_CopyItem">SECITEM_CopyItem</a>(arena, &amp;copyk-&gt;u.dsa.params.prime,
<strong><a name=
"1626"> 1626</a></strong>                                 &amp;pubk-&gt;u.dsa.params.prime);
<strong><a name="1627"> 1627</a></strong>           if (<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> != <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a>/selfse<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a><a href=
"../mozilla/security/nss/cmd/selfse.c.dep.html#SECSuccess">SECSuccess</a>) break;
<strong><a name="1628"> 1628</a></strong>           <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> = <a href=
"../util/secitem.c.dep.html#SECITEM_CopyItem">SECITEM_CopyItem</a>(arena, &amp;copyk-&gt;u.dsa.params.subPrime,
<strong><a name=
"1629"> 1629</a></strong>                                 &amp;pubk-&gt;u.dsa.params.subPrime);
<strong><a name="1630"> 1630</a></strong>           if (<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> != <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a>/selfse<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a><a href=
"../mozilla/security/nss/cmd/selfse.c.dep.html#SECSuccess">SECSuccess</a>) break;
<strong><a name="1631"> 1631</a></strong>           <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> = <a href=
"../util/secitem.c.dep.html#SECITEM_CopyItem">SECITEM_CopyItem</a>(arena, &amp;copyk-&gt;u.dsa.params.<a href="../mozilla/nsprpub/lib/libc/src/base64.c.dep.html#base">base</a><a href="../mozilla/nsprpub/lib/tests/base64t.c.dep.html#base">[1]</a><a href="../mozilla/nsprpub/pr/tests/xnotify.c.dep.html#base">[2]</a><a href="../mozilla/security/nss/cmd/crlutil/crlgen_lex.c.dep.html#base">[3]</a><a href="../mozilla/security/nss/cmd/modutil/lex.Pk11Install_yy.c.dep.html#base">[4]</a><a href="../mozilla/security/nss/cmd/signtool/signtool.c.dep.html#base">[5]</a><a href="../mozilla/security/nss/cmd/signtool/signtool.h.dep.html#base">[6]</a>,
<strong><a name=
"1632"> 1632</a></strong>                                 &amp;pubk-&gt;u.dsa.params.<a href="../mozilla/nsprpub/lib/libc/src/base64.c.dep.html#base">base</a><a href="../mozilla/nsprpub/lib/tests/base64t.c.dep.html#base">[1]</a><a href="../mozilla/nsprpub/pr/tests/xnotify.c.dep.html#base">[2]</a><a href="../mozilla/security/nss/cmd/crlutil/crlgen_lex.c.dep.html#base">[3]</a><a href="../mozilla/security/nss/cmd/modutil/lex.Pk11Install_yy.c.dep.html#base">[4]</a><a href="../mozilla/security/nss/cmd/signtool/signtool.c.dep.html#base">[5]</a><a href="../mozilla/security/nss/cmd/signtool/signtool.h.dep.html#base">[6]</a>);
<strong><a name="1633"> 1633</a></strong>           break;
<strong><a name="1634"> 1634</a></strong>       case keaKey:
<strong><a name="1635"> 1635</a></strong>           <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> = <a href=
"../util/secitem.c.dep.html#SECITEM_CopyItem">SECITEM_CopyItem</a>(arena, &amp;copyk-&gt;u.kea.publicValue,
<strong><a name=
"1636"> 1636</a></strong>                                 &amp;pubk-&gt;u.kea.publicValue);
<strong><a name="1637"> 1637</a></strong>           if (<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> != <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a>/selfse<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a><a href=
"../mozilla/security/nss/cmd/selfse.c.dep.html#SECSuccess">SECSuccess</a>) break;
<strong><a name="1638"> 1638</a></strong>           <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> = <a href=
"../util/secitem.c.dep.html#SECITEM_CopyItem">SECITEM_CopyItem</a>(arena, &amp;copyk-&gt;u.kea.params.hash,
<strong><a name=
"1639"> 1639</a></strong>                                 &amp;pubk-&gt;u.kea.params.hash);
<strong><a name="1640"> 1640</a></strong>           break;
<strong><a name="1641"> 1641</a></strong>       case fortezzaKey:
<strong><a name=
"1642"> 1642</a></strong>           copyk-&gt;u.fortezza.KEAversion = pubk-&gt;u.fortezza.KEAversion;
<strong><a name=
"1643"> 1643</a></strong>           copyk-&gt;u.fortezza.DSSversion = pubk-&gt;u.fortezza.DSSversion;
<strong><a name="1644"> 1644</a></strong>           <a href=
"../util/secport.h.dep.html#PORT_Memcpy">PORT_Memcpy</a>(copyk-&gt;u.fortezza.KMID, pubk-&gt;u.fortezza.KMID,
<strong><a name=
"1645"> 1645</a></strong>                       sizeof(pubk-&gt;u.fortezza.KMID));
<strong><a name="1646"> 1646</a></strong>           <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> = <a href=
"../util/secitem.c.dep.html#SECITEM_CopyItem">SECITEM_CopyItem</a>(arena, &amp;copyk-&gt;u.fortezza.clearance,
<strong><a name=
"1647"> 1647</a></strong>                                 &amp;pubk-&gt;u.fortezza.clearance);
<strong><a name="1648"> 1648</a></strong>           if (<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> != <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a>/selfse<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a><a href=
"../mozilla/security/nss/cmd/selfse.c.dep.html#SECSuccess">SECSuccess</a>) break;
<strong><a name="1649"> 1649</a></strong>           <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> = <a href=
"../util/secitem.c.dep.html#SECITEM_CopyItem">SECITEM_CopyItem</a>(arena, &amp;copyk-&gt;u.fortezza.KEApriviledge,
<strong><a name=
"1650"> 1650</a></strong>                                 &amp;pubk-&gt;u.fortezza.KEApriviledge);
<strong><a name="1651"> 1651</a></strong>           if (<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> != <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a>/selfse<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a><a href=
"../mozilla/security/nss/cmd/selfse.c.dep.html#SECSuccess">SECSuccess</a>) break;
<strong><a name="1652"> 1652</a></strong>           <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> = <a href=
"../util/secitem.c.dep.html#SECITEM_CopyItem">SECITEM_CopyItem</a>(arena, &amp;copyk-&gt;u.fortezza.DSSpriviledge,
<strong><a name=
"1653"> 1653</a></strong>                                 &amp;pubk-&gt;u.fortezza.DSSpriviledge);
<strong><a name="1654"> 1654</a></strong>           if (<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> != <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a>/selfse<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a><a href=
"../mozilla/security/nss/cmd/selfse.c.dep.html#SECSuccess">SECSuccess</a>) break;
<strong><a name="1655"> 1655</a></strong>           <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> = <a href=
"../util/secitem.c.dep.html#SECITEM_CopyItem">SECITEM_CopyItem</a>(arena, &amp;copyk-&gt;u.fortezza.KEAKey,
<strong><a name=
"1656"> 1656</a></strong>                                 &amp;pubk-&gt;u.fortezza.KEAKey);
<strong><a name="1657"> 1657</a></strong>           if (<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> != <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a>/selfse<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a><a href=
"../mozilla/security/nss/cmd/selfse.c.dep.html#SECSuccess">SECSuccess</a>) break;
<strong><a name="1658"> 1658</a></strong>           <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> = <a href=
"../util/secitem.c.dep.html#SECITEM_CopyItem">SECITEM_CopyItem</a>(arena, &amp;copyk-&gt;u.fortezza.DSSKey,
<strong><a name=
"1659"> 1659</a></strong>                                 &amp;pubk-&gt;u.fortezza.DSSKey);
<strong><a name="1660"> 1660</a></strong>           if (<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> != <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a>/selfse<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a><a href=
"../mozilla/security/nss/cmd/selfse.c.dep.html#SECSuccess">SECSuccess</a>) break;
<strong><a name="1661"> 1661</a></strong>           <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> = <a href=
"../util/secitem.c.dep.html#SECITEM_CopyItem">SECITEM_CopyItem</a>(arena, &amp;copyk-&gt;u.fortezza.params.prime,
<strong><a name=
"1662"> 1662</a></strong>                                 &amp;pubk-&gt;u.fortezza.params.prime);
<strong><a name="1663"> 1663</a></strong>           if (<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> != <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a>/selfse<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a><a href=
"../mozilla/security/nss/cmd/selfse.c.dep.html#SECSuccess">SECSuccess</a>) break;
<strong><a name="1664"> 1664</a></strong>           <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> = <a href=
"../util/secitem.c.dep.html#SECITEM_CopyItem">SECITEM_CopyItem</a>(arena, &amp;copyk-&gt;u.fortezza.params.subPrime,
<strong><a name=
"1665"> 1665</a></strong>                                 &amp;pubk-&gt;u.fortezza.params.subPrime);
<strong><a name="1666"> 1666</a></strong>           if (<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> != <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a>/selfse<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a><a href=
"../mozilla/security/nss/cmd/selfse.c.dep.html#SECSuccess">SECSuccess</a>) break;
<strong><a name="1667"> 1667</a></strong>           <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> = <a href=
"../util/secitem.c.dep.html#SECITEM_CopyItem">SECITEM_CopyItem</a>(arena, &amp;copyk-&gt;u.fortezza.params.<a href="../mozilla/nsprpub/lib/libc/src/base64.c.dep.html#base">base</a><a href="../mozilla/nsprpub/lib/tests/base64t.c.dep.html#base">[1]</a><a href="../mozilla/nsprpub/pr/tests/xnotify.c.dep.html#base">[2]</a><a href="../mozilla/security/nss/cmd/crlutil/crlgen_lex.c.dep.html#base">[3]</a><a href="../mozilla/security/nss/cmd/modutil/lex.Pk11Install_yy.c.dep.html#base">[4]</a><a href="../mozilla/security/nss/cmd/signtool/signtool.c.dep.html#base">[5]</a><a href="../mozilla/security/nss/cmd/signtool/signtool.h.dep.html#base">[6]</a>,
<strong><a name=
"1668"> 1668</a></strong>                                 &amp;pubk-&gt;u.fortezza.params.<a href="../mozilla/nsprpub/lib/libc/src/base64.c.dep.html#base">base</a><a href="../mozilla/nsprpub/lib/tests/base64t.c.dep.html#base">[1]</a><a href="../mozilla/nsprpub/pr/tests/xnotify.c.dep.html#base">[2]</a><a href="../mozilla/security/nss/cmd/crlutil/crlgen_lex.c.dep.html#base">[3]</a><a href="../mozilla/security/nss/cmd/modutil/lex.Pk11Install_yy.c.dep.html#base">[4]</a><a href="../mozilla/security/nss/cmd/signtool/signtool.c.dep.html#base">[5]</a><a href="../mozilla/security/nss/cmd/signtool/signtool.h.dep.html#base">[6]</a>);
<strong><a name="1669"> 1669</a></strong>           if (<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> != <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a>/selfse<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a><a href=
"../mozilla/security/nss/cmd/selfse.c.dep.html#SECSuccess">SECSuccess</a>) break;
<strong><a name="1670"> 1670</a></strong>           <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> = <a href=
"../util/secitem.c.dep.html#SECITEM_CopyItem">SECITEM_CopyItem</a>(arena, &amp;copyk-&gt;u.fortezza.keaParams.prime,
<strong><a name=
"1671"> 1671</a></strong>                                 &amp;pubk-&gt;u.fortezza.keaParams.prime);
<strong><a name="1672"> 1672</a></strong>           if (<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> != <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a>/selfse<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a><a href=
"../mozilla/security/nss/cmd/selfse.c.dep.html#SECSuccess">SECSuccess</a>) break;
<strong><a name="1673"> 1673</a></strong>           <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> = <a href=
"../util/secitem.c.dep.html#SECITEM_CopyItem">SECITEM_CopyItem</a>(arena, &amp;copyk-&gt;u.fortezza.keaParams.subPrime,
<strong><a name=
"1674"> 1674</a></strong>                                 &amp;pubk-&gt;u.fortezza.keaParams.subPrime);
<strong><a name="1675"> 1675</a></strong>           if (<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> != <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a>/selfse<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a><a href=
"../mozilla/security/nss/cmd/selfse.c.dep.html#SECSuccess">SECSuccess</a>) break;
<strong><a name="1676"> 1676</a></strong>           <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> = <a href=
"../util/secitem.c.dep.html#SECITEM_CopyItem">SECITEM_CopyItem</a>(arena, &amp;copyk-&gt;u.fortezza.keaParams.<a href="../mozilla/nsprpub/lib/libc/src/base64.c.dep.html#base">base</a><a href="../mozilla/nsprpub/lib/tests/base64t.c.dep.html#base">[1]</a><a href="../mozilla/nsprpub/pr/tests/xnotify.c.dep.html#base">[2]</a><a href="../mozilla/security/nss/cmd/crlutil/crlgen_lex.c.dep.html#base">[3]</a><a href="../mozilla/security/nss/cmd/modutil/lex.Pk11Install_yy.c.dep.html#base">[4]</a><a href="../mozilla/security/nss/cmd/signtool/signtool.c.dep.html#base">[5]</a><a href="../mozilla/security/nss/cmd/signtool/signtool.h.dep.html#base">[6]</a>,
<strong><a name=
"1677"> 1677</a></strong>                                 &amp;pubk-&gt;u.fortezza.keaParams.<a href="../mozilla/nsprpub/lib/libc/src/base64.c.dep.html#base">base</a><a href="../mozilla/nsprpub/lib/tests/base64t.c.dep.html#base">[1]</a><a href="../mozilla/nsprpub/pr/tests/xnotify.c.dep.html#base">[2]</a><a href="../mozilla/security/nss/cmd/crlutil/crlgen_lex.c.dep.html#base">[3]</a><a href="../mozilla/security/nss/cmd/modutil/lex.Pk11Install_yy.c.dep.html#base">[4]</a><a href="../mozilla/security/nss/cmd/signtool/signtool.c.dep.html#base">[5]</a><a href="../mozilla/security/nss/cmd/signtool/signtool.h.dep.html#base">[6]</a>);
<strong><a name="1678"> 1678</a></strong>           break;
<strong><a name="1679"> 1679</a></strong>       case dhKey:
<strong><a name="1680"> 1680</a></strong>           <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> = <a href=
"../util/secitem.c.dep.html#SECITEM_CopyItem">SECITEM_CopyItem</a>(arena,&amp;copyk-&gt;u.dh.prime,&amp;pubk-&gt;u.dh.prime);
<strong><a name="1681"> 1681</a></strong>           if (<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> != <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a>/selfse<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a><a href=
"../mozilla/security/nss/cmd/selfse.c.dep.html#SECSuccess">SECSuccess</a>) break;
<strong><a name="1682"> 1682</a></strong>           <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> = <a href=
"../util/secitem.c.dep.html#SECITEM_CopyItem">SECITEM_CopyItem</a>(arena,&amp;copyk-&gt;u.dh.<a href="../mozilla/nsprpub/lib/libc/src/base64.c.dep.html#base">base</a><a href="../mozilla/nsprpub/lib/tests/base64t.c.dep.html#base">[1]</a><a href="../mozilla/nsprpub/pr/tests/xnotify.c.dep.html#base">[2]</a><a href="../mozilla/security/nss/cmd/crlutil/crlgen_lex.c.dep.html#base">[3]</a><a href="../mozilla/security/nss/cmd/modutil/lex.Pk11Install_yy.c.dep.html#base">[4]</a><a href="../mozilla/security/nss/cmd/signtool/signtool.c.dep.html#base">[5]</a><a href="../mozilla/security/nss/cmd/signtool/signtool.h.dep.html#base">[6]</a>,&amp;pubk-&gt;u.dh.<a href="../mozilla/nsprpub/lib/libc/src/base64.c.dep.html#base">base</a><a href="../mozilla/nsprpub/lib/tests/base64t.c.dep.html#base">[1]</a><a href="../mozilla/nsprpub/pr/tests/xnotify.c.dep.html#base">[2]</a><a href="../mozilla/security/nss/cmd/crlutil/crlgen_lex.c.dep.html#base">[3]</a><a href="../mozilla/security/nss/cmd/modutil/lex.Pk11Install_yy.c.dep.html#base">[4]</a><a href="../mozilla/security/nss/cmd/signtool/signtool.c.dep.html#base">[5]</a><a href="../mozilla/security/nss/cmd/signtool/signtool.h.dep.html#base">[6]</a>);
<strong><a name="1683"> 1683</a></strong>           if (<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> != <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a>/selfse<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a><a href=
"../mozilla/security/nss/cmd/selfse.c.dep.html#SECSuccess">SECSuccess</a>) break;
<strong><a name="1684"> 1684</a></strong>           <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> = <a href=
"../util/secitem.c.dep.html#SECITEM_CopyItem">SECITEM_CopyItem</a>(arena, &amp;copyk-&gt;u.dh.publicValue,
<strong><a name=
"1685"> 1685</a></strong>                                 &amp;pubk-&gt;u.dh.publicValue);
<strong><a name="1686"> 1686</a></strong>           break;
<strong><a name="1687"> 1687</a></strong>       case ecKey:
<strong><a name="1688"> 1688</a></strong>           copyk-&gt;u.ec.<a href=
"../mozilla/security/nss/cmd/crlutil/crlgen_lex.c.dep.html#size">size</a><a href="../mozilla/security/nss/cmd/modutil/lex.Pk11Install_yy.c.dep.html#size">[4]</a><a href="../mozilla/security/nss/cmd/zlib/deflate.c.dep.html#size">[8]</a><a href="../mozilla/security/nss/cmd/zlib/zutil.c.dep.html#size">[9]</a> = pubk-&gt;u.ec.<a href="../mozilla/security/nss/cmd/crlutil/crlgen_lex.c.dep.html#size">size</a><a href="../mozilla/security/nss/cmd/modutil/lex.Pk11Install_yy.c.dep.html#size">[4]</a><a href="../mozilla/security/nss/cmd/zlib/deflate.c.dep.html#size">[8]</a><a href="../mozilla/security/nss/cmd/zlib/zutil.c.dep.html#size">[9]</a>;
<strong><a name="1689"> 1689</a></strong>           <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> = <a href=
"../util/secitem.c.dep.html#SECITEM_CopyItem">SECITEM_CopyItem</a>(arena,&amp;copyk-&gt;u.ec.DEREncodedParams,
<strong><a name=
"1690"> 1690</a></strong>                                 &amp;pubk-&gt;u.ec.DEREncodedParams);
<strong><a name="1691"> 1691</a></strong>           if (<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> != <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a>/selfse<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a><a href=
"../mozilla/security/nss/cmd/selfse.c.dep.html#SECSuccess">SECSuccess</a>) break;
<strong><a name="1692"> 1692</a></strong>           <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> = <a href=
"../util/secitem.c.dep.html#SECITEM_CopyItem">SECITEM_CopyItem</a>(arena,&amp;copyk-&gt;u.ec.publicValue,
<strong><a name=
"1693"> 1693</a></strong>                                 &amp;pubk-&gt;u.ec.publicValue);
<strong><a name="1694"> 1694</a></strong>           break;
<strong><a name="1695"> 1695</a></strong>       case nullKey:
<strong><a name="1696"> 1696</a></strong>           return copyk;
<strong><a name="1697"> 1697</a></strong>       default:
<strong><a name="1698"> 1698</a></strong>           <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> = SECFailure;
<strong><a name="1699"> 1699</a></strong>           break;
<strong><a name="1700"> 1700</a></strong>     }
<strong><a name="1701"> 1701</a></strong>     if (<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> == <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a>/selfse<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a><a href=
"../mozilla/security/nss/cmd/selfse.c.dep.html#SECSuccess">SECSuccess</a>)
<strong><a name="1702"> 1702</a></strong>         return copyk;
<strong><a name="1703"> 1703</a></strong>
<strong><a name="1704"> 1704</a></strong>     <a href=
"../cryptohi/seckey.c.dep.html#SECKEY_DestroyPublicKey">SECKEY_DestroyPublicKey</a> (copyk);
<strong><a name="1705"> 1705</a></strong>     return <a href=
"../mozilla/dbm/include/ncompat.h.dep.html#NULL">NULL</a>;
<strong><a name="1706"> 1706</a></strong> }
<strong><a name="1707"> 1707</a></strong>
<strong><a name="1708"> 1708</a></strong>
<strong><a name="1709"> 1709</a></strong> <a href=
"../cryptohi/keythi.h.dep.html#SECKEYPublicKey">SECKEYPublicKey</a> *
<strong><a name="1710"> 1710</a></strong> <a href=
"#1710">SECKEY_ConvertToPublicKey</a>(<a href=
"../cryptohi/keythi.h.dep.html#SECKEYPrivateKey">SECKEYPrivateKey</a> *privk)
<strong><a name="1711"> 1711</a></strong> {
<strong><a name="1712"> 1712</a></strong>     <a href=
"../cryptohi/keythi.h.dep.html#SECKEYPublicKey">SECKEYPublicKey</a> *pubk;
<strong><a name="1713"> 1713</a></strong>     <a href=
"../mozilla/nsprpub/pr/include/obsolete/protypes.h.dep.html#PRArenaPool">PRArenaPool</a> *arena;
<strong><a name="1714"> 1714</a></strong>     <a href=
"../mozilla/security/nss/cmd/SSLsample/server.c.dep.html#cert">cert</a>db/<a href="../mozilla/security/nss/cmd/SSLsample/server.c.dep.html#cert">cert</a><a href="../t.h.dep.html#CERTCertificate">CERTCertificate</a> *<a href="../mozilla/security/nss/cmd/SSLsample/server.c.dep.html#cert">cert</a>;
<strong><a name="1715"> 1715</a></strong>     <a href=
"../util/seccomon.h.dep.html#SECStatus">SECStatus</a> <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a>;
<strong><a name="1716"> 1716</a></strong>
<strong><a name="1717"> 1717</a></strong>     /*
<strong><a name="1718"> 1718</a></strong>      * First try to look up the cert.
<strong><a name="1719"> 1719</a></strong>      */
<strong><a name="1720"> 1720</a></strong>     <a href=
"../mozilla/security/nss/cmd/SSLsample/server.c.dep.html#cert">cert</a> = <a href="../pk11wrap/pk11cert.c.dep.html#PK11_GetCertFromPrivateKey">PK11_GetCertFromPrivateKey</a>(privk);
<strong><a name="1721"> 1721</a></strong>     if (<a href=
"../mozilla/security/nss/cmd/SSLsample/server.c.dep.html#cert">cert</a>) {
<strong><a name="1722"> 1722</a></strong>         pubk = <a href=
"../cryptohi/seckey.c.dep.html#CERT_ExtractPublicKey">CERT_ExtractPublicKey</a>(<a href="../mozilla/security/nss/cmd/SSLsample/server.c.dep.html#cert">cert</a>);
<strong><a name="1723"> 1723</a></strong>         <a href=
"../mozilla/security/nss/cmd/SSLsample/server.c.dep.html#cert">cert</a>db/stanp<a href="../mozilla/security/nss/cmd/SSLsample/server.c.dep.html#cert">cert</a><a href="../db.c.dep.html#CERT_DestroyCertificate">CERT_DestroyCertificate</a>(<a href="../mozilla/security/nss/cmd/SSLsample/server.c.dep.html#cert">cert</a>);
<strong><a name="1724"> 1724</a></strong>         return pubk;
<strong><a name="1725"> 1725</a></strong>     }
<strong><a name="1726"> 1726</a></strong>
<strong><a name=
"1727"> 1727</a></strong>     /* couldn't find the cert, build pub key by hand */
<strong><a name="1728"> 1728</a></strong>     arena = <a href=
"../util/secport.c.dep.html#PORT_NewArena">PORT_NewArena</a> (<a href=
"../util/secdert.h.dep.html#DER_DEFAULT_CHUNKSIZE">DER_DEFAULT_CHUNKSIZE</a>);
<strong><a name="1729"> 1729</a></strong>     if (arena == <a href=
"../mozilla/dbm/include/ncompat.h.dep.html#NULL">NULL</a>) {
<strong><a name="1730"> 1730</a></strong>         <a href=
"../util/secport.c.dep.html#PORT_SetError">PORT_SetError</a> (SEC_ERROR_NO_MEMORY);
<strong><a name="1731"> 1731</a></strong>         return <a href=
"../mozilla/dbm/include/ncompat.h.dep.html#NULL">NULL</a>;
<strong><a name="1732"> 1732</a></strong>     }
<strong><a name="1733"> 1733</a></strong>     pubk = (<a href=
"../cryptohi/keythi.h.dep.html#SECKEYPublicKey">SECKEYPublicKey</a> *)<a href=
"../util/secport.c.dep.html#PORT_ArenaZAlloc">PORT_ArenaZAlloc</a>(arena,
<strong><a name=
"1734"> 1734</a></strong>                                                    sizeof (<a href="../cryptohi/keythi.h.dep.html#SECKEYPublicKey">SECKEYPublicKey</a>));
<strong><a name="1735"> 1735</a></strong>     if (pubk == <a href=
"../mozilla/dbm/include/ncompat.h.dep.html#NULL">NULL</a>) {
<strong><a name="1736"> 1736</a></strong>         <a href=
"../util/secport.c.dep.html#PORT_FreeArena">PORT_FreeArena</a>(arena,<a href=
"../mozilla/nsprpub/pr/include/prtypes.h.dep.html#PR_FALSE">PR_FALSE</a>);
<strong><a name="1737"> 1737</a></strong>         return <a href=
"../mozilla/dbm/include/ncompat.h.dep.html#NULL">NULL</a>;
<strong><a name="1738"> 1738</a></strong>     }
<strong><a name=
"1739"> 1739</a></strong>     pubk-&gt;keyType = privk-&gt;keyType;
<strong><a name="1740"> 1740</a></strong>     pubk-&gt;pkcs11Slot = <a href=
"../mozilla/dbm/include/ncompat.h.dep.html#NULL">NULL</a>;
<strong><a name="1741"> 1741</a></strong>     pubk-&gt;pkcs11ID = <a href=
"../softoken/pkcs11t.h.dep.html#CK_INVALID_HANDLE">CK_INVALID_HANDLE</a>;
<strong><a name="1742"> 1742</a></strong>     pubk-&gt;arena = arena;
<strong><a name="1743"> 1743</a></strong>
<strong><a name="1744"> 1744</a></strong>     /*
<strong><a name=
"1745"> 1745</a></strong>      * fortezza is at the head of this switch, since we don't want to
<strong><a name=
"1746"> 1746</a></strong>      * allocate an arena... CERT_ExtractPublicKey will to that for us.
<strong><a name="1747"> 1747</a></strong>      */
<strong><a name="1748"> 1748</a></strong>     switch(privk-&gt;keyType) {
<strong><a name="1749"> 1749</a></strong>       case fortezzaKey:
<strong><a name="1750"> 1750</a></strong>       case nullKey:
<strong><a name="1751"> 1751</a></strong>       case dhKey:
<strong><a name="1752"> 1752</a></strong>       case dsaKey:
<strong><a name=
"1753"> 1753</a></strong>         /* Nothing to query, if the cert isn't there, we're done -- no way
<strong><a name="1754"> 1754</a></strong>          * to get the public key */
<strong><a name="1755"> 1755</a></strong>         break;
<strong><a name="1756"> 1756</a></strong>       case rsaKey:
<strong><a name="1757"> 1757</a></strong>         <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> = <a href=
"../pk11wrap/pk11obj.c.dep.html#PK11_ReadAttribute">PK11_ReadAttribute</a>(privk-&gt;pkcs11Slot,privk-&gt;pkcs11ID,
<strong><a name=
"1758"> 1758</a></strong>                                 <a href=
"../softoken/pkcs11t.h.dep.html#CKA_MODULUS">CKA_MODULUS</a>,arena,&amp;pubk-&gt;u.rsa.modulus);
<strong><a name="1759"> 1759</a></strong>         if (<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> != <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a>/selfse<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a><a href=
"../mozilla/security/nss/cmd/selfse.c.dep.html#SECSuccess">SECSuccess</a>)  break;
<strong><a name="1760"> 1760</a></strong>         <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> = <a href=
"../pk11wrap/pk11obj.c.dep.html#PK11_ReadAttribute">PK11_ReadAttribute</a>(privk-&gt;pkcs11Slot,privk-&gt;pkcs11ID,
<strong><a name="1761"> 1761</a></strong>                         <a href=
"../softoken/pkcs11t.h.dep.html#CKA_PUBLIC_EXPONENT">CKA_PUBLIC_EXPONENT</a>,arena,&amp;pubk-&gt;u.rsa.publicExponent);
<strong><a name="1762"> 1762</a></strong>         if (<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> != <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a>/selfse<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a><a href=
"../mozilla/security/nss/cmd/selfse.c.dep.html#SECSuccess">SECSuccess</a>)  break;
<strong><a name="1763"> 1763</a></strong>         return pubk;
<strong><a name="1764"> 1764</a></strong>         break;
<strong><a name="1765"> 1765</a></strong>     default:
<strong><a name="1766"> 1766</a></strong>         break;
<strong><a name="1767"> 1767</a></strong>     }
<strong><a name="1768"> 1768</a></strong>
<strong><a name="1769"> 1769</a></strong>     <a href=
"../util/secport.c.dep.html#PORT_FreeArena">PORT_FreeArena</a> (arena, <a href=
"../mozilla/nsprpub/pr/include/prtypes.h.dep.html#PR_FALSE">PR_FALSE</a>);
<strong><a name="1770"> 1770</a></strong>     return <a href=
"../mozilla/dbm/include/ncompat.h.dep.html#NULL">NULL</a>;
<strong><a name="1771"> 1771</a></strong> }
<strong><a name="1772"> 1772</a></strong>
<strong><a name="1773"> 1773</a></strong> <a href=
"../certdb/certt.h.dep.html#CERTSubjectPublicKeyInfo">CERTSubjectPublicKeyInfo</a> *
<strong><a name="1774"> 1774</a></strong> <a href=
"#1774">SECKEY_CreateSubjectPublicKeyInfo</a>(<a href=
"../cryptohi/keythi.h.dep.html#SECKEYPublicKey">SECKEYPublicKey</a> *pubk)
<strong><a name="1775"> 1775</a></strong> {
<strong><a name="1776"> 1776</a></strong>     <a href=
"../certdb/certt.h.dep.html#CERTSubjectPublicKeyInfo">CERTSubjectPublicKeyInfo</a> *spki;
<strong><a name="1777"> 1777</a></strong>     <a href=
"../mozilla/nsprpub/pr/include/obsolete/protypes.h.dep.html#PRArenaPool">PRArenaPool</a> *arena;
<strong><a name="1778"> 1778</a></strong>     <a href=
"../util/seccomon.h.dep.html#SECItem">SECItem</a> params = { siBuffer, <a href=
"../mozilla/dbm/include/ncompat.h.dep.html#NULL">NULL</a>, 0 };
<strong><a name="1779"> 1779</a></strong>
<strong><a name="1780"> 1780</a></strong>     arena = <a href=
"../util/secport.c.dep.html#PORT_NewArena">PORT_NewArena</a>(<a href=
"../util/secdert.h.dep.html#DER_DEFAULT_CHUNKSIZE">DER_DEFAULT_CHUNKSIZE</a>);
<strong><a name="1781"> 1781</a></strong>     if (arena == <a href=
"../mozilla/dbm/include/ncompat.h.dep.html#NULL">NULL</a>) {
<strong><a name="1782"> 1782</a></strong>         <a href=
"../util/secport.c.dep.html#PORT_SetError">PORT_SetError</a>(SEC_ERROR_NO_MEMORY);
<strong><a name="1783"> 1783</a></strong>         return <a href=
"../mozilla/dbm/include/ncompat.h.dep.html#NULL">NULL</a>;
<strong><a name="1784"> 1784</a></strong>     }
<strong><a name="1785"> 1785</a></strong>
<strong><a name="1786"> 1786</a></strong>     spki = (<a href=
"../certdb/certt.h.dep.html#CERTSubjectPublicKeyInfo">CERTSubjectPublicKeyInfo</a> *) <a href="../util/secport.c.dep.html#PORT_ArenaZAlloc">PORT_ArenaZAlloc</a>(arena, sizeof (*spki));
<strong><a name="1787"> 1787</a></strong>     if (spki != <a href=
"../mozilla/dbm/include/ncompat.h.dep.html#NULL">NULL</a>) {
<strong><a name="1788"> 1788</a></strong>         <a href=
"../util/seccomon.h.dep.html#SECStatus">SECStatus</a> <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a>;
<strong><a name="1789"> 1789</a></strong>         <a href=
"../util/seccomon.h.dep.html#SECItem">SECItem</a> *rv_item;
<strong><a name="1790"> 1790</a></strong>
<strong><a name="1791"> 1791</a></strong>         spki-&gt;arena = arena;
<strong><a name="1792"> 1792</a></strong>         switch(pubk-&gt;keyType) {
<strong><a name="1793"> 1793</a></strong>           case rsaKey:
<strong><a name="1794"> 1794</a></strong>             <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> = <a href=
"../util/secalgid.c.dep.html#SECOID_SetAlgorithmID">SECOID_SetAlgorithmID</a>(arena, &amp;spki-&gt;algorithm,
<strong><a name=
"1795"> 1795</a></strong>                                      SEC_OID_PKCS1_RSA_ENCRYPTION, 0);
<strong><a name="1796"> 1796</a></strong>             if (<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> == <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a>/selfse<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a><a href=
"../mozilla/security/nss/cmd/selfse.c.dep.html#SECSuccess">SECSuccess</a>) {
<strong><a name="1797"> 1797</a></strong>                 /*
<strong><a name=
"1798"> 1798</a></strong>                  * DER encode the public key into the subjectPublicKeyInfo.
<strong><a name="1799"> 1799</a></strong>                  */
<strong><a name="1800"> 1800</a></strong>                 <a href=
"../cryptohi/seckey.c.dep.html#prepare_rsa_pub_key_for_asn1">prepare_rsa_pub_key_for_asn1</a>(pubk);
<strong><a name="1801"> 1801</a></strong>                 rv_item = <a href=
"../util/secasn1e.c.dep.html#SEC_ASN1EncodeItem">SEC_ASN1EncodeItem</a>(arena, &amp;spki-&gt;subjectPublicKey,
<strong><a name=
"1802"> 1802</a></strong>                                              pubk, <a href="../cryptohi/keythi.h.dep.html#SECKEY_RSAPublicKeyTemplate">SECKEY_RSAPublicKeyTemplate</a><a href="../cryptohi/seckey.c.dep.html#SECKEY_RSAPublicKeyTemplate">[1]</a>);
<strong><a name=
"1803"> 1803</a></strong>                 if (rv_item != <a href=
"../mozilla/dbm/include/ncompat.h.dep.html#NULL">NULL</a>) {
<strong><a name="1804"> 1804</a></strong>                     /*
<strong><a name=
"1805"> 1805</a></strong>                      * The stored value is supposed to be a BIT_STRING,
<strong><a name=
"1806"> 1806</a></strong>                      * so convert the length.
<strong><a name="1807"> 1807</a></strong>                      */
<strong><a name=
"1808"> 1808</a></strong>                     spki-&gt;subjectPublicKey.<a href="../mozilla/security/nss/cmd/crlutil/crlgen_lex.c.dep.html#len">len</a><a href="../mozilla/security/nss/cmd/modutil/lex.Pk11Install_yy.c.dep.html#len">[1]</a><a href="../mozilla/security/nss/cmd/zlib/adler32.c.dep.html#len">[2]</a><a href="../mozilla/security/nss/cmd/zlib/crc32.c.dep.html#len">[3]</a><a href="../mozilla/security/nss/cmd/zlib/gzio.c.dep.html#len">[6]</a><a href="../mozilla/security/nss/cmd/zlib/inflate.c.dep.html#len">[9]</a><a href="../mozilla/security/nss/cmd/zlib/trees.c.dep.html#len">[10]</a><a href="../mozilla/security/nss/cmd/zlib/zutil.c.dep.html#len">[13]</a> &lt;&lt;= 3;
<strong><a name="1809"> 1809</a></strong>                     /*
<strong><a name=
"1810"> 1810</a></strong>                      * We got a good one; return it.
<strong><a name="1811"> 1811</a></strong>                      */
<strong><a name="1812"> 1812</a></strong>                     return spki;
<strong><a name="1813"> 1813</a></strong>                 }
<strong><a name="1814"> 1814</a></strong>             }
<strong><a name="1815"> 1815</a></strong>             break;
<strong><a name="1816"> 1816</a></strong>           case dsaKey:
<strong><a name=
"1817"> 1817</a></strong>             /* DER encode the params. */
<strong><a name="1818"> 1818</a></strong>             <a href=
"../cryptohi/seckey.c.dep.html#prepare_pqg_params_for_asn1">prepare_pqg_params_for_asn1</a>(&amp;pubk-&gt;u.dsa.params);
<strong><a name="1819"> 1819</a></strong>             rv_item = <a href=
"../util/secasn1e.c.dep.html#SEC_ASN1EncodeItem">SEC_ASN1EncodeItem</a>(arena, &amp;params, &amp;pubk-&gt;u.dsa.params,
<strong><a name=
"1820"> 1820</a></strong>                                          <a href=
"../mozilla/security/nss/cmd/certutil/keystuff.c.dep.html#SECKEY_PQGParamsTemplate">SECKEY_PQGParamsTemplate</a><a href="../cryptohi/keythi.h.dep.html#SECKEY_PQGParamsTemplate">[1]</a><a href="../cryptohi/seckey.c.dep.html#SECKEY_PQGParamsTemplate">[2]</a>);
<strong><a name="1821"> 1821</a></strong>             if (rv_item != <a href=
"../mozilla/dbm/include/ncompat.h.dep.html#NULL">NULL</a>) {
<strong><a name="1822"> 1822</a></strong>                 <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> = <a href=
"../util/secalgid.c.dep.html#SECOID_SetAlgorithmID">SECOID_SetAlgorithmID</a>(arena, &amp;spki-&gt;algorithm,
<strong><a name=
"1823"> 1823</a></strong>                                            SEC_OID_ANSIX9_DSA_SIGNATURE,
<strong><a name=
"1824"> 1824</a></strong>                                            &amp;params);
<strong><a name="1825"> 1825</a></strong>                 if (<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> == <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a>/selfse<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a><a href=
"../mozilla/security/nss/cmd/selfse.c.dep.html#SECSuccess">SECSuccess</a>) {
<strong><a name="1826"> 1826</a></strong>                     /*
<strong><a name=
"1827"> 1827</a></strong>                      * DER encode the public key into the subjectPublicKeyInfo.
<strong><a name="1828"> 1828</a></strong>                      */
<strong><a name="1829"> 1829</a></strong>                     <a href=
"../cryptohi/seckey.c.dep.html#prepare_dsa_pub_key_for_asn1">prepare_dsa_pub_key_for_asn1</a>(pubk);
<strong><a name=
"1830"> 1830</a></strong>                     rv_item = <a href="../util/secasn1e.c.dep.html#SEC_ASN1EncodeItem">SEC_ASN1EncodeItem</a>(arena, &amp;spki-&gt;subjectPublicKey,
<strong><a name=
"1831"> 1831</a></strong>                                                  pubk,
<strong><a name=
"1832"> 1832</a></strong>                                                  <a href="../cryptohi/keythi.h.dep.html#SECKEY_DSAPublicKeyTemplate">SECKEY_DSAPublicKeyTemplate</a><a href="../cryptohi/seckey.c.dep.html#SECKEY_DSAPublicKeyTemplate">[1]</a>);
<strong><a name=
"1833"> 1833</a></strong>                     if (rv_item != <a href=
"../mozilla/dbm/include/ncompat.h.dep.html#NULL">NULL</a>) {
<strong><a name="1834"> 1834</a></strong>                         /*
<strong><a name=
"1835"> 1835</a></strong>                          * The stored value is supposed to be a BIT_STRING,
<strong><a name=
"1836"> 1836</a></strong>                          * so convert the length.
<strong><a name="1837"> 1837</a></strong>                          */
<strong><a name=
"1838"> 1838</a></strong>                         spki-&gt;subjectPublicKey.<a href="../mozilla/security/nss/cmd/crlutil/crlgen_lex.c.dep.html#len">len</a><a href="../mozilla/security/nss/cmd/modutil/lex.Pk11Install_yy.c.dep.html#len">[1]</a><a href="../mozilla/security/nss/cmd/zlib/adler32.c.dep.html#len">[2]</a><a href="../mozilla/security/nss/cmd/zlib/crc32.c.dep.html#len">[3]</a><a href="../mozilla/security/nss/cmd/zlib/gzio.c.dep.html#len">[6]</a><a href="../mozilla/security/nss/cmd/zlib/inflate.c.dep.html#len">[9]</a><a href="../mozilla/security/nss/cmd/zlib/trees.c.dep.html#len">[10]</a><a href="../mozilla/security/nss/cmd/zlib/zutil.c.dep.html#len">[13]</a> &lt;&lt;= 3;
<strong><a name="1839"> 1839</a></strong>                         /*
<strong><a name=
"1840"> 1840</a></strong>                          * We got a good one; return it.
<strong><a name="1841"> 1841</a></strong>                          */
<strong><a name="1842"> 1842</a></strong>                         return spki;
<strong><a name="1843"> 1843</a></strong>                     }
<strong><a name="1844"> 1844</a></strong>                 }
<strong><a name="1845"> 1845</a></strong>             }
<strong><a name="1846"> 1846</a></strong>             <a href=
"../util/secitem.c.dep.html#SECITEM_FreeItem">SECITEM_FreeItem</a>(&amp;params, <a href="../mozilla/nsprpub/pr/include/prtypes.h.dep.html#PR_FALSE">PR_FALSE</a>);
<strong><a name="1847"> 1847</a></strong>             break;
<strong><a name="1848"> 1848</a></strong>           case ecKey:
<strong><a name="1849"> 1849</a></strong>             <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> = <a href=
"../util/secitem.c.dep.html#SECITEM_CopyItem">SECITEM_CopyItem</a>(arena, &amp;params,
<strong><a name=
"1850"> 1850</a></strong>                                   &amp;pubk-&gt;u.ec.DEREncodedParams);
<strong><a name="1851"> 1851</a></strong>             if (<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> != <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a>/selfse<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a><a href=
"../mozilla/security/nss/cmd/selfse.c.dep.html#SECSuccess">SECSuccess</a>) break;
<strong><a name="1852"> 1852</a></strong>
<strong><a name="1853"> 1853</a></strong>             <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> = <a href=
"../util/secalgid.c.dep.html#SECOID_SetAlgorithmID">SECOID_SetAlgorithmID</a>(arena, &amp;spki-&gt;algorithm,
<strong><a name=
"1854"> 1854</a></strong>                                        SEC_OID_ANSIX962_EC_PUBLIC_KEY,
<strong><a name=
"1855"> 1855</a></strong>                                        &amp;params);
<strong><a name="1856"> 1856</a></strong>             if (<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> != <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a>/selfse<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a><a href=
"../mozilla/security/nss/cmd/selfse.c.dep.html#SECSuccess">SECSuccess</a>) break;
<strong><a name="1857"> 1857</a></strong>
<strong><a name="1858"> 1858</a></strong>             <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> = <a href=
"../util/secitem.c.dep.html#SECITEM_CopyItem">SECITEM_CopyItem</a>(arena, &amp;spki-&gt;subjectPublicKey,
<strong><a name=
"1859"> 1859</a></strong>                                   &amp;pubk-&gt;u.ec.publicValue);
<strong><a name="1860"> 1860</a></strong>
<strong><a name="1861"> 1861</a></strong>             if (<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> == <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a>/selfse<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a><a href=
"../mozilla/security/nss/cmd/selfse.c.dep.html#SECSuccess">SECSuccess</a>) {
<strong><a name="1862"> 1862</a></strong>                 /*
<strong><a name=
"1863"> 1863</a></strong>                  * The stored value is supposed to be a BIT_STRING,
<strong><a name=
"1864"> 1864</a></strong>                  * so convert the length.
<strong><a name="1865"> 1865</a></strong>                  */
<strong><a name=
"1866"> 1866</a></strong>                 spki-&gt;subjectPublicKey.<a href=
"../mozilla/security/nss/cmd/crlutil/crlgen_lex.c.dep.html#len">len</a><a href=
"../mozilla/security/nss/cmd/modutil/lex.Pk11Install_yy.c.dep.html#len">[1]</a><a href="../mozilla/security/nss/cmd/zlib/adler32.c.dep.html#len">[2]</a><a href="../mozilla/security/nss/cmd/zlib/crc32.c.dep.html#len">[3]</a><a href="../mozilla/security/nss/cmd/zlib/gzio.c.dep.html#len">[6]</a><a href="../mozilla/security/nss/cmd/zlib/inflate.c.dep.html#len">[9]</a><a href="../mozilla/security/nss/cmd/zlib/trees.c.dep.html#len">[10]</a><a href="../mozilla/security/nss/cmd/zlib/zutil.c.dep.html#len">[13]</a> &lt;&lt;= 3;
<strong><a name="1867"> 1867</a></strong>                 /*
<strong><a name=
"1868"> 1868</a></strong>                  * We got a good one; return it.
<strong><a name="1869"> 1869</a></strong>                  */
<strong><a name="1870"> 1870</a></strong>                 return spki;
<strong><a name="1871"> 1871</a></strong>             }
<strong><a name="1872"> 1872</a></strong>             break;
<strong><a name="1873"> 1873</a></strong>           case keaKey:
<strong><a name="1874"> 1874</a></strong>           case dhKey: /* later... */
<strong><a name="1875"> 1875</a></strong>
<strong><a name="1876"> 1876</a></strong>           break;
<strong><a name="1877"> 1877</a></strong>           case fortezzaKey:
<strong><a name="1878"> 1878</a></strong> #ifdef notdef
<strong><a name=
"1879"> 1879</a></strong>             /* encode the DSS parameters (PQG) */
<strong><a name="1880"> 1880</a></strong>             <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> = FortezzaBuildParams(&amp;params,pubk);
<strong><a name="1881"> 1881</a></strong>             if (<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> != <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a>/selfse<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a><a href=
"../mozilla/security/nss/cmd/selfse.c.dep.html#SECSuccess">SECSuccess</a>) break;
<strong><a name="1882"> 1882</a></strong>
<strong><a name="1883"> 1883</a></strong>             /* set the algorithm */
<strong><a name="1884"> 1884</a></strong>             <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> = <a href=
"../util/secalgid.c.dep.html#SECOID_SetAlgorithmID">SECOID_SetAlgorithmID</a>(arena, &amp;spki-&gt;algorithm,
<strong><a name=
"1885"> 1885</a></strong>                                        SEC_OID_MISSI_KEA_DSS, &amp;params);
<strong><a name="1886"> 1886</a></strong>             <a href=
"../util/secport.c.dep.html#PORT_Free">PORT_Free</a>(params.<a href=
"../mozilla/security/nss/tests/pkcs11/netscape/suites/security/ssl/ssls.c.dep.html#data">data</a><a href="../mozilla/security/nss/tests/pkcs11/netscape/suites/security/ssl/ssls.h.dep.html#data">[2]</a>);
<strong><a name="1887"> 1887</a></strong>             if (<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> == <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a>/selfse<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a><a href=
"../mozilla/security/nss/cmd/selfse.c.dep.html#SECSuccess">SECSuccess</a>) {
<strong><a name="1888"> 1888</a></strong>                 /*
<strong><a name=
"1889"> 1889</a></strong>                  * Encode the public key into the subjectPublicKeyInfo.
<strong><a name=
"1890"> 1890</a></strong>                  * Fortezza key material is not standard DER
<strong><a name="1891"> 1891</a></strong>                  */
<strong><a name="1892"> 1892</a></strong>                 <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> = FortezzaEncodeCertKey(arena,&amp;spki-&gt;subjectPublicKey,pubk);
<strong><a name="1893"> 1893</a></strong>                 if (<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> == <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a>/selfse<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a><a href=
"../mozilla/security/nss/cmd/selfse.c.dep.html#SECSuccess">SECSuccess</a>) {
<strong><a name="1894"> 1894</a></strong>                     /*
<strong><a name=
"1895"> 1895</a></strong>                      * The stored value is supposed to be a BIT_STRING,
<strong><a name=
"1896"> 1896</a></strong>                      * so convert the length.
<strong><a name="1897"> 1897</a></strong>                      */
<strong><a name=
"1898"> 1898</a></strong>                     spki-&gt;subjectPublicKey.<a href="../mozilla/security/nss/cmd/crlutil/crlgen_lex.c.dep.html#len">len</a><a href="../mozilla/security/nss/cmd/modutil/lex.Pk11Install_yy.c.dep.html#len">[1]</a><a href="../mozilla/security/nss/cmd/zlib/adler32.c.dep.html#len">[2]</a><a href="../mozilla/security/nss/cmd/zlib/crc32.c.dep.html#len">[3]</a><a href="../mozilla/security/nss/cmd/zlib/gzio.c.dep.html#len">[6]</a><a href="../mozilla/security/nss/cmd/zlib/inflate.c.dep.html#len">[9]</a><a href="../mozilla/security/nss/cmd/zlib/trees.c.dep.html#len">[10]</a><a href="../mozilla/security/nss/cmd/zlib/zutil.c.dep.html#len">[13]</a> &lt;&lt;= 3;
<strong><a name="1899"> 1899</a></strong>
<strong><a name="1900"> 1900</a></strong>                     /*
<strong><a name=
"1901"> 1901</a></strong>                      * We got a good one; return it.
<strong><a name="1902"> 1902</a></strong>                      */
<strong><a name="1903"> 1903</a></strong>                     return spki;
<strong><a name="1904"> 1904</a></strong>                 }
<strong><a name="1905"> 1905</a></strong>             }
<strong><a name="1906"> 1906</a></strong> #endif
<strong><a name="1907"> 1907</a></strong>             break;
<strong><a name="1908"> 1908</a></strong>           default:
<strong><a name="1909"> 1909</a></strong>             break;
<strong><a name="1910"> 1910</a></strong>         }
<strong><a name="1911"> 1911</a></strong>     } else {
<strong><a name="1912"> 1912</a></strong>         <a href=
"../util/secport.c.dep.html#PORT_SetError">PORT_SetError</a>(SEC_ERROR_NO_MEMORY);
<strong><a name="1913"> 1913</a></strong>     }
<strong><a name="1914"> 1914</a></strong>
<strong><a name="1915"> 1915</a></strong>     <a href=
"../util/secport.c.dep.html#PORT_FreeArena">PORT_FreeArena</a>(arena, <a href=
"../mozilla/nsprpub/pr/include/prtypes.h.dep.html#PR_FALSE">PR_FALSE</a>);
<strong><a name="1916"> 1916</a></strong>     return <a href=
"../mozilla/dbm/include/ncompat.h.dep.html#NULL">NULL</a>;
<strong><a name="1917"> 1917</a></strong> }
<strong><a name="1918"> 1918</a></strong>
<strong><a name="1919"> 1919</a></strong> void
<strong><a name="1920"> 1920</a></strong> <a href=
"#1920">SECKEY_DestroySubjectPublicKeyInfo</a>(<a href=
"../certdb/certt.h.dep.html#CERTSubjectPublicKeyInfo">CERTSubjectPublicKeyInfo</a> *spki)
<strong><a name="1921"> 1921</a></strong> {
<strong><a name=
"1922"> 1922</a></strong>     if (spki &amp;&amp; spki-&gt;arena) {
<strong><a name="1923"> 1923</a></strong>         <a href=
"../util/secport.c.dep.html#PORT_FreeArena">PORT_FreeArena</a>(spki-&gt;arena, <a href="../mozilla/nsprpub/pr/include/prtypes.h.dep.html#PR_FALSE">PR_FALSE</a>);
<strong><a name="1924"> 1924</a></strong>     }
<strong><a name="1925"> 1925</a></strong> }
<strong><a name="1926"> 1926</a></strong>
<strong><a name="1927"> 1927</a></strong> /*
<strong><a name=
"1928"> 1928</a></strong>  * this only works for RSA keys... need to do something
<strong><a name=
"1929"> 1929</a></strong>  * similiar to CERT_ExtractPublicKey for other key times.
<strong><a name="1930"> 1930</a></strong>  */
<strong><a name="1931"> 1931</a></strong> <a href=
"../cryptohi/keythi.h.dep.html#SECKEYPublicKey">SECKEYPublicKey</a> *
<strong><a name="1932"> 1932</a></strong> <a href=
"#1932">SECKEY_DecodeDERPublicKey</a>(<a href=
"../util/seccomon.h.dep.html#SECItem">SECItem</a> *pubkder)
<strong><a name="1933"> 1933</a></strong> {
<strong><a name="1934"> 1934</a></strong>     <a href=
"../mozilla/nsprpub/pr/include/obsolete/protypes.h.dep.html#PRArenaPool">PRArenaPool</a> *arena;
<strong><a name="1935"> 1935</a></strong>     <a href=
"../cryptohi/keythi.h.dep.html#SECKEYPublicKey">SECKEYPublicKey</a> *pubk;
<strong><a name="1936"> 1936</a></strong>     <a href=
"../util/seccomon.h.dep.html#SECStatus">SECStatus</a> <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a>;
<strong><a name="1937"> 1937</a></strong>     <a href=
"../util/seccomon.h.dep.html#SECItem">SECItem</a> newPubkder;
<strong><a name="1938"> 1938</a></strong>
<strong><a name="1939"> 1939</a></strong>     arena = <a href=
"../util/secport.c.dep.html#PORT_NewArena">PORT_NewArena</a> (<a href=
"../util/secdert.h.dep.html#DER_DEFAULT_CHUNKSIZE">DER_DEFAULT_CHUNKSIZE</a>);
<strong><a name="1940"> 1940</a></strong>     if (arena == <a href=
"../mozilla/dbm/include/ncompat.h.dep.html#NULL">NULL</a>) {
<strong><a name="1941"> 1941</a></strong>         <a href=
"../util/secport.c.dep.html#PORT_SetError">PORT_SetError</a> (SEC_ERROR_NO_MEMORY);
<strong><a name="1942"> 1942</a></strong>         return <a href=
"../mozilla/dbm/include/ncompat.h.dep.html#NULL">NULL</a>;
<strong><a name="1943"> 1943</a></strong>     }
<strong><a name="1944"> 1944</a></strong>
<strong><a name="1945"> 1945</a></strong>     pubk = (<a href=
"../cryptohi/keythi.h.dep.html#SECKEYPublicKey">SECKEYPublicKey</a> *) <a href=
"../util/secport.c.dep.html#PORT_ArenaZAlloc">PORT_ArenaZAlloc</a> (arena, sizeof (<a href="../cryptohi/keythi.h.dep.html#SECKEYPublicKey">SECKEYPublicKey</a>));
<strong><a name="1946"> 1946</a></strong>     if (pubk != <a href=
"../mozilla/dbm/include/ncompat.h.dep.html#NULL">NULL</a>) {
<strong><a name="1947"> 1947</a></strong>         pubk-&gt;arena = arena;
<strong><a name=
"1948"> 1948</a></strong>         pubk-&gt;pkcs11Slot = <a href="../mozilla/dbm/include/ncompat.h.dep.html#NULL">NULL</a>;
<strong><a name="1949"> 1949</a></strong>         pubk-&gt;pkcs11ID = 0;
<strong><a name="1950"> 1950</a></strong>         <a href=
"../cryptohi/seckey.c.dep.html#prepare_rsa_pub_key_for_asn1">prepare_rsa_pub_key_for_asn1</a>(pubk);
<strong><a name=
"1951"> 1951</a></strong>         /* copy the DER into the arena, since Quick DER returns data that points
<strong><a name=
"1952"> 1952</a></strong>            into the DER input, which may get freed by the caller */
<strong><a name="1953"> 1953</a></strong>         <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> = <a href=
"../util/secitem.c.dep.html#SECITEM_CopyItem">SECITEM_CopyItem</a>(arena, &amp;newPubkder, pubkder);
<strong><a name="1954"> 1954</a></strong>         if ( <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> == <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a>/selfse<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a><a href=
"../mozilla/security/nss/cmd/selfse.c.dep.html#SECSuccess">SECSuccess</a> ) {
<strong><a name="1955"> 1955</a></strong>             <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> = <a href=
"../util/quickder.c.dep.html#SEC_QuickDERDecodeItem">SEC_QuickDERDecodeItem</a>(arena, pubk, <a href="../cryptohi/keythi.h.dep.html#SECKEY_RSAPublicKeyTemplate">SECKEY_RSAPublicKeyTemplate</a><a href="../cryptohi/seckey.c.dep.html#SECKEY_RSAPublicKeyTemplate">[1]</a>,
<strong><a name=
"1956"> 1956</a></strong>                                 &amp;newPubkder);
<strong><a name="1957"> 1957</a></strong>         }
<strong><a name="1958"> 1958</a></strong>         if (<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> == <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a>/selfse<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a><a href=
"../mozilla/security/nss/cmd/selfse.c.dep.html#SECSuccess">SECSuccess</a>)
<strong><a name="1959"> 1959</a></strong>             return pubk;
<strong><a name="1960"> 1960</a></strong>         <a href=
"../cryptohi/seckey.c.dep.html#SECKEY_DestroyPublicKey">SECKEY_DestroyPublicKey</a> (pubk);
<strong><a name="1961"> 1961</a></strong>     } else {
<strong><a name="1962"> 1962</a></strong>         <a href=
"../util/secport.c.dep.html#PORT_SetError">PORT_SetError</a> (SEC_ERROR_NO_MEMORY);
<strong><a name="1963"> 1963</a></strong>     }
<strong><a name="1964"> 1964</a></strong>
<strong><a name="1965"> 1965</a></strong>     <a href=
"../util/secport.c.dep.html#PORT_FreeArena">PORT_FreeArena</a> (arena, <a href=
"../mozilla/nsprpub/pr/include/prtypes.h.dep.html#PR_FALSE">PR_FALSE</a>);
<strong><a name="1966"> 1966</a></strong>     return <a href=
"../mozilla/dbm/include/ncompat.h.dep.html#NULL">NULL</a>;
<strong><a name="1967"> 1967</a></strong> }
<strong><a name="1968"> 1968</a></strong>
<strong><a name="1969"> 1969</a></strong> /*
<strong><a name=
"1970"> 1970</a></strong>  * Decode a base64 ascii encoded DER encoded public key.
<strong><a name="1971"> 1971</a></strong>  */
<strong><a name="1972"> 1972</a></strong> <a href=
"../cryptohi/keythi.h.dep.html#SECKEYPublicKey">SECKEYPublicKey</a> *
<strong><a name="1973"> 1973</a></strong> <a href=
"#1973">SECKEY_ConvertAndDecodePublicKey</a>(char *pubkstr)
<strong><a name="1974"> 1974</a></strong> {
<strong><a name="1975"> 1975</a></strong>     <a href=
"../cryptohi/keythi.h.dep.html#SECKEYPublicKey">SECKEYPublicKey</a> *pubk;
<strong><a name="1976"> 1976</a></strong>     <a href=
"../util/seccomon.h.dep.html#SECStatus">SECStatus</a> <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a>;
<strong><a name="1977"> 1977</a></strong>     <a href=
"../util/seccomon.h.dep.html#SECItem">SECItem</a> der;
<strong><a name="1978"> 1978</a></strong>
<strong><a name="1979"> 1979</a></strong>     <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> = <a href=
"../util/nssb64d.c.dep.html#ATOB_ConvertAsciiToItem">ATOB_ConvertAsciiToItem</a> (&amp;der, pubkstr);
<strong><a name="1980"> 1980</a></strong>     if (<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> != <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a>/selfse<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a><a href=
"../mozilla/security/nss/cmd/selfse.c.dep.html#SECSuccess">SECSuccess</a>)
<strong><a name="1981"> 1981</a></strong>         return <a href=
"../mozilla/dbm/include/ncompat.h.dep.html#NULL">NULL</a>;
<strong><a name="1982"> 1982</a></strong>
<strong><a name="1983"> 1983</a></strong>     pubk = <a href=
"../cryptohi/seckey.c.dep.html#SECKEY_DecodeDERPublicKey">SECKEY_DecodeDERPublicKey</a> (&amp;der);
<strong><a name="1984"> 1984</a></strong>
<strong><a name="1985"> 1985</a></strong>     <a href=
"../util/secport.c.dep.html#PORT_Free">PORT_Free</a> (der.<a href=
"../mozilla/security/nss/tests/pkcs11/netscape/suites/security/ssl/ssls.c.dep.html#data">data</a><a href="../mozilla/security/nss/tests/pkcs11/netscape/suites/security/ssl/ssls.h.dep.html#data">[2]</a>);
<strong><a name="1986"> 1986</a></strong>     return pubk;
<strong><a name="1987"> 1987</a></strong> }
<strong><a name="1988"> 1988</a></strong>
<strong><a name="1989"> 1989</a></strong> <a href=
"../util/seccomon.h.dep.html#SECItem">SECItem</a> *
<strong><a name="1990"> 1990</a></strong> <a href=
"#1990">SECKEY_EncodeDERSubjectPublicKeyInfo</a>(<a href=
"../cryptohi/keythi.h.dep.html#SECKEYPublicKey">SECKEYPublicKey</a> *pubk)
<strong><a name="1991"> 1991</a></strong> {
<strong><a name="1992"> 1992</a></strong>     <a href=
"../certdb/certt.h.dep.html#CERTSubjectPublicKeyInfo">CERTSubjectPublicKeyInfo</a> *spki=<a href="../mozilla/dbm/include/ncompat.h.dep.html#NULL">NULL</a>;
<strong><a name="1993"> 1993</a></strong>     <a href=
"../util/seccomon.h.dep.html#SECItem">SECItem</a> *spkiDER=<a href=
"../mozilla/dbm/include/ncompat.h.dep.html#NULL">NULL</a>;
<strong><a name="1994"> 1994</a></strong>
<strong><a name=
"1995"> 1995</a></strong>     /* get the subjectpublickeyinfo */
<strong><a name="1996"> 1996</a></strong>     spki = <a href=
"../cryptohi/seckey.c.dep.html#SECKEY_CreateSubjectPublicKeyInfo">SECKEY_CreateSubjectPublicKeyInfo</a>(pubk);
<strong><a name="1997"> 1997</a></strong>     if( spki == <a href=
"../mozilla/dbm/include/ncompat.h.dep.html#NULL">NULL</a> ) {
<strong><a name="1998"> 1998</a></strong>         goto finish;
<strong><a name="1999"> 1999</a></strong>     }
<strong><a name="2000"> 2000</a></strong>
<strong><a name=
"2001"> 2001</a></strong>     /* DER-encode the subjectpublickeyinfo */
<strong><a name="2002"> 2002</a></strong>     spkiDER = <a href=
"../util/secasn1e.c.dep.html#SEC_ASN1EncodeItem">SEC_ASN1EncodeItem</a>(<a href="../mozilla/dbm/include/ncompat.h.dep.html#NULL">NULL</a> /*arena*/, <a href="../mozilla/dbm/include/ncompat.h.dep.html#NULL">NULL</a>/*dest*/, spki,
<strong><a name=
"2003"> 2003</a></strong>                                         <a href=
"../certdb/certt.h.dep.html#CERT_SubjectPublicKeyInfoTemplate">CERT_SubjectPublicKeyInfoTemplate</a><a href="../cryptohi/seckey.c.dep.html#CERT_SubjectPublicKeyInfoTemplate">[1]</a>);
<strong><a name="2004"> 2004</a></strong> finish:
<strong><a name="2005"> 2005</a></strong>     if (spki!=<a href=
"../mozilla/dbm/include/ncompat.h.dep.html#NULL">NULL</a>) {
<strong><a name="2006"> 2006</a></strong>         <a href=
"../cryptohi/seckey.c.dep.html#SECKEY_DestroySubjectPublicKeyInfo">SECKEY_DestroySubjectPublicKeyInfo</a>(spki);
<strong><a name="2007"> 2007</a></strong>     }
<strong><a name="2008"> 2008</a></strong>     return spkiDER;
<strong><a name="2009"> 2009</a></strong> }
<strong><a name="2010"> 2010</a></strong>
<strong><a name="2011"> 2011</a></strong>
<strong><a name="2012"> 2012</a></strong> <a href=
"../certdb/certt.h.dep.html#CERTSubjectPublicKeyInfo">CERTSubjectPublicKeyInfo</a> *
<strong><a name="2013"> 2013</a></strong> <a href=
"#2013">SECKEY_DecodeDERSubjectPublicKeyInfo</a>(<a href=
"../util/seccomon.h.dep.html#SECItem">SECItem</a> *spkider)
<strong><a name="2014"> 2014</a></strong> {
<strong><a name="2015"> 2015</a></strong>     <a href=
"../mozilla/nsprpub/pr/include/obsolete/protypes.h.dep.html#PRArenaPool">PRArenaPool</a> *arena;
<strong><a name="2016"> 2016</a></strong>     <a href=
"../certdb/certt.h.dep.html#CERTSubjectPublicKeyInfo">CERTSubjectPublicKeyInfo</a> *spki;
<strong><a name="2017"> 2017</a></strong>     <a href=
"../util/seccomon.h.dep.html#SECStatus">SECStatus</a> <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a>;
<strong><a name="2018"> 2018</a></strong>     <a href=
"../util/seccomon.h.dep.html#SECItem">SECItem</a> newSpkider;
<strong><a name="2019"> 2019</a></strong>
<strong><a name="2020"> 2020</a></strong>     arena = <a href=
"../util/secport.c.dep.html#PORT_NewArena">PORT_NewArena</a>(<a href=
"../util/secdert.h.dep.html#DER_DEFAULT_CHUNKSIZE">DER_DEFAULT_CHUNKSIZE</a>);
<strong><a name="2021"> 2021</a></strong>     if (arena == <a href=
"../mozilla/dbm/include/ncompat.h.dep.html#NULL">NULL</a>) {
<strong><a name="2022"> 2022</a></strong>         <a href=
"../util/secport.c.dep.html#PORT_SetError">PORT_SetError</a>(SEC_ERROR_NO_MEMORY);
<strong><a name="2023"> 2023</a></strong>         return <a href=
"../mozilla/dbm/include/ncompat.h.dep.html#NULL">NULL</a>;
<strong><a name="2024"> 2024</a></strong>     }
<strong><a name="2025"> 2025</a></strong>
<strong><a name="2026"> 2026</a></strong>     spki = (<a href=
"../certdb/certt.h.dep.html#CERTSubjectPublicKeyInfo">CERTSubjectPublicKeyInfo</a> *)
<strong><a name="2027"> 2027</a></strong>                 <a href=
"../util/secport.c.dep.html#PORT_ArenaZAlloc">PORT_ArenaZAlloc</a>(arena, sizeof (<a href="../certdb/certt.h.dep.html#CERTSubjectPublicKeyInfo">CERTSubjectPublicKeyInfo</a>));
<strong><a name="2028"> 2028</a></strong>     if (spki != <a href=
"../mozilla/dbm/include/ncompat.h.dep.html#NULL">NULL</a>) {
<strong><a name="2029"> 2029</a></strong>         spki-&gt;arena = arena;
<strong><a name="2030"> 2030</a></strong>
<strong><a name=
"2031"> 2031</a></strong>         /* copy the DER into the arena, since Quick DER returns data that points
<strong><a name=
"2032"> 2032</a></strong>            into the DER input, which may get freed by the caller */
<strong><a name="2033"> 2033</a></strong>         <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> = <a href=
"../util/secitem.c.dep.html#SECITEM_CopyItem">SECITEM_CopyItem</a>(arena, &amp;newSpkider, spkider);
<strong><a name="2034"> 2034</a></strong>         if ( <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> == <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a>/selfse<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a><a href=
"../mozilla/security/nss/cmd/selfse.c.dep.html#SECSuccess">SECSuccess</a> ) {
<strong><a name="2035"> 2035</a></strong>             <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> = <a href=
"../util/quickder.c.dep.html#SEC_QuickDERDecodeItem">SEC_QuickDERDecodeItem</a>(arena,spki,
<strong><a name=
"2036"> 2036</a></strong>                                     <a href=
"../certdb/certt.h.dep.html#CERT_SubjectPublicKeyInfoTemplate">CERT_SubjectPublicKeyInfoTemplate</a><a href="../cryptohi/seckey.c.dep.html#CERT_SubjectPublicKeyInfoTemplate">[1]</a>, &amp;newSpkider);
<strong><a name="2037"> 2037</a></strong>         }
<strong><a name="2038"> 2038</a></strong>         if (<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> == <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a>/selfse<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a><a href=
"../mozilla/security/nss/cmd/selfse.c.dep.html#SECSuccess">SECSuccess</a>)
<strong><a name="2039"> 2039</a></strong>             return spki;
<strong><a name="2040"> 2040</a></strong>     } else {
<strong><a name="2041"> 2041</a></strong>         <a href=
"../util/secport.c.dep.html#PORT_SetError">PORT_SetError</a>(SEC_ERROR_NO_MEMORY);
<strong><a name="2042"> 2042</a></strong>     }
<strong><a name="2043"> 2043</a></strong>
<strong><a name="2044"> 2044</a></strong>     <a href=
"../util/secport.c.dep.html#PORT_FreeArena">PORT_FreeArena</a>(arena, <a href=
"../mozilla/nsprpub/pr/include/prtypes.h.dep.html#PR_FALSE">PR_FALSE</a>);
<strong><a name="2045"> 2045</a></strong>     return <a href=
"../mozilla/dbm/include/ncompat.h.dep.html#NULL">NULL</a>;
<strong><a name="2046"> 2046</a></strong> }
<strong><a name="2047"> 2047</a></strong>
<strong><a name="2048"> 2048</a></strong> /*
<strong><a name=
"2049"> 2049</a></strong>  * Decode a base64 ascii encoded DER encoded subject public key info.
<strong><a name="2050"> 2050</a></strong>  */
<strong><a name="2051"> 2051</a></strong> <a href=
"../certdb/certt.h.dep.html#CERTSubjectPublicKeyInfo">CERTSubjectPublicKeyInfo</a> *
<strong><a name="2052"> 2052</a></strong> <a href=
"#2052">SECKEY_ConvertAndDecodeSubjectPublicKeyInfo</a>(char *spkistr)
<strong><a name="2053"> 2053</a></strong> {
<strong><a name="2054"> 2054</a></strong>     <a href=
"../certdb/certt.h.dep.html#CERTSubjectPublicKeyInfo">CERTSubjectPublicKeyInfo</a> *spki;
<strong><a name="2055"> 2055</a></strong>     <a href=
"../util/seccomon.h.dep.html#SECStatus">SECStatus</a> <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a>;
<strong><a name="2056"> 2056</a></strong>     <a href=
"../util/seccomon.h.dep.html#SECItem">SECItem</a> der;
<strong><a name="2057"> 2057</a></strong>
<strong><a name="2058"> 2058</a></strong>     <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> = <a href=
"../util/nssb64d.c.dep.html#ATOB_ConvertAsciiToItem">ATOB_ConvertAsciiToItem</a>(&amp;der, spkistr);
<strong><a name="2059"> 2059</a></strong>     if (<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> != <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a>/selfse<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a><a href=
"../mozilla/security/nss/cmd/selfse.c.dep.html#SECSuccess">SECSuccess</a>)
<strong><a name="2060"> 2060</a></strong>         return <a href=
"../mozilla/dbm/include/ncompat.h.dep.html#NULL">NULL</a>;
<strong><a name="2061"> 2061</a></strong>
<strong><a name="2062"> 2062</a></strong>     spki = <a href=
"../cryptohi/seckey.c.dep.html#SECKEY_DecodeDERSubjectPublicKeyInfo">SECKEY_DecodeDERSubjectPublicKeyInfo</a>(&amp;der);
<strong><a name="2063"> 2063</a></strong>
<strong><a name="2064"> 2064</a></strong>     <a href=
"../util/secport.c.dep.html#PORT_Free">PORT_Free</a>(der.<a href=
"../mozilla/security/nss/tests/pkcs11/netscape/suites/security/ssl/ssls.c.dep.html#data">data</a><a href="../mozilla/security/nss/tests/pkcs11/netscape/suites/security/ssl/ssls.h.dep.html#data">[2]</a>);
<strong><a name="2065"> 2065</a></strong>     return spki;
<strong><a name="2066"> 2066</a></strong> }
<strong><a name="2067"> 2067</a></strong>
<strong><a name="2068"> 2068</a></strong> /*
<strong><a name=
"2069"> 2069</a></strong>  * Decode a base64 ascii encoded DER encoded public key and challenge
<strong><a name=
"2070"> 2070</a></strong>  * Verify digital signature and make sure challenge matches
<strong><a name="2071"> 2071</a></strong>  */
<strong><a name="2072"> 2072</a></strong> <a href=
"../certdb/certt.h.dep.html#CERTSubjectPublicKeyInfo">CERTSubjectPublicKeyInfo</a> *
<strong><a name="2073"> 2073</a></strong> <a href=
"#2073">SECKEY_ConvertAndDecodePublicKeyAndChallenge</a>(char *pkacstr, char *challenge,
<strong><a name=
"2074"> 2074</a></strong>                                                                 void *wincx)
<strong><a name="2075"> 2075</a></strong> {
<strong><a name="2076"> 2076</a></strong>     <a href=
"../certdb/certt.h.dep.html#CERTSubjectPublicKeyInfo">CERTSubjectPublicKeyInfo</a> *spki = <a href="../mozilla/dbm/include/ncompat.h.dep.html#NULL">NULL</a>;
<strong><a name="2077"> 2077</a></strong>     <a href=
"../certdb/certt.h.dep.html#CERTPublicKeyAndChallenge">CERTPublicKeyAndChallenge</a> pkac;
<strong><a name="2078"> 2078</a></strong>     <a href=
"../util/seccomon.h.dep.html#SECStatus">SECStatus</a> <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a>;
<strong><a name="2079"> 2079</a></strong>     <a href=
"../util/seccomon.h.dep.html#SECItem">SECItem</a> signedItem;
<strong><a name="2080"> 2080</a></strong>     <a href=
"../mozilla/nsprpub/pr/include/obsolete/protypes.h.dep.html#PRArenaPool">PRArenaPool</a> *arena = <a href="../mozilla/dbm/include/ncompat.h.dep.html#NULL">NULL</a>;
<strong><a name="2081"> 2081</a></strong>     <a href=
"../certdb/certt.h.dep.html#CERTSignedData">CERTSignedData</a> sd;
<strong><a name="2082"> 2082</a></strong>     <a href=
"../util/seccomon.h.dep.html#SECItem">SECItem</a> sig;
<strong><a name="2083"> 2083</a></strong>     <a href=
"../cryptohi/keythi.h.dep.html#SECKEYPublicKey">SECKEYPublicKey</a> *pubKey = <a href="../mozilla/dbm/include/ncompat.h.dep.html#NULL">NULL</a>;
<strong><a name="2084"> 2084</a></strong>     unsigned int <a href=
"../mozilla/security/nss/cmd/crlutil/crlgen_lex.c.dep.html#len">len</a><a href=
"../mozilla/security/nss/cmd/modutil/lex.Pk11Install_yy.c.dep.html#len">[1]</a><a href="../mozilla/security/nss/cmd/zlib/adler32.c.dep.html#len">[2]</a><a href="../mozilla/security/nss/cmd/zlib/crc32.c.dep.html#len">[3]</a><a href="../mozilla/security/nss/cmd/zlib/gzio.c.dep.html#len">[6]</a><a href="../mozilla/security/nss/cmd/zlib/inflate.c.dep.html#len">[9]</a><a href="../mozilla/security/nss/cmd/zlib/trees.c.dep.html#len">[10]</a><a href="../mozilla/security/nss/cmd/zlib/zutil.c.dep.html#len">[13]</a>;
<strong><a name="2085"> 2085</a></strong>
<strong><a name="2086"> 2086</a></strong>     signedItem.<a href=
"../mozilla/security/nss/tests/pkcs11/netscape/suites/security/ssl/ssls.c.dep.html#data">data</a><a href="../mozilla/security/nss/tests/pkcs11/netscape/suites/security/ssl/ssls.h.dep.html#data">[2]</a> = <a href="../mozilla/dbm/include/ncompat.h.dep.html#NULL">NULL</a>;
<strong><a name="2087"> 2087</a></strong>
<strong><a name=
"2088"> 2088</a></strong>     /* convert the base64 encoded data to binary */
<strong><a name="2089"> 2089</a></strong>     <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> = <a href=
"../util/nssb64d.c.dep.html#ATOB_ConvertAsciiToItem">ATOB_ConvertAsciiToItem</a>(&amp;signedItem, pkacstr);
<strong><a name="2090"> 2090</a></strong>     if (<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> != <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a>/selfse<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a><a href=
"../mozilla/security/nss/cmd/selfse.c.dep.html#SECSuccess">SECSuccess</a>) {
<strong><a name="2091"> 2091</a></strong>         goto loser;
<strong><a name="2092"> 2092</a></strong>     }
<strong><a name="2093"> 2093</a></strong>
<strong><a name="2094"> 2094</a></strong>     /* create an arena */
<strong><a name="2095"> 2095</a></strong>     arena = <a href=
"../util/secport.c.dep.html#PORT_NewArena">PORT_NewArena</a>(<a href=
"../util/secdert.h.dep.html#DER_DEFAULT_CHUNKSIZE">DER_DEFAULT_CHUNKSIZE</a>);
<strong><a name="2096"> 2096</a></strong>     if (arena == <a href=
"../mozilla/dbm/include/ncompat.h.dep.html#NULL">NULL</a>) {
<strong><a name="2097"> 2097</a></strong>         goto loser;
<strong><a name="2098"> 2098</a></strong>     }
<strong><a name="2099"> 2099</a></strong>
<strong><a name=
"2100"> 2100</a></strong>     /* decode the outer wrapping of signed data */
<strong><a name="2101"> 2101</a></strong>     <a href=
"../util/secport.h.dep.html#PORT_Memset">PORT_Memset</a>(&amp;sd, 0, sizeof(<a href="../certdb/certt.h.dep.html#CERTSignedData">CERTSignedData</a>));
<strong><a name="2102"> 2102</a></strong>     <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> = <a href=
"../util/quickder.c.dep.html#SEC_QuickDERDecodeItem">SEC_QuickDERDecodeItem</a>(arena, &amp;sd, <a href="../certdb/certt.h.dep.html#CERT_SignedDataTemplate">CERT_SignedDataTemplate</a><a href="../cryptohi/secsign.c.dep.html#CERT_SignedDataTemplate">[1]</a>, &amp;signedItem );
<strong><a name="2103"> 2103</a></strong>     if ( <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> ) {
<strong><a name="2104"> 2104</a></strong>         goto loser;
<strong><a name="2105"> 2105</a></strong>     }
<strong><a name="2106"> 2106</a></strong>
<strong><a name=
"2107"> 2107</a></strong>     /* decode the public key and challenge wrapper */
<strong><a name="2108"> 2108</a></strong>     <a href=
"../util/secport.h.dep.html#PORT_Memset">PORT_Memset</a>(&amp;pkac, 0, sizeof(<a href="../certdb/certt.h.dep.html#CERTPublicKeyAndChallenge">CERTPublicKeyAndChallenge</a>));
<strong><a name="2109"> 2109</a></strong>     <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> = <a href=
"../util/quickder.c.dep.html#SEC_QuickDERDecodeItem">SEC_QuickDERDecodeItem</a>(arena, &amp;pkac, <a href="../certdb/certt.h.dep.html#CERT_PublicKeyAndChallengeTemplate">CERT_PublicKeyAndChallengeTemplate</a><a href="../cryptohi/seckey.c.dep.html#CERT_PublicKeyAndChallengeTemplate">[1]</a>,
<strong><a name=
"2110"> 2110</a></strong>                             &amp;sd.<a href=
"../mozilla/security/nss/tests/pkcs11/netscape/suites/security/ssl/ssls.c.dep.html#data">data</a><a href="../mozilla/security/nss/tests/pkcs11/netscape/suites/security/ssl/ssls.h.dep.html#data">[2]</a>);
<strong><a name="2111"> 2111</a></strong>     if ( <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> ) {
<strong><a name="2112"> 2112</a></strong>         goto loser;
<strong><a name="2113"> 2113</a></strong>     }
<strong><a name="2114"> 2114</a></strong>
<strong><a name=
"2115"> 2115</a></strong>     /* decode the subject public key info */
<strong><a name="2116"> 2116</a></strong>     spki = <a href=
"../cryptohi/seckey.c.dep.html#SECKEY_DecodeDERSubjectPublicKeyInfo">SECKEY_DecodeDERSubjectPublicKeyInfo</a>(&amp;pkac.spki);
<strong><a name="2117"> 2117</a></strong>     if ( spki == <a href=
"../mozilla/dbm/include/ncompat.h.dep.html#NULL">NULL</a> ) {
<strong><a name="2118"> 2118</a></strong>         goto loser;
<strong><a name="2119"> 2119</a></strong>     }
<strong><a name="2120"> 2120</a></strong>
<strong><a name="2121"> 2121</a></strong>     /* get the public key */
<strong><a name="2122"> 2122</a></strong>     pubKey = <a href=
"../cryptohi/seckey.c.dep.html#seckey_ExtractPublicKey">seckey_ExtractPublicKey</a>(spki);
<strong><a name="2123"> 2123</a></strong>     if ( pubKey == <a href=
"../mozilla/dbm/include/ncompat.h.dep.html#NULL">NULL</a> ) {
<strong><a name="2124"> 2124</a></strong>         goto loser;
<strong><a name="2125"> 2125</a></strong>     }
<strong><a name="2126"> 2126</a></strong>
<strong><a name="2127"> 2127</a></strong>     /* check the signature */
<strong><a name="2128"> 2128</a></strong>     sig = sd.signature;
<strong><a name="2129"> 2129</a></strong>     <a href=
"../util/secdert.h.dep.html#DER_ConvertBitString">DER_ConvertBitString</a>(&amp;sig);
<strong><a name="2130"> 2130</a></strong>     <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> = <a href=
"../cryptohi/secvfy.c.dep.html#VFY_VerifyDataWithAlgorithmID">VFY_VerifyDataWithAlgorithmID</a>(sd.<a href="../mozilla/security/nss/tests/pkcs11/netscape/suites/security/ssl/ssls.c.dep.html#data">data</a><a href="../mozilla/security/nss/tests/pkcs11/netscape/suites/security/ssl/ssls.h.dep.html#data">[2]</a>.<a href="../mozilla/security/nss/tests/pkcs11/netscape/suites/security/ssl/ssls.c.dep.html#data">data</a><a href="../mozilla/security/nss/tests/pkcs11/netscape/suites/security/ssl/ssls.h.dep.html#data">[2]</a>, sd.<a href="../mozilla/security/nss/tests/pkcs11/netscape/suites/security/ssl/ssls.c.dep.html#data">data</a><a href="../mozilla/security/nss/tests/pkcs11/netscape/suites/security/ssl/ssls.h.dep.html#data">[2]</a>.<a href="../mozilla/security/nss/cmd/crlutil/crlgen_lex.c.dep.html#len">len</a><a href="../mozilla/security/nss/cmd/modutil/lex.Pk11Install_yy.c.dep.html#len">[1]</a><a href="../mozilla/security/nss/cmd/zlib/adler32.c.dep.html#len">[2]</a><a href="../mozilla/security/nss/cmd/zlib/crc32.c.dep.html#len">[3]</a><a href="../mozilla/security/nss/cmd/zlib/gzio.c.dep.html#len">[6]</a><a href="../mozilla/security/nss/cmd/zlib/inflate.c.dep.html#len">[9]</a><a href="../mozilla/security/nss/cmd/zlib/trees.c.dep.html#len">[10]</a><a href="../mozilla/security/nss/cmd/zlib/zutil.c.dep.html#len">[13]</a>, pubKey, &amp;sig,
<strong><a name=
"2131"> 2131</a></strong>                              &amp;sd.signatureAlgorithm, <a href="../mozilla/dbm/include/ncompat.h.dep.html#NULL">NULL</a>, wincx);
<strong><a name="2132"> 2132</a></strong>     if ( <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> != <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a>/selfse<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a><a href=
"../mozilla/security/nss/cmd/selfse.c.dep.html#SECSuccess">SECSuccess</a> ) {
<strong><a name="2133"> 2133</a></strong>         goto loser;
<strong><a name="2134"> 2134</a></strong>     }
<strong><a name="2135"> 2135</a></strong>
<strong><a name="2136"> 2136</a></strong>     /* check the challenge */
<strong><a name="2137"> 2137</a></strong>     if ( challenge ) {
<strong><a name="2138"> 2138</a></strong>         <a href=
"../mozilla/security/nss/cmd/crlutil/crlgen_lex.c.dep.html#len">len</a><a href=
"../mozilla/security/nss/cmd/modutil/lex.Pk11Install_yy.c.dep.html#len">[1]</a><a href="../mozilla/security/nss/cmd/zlib/adler32.c.dep.html#len">[2]</a><a href="../mozilla/security/nss/cmd/zlib/crc32.c.dep.html#len">[3]</a><a href="../mozilla/security/nss/cmd/zlib/gzio.c.dep.html#len">[6]</a><a href="../mozilla/security/nss/cmd/zlib/inflate.c.dep.html#len">[9]</a><a href="../mozilla/security/nss/cmd/zlib/trees.c.dep.html#len">[10]</a><a href="../mozilla/security/nss/cmd/zlib/zutil.c.dep.html#len">[13]</a> = PORT_Str<a href="../mozilla/security/nss/cmd/crlutil/crlgen_lex.c.dep.html#len">len</a><a href="../mozilla/security/nss/cmd/modutil/lex.Pk11Install_yy.c.dep.html#len">[1]</a><a href="../mozilla/security/nss/cmd/zlib/adler32.c.dep.html#len">[2]</a><a href="../mozilla/security/nss/cmd/zlib/crc32.c.dep.html#len">[3]</a><a href="../mozilla/security/nss/cmd/zlib/gzio.c.dep.html#len">[6]</a><a href="../mozilla/security/nss/cmd/zlib/inflate.c.dep.html#len">[9]</a><a href="../mozilla/security/nss/cmd/zlib/trees.c.dep.html#len">[10]</a><a href="../mozilla/security/nss/cmd/zlib/zutil.c.dep.html#len">[13]</a>(chal<a href="../mozilla/security/nss/cmd/crlutil/crlgen_lex.c.dep.html#len">len</a><a href="../mozilla/security/nss/cmd/modutil/lex.Pk11Install_yy.c.dep.html#len">[1]</a><a href="../mozilla/security/nss/cmd/zlib/adler32.c.dep.html#len">[2]</a><a href="../mozilla/security/nss/cmd/zlib/crc32.c.dep.html#len">[3]</a><a href="../mozilla/security/nss/cmd/zlib/gzio.c.dep.html#len">[6]</a><a href="../mozilla/security/nss/cmd/zlib/inflate.c.dep.html#len">[9]</a><a href="../mozilla/security/nss/cmd/zlib/trees.c.dep.html#len">[10]</a><a href="../mozilla/security/nss/cmd/zlib/zutil.c.dep.html#len">[13]</a>ge);
<strong><a name="2139"> 2139</a></strong>         /* length is right */
<strong><a name="2140"> 2140</a></strong>         if ( <a href=
"../mozilla/security/nss/cmd/crlutil/crlgen_lex.c.dep.html#len">len</a><a href=
"../mozilla/security/nss/cmd/modutil/lex.Pk11Install_yy.c.dep.html#len">[1]</a><a href="../mozilla/security/nss/cmd/zlib/adler32.c.dep.html#len">[2]</a><a href="../mozilla/security/nss/cmd/zlib/crc32.c.dep.html#len">[3]</a><a href="../mozilla/security/nss/cmd/zlib/gzio.c.dep.html#len">[6]</a><a href="../mozilla/security/nss/cmd/zlib/inflate.c.dep.html#len">[9]</a><a href="../mozilla/security/nss/cmd/zlib/trees.c.dep.html#len">[10]</a><a href="../mozilla/security/nss/cmd/zlib/zutil.c.dep.html#len">[13]</a> != pkac.chal<a href="../mozilla/security/nss/cmd/crlutil/crlgen_lex.c.dep.html#len">len</a><a href="../mozilla/security/nss/cmd/modutil/lex.Pk11Install_yy.c.dep.html#len">[1]</a><a href="../mozilla/security/nss/cmd/zlib/adler32.c.dep.html#len">[2]</a><a href="../mozilla/security/nss/cmd/zlib/crc32.c.dep.html#len">[3]</a><a href="../mozilla/security/nss/cmd/zlib/gzio.c.dep.html#len">[6]</a><a href="../mozilla/security/nss/cmd/zlib/inflate.c.dep.html#len">[9]</a><a href="../mozilla/security/nss/cmd/zlib/trees.c.dep.html#len">[10]</a><a href="../mozilla/security/nss/cmd/zlib/zutil.c.dep.html#len">[13]</a>ge.<a href="../mozilla/security/nss/cmd/crlutil/crlgen_lex.c.dep.html#len">len</a><a href="../mozilla/security/nss/cmd/modutil/lex.Pk11Install_yy.c.dep.html#len">[1]</a><a href="../mozilla/security/nss/cmd/zlib/adler32.c.dep.html#len">[2]</a><a href="../mozilla/security/nss/cmd/zlib/crc32.c.dep.html#len">[3]</a><a href="../mozilla/security/nss/cmd/zlib/gzio.c.dep.html#len">[6]</a><a href="../mozilla/security/nss/cmd/zlib/inflate.c.dep.html#len">[9]</a><a href="../mozilla/security/nss/cmd/zlib/trees.c.dep.html#len">[10]</a><a href="../mozilla/security/nss/cmd/zlib/zutil.c.dep.html#len">[13]</a> ) {
<strong><a name="2141"> 2141</a></strong>             goto loser;
<strong><a name="2142"> 2142</a></strong>         }
<strong><a name="2143"> 2143</a></strong>         /* actual data is right */
<strong><a name="2144"> 2144</a></strong>         if ( <a href=
"../util/secport.h.dep.html#PORT_Memcmp">PORT_Memcmp</a>(chal<a href=
"../mozilla/security/nss/cmd/crlutil/crlgen_lex.c.dep.html#len">len</a><a href=
"../mozilla/security/nss/cmd/modutil/lex.Pk11Install_yy.c.dep.html#len">[1]</a><a href="../mozilla/security/nss/cmd/zlib/adler32.c.dep.html#len">[2]</a><a href="../mozilla/security/nss/cmd/zlib/crc32.c.dep.html#len">[3]</a><a href="../mozilla/security/nss/cmd/zlib/gzio.c.dep.html#len">[6]</a><a href="../mozilla/security/nss/cmd/zlib/inflate.c.dep.html#len">[9]</a><a href="../mozilla/security/nss/cmd/zlib/trees.c.dep.html#len">[10]</a><a href="../mozilla/security/nss/cmd/zlib/zutil.c.dep.html#len">[13]</a>ge, pkac.chal<a href="../mozilla/security/nss/cmd/crlutil/crlgen_lex.c.dep.html#len">len</a><a href="../mozilla/security/nss/cmd/modutil/lex.Pk11Install_yy.c.dep.html#len">[1]</a><a href="../mozilla/security/nss/cmd/zlib/adler32.c.dep.html#len">[2]</a><a href="../mozilla/security/nss/cmd/zlib/crc32.c.dep.html#len">[3]</a><a href="../mozilla/security/nss/cmd/zlib/gzio.c.dep.html#len">[6]</a><a href="../mozilla/security/nss/cmd/zlib/inflate.c.dep.html#len">[9]</a><a href="../mozilla/security/nss/cmd/zlib/trees.c.dep.html#len">[10]</a><a href="../mozilla/security/nss/cmd/zlib/zutil.c.dep.html#len">[13]</a>ge.<a href="../mozilla/security/nss/tests/pkcs11/netscape/suites/security/ssl/ssls.c.dep.html#data">data</a><a href="../mozilla/security/nss/tests/pkcs11/netscape/suites/security/ssl/ssls.h.dep.html#data">[2]</a>, <a href="../mozilla/security/nss/cmd/crlutil/crlgen_lex.c.dep.html#len">len</a><a href="../mozilla/security/nss/cmd/modutil/lex.Pk11Install_yy.c.dep.html#len">[1]</a><a href="../mozilla/security/nss/cmd/zlib/adler32.c.dep.html#len">[2]</a><a href="../mozilla/security/nss/cmd/zlib/crc32.c.dep.html#len">[3]</a><a href="../mozilla/security/nss/cmd/zlib/gzio.c.dep.html#len">[6]</a><a href="../mozilla/security/nss/cmd/zlib/inflate.c.dep.html#len">[9]</a><a href="../mozilla/security/nss/cmd/zlib/trees.c.dep.html#len">[10]</a><a href="../mozilla/security/nss/cmd/zlib/zutil.c.dep.html#len">[13]</a>) != 0 ) {
<strong><a name="2145"> 2145</a></strong>             goto loser;
<strong><a name="2146"> 2146</a></strong>         }
<strong><a name="2147"> 2147</a></strong>     }
<strong><a name="2148"> 2148</a></strong>     goto done;
<strong><a name="2149"> 2149</a></strong>
<strong><a name="2150"> 2150</a></strong> loser:
<strong><a name=
"2151"> 2151</a></strong>     /* make sure that we return null if we got an error */
<strong><a name="2152"> 2152</a></strong>     if ( spki ) {
<strong><a name="2153"> 2153</a></strong>         <a href=
"../cryptohi/seckey.c.dep.html#SECKEY_DestroySubjectPublicKeyInfo">SECKEY_DestroySubjectPublicKeyInfo</a>(spki);
<strong><a name="2154"> 2154</a></strong>     }
<strong><a name="2155"> 2155</a></strong>     spki = <a href=
"../mozilla/dbm/include/ncompat.h.dep.html#NULL">NULL</a>;
<strong><a name="2156"> 2156</a></strong>
<strong><a name="2157"> 2157</a></strong> done:
<strong><a name="2158"> 2158</a></strong>     if ( signedItem.<a href=
"../mozilla/security/nss/tests/pkcs11/netscape/suites/security/ssl/ssls.c.dep.html#data">data</a><a href="../mozilla/security/nss/tests/pkcs11/netscape/suites/security/ssl/ssls.h.dep.html#data">[2]</a> ) {
<strong><a name="2159"> 2159</a></strong>         <a href=
"../util/secport.c.dep.html#PORT_Free">PORT_Free</a>(signedItem.<a href=
"../mozilla/security/nss/tests/pkcs11/netscape/suites/security/ssl/ssls.c.dep.html#data">data</a><a href="../mozilla/security/nss/tests/pkcs11/netscape/suites/security/ssl/ssls.h.dep.html#data">[2]</a>);
<strong><a name="2160"> 2160</a></strong>     }
<strong><a name="2161"> 2161</a></strong>     if ( arena ) {
<strong><a name="2162"> 2162</a></strong>         <a href=
"../util/secport.c.dep.html#PORT_FreeArena">PORT_FreeArena</a>(arena, <a href=
"../mozilla/nsprpub/pr/include/prtypes.h.dep.html#PR_FALSE">PR_FALSE</a>);
<strong><a name="2163"> 2163</a></strong>     }
<strong><a name="2164"> 2164</a></strong>     if ( pubKey ) {
<strong><a name="2165"> 2165</a></strong>         <a href=
"../cryptohi/seckey.c.dep.html#SECKEY_DestroyPublicKey">SECKEY_DestroyPublicKey</a>(pubKey);
<strong><a name="2166"> 2166</a></strong>     }
<strong><a name="2167"> 2167</a></strong>
<strong><a name="2168"> 2168</a></strong>     return spki;
<strong><a name="2169"> 2169</a></strong> }
<strong><a name="2170"> 2170</a></strong>
<strong><a name="2171"> 2171</a></strong> void
<strong><a name="2172"> 2172</a></strong> <a href=
"#2172">SECKEY_DestroyPrivateKeyInfo</a>(<a href=
"../pk11wrap/secmodt.h.dep.html#SECKEYPrivateKeyInfo">SECKEYPrivateKeyInfo</a> *pvk,
<strong><a name="2173"> 2173</a></strong>                              <a href=
"../mozilla/nsprpub/pr/include/prtypes.h.dep.html#PRBool">PRBool</a> freeit)
<strong><a name="2174"> 2174</a></strong> {
<strong><a name="2175"> 2175</a></strong>     <a href=
"../mozilla/nsprpub/pr/include/obsolete/protypes.h.dep.html#PRArenaPool">PRArenaPool</a> *poolp;
<strong><a name="2176"> 2176</a></strong>
<strong><a name="2177"> 2177</a></strong>     if(pvk != <a href=
"../mozilla/dbm/include/ncompat.h.dep.html#NULL">NULL</a>) {
<strong><a name="2178"> 2178</a></strong>         if(pvk-&gt;arena) {
<strong><a name="2179"> 2179</a></strong>             poolp = pvk-&gt;arena;
<strong><a name=
"2180"> 2180</a></strong>             /* zero structure since PORT_FreeArena does not support
<strong><a name="2181"> 2181</a></strong>              * this yet.
<strong><a name="2182"> 2182</a></strong>              */
<strong><a name="2183"> 2183</a></strong>             <a href=
"../util/secport.h.dep.html#PORT_Memset">PORT_Memset</a>(pvk-&gt;privateKey.<a href="../mozilla/security/nss/tests/pkcs11/netscape/suites/security/ssl/ssls.c.dep.html#data">data</a><a href="../mozilla/security/nss/tests/pkcs11/netscape/suites/security/ssl/ssls.h.dep.html#data">[2]</a>, 0, pvk-&gt;privateKey.<a href="../mozilla/security/nss/cmd/crlutil/crlgen_lex.c.dep.html#len">len</a><a href="../mozilla/security/nss/cmd/modutil/lex.Pk11Install_yy.c.dep.html#len">[1]</a><a href="../mozilla/security/nss/cmd/zlib/adler32.c.dep.html#len">[2]</a><a href="../mozilla/security/nss/cmd/zlib/crc32.c.dep.html#len">[3]</a><a href="../mozilla/security/nss/cmd/zlib/gzio.c.dep.html#len">[6]</a><a href="../mozilla/security/nss/cmd/zlib/inflate.c.dep.html#len">[9]</a><a href="../mozilla/security/nss/cmd/zlib/trees.c.dep.html#len">[10]</a><a href="../mozilla/security/nss/cmd/zlib/zutil.c.dep.html#len">[13]</a>);
<strong><a name="2184"> 2184</a></strong>             <a href=
"../util/secport.h.dep.html#PORT_Memset">PORT_Memset</a>((char *)pvk, 0, sizeof(*pvk));
<strong><a name="2185"> 2185</a></strong>             if(freeit == <a href=
"../mozilla/nsprpub/pr/include/prtypes.h.dep.html#PR_TRUE">PR_TRUE</a>) {
<strong><a name="2186"> 2186</a></strong>                 <a href=
"../util/secport.c.dep.html#PORT_FreeArena">PORT_FreeArena</a>(poolp, <a href=
"../mozilla/nsprpub/pr/include/prtypes.h.dep.html#PR_TRUE">PR_TRUE</a>);
<strong><a name="2187"> 2187</a></strong>             } else {
<strong><a name=
"2188"> 2188</a></strong>                 pvk-&gt;arena = poolp;
<strong><a name="2189"> 2189</a></strong>             }
<strong><a name="2190"> 2190</a></strong>         } else {
<strong><a name="2191"> 2191</a></strong>             <a href=
"../util/secitem.c.dep.html#SECITEM_ZfreeItem">SECITEM_ZfreeItem</a>(&amp;pvk-&gt;<a href="../mozilla/security/nss/cmd/zlib/deflate.c.dep.html#version">version</a><a href="../mozilla/security/nss/cmd/zlib/infback.c.dep.html#version">[2]</a><a href="../mozilla/security/nss/cmd/zlib/inflate.c.dep.html#version">[3]</a>, <a href="../mozilla/nsprpub/pr/include/prtypes.h.dep.html#PR_FALSE">PR_FALSE</a>);
<strong><a name="2192"> 2192</a></strong>             <a href=
"../util/secitem.c.dep.html#SECITEM_ZfreeItem">SECITEM_ZfreeItem</a>(&amp;pvk-&gt;privateKey, <a href="../mozilla/nsprpub/pr/include/prtypes.h.dep.html#PR_FALSE">PR_FALSE</a>);
<strong><a name="2193"> 2193</a></strong>             <a href=
"../util/secalgid.c.dep.html#SECOID_DestroyAlgorithmID">SECOID_DestroyAlgorithmID</a>(&amp;pvk-&gt;algorithm, <a href="../mozilla/nsprpub/pr/include/prtypes.h.dep.html#PR_FALSE">PR_FALSE</a>);
<strong><a name="2194"> 2194</a></strong>             <a href=
"../util/secport.h.dep.html#PORT_Memset">PORT_Memset</a>((char *)pvk, 0, sizeof(pvk));
<strong><a name="2195"> 2195</a></strong>             if(freeit == <a href=
"../mozilla/nsprpub/pr/include/prtypes.h.dep.html#PR_TRUE">PR_TRUE</a>) {
<strong><a name="2196"> 2196</a></strong>                 <a href=
"../util/secport.c.dep.html#PORT_Free">PORT_Free</a>(pvk);
<strong><a name="2197"> 2197</a></strong>             }
<strong><a name="2198"> 2198</a></strong>         }
<strong><a name="2199"> 2199</a></strong>     }
<strong><a name="2200"> 2200</a></strong> }
<strong><a name="2201"> 2201</a></strong>
<strong><a name="2202"> 2202</a></strong> void
<strong><a name="2203"> 2203</a></strong> <a href=
"#2203">SECKEY_DestroyEncryptedPrivateKeyInfo</a>(<a href=
"../pk11wrap/secmodt.h.dep.html#SECKEYEncryptedPrivateKeyInfo">SECKEYEncryptedPrivateKeyInfo</a> *epki,
<strong><a name=
"2204"> 2204</a></strong>                                       <a href=
"../mozilla/nsprpub/pr/include/prtypes.h.dep.html#PRBool">PRBool</a> freeit)
<strong><a name="2205"> 2205</a></strong> {
<strong><a name="2206"> 2206</a></strong>     <a href=
"../mozilla/nsprpub/pr/include/obsolete/protypes.h.dep.html#PRArenaPool">PRArenaPool</a> *poolp;
<strong><a name="2207"> 2207</a></strong>
<strong><a name="2208"> 2208</a></strong>     if(epki != <a href=
"../mozilla/dbm/include/ncompat.h.dep.html#NULL">NULL</a>) {
<strong><a name="2209"> 2209</a></strong>         if(epki-&gt;arena) {
<strong><a name="2210"> 2210</a></strong>             poolp = epki-&gt;arena;
<strong><a name=
"2211"> 2211</a></strong>             /* zero structure since PORT_FreeArena does not support
<strong><a name="2212"> 2212</a></strong>              * this yet.
<strong><a name="2213"> 2213</a></strong>              */
<strong><a name="2214"> 2214</a></strong>             <a href=
"../util/secport.h.dep.html#PORT_Memset">PORT_Memset</a>(epki-&gt;encryptedData.<a href="../mozilla/security/nss/tests/pkcs11/netscape/suites/security/ssl/ssls.c.dep.html#data">data</a><a href="../mozilla/security/nss/tests/pkcs11/netscape/suites/security/ssl/ssls.h.dep.html#data">[2]</a>, 0, epki-&gt;encryptedData.<a href="../mozilla/security/nss/cmd/crlutil/crlgen_lex.c.dep.html#len">len</a><a href="../mozilla/security/nss/cmd/modutil/lex.Pk11Install_yy.c.dep.html#len">[1]</a><a href="../mozilla/security/nss/cmd/zlib/adler32.c.dep.html#len">[2]</a><a href="../mozilla/security/nss/cmd/zlib/crc32.c.dep.html#len">[3]</a><a href="../mozilla/security/nss/cmd/zlib/gzio.c.dep.html#len">[6]</a><a href="../mozilla/security/nss/cmd/zlib/inflate.c.dep.html#len">[9]</a><a href="../mozilla/security/nss/cmd/zlib/trees.c.dep.html#len">[10]</a><a href="../mozilla/security/nss/cmd/zlib/zutil.c.dep.html#len">[13]</a>);
<strong><a name="2215"> 2215</a></strong>             <a href=
"../util/secport.h.dep.html#PORT_Memset">PORT_Memset</a>((char *)epki, 0, sizeof(*epki));
<strong><a name="2216"> 2216</a></strong>             if(freeit == <a href=
"../mozilla/nsprpub/pr/include/prtypes.h.dep.html#PR_TRUE">PR_TRUE</a>) {
<strong><a name="2217"> 2217</a></strong>                 <a href=
"../util/secport.c.dep.html#PORT_FreeArena">PORT_FreeArena</a>(poolp, <a href=
"../mozilla/nsprpub/pr/include/prtypes.h.dep.html#PR_TRUE">PR_TRUE</a>);
<strong><a name="2218"> 2218</a></strong>             } else {
<strong><a name=
"2219"> 2219</a></strong>                 epki-&gt;arena = poolp;
<strong><a name="2220"> 2220</a></strong>             }
<strong><a name="2221"> 2221</a></strong>         } else {
<strong><a name="2222"> 2222</a></strong>             <a href=
"../util/secitem.c.dep.html#SECITEM_ZfreeItem">SECITEM_ZfreeItem</a>(&amp;epki-&gt;encryptedData, <a href="../mozilla/nsprpub/pr/include/prtypes.h.dep.html#PR_FALSE">PR_FALSE</a>);
<strong><a name="2223"> 2223</a></strong>             <a href=
"../util/secalgid.c.dep.html#SECOID_DestroyAlgorithmID">SECOID_DestroyAlgorithmID</a>(&amp;epki-&gt;algorithm, <a href="../mozilla/nsprpub/pr/include/prtypes.h.dep.html#PR_FALSE">PR_FALSE</a>);
<strong><a name="2224"> 2224</a></strong>             <a href=
"../util/secport.h.dep.html#PORT_Memset">PORT_Memset</a>((char *)epki, 0, sizeof(epki));
<strong><a name="2225"> 2225</a></strong>             if(freeit == <a href=
"../mozilla/nsprpub/pr/include/prtypes.h.dep.html#PR_TRUE">PR_TRUE</a>) {
<strong><a name="2226"> 2226</a></strong>                 <a href=
"../util/secport.c.dep.html#PORT_Free">PORT_Free</a>(epki);
<strong><a name="2227"> 2227</a></strong>             }
<strong><a name="2228"> 2228</a></strong>         }
<strong><a name="2229"> 2229</a></strong>     }
<strong><a name="2230"> 2230</a></strong> }
<strong><a name="2231"> 2231</a></strong>
<strong><a name="2232"> 2232</a></strong> <a href=
"../util/seccomon.h.dep.html#SECStatus">SECStatus</a>
<strong><a name="2233"> 2233</a></strong> <a href=
"#2233">SECKEY_CopyPrivateKeyInfo</a>(<a href=
"../mozilla/nsprpub/pr/include/obsolete/protypes.h.dep.html#PRArenaPool">PRArenaPool</a> *poolp,
<strong><a name="2234"> 2234</a></strong>                           <a href=
"../pk11wrap/secmodt.h.dep.html#SECKEYPrivateKeyInfo">SECKEYPrivateKeyInfo</a> *to,
<strong><a name="2235"> 2235</a></strong>                           <a href=
"../pk11wrap/secmodt.h.dep.html#SECKEYPrivateKeyInfo">SECKEYPrivateKeyInfo</a> *from)
<strong><a name="2236"> 2236</a></strong> {
<strong><a name="2237"> 2237</a></strong>     <a href=
"../util/seccomon.h.dep.html#SECStatus">SECStatus</a> <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> = SECFailure;
<strong><a name="2238"> 2238</a></strong>
<strong><a name="2239"> 2239</a></strong>     if((to == <a href=
"../mozilla/dbm/include/ncompat.h.dep.html#NULL">NULL</a>) || (from == <a href=
"../mozilla/dbm/include/ncompat.h.dep.html#NULL">NULL</a>)) {
<strong><a name="2240"> 2240</a></strong>         return SECFailure;
<strong><a name="2241"> 2241</a></strong>     }
<strong><a name="2242"> 2242</a></strong>
<strong><a name="2243"> 2243</a></strong>     <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> = <a href=
"../util/secalgid.c.dep.html#SECOID_CopyAlgorithmID">SECOID_CopyAlgorithmID</a>(poolp, &amp;to-&gt;algorithm, &amp;from-&gt;algorithm);
<strong><a name="2244"> 2244</a></strong>     if(<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> != <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a>/selfse<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a><a href=
"../mozilla/security/nss/cmd/selfse.c.dep.html#SECSuccess">SECSuccess</a>) {
<strong><a name="2245"> 2245</a></strong>         return SECFailure;
<strong><a name="2246"> 2246</a></strong>     }
<strong><a name="2247"> 2247</a></strong>     <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> = <a href=
"../util/secitem.c.dep.html#SECITEM_CopyItem">SECITEM_CopyItem</a>(poolp, &amp;to-&gt;privateKey, &amp;from-&gt;privateKey);
<strong><a name="2248"> 2248</a></strong>     if(<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> != <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a>/selfse<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a><a href=
"../mozilla/security/nss/cmd/selfse.c.dep.html#SECSuccess">SECSuccess</a>) {
<strong><a name="2249"> 2249</a></strong>         return SECFailure;
<strong><a name="2250"> 2250</a></strong>     }
<strong><a name="2251"> 2251</a></strong>     <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> = <a href=
"../util/secitem.c.dep.html#SECITEM_CopyItem">SECITEM_CopyItem</a>(poolp, &amp;to-&gt;<a href="../mozilla/security/nss/cmd/zlib/deflate.c.dep.html#version">version</a><a href="../mozilla/security/nss/cmd/zlib/infback.c.dep.html#version">[2]</a><a href="../mozilla/security/nss/cmd/zlib/inflate.c.dep.html#version">[3]</a>, &amp;from-&gt;<a href="../mozilla/security/nss/cmd/zlib/deflate.c.dep.html#version">version</a><a href="../mozilla/security/nss/cmd/zlib/infback.c.dep.html#version">[2]</a><a href="../mozilla/security/nss/cmd/zlib/inflate.c.dep.html#version">[3]</a>);
<strong><a name="2252"> 2252</a></strong>
<strong><a name="2253"> 2253</a></strong>     return <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a>;
<strong><a name="2254"> 2254</a></strong> }
<strong><a name="2255"> 2255</a></strong>
<strong><a name="2256"> 2256</a></strong> <a href=
"../util/seccomon.h.dep.html#SECStatus">SECStatus</a>
<strong><a name="2257"> 2257</a></strong> <a href=
"#2257">SECKEY_CopyEncryptedPrivateKeyInfo</a>(<a href=
"../mozilla/nsprpub/pr/include/obsolete/protypes.h.dep.html#PRArenaPool">PRArenaPool</a> *poolp,
<strong><a name=
"2258"> 2258</a></strong>                                    <a href=
"../pk11wrap/secmodt.h.dep.html#SECKEYEncryptedPrivateKeyInfo">SECKEYEncryptedPrivateKeyInfo</a> *to,
<strong><a name=
"2259"> 2259</a></strong>                                    <a href=
"../pk11wrap/secmodt.h.dep.html#SECKEYEncryptedPrivateKeyInfo">SECKEYEncryptedPrivateKeyInfo</a> *from)
<strong><a name="2260"> 2260</a></strong> {
<strong><a name="2261"> 2261</a></strong>     <a href=
"../util/seccomon.h.dep.html#SECStatus">SECStatus</a> <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> = SECFailure;
<strong><a name="2262"> 2262</a></strong>
<strong><a name="2263"> 2263</a></strong>     if((to == <a href=
"../mozilla/dbm/include/ncompat.h.dep.html#NULL">NULL</a>) || (from == <a href=
"../mozilla/dbm/include/ncompat.h.dep.html#NULL">NULL</a>)) {
<strong><a name="2264"> 2264</a></strong>         return SECFailure;
<strong><a name="2265"> 2265</a></strong>     }
<strong><a name="2266"> 2266</a></strong>
<strong><a name="2267"> 2267</a></strong>     <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> = <a href=
"../util/secalgid.c.dep.html#SECOID_CopyAlgorithmID">SECOID_CopyAlgorithmID</a>(poolp, &amp;to-&gt;algorithm, &amp;from-&gt;algorithm);
<strong><a name="2268"> 2268</a></strong>     if(<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> != <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a>/selfse<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a><a href=
"../mozilla/security/nss/cmd/selfse.c.dep.html#SECSuccess">SECSuccess</a>) {
<strong><a name="2269"> 2269</a></strong>         return SECFailure;
<strong><a name="2270"> 2270</a></strong>     }
<strong><a name="2271"> 2271</a></strong>     <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> = <a href=
"../util/secitem.c.dep.html#SECITEM_CopyItem">SECITEM_CopyItem</a>(poolp, &amp;to-&gt;encryptedData, &amp;from-&gt;encryptedData);
<strong><a name="2272"> 2272</a></strong>
<strong><a name="2273"> 2273</a></strong>     return <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a>;
<strong><a name="2274"> 2274</a></strong> }
<strong><a name="2275"> 2275</a></strong>
<strong><a name="2276"> 2276</a></strong> <a href=
"../cryptohi/keythi.h.dep.html#KeyType">KeyType</a>
<strong><a name="2277"> 2277</a></strong> <a href=
"#2277">SECKEY_GetPrivateKeyType</a>(<a href=
"../cryptohi/keythi.h.dep.html#SECKEYPrivateKey">SECKEYPrivateKey</a> *<a href=
"../mozilla/security/nss/cmd/SSLsample/server.c.dep.html#privKey">privKey</a>)
<strong><a name="2278"> 2278</a></strong> {
<strong><a name="2279"> 2279</a></strong>    return <a href=
"../mozilla/security/nss/cmd/SSLsample/server.c.dep.html#privKey">privKey</a>-&gt;keyType;
<strong><a name="2280"> 2280</a></strong> }
<strong><a name="2281"> 2281</a></strong>
<strong><a name="2282"> 2282</a></strong> <a href=
"../cryptohi/keythi.h.dep.html#KeyType">KeyType</a>
<strong><a name="2283"> 2283</a></strong> <a href=
"#2283">SECKEY_GetPublicKeyType</a>(<a href=
"../cryptohi/keythi.h.dep.html#SECKEYPublicKey">SECKEYPublicKey</a> *pubKey)
<strong><a name="2284"> 2284</a></strong> {
<strong><a name="2285"> 2285</a></strong>    return pubKey-&gt;keyType;
<strong><a name="2286"> 2286</a></strong> }
<strong><a name="2287"> 2287</a></strong>
<strong><a name="2288"> 2288</a></strong> <a href=
"../cryptohi/keythi.h.dep.html#SECKEYPublicKey">SECKEYPublicKey</a>*
<strong><a name="2289"> 2289</a></strong> <a href=
"#2289">SECKEY_ImportDERPublicKey</a>(<a href=
"../util/seccomon.h.dep.html#SECItem">SECItem</a> *derKey, <a href=
"../softoken/pkcs11t.h.dep.html#CK_KEY_TYPE">CK_KEY_TYPE</a> <a href=
"../mozilla/security/nss/cmd/zlib/inftrees.c.dep.html#type">type</a>)
<strong><a name="2290"> 2290</a></strong> {
<strong><a name="2291"> 2291</a></strong>     <a href=
"../cryptohi/keythi.h.dep.html#SECKEYPublicKey">SECKEYPublicKey</a> *pubk = <a href="../mozilla/dbm/include/ncompat.h.dep.html#NULL">NULL</a>;
<strong><a name="2292"> 2292</a></strong>     <a href=
"../util/seccomon.h.dep.html#SECStatus">SECStatus</a> <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> = SECFailure;
<strong><a name="2293"> 2293</a></strong>     <a href=
"../util/seccomon.h.dep.html#SECItem">SECItem</a> newDerKey;
<strong><a name="2294"> 2294</a></strong>
<strong><a name="2295"> 2295</a></strong>     if (!derKey) {
<strong><a name="2296"> 2296</a></strong>         return <a href=
"../mozilla/dbm/include/ncompat.h.dep.html#NULL">NULL</a>;
<strong><a name="2297"> 2297</a></strong>     }
<strong><a name="2298"> 2298</a></strong>
<strong><a name="2299"> 2299</a></strong>     pubk = <a href=
"../util/secport.h.dep.html#PORT_ZNew">PORT_ZNew</a>(<a href=
"../cryptohi/keythi.h.dep.html#SECKEYPublicKey">SECKEYPublicKey</a>);
<strong><a name="2300"> 2300</a></strong>     if(pubk == <a href=
"../mozilla/dbm/include/ncompat.h.dep.html#NULL">NULL</a>) {
<strong><a name="2301"> 2301</a></strong>         goto finish;
<strong><a name="2302"> 2302</a></strong>     }
<strong><a name="2303"> 2303</a></strong>     pubk-&gt;arena = <a href=
"../util/secport.c.dep.html#PORT_NewArena">PORT_NewArena</a>(<a href=
"../util/secdert.h.dep.html#DER_DEFAULT_CHUNKSIZE">DER_DEFAULT_CHUNKSIZE</a>);
<strong><a name="2304"> 2304</a></strong>     if (<a href=
"../mozilla/dbm/include/ncompat.h.dep.html#NULL">NULL</a> == pubk-&gt;arena) {
<strong><a name="2305"> 2305</a></strong>         goto finish;
<strong><a name="2306"> 2306</a></strong>     }
<strong><a name="2307"> 2307</a></strong>     <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> = <a href=
"../util/secitem.c.dep.html#SECITEM_CopyItem">SECITEM_CopyItem</a>(pubk-&gt;arena, &amp;newDerKey, derKey);
<strong><a name="2308"> 2308</a></strong>     if (<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a>/selfse<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a><a href=
"../mozilla/security/nss/cmd/selfse.c.dep.html#SECSuccess">SECSuccess</a> != <a href="../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href="../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a>) {
<strong><a name="2309"> 2309</a></strong>         goto finish;
<strong><a name="2310"> 2310</a></strong>     }
<strong><a name="2311"> 2311</a></strong>
<strong><a name="2312"> 2312</a></strong>     pubk-&gt;pkcs11Slot = <a href=
"../mozilla/dbm/include/ncompat.h.dep.html#NULL">NULL</a>;
<strong><a name="2313"> 2313</a></strong>     pubk-&gt;pkcs11ID = <a href=
"../softoken/pkcs11t.h.dep.html#CK_INVALID_HANDLE">CK_INVALID_HANDLE</a>;
<strong><a name="2314"> 2314</a></strong>
<strong><a name="2315"> 2315</a></strong>     switch( <a href=
"../mozilla/security/nss/cmd/zlib/inftrees.c.dep.html#type">type</a> ) {
<strong><a name="2316"> 2316</a></strong>       case <a href=
"../softoken/pkcs11t.h.dep.html#CKK_RSA">CKK_RSA</a>:
<strong><a name="2317"> 2317</a></strong>         <a href=
"../cryptohi/seckey.c.dep.html#prepare_rsa_pub_key_for_asn1">prepare_rsa_pub_key_for_asn1</a>(pubk);
<strong><a name="2318"> 2318</a></strong>         <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> = <a href=
"../util/quickder.c.dep.html#SEC_QuickDERDecodeItem">SEC_QuickDERDecodeItem</a>(pubk-&gt;arena, pubk, <a href="../cryptohi/keythi.h.dep.html#SECKEY_RSAPublicKeyTemplate">SECKEY_RSAPublicKeyTemplate</a><a href="../cryptohi/seckey.c.dep.html#SECKEY_RSAPublicKeyTemplate">[1]</a>, &amp;newDerKey);
<strong><a name="2319"> 2319</a></strong>         pubk-&gt;keyType = rsaKey;
<strong><a name="2320"> 2320</a></strong>         break;
<strong><a name="2321"> 2321</a></strong>       case <a href=
"../softoken/pkcs11t.h.dep.html#CKK_DSA">CKK_DSA</a>:
<strong><a name="2322"> 2322</a></strong>         <a href=
"../cryptohi/seckey.c.dep.html#prepare_dsa_pub_key_for_asn1">prepare_dsa_pub_key_for_asn1</a>(pubk);
<strong><a name="2323"> 2323</a></strong>         <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> = <a href=
"../util/quickder.c.dep.html#SEC_QuickDERDecodeItem">SEC_QuickDERDecodeItem</a>(pubk-&gt;arena, pubk, <a href="../cryptohi/keythi.h.dep.html#SECKEY_DSAPublicKeyTemplate">SECKEY_DSAPublicKeyTemplate</a><a href="../cryptohi/seckey.c.dep.html#SECKEY_DSAPublicKeyTemplate">[1]</a>, &amp;newDerKey);
<strong><a name="2324"> 2324</a></strong>         pubk-&gt;keyType = dsaKey;
<strong><a name="2325"> 2325</a></strong>         break;
<strong><a name="2326"> 2326</a></strong>       case <a href=
"../softoken/pkcs11t.h.dep.html#CKK_DH">CKK_DH</a>:
<strong><a name="2327"> 2327</a></strong>         <a href=
"../cryptohi/seckey.c.dep.html#prepare_dh_pub_key_for_asn1">prepare_dh_pub_key_for_asn1</a>(pubk);
<strong><a name="2328"> 2328</a></strong>         <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> = <a href=
"../util/quickder.c.dep.html#SEC_QuickDERDecodeItem">SEC_QuickDERDecodeItem</a>(pubk-&gt;arena, pubk, <a href="../cryptohi/keythi.h.dep.html#SECKEY_DHPublicKeyTemplate">SECKEY_DHPublicKeyTemplate</a><a href="../cryptohi/seckey.c.dep.html#SECKEY_DHPublicKeyTemplate">[1]</a>, &amp;newDerKey);
<strong><a name="2329"> 2329</a></strong>         pubk-&gt;keyType = dhKey;
<strong><a name="2330"> 2330</a></strong>         break;
<strong><a name="2331"> 2331</a></strong>       default:
<strong><a name="2332"> 2332</a></strong>         <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> = SECFailure;
<strong><a name="2333"> 2333</a></strong>         break;
<strong><a name="2334"> 2334</a></strong>     }
<strong><a name="2335"> 2335</a></strong>
<strong><a name="2336"> 2336</a></strong> finish:
<strong><a name="2337"> 2337</a></strong>     if( <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> != <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a>/selfse<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a><a href=
"../mozilla/security/nss/cmd/selfse.c.dep.html#SECSuccess">SECSuccess</a> &amp;&amp; pubk != <a href="../mozilla/dbm/include/ncompat.h.dep.html#NULL">NULL</a>) {
<strong><a name="2338"> 2338</a></strong>         if (pubk-&gt;arena) {
<strong><a name="2339"> 2339</a></strong>             <a href=
"../util/secport.c.dep.html#PORT_FreeArena">PORT_FreeArena</a>(pubk-&gt;arena, <a href="../mozilla/nsprpub/pr/include/prtypes.h.dep.html#PR_TRUE">PR_TRUE</a>);
<strong><a name="2340"> 2340</a></strong>         }
<strong><a name="2341"> 2341</a></strong>         <a href=
"../util/secport.c.dep.html#PORT_Free">PORT_Free</a>(pubk);
<strong><a name="2342"> 2342</a></strong>         pubk = <a href=
"../mozilla/dbm/include/ncompat.h.dep.html#NULL">NULL</a>;
<strong><a name="2343"> 2343</a></strong>     }
<strong><a name="2344"> 2344</a></strong>     return pubk;
<strong><a name="2345"> 2345</a></strong> }
<strong><a name="2346"> 2346</a></strong>
<strong><a name="2347"> 2347</a></strong> <a href=
"../cryptohi/keythi.h.dep.html#SECKEYPrivateKeyList">SECKEYPrivateKeyList</a>*
<strong><a name="2348"> 2348</a></strong> <a href=
"#2348">SECKEY_NewPrivateKeyList</a>(void)
<strong><a name="2349"> 2349</a></strong> {
<strong><a name="2350"> 2350</a></strong>     <a href=
"../mozilla/nsprpub/pr/include/obsolete/protypes.h.dep.html#PRArenaPool">PRArenaPool</a> *arena = <a href="../mozilla/dbm/include/ncompat.h.dep.html#NULL">NULL</a>;
<strong><a name="2351"> 2351</a></strong>     <a href=
"../cryptohi/keythi.h.dep.html#SECKEYPrivateKeyList">SECKEYPrivateKeyList</a> *ret = <a href="../mozilla/dbm/include/ncompat.h.dep.html#NULL">NULL</a>;
<strong><a name="2352"> 2352</a></strong>
<strong><a name="2353"> 2353</a></strong>     arena = <a href=
"../util/secport.c.dep.html#PORT_NewArena">PORT_NewArena</a>(<a href=
"../util/secdert.h.dep.html#DER_DEFAULT_CHUNKSIZE">DER_DEFAULT_CHUNKSIZE</a>);
<strong><a name="2354"> 2354</a></strong>     if ( arena == <a href=
"../mozilla/dbm/include/ncompat.h.dep.html#NULL">NULL</a> ) {
<strong><a name="2355"> 2355</a></strong>         goto loser;
<strong><a name="2356"> 2356</a></strong>     }
<strong><a name="2357"> 2357</a></strong>
<strong><a name="2358"> 2358</a></strong>     ret = (<a href=
"../cryptohi/keythi.h.dep.html#SECKEYPrivateKeyList">SECKEYPrivateKeyList</a> *)<a href="../util/secport.c.dep.html#PORT_ArenaZAlloc">PORT_ArenaZAlloc</a>(arena,
<strong><a name="2359"> 2359</a></strong>                 sizeof(<a href=
"../cryptohi/keythi.h.dep.html#SECKEYPrivateKeyList">SECKEYPrivateKeyList</a>));
<strong><a name="2360"> 2360</a></strong>     if ( ret == <a href=
"../mozilla/dbm/include/ncompat.h.dep.html#NULL">NULL</a> ) {
<strong><a name="2361"> 2361</a></strong>         goto loser;
<strong><a name="2362"> 2362</a></strong>     }
<strong><a name="2363"> 2363</a></strong>
<strong><a name="2364"> 2364</a></strong>     ret-&gt;arena = arena;
<strong><a name="2365"> 2365</a></strong>
<strong><a name="2366"> 2366</a></strong>     <a href=
"../mozilla/security/nss/cmd/pk11util/pk11util.c.dep.html#list">list</a><a href="../mozilla/nsprpub/pr/include/prc.h.dep.html#PR_INIT_CLIST">PR_INIT_CLIST</a>(&amp;ret-&gt;<a href="../mozilla/security/nss/cmd/pk11util/pk11util.c.dep.html#list">list</a>);
<strong><a name="2367"> 2367</a></strong>
<strong><a name="2368"> 2368</a></strong>     return(ret);
<strong><a name="2369"> 2369</a></strong>
<strong><a name="2370"> 2370</a></strong> loser:
<strong><a name="2371"> 2371</a></strong>     if ( arena != <a href=
"../mozilla/dbm/include/ncompat.h.dep.html#NULL">NULL</a> ) {
<strong><a name="2372"> 2372</a></strong>         <a href=
"../util/secport.c.dep.html#PORT_FreeArena">PORT_FreeArena</a>(arena, <a href=
"../mozilla/nsprpub/pr/include/prtypes.h.dep.html#PR_FALSE">PR_FALSE</a>);
<strong><a name="2373"> 2373</a></strong>     }
<strong><a name="2374"> 2374</a></strong>
<strong><a name="2375"> 2375</a></strong>     return(<a href=
"../mozilla/dbm/include/ncompat.h.dep.html#NULL">NULL</a>);
<strong><a name="2376"> 2376</a></strong> }
<strong><a name="2377"> 2377</a></strong>
<strong><a name="2378"> 2378</a></strong> void
<strong><a name="2379"> 2379</a></strong> <a href=
"#2379">SECKEY_DestroyPrivateKeyList</a>(<a href=
"../cryptohi/keythi.h.dep.html#SECKEYPrivateKeyList">SECKEYPrivateKeyList</a> *keys)
<strong><a name="2380"> 2380</a></strong> {
<strong><a name="2381"> 2381</a></strong>     while( !<a href=
"../mozilla/nsprpub/pr/include/prclist.h.dep.html#PR_CLIST_IS_EMPTY">PR_CLIST_IS_EMPTY</a>(&amp;keys-&gt;<a href="../mozilla/security/nss/cmd/pk11util/pk11util.c.dep.html#list">list</a>) ) {
<strong><a name="2382"> 2382</a></strong>         <a href=
"../cryptohi/seckey.c.dep.html#SECKEY_RemovePrivateKeyListNode">SECKEY_RemovePrivateKeyListNode</a>(
<strong><a name="2383"> 2383</a></strong>             (<a href=
"../cryptohi/keythi.h.dep.html#SECKEYPrivateKeyListNode">SECKEYPrivateKeyListNode</a>*)(<a href="../mozilla/nsprpub/pr/include/prclist.h.dep.html#PR_LIST_HEAD">PR_LIST_HEAD</a>(&amp;keys-&gt;<a href="../mozilla/security/nss/cmd/pk11util/pk11util.c.dep.html#list">list</a>)) );
<strong><a name="2384"> 2384</a></strong>     }
<strong><a name="2385"> 2385</a></strong>
<strong><a name="2386"> 2386</a></strong>     <a href=
"../util/secport.c.dep.html#PORT_FreeArena">PORT_FreeArena</a>(keys-&gt;arena, <a href="../mozilla/nsprpub/pr/include/prtypes.h.dep.html#PR_FALSE">PR_FALSE</a>);
<strong><a name="2387"> 2387</a></strong>
<strong><a name="2388"> 2388</a></strong>     return;
<strong><a name="2389"> 2389</a></strong> }
<strong><a name="2390"> 2390</a></strong>
<strong><a name="2391"> 2391</a></strong>
<strong><a name="2392"> 2392</a></strong> void
<strong><a name="2393"> 2393</a></strong> <a href=
"#2393">SECKEY_RemovePrivateKeyListNode</a>(<a href=
"../cryptohi/keythi.h.dep.html#SECKEYPrivateKeyListNode">SECKEYPrivateKeyListNode</a> *node)
<strong><a name="2394"> 2394</a></strong> {
<strong><a name="2395"> 2395</a></strong>     <a href=
"../mozilla/nsprpub/pr/include/prlog.h.dep.html#PR_ASSERT">PR_ASSERT</a>(node-&gt;<a href="../mozilla/nsprpub/pr/src/cplus/tests/tpd.cpp.dep.html#key">key</a><a href="../mozilla/nsprpub/pr/tests/tpd.c.dep.html#key">[1]</a>);
<strong><a name="2396"> 2396</a></strong>     <a href=
"../mozilla/nsprpub/pr/src/cplus/tests/tpd.cpp.dep.html#key">key</a><a href=
"../mozilla/nsprpub/pr/tests/tpd.c.dep.html#key">[1]</a><a href=
"../cryptohi/sec.c.dep.html#SECKEY_DestroyPrivateKey">SECKEY_DestroyPrivateKey</a>(node-&gt;<a href="../mozilla/nsprpub/pr/src/cplus/tests/tpd.cpp.dep.html#key">key</a><a href="../mozilla/nsprpub/pr/tests/tpd.c.dep.html#key">[1]</a>);
<strong><a name="2397"> 2397</a></strong>     node-&gt;<a href=
"../mozilla/nsprpub/pr/src/cplus/tests/tpd.cpp.dep.html#key">key</a><a href=
"../mozilla/nsprpub/pr/tests/tpd.c.dep.html#key">[1]</a> = <a href=
"../mozilla/dbm/include/ncompat.h.dep.html#NULL">NULL</a>;
<strong><a name="2398"> 2398</a></strong>     <a href=
"../mozilla/nsprpub/pr/include/prclist.h.dep.html#PR_REMOVE_LINK">PR_REMOVE_LINK</a>(&amp;node-&gt;links);
<strong><a name="2399"> 2399</a></strong>     return;
<strong><a name="2400"> 2400</a></strong>
<strong><a name="2401"> 2401</a></strong> }
<strong><a name="2402"> 2402</a></strong>
<strong><a name="2403"> 2403</a></strong> <a href=
"../util/seccomon.h.dep.html#SECStatus">SECStatus</a>
<strong><a name="2404"> 2404</a></strong> <a href=
"#2404">SECKEY_AddPrivateKeyToListTail</a>( <a href=
"../cryptohi/keythi.h.dep.html#SECKEYPrivateKeyList">SECKEYPrivateKeyList</a> *<a href="../mozilla/security/nss/cmd/pk11util/pk11util.c.dep.html#list">list</a>,
<strong><a name=
"2405"> 2405</a></strong>                                 <a href=
"../mozilla/nsprpub/pr/src/cplus/tests/tpd.cpp.dep.html#key">key</a><a href=
"../mozilla/nsprpub/pr/tests/tpd.c.dep.html#key">[1]</a><a href=
"../cryptohi/thi.h.dep.html#SECKEYPrivateKey">SECKEYPrivateKey</a> *<a href=
"../mozilla/nsprpub/pr/src/cplus/tests/tpd.cpp.dep.html#key">key</a><a href=
"../mozilla/nsprpub/pr/tests/tpd.c.dep.html#key">[1]</a>)
<strong><a name="2406"> 2406</a></strong> {
<strong><a name="2407"> 2407</a></strong>     <a href=
"../cryptohi/keythi.h.dep.html#SECKEYPrivateKeyListNode">SECKEYPrivateKeyListNode</a> *node;
<strong><a name="2408"> 2408</a></strong>
<strong><a name="2409"> 2409</a></strong>     node = (<a href=
"../cryptohi/keythi.h.dep.html#SECKEYPrivateKeyListNode">SECKEYPrivateKeyListNode</a> *)<a href="../util/secport.c.dep.html#PORT_ArenaZAlloc">PORT_ArenaZAlloc</a>(<a href="../mozilla/security/nss/cmd/pk11util/pk11util.c.dep.html#list">list</a>-&gt;arena,
<strong><a name="2410"> 2410</a></strong>                 sizeof(<a href=
"../cryptohi/keythi.h.dep.html#SECKEYPrivateKeyListNode">SECKEYPrivateKeyListNode</a>));
<strong><a name="2411"> 2411</a></strong>     if ( node == <a href=
"../mozilla/dbm/include/ncompat.h.dep.html#NULL">NULL</a> ) {
<strong><a name="2412"> 2412</a></strong>         goto loser;
<strong><a name="2413"> 2413</a></strong>     }
<strong><a name="2414"> 2414</a></strong>
<strong><a name="2415"> 2415</a></strong>     <a href=
"../mozilla/security/nss/cmd/pk11util/pk11util.c.dep.html#list">list</a><a href="../mozilla/nsprpub/pr/include/prc.h.dep.html#PR_INSERT_BEFORE">PR_INSERT_BEFORE</a>(&amp;node-&gt;links, &amp;<a href="../mozilla/security/nss/cmd/pk11util/pk11util.c.dep.html#list">list</a>-&gt;<a href="../mozilla/security/nss/cmd/pk11util/pk11util.c.dep.html#list">list</a>);
<strong><a name="2416"> 2416</a></strong>     node-&gt;<a href=
"../mozilla/nsprpub/pr/src/cplus/tests/tpd.cpp.dep.html#key">key</a><a href=
"../mozilla/nsprpub/pr/tests/tpd.c.dep.html#key">[1]</a> = <a href=
"../mozilla/nsprpub/pr/src/cplus/tests/tpd.cpp.dep.html#key">key</a><a href=
"../mozilla/nsprpub/pr/tests/tpd.c.dep.html#key">[1]</a>;
<strong><a name="2417"> 2417</a></strong>     return(<a href=
"../mozilla/security/nss/cmd/selfserv/selfserv.c.dep.html#SECSuccess">SECSuccess</a>);
<strong><a name="2418"> 2418</a></strong>
<strong><a name="2419"> 2419</a></strong> loser:
<strong><a name="2420"> 2420</a></strong>     return(SECFailure);
<strong><a name="2421"> 2421</a></strong> }
<strong><a name="2422"> 2422</a></strong>
<strong><a name="2423"> 2423</a></strong>
<strong><a name="2424"> 2424</a></strong> <a href=
"../cryptohi/keythi.h.dep.html#SECKEYPublicKeyList">SECKEYPublicKeyList</a>*
<strong><a name="2425"> 2425</a></strong> <a href=
"#2425">SECKEY_NewPublicKeyList</a>(void)
<strong><a name="2426"> 2426</a></strong> {
<strong><a name="2427"> 2427</a></strong>     <a href=
"../mozilla/nsprpub/pr/include/obsolete/protypes.h.dep.html#PRArenaPool">PRArenaPool</a> *arena = <a href="../mozilla/dbm/include/ncompat.h.dep.html#NULL">NULL</a>;
<strong><a name="2428"> 2428</a></strong>     <a href=
"../cryptohi/keythi.h.dep.html#SECKEYPublicKeyList">SECKEYPublicKeyList</a> *ret = <a href="../mozilla/dbm/include/ncompat.h.dep.html#NULL">NULL</a>;
<strong><a name="2429"> 2429</a></strong>
<strong><a name="2430"> 2430</a></strong>     arena = <a href=
"../util/secport.c.dep.html#PORT_NewArena">PORT_NewArena</a>(<a href=
"../util/secdert.h.dep.html#DER_DEFAULT_CHUNKSIZE">DER_DEFAULT_CHUNKSIZE</a>);
<strong><a name="2431"> 2431</a></strong>     if ( arena == <a href=
"../mozilla/dbm/include/ncompat.h.dep.html#NULL">NULL</a> ) {
<strong><a name="2432"> 2432</a></strong>         goto loser;
<strong><a name="2433"> 2433</a></strong>     }
<strong><a name="2434"> 2434</a></strong>
<strong><a name="2435"> 2435</a></strong>     ret = (<a href=
"../cryptohi/keythi.h.dep.html#SECKEYPublicKeyList">SECKEYPublicKeyList</a> *)<a href="../util/secport.c.dep.html#PORT_ArenaZAlloc">PORT_ArenaZAlloc</a>(arena,
<strong><a name="2436"> 2436</a></strong>                 sizeof(<a href=
"../cryptohi/keythi.h.dep.html#SECKEYPublicKeyList">SECKEYPublicKeyList</a>));
<strong><a name="2437"> 2437</a></strong>     if ( ret == <a href=
"../mozilla/dbm/include/ncompat.h.dep.html#NULL">NULL</a> ) {
<strong><a name="2438"> 2438</a></strong>         goto loser;
<strong><a name="2439"> 2439</a></strong>     }
<strong><a name="2440"> 2440</a></strong>
<strong><a name="2441"> 2441</a></strong>     ret-&gt;arena = arena;
<strong><a name="2442"> 2442</a></strong>
<strong><a name="2443"> 2443</a></strong>     <a href=
"../mozilla/security/nss/cmd/pk11util/pk11util.c.dep.html#list">list</a><a href="../mozilla/nsprpub/pr/include/prc.h.dep.html#PR_INIT_CLIST">PR_INIT_CLIST</a>(&amp;ret-&gt;<a href="../mozilla/security/nss/cmd/pk11util/pk11util.c.dep.html#list">list</a>);
<strong><a name="2444"> 2444</a></strong>
<strong><a name="2445"> 2445</a></strong>     return(ret);
<strong><a name="2446"> 2446</a></strong>
<strong><a name="2447"> 2447</a></strong> loser:
<strong><a name="2448"> 2448</a></strong>     if ( arena != <a href=
"../mozilla/dbm/include/ncompat.h.dep.html#NULL">NULL</a> ) {
<strong><a name="2449"> 2449</a></strong>         <a href=
"../util/secport.c.dep.html#PORT_FreeArena">PORT_FreeArena</a>(arena, <a href=
"../mozilla/nsprpub/pr/include/prtypes.h.dep.html#PR_FALSE">PR_FALSE</a>);
<strong><a name="2450"> 2450</a></strong>     }
<strong><a name="2451"> 2451</a></strong>
<strong><a name="2452"> 2452</a></strong>     return(<a href=
"../mozilla/dbm/include/ncompat.h.dep.html#NULL">NULL</a>);
<strong><a name="2453"> 2453</a></strong> }
<strong><a name="2454"> 2454</a></strong>
<strong><a name="2455"> 2455</a></strong> void
<strong><a name="2456"> 2456</a></strong> <a href=
"#2456">SECKEY_DestroyPublicKeyList</a>(<a href=
"../cryptohi/keythi.h.dep.html#SECKEYPublicKeyList">SECKEYPublicKeyList</a> *keys)
<strong><a name="2457"> 2457</a></strong> {
<strong><a name="2458"> 2458</a></strong>     while( !<a href=
"../mozilla/nsprpub/pr/include/prclist.h.dep.html#PR_CLIST_IS_EMPTY">PR_CLIST_IS_EMPTY</a>(&amp;keys-&gt;<a href="../mozilla/security/nss/cmd/pk11util/pk11util.c.dep.html#list">list</a>) ) {
<strong><a name="2459"> 2459</a></strong>         <a href=
"../cryptohi/seckey.c.dep.html#SECKEY_RemovePublicKeyListNode">SECKEY_RemovePublicKeyListNode</a>(
<strong><a name="2460"> 2460</a></strong>             (<a href=
"../cryptohi/keythi.h.dep.html#SECKEYPublicKeyListNode">SECKEYPublicKeyListNode</a>*)(<a href="../mozilla/nsprpub/pr/include/prclist.h.dep.html#PR_LIST_HEAD">PR_LIST_HEAD</a>(&amp;keys-&gt;<a href="../mozilla/security/nss/cmd/pk11util/pk11util.c.dep.html#list">list</a>)) );
<strong><a name="2461"> 2461</a></strong>     }
<strong><a name="2462"> 2462</a></strong>
<strong><a name="2463"> 2463</a></strong>     <a href=
"../util/secport.c.dep.html#PORT_FreeArena">PORT_FreeArena</a>(keys-&gt;arena, <a href="../mozilla/nsprpub/pr/include/prtypes.h.dep.html#PR_FALSE">PR_FALSE</a>);
<strong><a name="2464"> 2464</a></strong>
<strong><a name="2465"> 2465</a></strong>     return;
<strong><a name="2466"> 2466</a></strong> }
<strong><a name="2467"> 2467</a></strong>
<strong><a name="2468"> 2468</a></strong>
<strong><a name="2469"> 2469</a></strong> void
<strong><a name="2470"> 2470</a></strong> <a href=
"#2470">SECKEY_RemovePublicKeyListNode</a>(<a href=
"../cryptohi/keythi.h.dep.html#SECKEYPublicKeyListNode">SECKEYPublicKeyListNode</a> *node)
<strong><a name="2471"> 2471</a></strong> {
<strong><a name="2472"> 2472</a></strong>     <a href=
"../mozilla/nsprpub/pr/include/prlog.h.dep.html#PR_ASSERT">PR_ASSERT</a>(node-&gt;<a href="../mozilla/nsprpub/pr/src/cplus/tests/tpd.cpp.dep.html#key">key</a><a href="../mozilla/nsprpub/pr/tests/tpd.c.dep.html#key">[1]</a>);
<strong><a name="2473"> 2473</a></strong>     <a href=
"../mozilla/nsprpub/pr/src/cplus/tests/tpd.cpp.dep.html#key">key</a><a href=
"../mozilla/nsprpub/pr/tests/tpd.c.dep.html#key">[1]</a><a href=
"../cryptohi/sec.c.dep.html#SECKEY_DestroyPublicKey">SECKEY_DestroyPublicKey</a>(node-&gt;<a href="../mozilla/nsprpub/pr/src/cplus/tests/tpd.cpp.dep.html#key">key</a><a href="../mozilla/nsprpub/pr/tests/tpd.c.dep.html#key">[1]</a>);
<strong><a name="2474"> 2474</a></strong>     node-&gt;<a href=
"../mozilla/nsprpub/pr/src/cplus/tests/tpd.cpp.dep.html#key">key</a><a href=
"../mozilla/nsprpub/pr/tests/tpd.c.dep.html#key">[1]</a> = <a href=
"../mozilla/dbm/include/ncompat.h.dep.html#NULL">NULL</a>;
<strong><a name="2475"> 2475</a></strong>     <a href=
"../mozilla/nsprpub/pr/include/prclist.h.dep.html#PR_REMOVE_LINK">PR_REMOVE_LINK</a>(&amp;node-&gt;links);
<strong><a name="2476"> 2476</a></strong>     return;
<strong><a name="2477"> 2477</a></strong>
<strong><a name="2478"> 2478</a></strong> }
<strong><a name="2479"> 2479</a></strong>
<strong><a name="2480"> 2480</a></strong> <a href=
"../util/seccomon.h.dep.html#SECStatus">SECStatus</a>
<strong><a name="2481"> 2481</a></strong> <a href=
"#2481">SECKEY_AddPublicKeyToListTail</a>( <a href=
"../cryptohi/keythi.h.dep.html#SECKEYPublicKeyList">SECKEYPublicKeyList</a> *<a href="../mozilla/security/nss/cmd/pk11util/pk11util.c.dep.html#list">list</a>,
<strong><a name=
"2482"> 2482</a></strong>                                 <a href=
"../mozilla/nsprpub/pr/src/cplus/tests/tpd.cpp.dep.html#key">key</a><a href=
"../mozilla/nsprpub/pr/tests/tpd.c.dep.html#key">[1]</a><a href=
"../cryptohi/thi.h.dep.html#SECKEYPublicKey">SECKEYPublicKey</a> *<a href=
"../mozilla/nsprpub/pr/src/cplus/tests/tpd.cpp.dep.html#key">key</a><a href=
"../mozilla/nsprpub/pr/tests/tpd.c.dep.html#key">[1]</a>)
<strong><a name="2483"> 2483</a></strong> {
<strong><a name="2484"> 2484</a></strong>     <a href=
"../cryptohi/keythi.h.dep.html#SECKEYPublicKeyListNode">SECKEYPublicKeyListNode</a> *node;
<strong><a name="2485"> 2485</a></strong>
<strong><a name="2486"> 2486</a></strong>     node = (<a href=
"../cryptohi/keythi.h.dep.html#SECKEYPublicKeyListNode">SECKEYPublicKeyListNode</a> *)<a href="../util/secport.c.dep.html#PORT_ArenaZAlloc">PORT_ArenaZAlloc</a>(<a href="../mozilla/security/nss/cmd/pk11util/pk11util.c.dep.html#list">list</a>-&gt;arena,
<strong><a name="2487"> 2487</a></strong>                 sizeof(<a href=
"../cryptohi/keythi.h.dep.html#SECKEYPublicKeyListNode">SECKEYPublicKeyListNode</a>));
<strong><a name="2488"> 2488</a></strong>     if ( node == <a href=
"../mozilla/dbm/include/ncompat.h.dep.html#NULL">NULL</a> ) {
<strong><a name="2489"> 2489</a></strong>         goto loser;
<strong><a name="2490"> 2490</a></strong>     }
<strong><a name="2491"> 2491</a></strong>
<strong><a name="2492"> 2492</a></strong>     <a href=
"../mozilla/security/nss/cmd/pk11util/pk11util.c.dep.html#list">list</a><a href="../mozilla/nsprpub/pr/include/prc.h.dep.html#PR_INSERT_BEFORE">PR_INSERT_BEFORE</a>(&amp;node-&gt;links, &amp;<a href="../mozilla/security/nss/cmd/pk11util/pk11util.c.dep.html#list">list</a>-&gt;<a href="../mozilla/security/nss/cmd/pk11util/pk11util.c.dep.html#list">list</a>);
<strong><a name="2493"> 2493</a></strong>     node-&gt;<a href=
"../mozilla/nsprpub/pr/src/cplus/tests/tpd.cpp.dep.html#key">key</a><a href=
"../mozilla/nsprpub/pr/tests/tpd.c.dep.html#key">[1]</a> = <a href=
"../mozilla/nsprpub/pr/src/cplus/tests/tpd.cpp.dep.html#key">key</a><a href=
"../mozilla/nsprpub/pr/tests/tpd.c.dep.html#key">[1]</a>;
<strong><a name="2494"> 2494</a></strong>     return(<a href=
"../mozilla/security/nss/cmd/selfserv/selfserv.c.dep.html#SECSuccess">SECSuccess</a>);
<strong><a name="2495"> 2495</a></strong>
<strong><a name="2496"> 2496</a></strong> loser:
<strong><a name="2497"> 2497</a></strong>     return(SECFailure);
<strong><a name="2498"> 2498</a></strong> }
<strong><a name="2499"> 2499</a></strong>
<strong><a name="2500"> 2500</a></strong> #define <a href=
"#2500">SECKEY_CacheAttribute</a>(<a href=
"../mozilla/nsprpub/pr/src/cplus/tests/tpd.cpp.dep.html#key">key</a><a href=
"../mozilla/nsprpub/pr/tests/tpd.c.dep.html#key">[1]</a>, attribute) \
<strong><a name="2501"> 2501</a></strong>     if (<a href=
"../softoken/pkcs11t.h.dep.html#CK_TRUE">CK_TRUE</a><a href=
"../mozilla/security/nss/tests/pkcs11/netscape/trivial/trivial.c.dep.html#CK_TRUE">[1]</a> == <a href="../pk11wrap/pk11obj.c.dep.html#PK11_HasAttributeSet">PK11_HasAttributeSet</a>(<a href="../mozilla/nsprpub/pr/src/cplus/tests/tpd.cpp.dep.html#key">key</a><a href="../mozilla/nsprpub/pr/tests/tpd.c.dep.html#key">[1]</a>-&gt;pkcs11Slot, <a href="../mozilla/nsprpub/pr/src/cplus/tests/tpd.cpp.dep.html#key">key</a><a href="../mozilla/nsprpub/pr/tests/tpd.c.dep.html#key">[1]</a>-&gt;pkcs11ID, attribute)) { \
<strong><a name="2502"> 2502</a></strong>         <a href=
"../mozilla/nsprpub/pr/src/cplus/tests/tpd.cpp.dep.html#key">key</a><a href=
"../mozilla/nsprpub/pr/tests/tpd.c.dep.html#key">[1]</a>-&gt;staticflags |= SECKEY_##attribute; \
<strong><a name="2503"> 2503</a></strong>     } else { \
<strong><a name="2504"> 2504</a></strong>         <a href=
"../mozilla/nsprpub/pr/src/cplus/tests/tpd.cpp.dep.html#key">key</a><a href=
"../mozilla/nsprpub/pr/tests/tpd.c.dep.html#key">[1]</a>-&gt;staticflags &amp;= (~SECKEY_##attribute); \
<strong><a name="2505"> 2505</a></strong>     }
<strong><a name="2506"> 2506</a></strong>
<strong><a name="2507"> 2507</a></strong> <a href=
"../util/seccomon.h.dep.html#SECStatus">SECStatus</a>
<strong><a name="2508"> 2508</a></strong> <a href=
"#2508">SECKEY_CacheStaticFlags</a>(<a href=
"../mozilla/nsprpub/pr/src/cplus/tests/tpd.cpp.dep.html#key">key</a><a href=
"../mozilla/nsprpub/pr/tests/tpd.c.dep.html#key">[1]</a><a href=
"../cryptohi/thi.h.dep.html#SECKEYPrivateKey">SECKEYPrivateKey</a>* <a href=
"../mozilla/nsprpub/pr/src/cplus/tests/tpd.cpp.dep.html#key">key</a><a href=
"../mozilla/nsprpub/pr/tests/tpd.c.dep.html#key">[1]</a>)
<strong><a name="2509"> 2509</a></strong> {
<strong><a name="2510"> 2510</a></strong>     <a href=
"../util/seccomon.h.dep.html#SECStatus">SECStatus</a> <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> = SECFailure;
<strong><a name="2511"> 2511</a></strong>     if (<a href=
"../mozilla/nsprpub/pr/src/cplus/tests/tpd.cpp.dep.html#key">key</a><a href=
"../mozilla/nsprpub/pr/tests/tpd.c.dep.html#key">[1]</a> &amp;&amp; <a href=
"../mozilla/nsprpub/pr/src/cplus/tests/tpd.cpp.dep.html#key">key</a><a href=
"../mozilla/nsprpub/pr/tests/tpd.c.dep.html#key">[1]</a>-&gt;pkcs11Slot &amp;&amp; <a href="../mozilla/nsprpub/pr/src/cplus/tests/tpd.cpp.dep.html#key">key</a><a href="../mozilla/nsprpub/pr/tests/tpd.c.dep.html#key">[1]</a>-&gt;pkcs11ID) {
<strong><a name="2512"> 2512</a></strong>         <a href=
"../mozilla/nsprpub/pr/src/cplus/tests/tpd.cpp.dep.html#key">key</a><a href=
"../mozilla/nsprpub/pr/tests/tpd.c.dep.html#key">[1]</a>-&gt;staticflags |= <a href="../mozilla/nsprpub/pr/src/cplus/tests/tpd.cpp.dep.html#key">key</a><a href="../mozilla/nsprpub/pr/tests/tpd.c.dep.html#key">[1]</a><a href="../cryptohi/thi.h.dep.html#SECKEY_Attributes_Cached">SECKEY_Attributes_Cached</a>;
<strong><a name="2513"> 2513</a></strong>         <a href=
"../mozilla/nsprpub/pr/src/cplus/tests/tpd.cpp.dep.html#key">key</a><a href=
"../mozilla/nsprpub/pr/tests/tpd.c.dep.html#key">[1]</a><a href=
"../cryptohi/sec.c.dep.html#SECKEY_CacheAttribute">SECKEY_CacheAttribute</a>(<a href="../mozilla/nsprpub/pr/src/cplus/tests/tpd.cpp.dep.html#key">key</a><a href="../mozilla/nsprpub/pr/tests/tpd.c.dep.html#key">[1]</a>, <a href="../softoken/pkcs11t.h.dep.html#CKA_PRIVATE">CKA_PRIVATE</a>);
<strong><a name="2514"> 2514</a></strong>         <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a> = <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a>/selfse<a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a><a href=
"../mozilla/security/nss/cmd/selfse.c.dep.html#SECSuccess">SECSuccess</a>;
<strong><a name="2515"> 2515</a></strong>     }
<strong><a name="2516"> 2516</a></strong>     return <a href=
"../mozilla/nsprpub/pr/tests/accept.c.dep.html#rv">rv</a><a href=
"../mozilla/nsprpub/pr/tests/sleep.c.dep.html#rv">[1]</a>;
<strong><a name="2517"> 2517</a></strong> }
</pre>



<?
require_once "{$config['file_root']}/includes/footer.inc.php"
?>
